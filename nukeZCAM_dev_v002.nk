#! /Applications/Nuke13.0v3/Nuke13.0v3.app/Contents/MacOS/libnuke-13.0.3.dylib -nx
version 13.0 v3
define_window_layout_xml {<?xml version="1.0" encoding="UTF-8"?>
<layout version="1.0">
    <window x="0" y="25" w="3008" h="1562" maximized="1" screen="0">
        <splitter orientation="1">
            <split size="40"/>
            <dock id="" hideTitles="1" activePageId="Toolbar.1">
                <page id="Toolbar.1"/>
            </dock>
            <split size="2345" stretch="1"/>
            <splitter orientation="2">
                <split size="905"/>
                <dock id="" activePageId="Viewer.1">
                    <page id="Viewer.1"/>
                </dock>
                <split size="637"/>
                <dock id="" activePageId="DAG.1" focus="true">
                    <page id="DAG.1"/>
                    <page id="Curve Editor.1"/>
                    <page id="DopeSheet.1"/>
                </dock>
            </splitter>
            <split size="615"/>
            <dock id="" activePageId="Properties.1">
                <page id="Properties.1"/>
                <page id="uk.co.thefoundry.backgroundrenderview.1"/>
                <page id="uk.co.thefoundry.scripteditor.1"/>
            </dock>
        </splitter>
    </window>
</layout>
}
Root {
 inputs 0
 name /Users/afry/GitHub/nukeZCAM/nukeZCAM_dev_v002.nk
 mapsize {0.1093260188 0.09103641457}
 frame 3
 first_frame 0
 last_frame 1023
 format "2048 1556 0 0 2048 1556 1 2K_Super_35(full-ap)"
 proxy_type scale
 proxy_format "1024 778 0 0 1024 778 1 1K_Super_35(full-ap)"
 colorManagement Nuke
 OCIO_config custom
 customOCIOConfigPath /Users/afry/Documents/GitHub/OpenColorIO-Configs/aces_1.2/config.ocio
 workingSpaceLUT linear
 monitorLut sRGB
 monitorOutLUT rec709
 int8Lut sRGB
 int16Lut sRGB
 logLut Cineon
 floatLut linear
}
BackdropNode {
 inputs 0
 name BackdropNode1
 label "writeNode = nuke.toNode('Write4')\nreadNode = nuke.toNode('Read68')\n\n\nfor i in range(0,1024):\n    nuke.execute(writeNode, i, i)\n    readNode.knob('reload').execute()"
 xpos 608
 ypos 1684
 bdwidth 196
 bdheight 107
}
Shuffle2 {
 inputs 0
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 name Shuffle1
 xpos 1207
 ypos 189
}
Reformat {
 inputs 0
 type "to box"
 format "256 256 0 0 256 256 1 square_256"
 box_width 256
 box_height 256
 box_fixed true
 name Reformat1
 xpos -1424
 ypos 314
}
Ramp {
 p0 {0 0}
 p1 {{width i} 0}
 name Ramp2
 xpos -1424
 ypos 338
}
Grade {
 white {1.399999976 0.5600000024 1 1}
 gamma {0.6100000143 1.320000052 0.6499999762 1}
 name Grade2
 xpos -1424
 ypos 362
}
Expression {
 expr0 "y==floor(r(x, pos.y)*height*mult)?1:0"
 expr1 "y==floor(g(x, pos.y)*height*mult)?1:0"
 expr2 "y==floor(b(x, pos.y)*height*mult)?1:0"
 channel3 alpha
 name PlotScanline
 xpos -1424
 ypos 423
 addUserKnob {20 User}
 addUserKnob {12 pos}
 addUserKnob {7 mult R 0 5}
 mult 1
}
Constant {
 inputs 0
 channels rgb
 color 0.18
 name Constant2
 xpos 62
 ypos -684
}
set N1faecc00 [stack 0]
EXPTool {
 mode Stops
 red 1
 green 1
 blue 1
 name Exposure1
 xpos -46
 ypos -611
}
push $N1faecc00
Expression {
 temp_name0 stop
 temp_expr0 1
 channel0 rgba
 expr0 r*pow(2,1)
 name Expression2
 xpos 62
 ypos -612
}
Reformat {
 inputs 0
 format "1024 1024 0 0 1024 1024 1 square_1K"
 name Reformat2
 xpos 156
 ypos -685
}
Expression {
 channel0 rgba
 expr0 .18*pow(2,(cx*7))
 name Expression1
 xpos 156
 ypos -653
}
Ramp {
 p0 {0 0}
 p1 {{width} 0}
 color 20
 name Ramp1
 xpos 156
 ypos -612
 disable true
}
Colorspace {
 inputs 0
 primary_out DCI-P3
 name VIEWER_INPUT
 xpos 1528
 ypos 324
}
Reformat {
 inputs 0
 format "1024 1024 0 0 1024 1024 1 square_1K"
 name Reformat6
 xpos 7539
 ypos -514
}
set N1fa8a800 [stack 0]
Crop {
 box {0 0 1024 {height/7}}
 reformat true
 crop false
 name Crop1
 xpos 7703
 ypos -494
}
set N1fa8a000 [stack 0]
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 white -1 -1 rgba.red 0 0 white -1 -1 rgba.green 0 1 black -1 -1 rgba.blue 0 2 rgba.alpha 0 3 rgba.alpha 0 3"
 name Shuffle23
 xpos 8336
 ypos -449
}
push $N1fa8a000
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 white -1 -1 rgba.red 0 0 black -1 -1 rgba.green 0 1 white -1 -1 rgba.blue 0 2 rgba.alpha 0 3 rgba.alpha 0 3"
 name Shuffle22
 xpos 8230
 ypos -444
}
push $N1fa8a000
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 black -1 -1 rgba.red 0 0 white -1 -1 rgba.green 0 1 white -1 -1 rgba.blue 0 2 rgba.alpha 0 3 rgba.alpha 0 3"
 name Shuffle24
 xpos 8108
 ypos -438
}
push $N1fa8a000
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 black -1 -1 rgba.red 0 0 black -1 -1 rgba.green 0 1 white -1 -1 rgba.blue 0 2 rgba.alpha 0 3 rgba.alpha 0 3"
 name Shuffle21
 xpos 7989
 ypos -440
}
push $N1fa8a000
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 black -1 -1 rgba.red 0 0 white -1 -1 rgba.green 0 1 black -1 -1 rgba.blue 0 2 rgba.alpha 0 3 rgba.alpha 0 3"
 name Shuffle20
 xpos 7888
 ypos -442
}
push $N1fa8a000
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 white -1 -1 rgba.red 0 0 black -1 -1 rgba.green 0 1 black -1 -1 rgba.blue 0 2 rgba.alpha 0 3 rgba.alpha 0 3"
 name Shuffle19
 xpos 7796
 ypos -440
}
push $N1fa8a000
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 white -1 -1 rgba.red 0 0 white -1 -1 rgba.green 0 1 white -1 -1 rgba.blue 0 2 rgba.alpha 0 3 rgba.alpha 0 3"
 name Shuffle18
 xpos 7703
 ypos -440
}
ContactSheet {
 inputs 7
 width 1024
 height 1024
 rows 7
 columns 1
 name ContactSheet2
 xpos 7709
 ypos -367
}
push $N1fa8a800
Expression {
 channel0 rgba
 expr0 .18*pow(2,(cx*7))
 name Expression7
 xpos 7539
 ypos -482
}
Merge2 {
 inputs 2
 operation multiply
 name Multiply
 xpos 7539
 ypos -362
}
Colorspace {
 primary_out ACES
 name Colorspace10
 xpos 7539
 ypos -338
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/troy-sobotka/ACEScg-notorious-primary-r-b.exr"
 format "960 540 0 0 960 540 1 "
 origset true
 name Read28
 xpos 7196
 ypos -520
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/troy-sobotka/ACEScg-notorious-primary-g.exr"
 format "960 540 0 0 960 540 1 "
 origset true
 name Read27
 xpos 7086
 ypos -520
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/troy-sobotka/ACEScg-notorious-primary-g-r.exr"
 format "960 540 0 0 960 540 1 "
 origset true
 name Read26
 xpos 6976
 ypos -520
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/troy-sobotka/ACEScg-notorious-primary-g-b.exr"
 format "960 540 0 0 960 540 1 "
 origset true
 name Read25
 xpos 6866
 ypos -520
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/troy-sobotka/ACEScg-notorious-primary-b.exr"
 format "960 540 0 0 960 540 1 "
 origset true
 name Read24
 xpos 6756
 ypos -520
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/troy-sobotka/ACEScg-notorious-primary-b-r.exr"
 format "960 540 0 0 960 540 1 "
 origset true
 name Read23
 xpos 6646
 ypos -520
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/troy-sobotka/ACEScg-notorious-primary-b-g.exr"
 format "960 540 0 0 960 540 1 "
 origset true
 name Read22
 xpos 6536
 ypos -520
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/troy-sobotka/ACEScg-notorious-primary-r.exr"
 format "960 540 0 0 960 540 1 "
 origset true
 name Read32
 xpos 6416
 ypos -517
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/troy-sobotka/ACEScg-notorious-primary-r-g.exr"
 format "960 540 0 0 960 540 1 "
 origset true
 name Read29
 xpos 6306
 ypos -517
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0022.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read59
 xpos 6131
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0021.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read58
 xpos 6021
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0020.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read57
 xpos 5911
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0019.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read56
 xpos 5801
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0018.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read55
 xpos 5691
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0017.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read54
 xpos 5581
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0016.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read53
 xpos 5471
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0015.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read52
 xpos 5361
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0014.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read51
 xpos 5251
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0013.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read50
 xpos 5141
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0012.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read49
 xpos 5031
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0011.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read48
 xpos 4921
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0010.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read47
 xpos 4811
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0009.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read46
 xpos 4701
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0008.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read45
 xpos 4591
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0007.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read44
 xpos 4481
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0006.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read43
 xpos 4371
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0005.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read42
 xpos 4261
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0004.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read41
 xpos 4151
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0003.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read40
 xpos 4041
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0002.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read38
 xpos 3931
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0001.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read34
 xpos 3821
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/jed-smith/jedsmith_colorchecker24_streaks_flat.aces.exr"
 format "1152 576 0 0 1152 576 1 "
 origset true
 name Read39
 xpos 3642
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/jed-smith/acescg_hueswatches_24.aces.exr"
 format "2048 768 0 0 2048 768 1 "
 origset true
 name Read33
 xpos 3497
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/jed-smith/jedsmith_colorchecker24_streaks_6ev.aces.exr"
 format "1152 576 0 0 1152 576 1 "
 origset true
 name Read37
 xpos 3339
 ypos -516
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/jed-smith/jedsmith_2020-08-20-06h43m50_riviere-au-tonnerre_sunrise.2048x1024.aces.exr"
 format "2048 1024 0 0 2048 1024 1 2K_LatLong"
 origset true
 name Read36
 xpos 3232
 ypos -515
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/jed-smith/jedsmith_2020-01-07-09h24_snowy_sunrise.2048x1024.aces.exr"
 format "2048 1024 0 0 2048 1024 1 2K_LatLong"
 origset true
 name Read35
 xpos 3122
 ypos -515
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/christophe-brejon/louise_sun_001_lin_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read31
 xpos 2989
 ypos -528
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/christophe-brejon/louise_concert_001_lin_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read30
 xpos 2856
 ypos -529
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/monsieur-lixm/fx_explosion_lookdev_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read21
 xpos 2715
 ypos -528
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/monsieur-lixm/dragonscene_ap0_v01_1003.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read20
 xpos 2605
 ypos -528
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/monsieur-lixm/dragonscene_ap0_v01_1002.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read19
 xpos 2495
 ypos -528
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/monsieur-lixm/dragonscene_ap0_v01_1001.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read18
 xpos 2385
 ypos -528
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/aces-exr-1920/christophe-brejon/sunny_spheres_001_lin_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read17
 xpos 2238
 ypos -530
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/aces-exr-1920/christophe-brejon/red_volumetric_002_lin_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read16
 xpos 2129
 ypos -531
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/aces-exr-1920/christophe-brejon/red_volumetric_001_lin_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read15
 xpos 2019
 ypos -531
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/aces-exr-1920/christophe-brejon/macbeth_spheres_001_lin_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read14
 xpos 1909
 ypos -531
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/aces-exr-1920/christophe-brejon/light_sabers_003_lin_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read13
 xpos 1799
 ypos -531
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/aces-exr-1920/christophe-brejon/light_sabers_002_lin_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read12
 xpos 1689
 ypos -531
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/aces-exr-1920/christophe-brejon/light_sabers_001_lin_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read11
 xpos 1579
 ypos -531
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/aces-exr-1920/christophe-brejon/glowing_spheres_002_lin_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read10
 xpos 1469
 ypos -531
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/aces-exr-1920/christophe-brejon/glowing_spheres_001_lin_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read9
 xpos 1359
 ypos -531
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/aces-exr-1920/christophe-brejon/cornell_box_001_lin_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read8
 xpos 1249
 ypos -531
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/aces-exr-1920/christophe-brejon/blue_volumetric_002_lin_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read7
 xpos 1139
 ypos -531
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/aces-exr-1920/christophe-brejon/blue_volumetric_001_lin_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read6
 xpos 1029
 ypos -531
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/aces-exr-1920/christophe-brejon/biped_jelly_001_lin_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read5
 xpos 919
 ypos -531
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/aces-exr-1920/aces_2048x1080_graded.00304.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read4
 xpos 806
 ypos -532
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/aces-exr-1920/RED_Christmas_ACES_via_RWG.exr"
 format "4096 2160 0 0 4096 2160 1 4K_DCP"
 origset true
 name Read3
 xpos 709
 ypos -528
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/images/TheLegoMovie_OT_VWG_zmk17_020_aces.0287.exr"
 format "2000 824 0 0 2000 824 1 kragle(Overscan)"
 origset true
 raw true
 name Read1
 xpos 613
 ypos -528
}
Switch {
 inputs 59
 which {{frame-1}}
 name Switch1
 label "\[value inputs]"
 xpos 710
 ypos -369
}
Reformat {
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 resize fit
 black_outside true
 name Reformat3
 xpos 710
 ypos -345
}
Saturation {
 saturation 4
 name Saturation3
 xpos 710
 ypos -290
 disable true
}
set Nb9c4ac00 [stack 0]
EXPTool {
 mode Stops
 red 5
 green 5
 blue 5
 name Exposure4
 xpos 771
 ypos -233
}
push $Nb9c4ac00
Dot {
 name Dot14
 xpos 742
 ypos -228
}
push $Nb9c4ac00
EXPTool {
 mode Stops
 red -3
 green -3
 blue -3
 name Exposure3
 xpos 643
 ypos -233
}
ContactSheet {
 inputs 3
 width {{input.width*columns}}
 height {{input.height*rows}}
 columns 1
 roworder TopBottom
 name ContactSheet5
 xpos 705
 ypos -203
}
Dot {
 name Dot2
 xpos 739
 ypos -171
}
set N314eec00 [stack 0]
Colorspace {
 primary_in ACES
 colorspace_out CIE-XYZ
 name Colorspace3
 label "ACES to XYZ"
 xpos 705
 ypos -143
}
Dot {
 name Dot4
 xpos 739
 ypos -88
}
set N314ee400 [stack 0]
Multiply {
 value 100
 name Multiply3
 label "Mult by 100 to put in absolute nits"
 xpos 705
 ypos -70
}
Dot {
 name Dot1
 xpos 739
 ypos -28
}
Group {
 name ZCAM
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos 705
 ypos -1
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set N314ed000 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set N3148b800 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $N3148b800
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set N31463900 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $N31463900
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set N31489c00 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set N31489800 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $N31489c00
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set N31488c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set N31488800 [stack 0]
push $N31489c00
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set N31488400 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set N3141bc00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set N3141b800 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set N3141b400 [stack 0]
add_layer {zcam zcam.J zcam.Q zcam.M zcam.C}
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $N31489800
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $N31489c00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $N31489c00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $N31489c00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $N314ed000
push $N31489800
push $N31488c00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set N31419800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
add_layer {zcam_bM zcam_bM.red zcam_bM.green zcam_bM.blue zcam_bM.alpha}
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $N31419800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
add_layer {zcam_aM zcam_aM.red zcam_aM.green zcam_aM.blue zcam_aM.alpha}
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $N31489800
push $N31488800
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set N31418400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
add_layer {zcam_bC zcam_bC.red zcam_bC.green zcam_bC.blue zcam_bC.alpha}
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $N31418400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
add_layer {zcam_aC zcam_aC.red zcam_aC.green zcam_aC.blue zcam_aC.alpha}
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $N31489800
push $N31488400
push $N31488c00
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set N3139e800 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set N3139e400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
add_layer {zcam_bS zcam_bS.red zcam_bS.green zcam_bS.blue zcam_bS.alpha}
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $N3139e400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
add_layer {zcam_aS zcam_aS.red zcam_aS.green zcam_aS.blue zcam_aS.alpha}
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $N3141b800
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
add_layer {zcam_Vz zcam_Vz.red zcam_Vz.green zcam_Vz.blue zcam_Vz.alpha}
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $N3139e800
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
add_layer {zcam_Sz zcam_Sz.red zcam_Sz.green zcam_Sz.blue zcam_Sz.alpha}
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $N3141b800
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
add_layer {zcam_Kz zcam_Kz.red zcam_Kz.green zcam_Kz.blue zcam_Kz.alpha}
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $N3141b400
add_layer {zcam_Wz zcam_Wz.red zcam_Wz.green zcam_Wz.blue zcam_Wz.alpha}
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $N3139e800
add_layer {zcam_s zcam_s.red zcam_s.green zcam_s.blue zcam_s.alpha}
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $N31488800
add_layer {zcam_C zcam_C.red zcam_C.green zcam_C.blue zcam_C.alpha}
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $N3141bc00
add_layer {zcam_J zcam_J.red zcam_J.green zcam_J.blue zcam_J.alpha}
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $N31488c00
add_layer {zcam_M zcam_M.red zcam_M.green zcam_M.blue zcam_M.alpha}
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $N31488400
add_layer {zcam_Q zcam_Q.red zcam_Q.green zcam_Q.blue zcam_Q.alpha}
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $N31489800
add_layer {zcam_h zcam_h.red zcam_h.green zcam_h.blue zcam_h.alpha}
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $N314ed000
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set N316fd000 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set N316fc400 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $N316fc400
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $N316fd000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $N316fd000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $N316fd000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set N3168a800 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set N31689c00 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $N31689c00
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $N31689c00
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set N31688c00 [stack 0]
push $N31688c00
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $N316fd000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $N316fd000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $N3168a800
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set N31645c00 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $N31645c00
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $N31645c00
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set N319fb900 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set N31644c00 [stack 0]
 Dot {
  name Dot44
  label C,h
  selected true
  xpos -1673
  ypos 2768
 }
push $N319fb900
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set N31644400 [stack 0]
 Dot {
  name Dot20
  label M,h
  selected true
  xpos -1737
  ypos 2767
 }
push $N319fb900
push $N316fd000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set N319e3400 [stack 0]
push $N316fd000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set N319e2800 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set N319fb200 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $N31644c00
push $N31644400
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set N319e0c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $N319e0c00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $N319fb200
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set N31972800 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $N31972800
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set N319fa400 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $N319fa400
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $N316fd000
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $N316fd000
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $N316fd000
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $N319fb200
push $N316fd000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $N3168a800
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $N319e3400
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $N319e2800
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $N319fb900
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
set N314e2b00 [stack 0]
Shuffle2 {
 fromInput1 {{0} B}
 in1 zcam_J
 fromInput2 {{0} B}
 mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
 name Shuffle2
 xpos 493
 ypos 50
}
Multiply {
 value {{1/parent.Multiply3.value}}
 name Multiply1
 label "Div by 100 to go from nits"
 xpos 493
 ypos 74
}
set N31904400 [stack 0]
ColorLookup {
 channels all
 lut {master {curve 0 x0.1089436561 0.0001599900424 x0.1538826674 0.0009879767895 x0.1697753966 0.001544326544 x0.1965807676 0.003412183374 x0.2212548852 0.005426112562 x0.2435974032 0.008081480861 x0.2744711637 0.01256972551 x0.335355252 0.02871714532 x0.3656598926 0.03916549683 x0.4067366123 0.05721262097 x0.451582104 0.08475825191 x0.5436673164 0.1626603603 x0.6915633678 0.3178277612 x0.7352961302 0.373636854 x0.8164004087 0.4692798555 x0.8752408028 0.5275940299 x0.9309006333 0.5828329325 x0.9754681587 0.6187173724 x1.033632636 0.6637632847 x1.16960156 0.745464921 x1.235319972 0.7762671709 x1.356181145 0.8217196465 x1.508617401 0.8695153594 x1.637787938 0.8979744911 x1.822932601 0.9321763515 x1.905457973 0.9441890717 x2.068963289 0.9626951218 x2.316649675 0.9837986231 x2.455148697 0.9925647378 x2.621634722 1}
   red {}
   green {}
   blue {}
   alpha {}}
 name ColorLookup4
 xpos 493
 ypos 116
}
Gamma {
 value 2.2
 name Gamma1
 xpos 493
 ypos 148
}
Multiply {
 value {{parent.Multiply3.value}}
 name Multiply4
 label "Mult by 100 to put in absolute nits"
 xpos 493
 ypos 180
}
Shuffle2 {
 fromInput1 {{0} B}
 out1 zcam_J
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
 name Shuffle3
 xpos 493
 ypos 222
}
push $N314e2b00
Copy {
 inputs 2
 from0 -rgba.alpha
 to0 -rgba.alpha
 channels zcam_J
 name Copy1
 xpos 706
 ypos 213
}
set N318aec00 [stack 0]
Shuffle2 {
 fromInput1 {{0} B}
 in1 zcam_J
 fromInput2 {{0} B}
 in2 zcam_M
 mappings "4 black -1 -1 rgba.red 0 0 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3 zcam_M.green 1 1 rgba.green 0 1"
 name Shuffle5
 xpos 1002
 ypos 243
}
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 in2 zcam_h
 mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.alpha 0 3 rgba.alpha 0 3 zcam_h.blue 1 2 rgba.blue 0 2"
 name Shuffle6
 xpos 1002
 ypos 267
}
push $N314eec00
PositionToPoints2 {
 inputs 2
 display textured
 render_mode textured
 detail 1
 pointSize 1
 name PositionToPoints1
 xpos 1002
 ypos 326
}
Reformat {
 inputs 0
 format "1024 1024 0 0 1024 1024 1 square_1K"
 name Reformat4
 xpos -200
 ypos 89
}
Expression {
 channel0 zcam_J
 expr0 100
 channel1 zcam_M
 expr1 y/height*100
 channel2 zcam_h
 expr2 cx*180
 name Expression3
 xpos -200
 ypos 121
}
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.blue 0 2 white -1 -1 rgba.alpha 0 3"
 name Shuffle9
 xpos -200
 ypos 145
}
Group {
 name ZCAM2
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos -200
 ypos 169
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 direction inverse
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 inverseData1 M,h
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set N318ac400 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set N31822c00 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $N31822c00
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set N31846400 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $N31846400
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set N31821000 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set N31820c00 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $N31821000
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set N317c7c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set N317c7800 [stack 0]
push $N31821000
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set N317c7400 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set N317c7000 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set N317c6c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set N317c6800 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $N31820c00
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $N31821000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $N31821000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $N31821000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $N318ac400
push $N31820c00
push $N317c7c00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set N317c4c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $N317c4c00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $N31820c00
push $N317c7800
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set N31753400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $N31753400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $N31820c00
push $N317c7400
push $N317c7c00
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set N31751c00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set N31751800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $N31751800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $N317c6c00
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $N31751c00
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $N317c6c00
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $N317c6800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $N31751c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $N317c7800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $N317c7000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $N317c7c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $N317c7400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $N31820c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $N318ac400
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set N31aa4400 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set N7f643400 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $N7f643400
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $N31aa4400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $N31aa4400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $N31aa4400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set N7f641c00 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set N7f641000 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $N7f641000
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $N7f641000
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set N7f5ffc00 [stack 0]
push $N7f5ffc00
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $N31aa4400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $N31aa4400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $N7f641c00
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set N7f5fd000 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $N7f5fd000
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $N7f5fd000
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set N7f64a400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set N7f5b7c00 [stack 0]
 Dot {
  name Dot44
  label C,h
  selected true
  xpos -1673
  ypos 2768
 }
push $N7f64a400
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set N7f5b7400 [stack 0]
 Dot {
  name Dot20
  label M,h
  selected true
  xpos -1737
  ypos 2767
 }
push $N7f64a400
push $N31aa4400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set N7f5b6800 [stack 0]
push $N31aa4400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set N7f5b5c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set N7f649d00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $N7f5b7c00
push $N7f5b7400
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set N7f547c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $N7f547c00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $N7f649d00
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set N7f545c00 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $N7f545c00
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set N7f648f00 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $N7f648f00
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $N31aa4400
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $N31aa4400
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $N31aa4400
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $N7f649d00
push $N31aa4400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $N7f641c00
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $N7f5b6800
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $N7f5b5c00
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $N7f64a400
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
Colorspace {
 colorspace_in CIE-XYZ
 name Colorspace2
 xpos -200
 ypos 221
}
set N31c47800 [stack 0]
Expression {
 temp_name0 minChan
 temp_expr0 min(r,min(g,b)
 temp_name1 maxChan
 temp_expr1 max(r,max(g,b)
 expr0 max(r<0,g<0,b<0)?0:r
 expr1 max(r<0,g<0,b<0)?0:g
 expr2 max(r<0,g<0,b<0)?0:b
 name Expression4
 xpos -336
 ypos 261
}
Colorspace {
 colorspace_out CIE-XYZ
 name Colorspace8
 xpos -200
 ypos 296
}
set N31c47000 [stack 0]
Group {
 name ZCAM3
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos -200
 ypos 333
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set N31c46400 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set N31c45000 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $N31c45000
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set N31bdf200 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $N31bdf200
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set N31bd7000 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set N31bd6c00 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $N31bd7000
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set N31bd6000 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set N31bd5c00 [stack 0]
push $N31bd7000
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set N31bd5800 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set N31bd5400 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set N31bd5000 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set N31bd4c00 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $N31bd6c00
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $N31bd7000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $N31bd7000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $N31bd7000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $N31c46400
push $N31bd6c00
push $N31bd6000
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set N31b62c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $N31b62c00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $N31bd6c00
push $N31bd5c00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set N31b61800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $N31b61800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $N31bd6c00
push $N31bd5800
push $N31bd6000
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set N7f70bc00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set N7f70b800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $N7f70b800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $N31bd5000
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $N7f70bc00
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $N31bd5000
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $N31bd4c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $N7f70bc00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $N31bd5c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $N31bd5400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $N31bd6000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $N31bd5800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $N31bd6c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $N31c46400
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set N7fa2a400 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set N7fa29800 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $N7fa29800
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $N7fa2a400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $N7fa2a400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $N7fa2a400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set N7f9d7c00 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set N7f9d7000 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $N7f9d7000
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $N7f9d7000
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set N7f9d6000 [stack 0]
push $N7f9d6000
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $N7fa2a400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $N7fa2a400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $N7f9d7c00
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set N7f983000 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $N7f983000
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $N7f983000
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set N7f9b7200 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set N7f982000 [stack 0]
 Dot {
  name Dot44
  label C,h
  selected true
  xpos -1673
  ypos 2768
 }
push $N7f9b7200
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set N7f981800 [stack 0]
 Dot {
  name Dot20
  label M,h
  selected true
  xpos -1737
  ypos 2767
 }
push $N7f9b7200
push $N7fa2a400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set N7f980c00 [stack 0]
push $N7fa2a400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set N7f92bc00 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set N7f9b6b00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $N7f982000
push $N7f981800
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set N7f92a000 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $N7f92a000
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $N7f9b6b00
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set N7f8b3c00 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $N7f8b3c00
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set N7f9b5d00 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $N7f9b5d00
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $N7fa2a400
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $N7fa2a400
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $N7fa2a400
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $N7f9b6b00
push $N7fa2a400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $N7f9d7c00
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $N7f980c00
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $N7f92bc00
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $N7f9b7200
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
set N7f4ba400 [stack 0]
Dot {
 name Dot3
 xpos -10
 ypos 327
}
set N7f84dc00 [stack 0]
Shuffle2 {
 fromInput1 {{0} B}
 in1 zcam_J
 fromInput2 {{0} B}
 in2 zcam_M
 mappings "4 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3 zcam_M.green 1 1 rgba.green 0 1 zcam_J.red 0 0 rgba.red 0 0"
 name Shuffle11
 xpos -44
 ypos 345
}
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 in2 zcam_h
 mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.alpha 0 3 rgba.alpha 0 3 zcam_h.blue 1 2 rgba.blue 0 2"
 name Shuffle12
 xpos -44
 ypos 369
}
set N7f84d400 [stack 0]
push $N7f4ba400
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.blue 0 2 white -1 -1 rgba.alpha 0 3"
 name Shuffle10
 xpos -200
 ypos 385
}
PositionToPoints2 {
 inputs 2
 display textured
 render_mode textured
 detail 1
 pointSize 1
 name PositionToPoints2
 xpos -44
 ypos 507
}
push $N318aec00
Shuffle2 {
 fromInput1 {{0} B}
 in1 zcam_M
 fromInput2 {{0} B}
 mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3 zcam_M.green 0 1 rgba.green 0 1"
 name Shuffle13
 xpos 858
 ypos 293
}
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 in2 zcam_h
 mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.blue 0 2 rgba.blue 0 2 rgba.alpha 0 3 rgba.alpha 0 3 zcam_h.green 1 1 rgba.green 0 1"
 name Shuffle16
 xpos 858
 ypos 317
}
set N7f84c400 [stack 0]
Expression {
 channel0 rgba
 expr0 (g/360)+.5
 name Expression6
 xpos 959
 ypos 366
}
push $N31c47800
Clamp {
 name Clamp1
 xpos -200
 ypos 252
 disable true
}
ColorWheel {
 inputs 0
 format "1024 1024 0 0 1024 1024 1 square_1K"
 gamma 0.45
 name ColorWheel1
 xpos 276
 ypos -737
}
Colorspace {
 colorspace_out CIE-XYZ
 name Colorspace5
 xpos 276
 ypos -665
}
Multiply {
 value 0.3
 name Multiply6
 xpos 276
 ypos -611
 disable true
}
Constant {
 inputs 0
 channels rgb
 color {1 0.4 0.4 1}
 color_panelDropped true
 name Constant1
 xpos -156
 ypos -680
}
Colorspace {
 colorspace_out CIE-XYZ
 name Colorspace1
 xpos -156
 ypos -608
}
Read {
 inputs 0
 file_type exr
 file /Users/afry/GitHub/nukeFnCoder24/fnCoder_samples_out.exr
 format "209 1 0 0 209 1 1 "
 origset true
 name Read60
 xpos -1270
 ypos 280
}
set N7f7ee000 [stack 0]
LayerContactSheet {
 showLayerNames true
 name LayerContactSheet2
 xpos -1270
 ypos 398
}
push $N7f7ee000
Dot {
 name Dot6
 xpos -1210
 ypos 454
}
Multiply {
 value {0.001 1 1 1}
 name Multiply7
 xpos -1203
 ypos 466
}
push $N7f7ee000
Dot {
 name Dot5
 xpos -1089
 ypos 354
}
Colorspace {
 colorspace_in CIE-Yxy
 name Colorspace11
 xpos -1123
 ypos 406
}
Grade {
 multiply 0.095
 name Grade7
 xpos -1123
 ypos 430
}
PositionToPoints2 {
 inputs 2
 display textured
 render_mode textured
 detail 1
 name PositionToPoints3
 xpos -1123
 ypos 519
}
push $N31904400
Colorspace {
 colorspace_in st2084
 name Colorspace4
 xpos 231
 ypos 83
}
Group {
 name ssts
 xpos 231
 ypos 129
 addUserKnob {20 ssts_tab l ssts}
 addUserKnob {26 display_label l " " T "<b>Display Settings</b>"}
 addUserKnob {78 lum l luminance t "<b>SSTS Display Luminance</b>: \ny_min y_mid y_max\n\nAccording to Zach Lewis's ACES_OT\nhttps://gist.github.com/zachlewis/786c0be941868644c993fde1c3515c2c\n\n<b>Standard Cinema</b>: \n0.02 4.8 48\n<b>Dolby Cinema</b>: \n0.0001 7.2 108\n<b>Dolby Pulsar</b>: \n0.005 15 4000\n<b>Dolby PRR-4220</b>: \n0.005 10 600\n<b>Sony BVM-X300</b>: \n0.0001 10 1000\n<b>ACES OCES</b>: \n0.0001 4.8 10000\n\n" n 3}
 lum {0.0001 4.8 10000}
 addUserKnob {6 override_ssts_params l "override ssts params" t "Enable overrides of SSTS params.\n\nOtherwise the values will be calculated automatically by the algorithm." +STARTLINE}
 addUserKnob {7 exposure R -5 5}
 addUserKnob {7 knee}
 knee 0.35
 addUserKnob {7 shoulder}
 shoulder 0.89
 addUserKnob {78 slope n 3}
 slope {0.38 1.501 0.01}
 addUserKnob {20 TsParams_tab l TsParams}
 addUserKnob {7 mid_lum l "mid lum" R 0 20}
 mid_lum 4.8
 addUserKnob {7 expShift R -4 4}
 addUserKnob {13 minPoint t "x;        // ACES\ny;        // luminance\nz;        // slope"}
 minPoint {5.493164063e-06 0.0001 0}
 addUserKnob {13 midPoint t "x;        // ACES\ny;        // luminance\nz;        // slope"}
 midPoint {0.18 4.8 1.55}
 addUserKnob {13 maxPoint t "x;        // ACES\ny;        // luminance\nz;        // slope"}
 maxPoint {47185.92 10000 0}
 addUserKnob {7 knotIncLow}
 knotIncLow 1.505149978
 addUserKnob {7 knotIncHigh}
 knotIncHigh 1.806179974
 addUserKnob {7 pctLow}
 pctLow 0.18
 addUserKnob {7 pctHigh}
 pctHigh 0.8920050508
 addUserKnob {78 coefsLow n 5}
 coefsLow {-4 -4 -3.157376577 -0.4852499958 1.847732471}
 addUserKnob {78 coefsHigh n 5}
 coefsHigh {-0.7185482425 2.081030717 3.641590816 4 4}
 addUserKnob {20 Constants_tab l const}
 addUserKnob {3 N_KNOTS_LOW}
 N_KNOTS_LOW 4
 addUserKnob {3 N_KNOTS_HIGH}
 N_KNOTS_HIGH 4
 addUserKnob {7 MIN_STOP_SDR R -20 20}
 MIN_STOP_SDR -6.5
 addUserKnob {7 MAX_STOP_SDR R -20 20}
 MAX_STOP_SDR 6.5
 addUserKnob {7 MIN_STOP_RRT R -20 20}
 MIN_STOP_RRT -15
 addUserKnob {7 MAX_STOP_RRT R -20 20}
 MAX_STOP_RRT 18
 addUserKnob {7 MIN_LUM_SDR R 0 0.1}
 MIN_LUM_SDR 0.02
 addUserKnob {7 MAX_LUM_SDR R 0 100}
 MAX_LUM_SDR 48
 addUserKnob {7 MIN_LUM_RRT R 0 0.1}
 MIN_LUM_RRT 0.0001
 addUserKnob {7 MAX_LUM_RRT R 0 10000}
 MAX_LUM_RRT 10000
}
 Input {
  inputs 0
  name Input
  xpos -1030
  ypos -634
 }
 Dot {
  name Dot25
  label " "
  xpos -996
  ypos -318
 }
set N80ddf800 [stack 0]
 Dot {
  name Dot26
  label " "
  xpos -996
  ypos 1506
 }
push $N80ddf800
 Dot {
  name Dot4
  label " "
  xpos -886
  ypos -318
 }
set N80ddf000 [stack 0]
 Dot {
  name Dot5
  label " "
  xpos -776
  ypos -318
 }
set N80ddec00 [stack 0]
 Dot {
  name Dot2
  label " "
  xpos -666
  ypos -318
 }
set N80dde800 [stack 0]
 Dot {
  name Dot3
  label " "
  xpos -556
  ypos -318
 }
set N80dde400 [stack 0]
 Expression {
  temp_name0 logr
  temp_expr0 "log10( max(r, 5.96046448e-08 ))"
  temp_name1 logg
  temp_expr1 "log10( max(g, 5.96046448e-08 ))"
  temp_name2 logb
  temp_expr2 "log10( max(b, 5.96046448e-08 ))"
  expr0 "logr <= log10(minPoint.x)"
  expr1 "logg <= log10(minPoint.x)"
  expr2 "logb <= log10(minPoint.x)"
  name segment_bottom
  xpos -590
  ypos -178
 }
 Dot {
  name Dot1
  label " "
  xpos -556
  ypos 162
 }
push $N80dde400
 Dot {
  name Dot7
  label " "
  xpos -336
  ypos -318
 }
set N80ddd800 [stack 0]
 Expression {
  temp_name0 logr
  temp_expr0 "log10( max(r, 5.96046448e-08 ))"
  temp_name1 logg
  temp_expr1 "log10( max(g, 5.96046448e-08 ))"
  temp_name2 logb
  temp_expr2 "log10( max(b, 5.96046448e-08 ))"
  channel0 {rgba.red -rgba.green -rgba.blue none}
  expr0 "logr * minPoint.z + ( log10(minPoint.y) - minPoint.z * log10(minPoint.x) )"
  expr1 "logg * minPoint.z + ( log10(minPoint.y) - minPoint.z * log10(minPoint.x) )"
  expr2 "logb* minPoint.z + ( log10(minPoint.y) - minPoint.z * log10(minPoint.x) )"
  expr3 1
  name Expression
  xpos -370
  ypos -178
 }
 Merge2 {
  inputs 2
  operation multiply
  also_merge all
  name Multiply3
  xpos -370
  ypos 158
 }
 Dot {
  name Dot27
  label " "
  xpos -336
  ypos 786
 }
push $N80dde800
 Expression {
  temp_name0 logr
  temp_expr0 "log10( max(r, 5.96046448e-08 ))"
  temp_name1 logg
  temp_expr1 "log10( max(g, 5.96046448e-08 ))"
  temp_name2 logb
  temp_expr2 "log10( max(b, 5.96046448e-08 ))"
  expr0 "( logr > log10(minPoint.x) ) * ( logr < log10(midPoint.x) )"
  expr1 "( logg > log10(minPoint.x) ) * ( logg < log10(midPoint.x) )"
  expr2 "( logb > log10(minPoint.x) ) * ( logb < log10(midPoint.x) )"
  name segment_low
  xpos -700
  ypos -178
 }
 Dot {
  name Dot22
  label " "
  xpos -666
  ypos 354
 }
push $N80ddd800
 Dot {
  name Dot9
  label " "
  xpos -6
  ypos -318
 }
set N80da3c00 [stack 0]
 Dot {
  name Dot6
  label " "
  xpos -6
  ypos -198
 }
set N80da3800 [stack 0]
 Dot {
  name Dot8
  label " "
  xpos 214
  ypos -198
 }
set N80da3400 [stack 0]
 Dot {
  name Dot13
  label " "
  xpos 434
  ypos -198
 }
 Dot {
  name Dot12
  label " "
  xpos 434
  ypos -78
 }
set N80da2c00 [stack 0]
 Expression {
  temp_name0 logx
  temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
  temp_name1 knot_coord
  temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
  temp_name2 j
  temp_expr2 int(knot_coord)
  temp_name3 t
  temp_expr3 "knot_coord - j"
  expr0 "j == 0 ? coefsLow.0 : j == 1 ? coefsLow.1 : j == 2 ? coefsLow.2 :j == 3 ? coefsLow.3 : j == 4 ? coefsLow.4 : 0"
  expr1 "j == 0 ? coefsLow.1 : j == 1 ? coefsLow.2 : j == 2 ? coefsLow.3 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
  expr2 "j == 0 ? coefsLow.2 : j == 1 ? coefsLow.3 : j == 2 ? coefsLow.4 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
  name Expression5
  xpos 290
  ypos -34
 }
 ColorMatrix {
  matrix {
      {0.5 -1 0.5}
      {-1 1 0}
      {0.5 0.5 0}
    }
  name ColorMatrix3
  label "mult_f3_f33( cf, M)"
  xpos 290
  ypos 8
 }
push $N80da2c00
 Expression {
  temp_name0 logx
  temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
  temp_name1 knot_coord
  temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
  temp_name2 j
  temp_expr2 int(knot_coord)
  temp_name3 t
  temp_expr3 "knot_coord - j"
  expr0 t*t
  expr1 t
  expr2 1
  expr3 1
  name Expression6
  xpos 400
  ypos -34
 }
 MergeExpression {
  inputs 2
  channel0 {rgba.red -rgba.green -rgba.blue none}
  expr0 0
  expr1 0
  expr2 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
  name dot_f3_f2
  label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
  xpos 400
  ypos 8
 }
push 0
push $N80da3400
 Dot {
  name Dot11
  label " "
  xpos 214
  ypos -78
 }
set N80da1800 [stack 0]
 Expression {
  temp_name0 logx
  temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
  temp_name1 knot_coord
  temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
  temp_name2 j
  temp_expr2 int(knot_coord)
  temp_name3 t
  temp_expr3 "knot_coord - j"
  expr0 "j == 0 ? coefsLow.0 : j == 1 ? coefsLow.1 : j == 2 ? coefsLow.2 :j == 3 ? coefsLow.3 : j == 4 ? coefsLow.4 : 0"
  expr1 "j == 0 ? coefsLow.1 : j == 1 ? coefsLow.2 : j == 2 ? coefsLow.3 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
  expr2 "j == 0 ? coefsLow.2 : j == 1 ? coefsLow.3 : j == 2 ? coefsLow.4 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
  name Expression3
  xpos 70
  ypos -34
 }
 ColorMatrix {
  matrix {
      {0.5 -1 0.5}
      {-1 1 0}
      {0.5 0.5 0}
    }
  name ColorMatrix1
  label "mult_f3_f33( cf, M)"
  xpos 70
  ypos 8
 }
push $N80da1800
 Expression {
  temp_name0 logx
  temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
  temp_name1 knot_coord
  temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
  temp_name2 j
  temp_expr2 int(knot_coord)
  temp_name3 t
  temp_expr3 "knot_coord - j"
  expr0 t*t
  expr1 t
  expr2 1
  expr3 1
  name Expression4
  xpos 180
  ypos -34
 }
 MergeExpression {
  inputs 2
  channel0 {rgba.red -rgba.green -rgba.blue none}
  expr0 0
  expr1 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
  expr2 0
  name dot_f3_f7
  label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
  xpos 180
  ypos 8
 }
push $N80da3800
 Dot {
  name Dot10
  label " "
  xpos -6
  ypos -78
 }
set N80da0400 [stack 0]
 Expression {
  temp_name0 logx
  temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
  temp_name1 knot_coord
  temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
  temp_name2 j
  temp_expr2 int(knot_coord)
  temp_name3 t
  temp_expr3 "knot_coord - j"
  expr0 "j == 0 ? coefsLow.0 : j == 1 ? coefsLow.1 : j == 2 ? coefsLow.2 :j == 3 ? coefsLow.3 : j == 4 ? coefsLow.4 : 0"
  expr1 "j == 0 ? coefsLow.1 : j == 1 ? coefsLow.2 : j == 2 ? coefsLow.3 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
  expr2 "j == 0 ? coefsLow.2 : j == 1 ? coefsLow.3 : j == 2 ? coefsLow.4 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
  name Expression1
  xpos -150
  ypos -34
 }
 ColorMatrix {
  matrix {
      {0.5 -1 0.5}
      {-1 1 0}
      {0.5 0.5 0}
    }
  name ColorMatrix2
  label "mult_f3_f33( cf, M)"
  xpos -150
  ypos 8
 }
push $N80da0400
 Expression {
  temp_name0 logx
  temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
  temp_name1 knot_coord
  temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
  temp_name2 j
  temp_expr2 int(knot_coord)
  temp_name3 t
  temp_expr3 "knot_coord - j"
  expr0 t*t
  expr1 t
  expr2 1
  expr3 1
  name Expression2
  xpos -40
  ypos -34
 }
 MergeExpression {
  inputs 2
  channel0 {rgba.red -rgba.green -rgba.blue none}
  expr0 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
  expr1 0
  expr2 0
  name dot_f3_f1
  label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
  xpos -40
  ypos 8
 }
 Merge2 {
  inputs 3+1
  operation plus
  bbox B
  output rgb
  name Merge1
  xpos 180
  ypos 158
 }
 Merge2 {
  inputs 2
  operation multiply
  also_merge all
  name Multiply1
  xpos 180
  ypos 350
 }
 Dot {
  name Dot28
  label " "
  xpos 214
  ypos 786
 }
push 0
push $N80ddec00
 Expression {
  temp_name0 logr
  temp_expr0 "log10( max(r, 5.96046448e-08 ))"
  temp_name1 logg
  temp_expr1 "log10( max(g, 5.96046448e-08 ))"
  temp_name2 logb
  temp_expr2 "log10( max(b, 5.96046448e-08 ))"
  expr0 "( logr >= log10(midPoint.x) ) * ( logr < log10(maxPoint.x) )"
  expr1 "( logg >= log10(midPoint.x) ) * ( logg < log10(maxPoint.x) )"
  expr2 "( logb >= log10(midPoint.x) ) * ( logb < log10(maxPoint.x) )"
  name segment_high
  xpos -810
  ypos -178
 }
 Dot {
  name Dot23
  label " "
  xpos -776
  ypos 474
 }
push $N80da3c00
 Dot {
  name Dot14
  label " "
  xpos 764
  ypos -318
 }
set N80d41800 [stack 0]
 Dot {
  name Dot15
  label " "
  xpos 764
  ypos -198
 }
set N80d41400 [stack 0]
 Dot {
  name Dot17
  label " "
  xpos 984
  ypos -198
 }
set N80d41000 [stack 0]
 Dot {
  name Dot20
  label " "
  xpos 1204
  ypos -198
 }
 Dot {
  name Dot19
  label " "
  xpos 1204
  ypos -78
 }
set N80d40800 [stack 0]
 Expression {
  temp_name0 logx
  temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
  temp_name1 knot_coord
  temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
  temp_name2 j
  temp_expr2 int(knot_coord)
  temp_name3 t
  temp_expr3 "knot_coord - j"
  expr0 "j == 0 ? coefsHigh.0 : j == 1 ? coefsHigh.1 : j == 2 ? coefsHigh.2 :j == 3 ? coefsHigh.3 : j == 4 ? coefsHigh.4 : 0"
  expr1 "j == 0 ? coefsHigh.1 : j == 1 ? coefsHigh.2 : j == 2 ? coefsHigh.3 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
  expr2 "j == 0 ? coefsHigh.2 : j == 1 ? coefsHigh.3 : j == 2 ? coefsHigh.4 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
  expr3 j
  name Expression11
  xpos 1060
  ypos -34
 }
 ColorMatrix {
  matrix {
      {0.5 -1 0.5}
      {-1 1 0}
      {0.5 0.5 0}
    }
  name ColorMatrix6
  label "mult_f3_f33( cf, M)"
  xpos 1060
  ypos 8
 }
push $N80d40800
 Expression {
  temp_name0 logx
  temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
  temp_name1 knot_coord
  temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
  temp_name2 j
  temp_expr2 int(knot_coord)
  temp_name3 t
  temp_expr3 "knot_coord - j"
  expr0 t*t
  expr1 t
  expr2 1
  expr3 1
  name Expression12
  xpos 1170
  ypos -34
 }
 MergeExpression {
  inputs 2
  channel0 {rgba.red -rgba.green -rgba.blue none}
  expr0 0
  expr1 0
  expr2 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
  name dot_f3_f6
  label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
  xpos 1170
  ypos 8
 }
push 0
push $N80d41000
 Dot {
  name Dot18
  label " "
  xpos 984
  ypos -78
 }
set N80ce3000 [stack 0]
 Expression {
  temp_name0 logx
  temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
  temp_name1 knot_coord
  temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
  temp_name2 j
  temp_expr2 int(knot_coord)
  temp_name3 t
  temp_expr3 "knot_coord - j"
  expr0 "j == 0 ? coefsHigh.0 : j == 1 ? coefsHigh.1 : j == 2 ? coefsHigh.2 :j == 3 ? coefsHigh.3 : j == 4 ? coefsHigh.4 : 0"
  expr1 "j == 0 ? coefsHigh.1 : j == 1 ? coefsHigh.2 : j == 2 ? coefsHigh.3 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
  expr2 "j == 0 ? coefsHigh.2 : j == 1 ? coefsHigh.3 : j == 2 ? coefsHigh.4 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
  expr3 j
  name Expression9
  xpos 840
  ypos -34
 }
 ColorMatrix {
  matrix {
      {0.5 -1 0.5}
      {-1 1 0}
      {0.5 0.5 0}
    }
  name ColorMatrix5
  label "mult_f3_f33( cf, M)"
  xpos 840
  ypos 8
 }
push $N80ce3000
 Expression {
  temp_name0 logx
  temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
  temp_name1 knot_coord
  temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
  temp_name2 j
  temp_expr2 int(knot_coord)
  temp_name3 t
  temp_expr3 "knot_coord - j"
  expr0 t*t
  expr1 t
  expr2 1
  expr3 1
  name Expression10
  xpos 950
  ypos -34
 }
 MergeExpression {
  inputs 2
  channel0 {rgba.red -rgba.green -rgba.blue none}
  expr0 0
  expr1 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
  expr2 0
  name dot_f3_f5
  label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
  xpos 950
  ypos 8
 }
push $N80d41400
 Dot {
  name Dot16
  label " "
  xpos 764
  ypos -78
 }
set N80ce1c00 [stack 0]
 Expression {
  temp_name0 logx
  temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
  temp_name1 knot_coord
  temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
  temp_name2 j
  temp_expr2 int(knot_coord)
  temp_name3 t
  temp_expr3 "knot_coord - j"
  expr0 "j == 0 ? coefsHigh.0 : j == 1 ? coefsHigh.1 : j == 2 ? coefsHigh.2 :j == 3 ? coefsHigh.3 : j == 4 ? coefsHigh.4 : 0"
  expr1 "j == 0 ? coefsHigh.1 : j == 1 ? coefsHigh.2 : j == 2 ? coefsHigh.3 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
  expr2 "j == 0 ? coefsHigh.2 : j == 1 ? coefsHigh.3 : j == 2 ? coefsHigh.4 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
  expr3 j
  name Expression7
  xpos 620
  ypos -34
 }
 ColorMatrix {
  matrix {
      {0.5 -1 0.5}
      {-1 1 0}
      {0.5 0.5 0}
    }
  name ColorMatrix4
  label "mult_f3_f33( cf, M)"
  xpos 620
  ypos 8
 }
push $N80ce1c00
 Expression {
  temp_name0 logx
  temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
  temp_name1 knot_coord
  temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
  temp_name2 j
  temp_expr2 int(knot_coord)
  temp_name3 t
  temp_expr3 "knot_coord - j"
  expr0 t*t
  expr1 t
  expr2 1
  expr3 1
  name Expression8
  xpos 730
  ypos -34
 }
 MergeExpression {
  inputs 2
  channel0 {rgba.red -rgba.green -rgba.blue none}
  expr0 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
  expr1 0
  expr2 0
  name dot_f3_f4
  label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
  xpos 730
  ypos 8
 }
 Merge2 {
  inputs 3+1
  operation plus
  bbox B
  output rgb
  name Merge2
  xpos 950
  ypos 158
 }
 Merge2 {
  inputs 2
  operation multiply
  also_merge all
  name Multiply2
  xpos 950
  ypos 470
 }
 Dot {
  name Dot29
  label " "
  xpos 984
  ypos 786
 }
push $N80ddf000
 Expression {
  temp_name0 logr
  temp_expr0 "log10( max(r, 5.96046448e-08 ))"
  temp_name1 logg
  temp_expr1 "log10( max(g, 5.96046448e-08 ))"
  temp_name2 logb
  temp_expr2 "log10( max(b, 5.96046448e-08 ))"
  expr0 "logr >= log10(maxPoint.x) ? 1 : 0"
  expr1 "logg >= log10(maxPoint.x) ? 1 : 0"
  expr2 "logb >= log10(maxPoint.x) ? 1 : 0"
  name segment_peak
  xpos -920
  ypos -178
 }
 Dot {
  name Dot24
  label " "
  xpos -886
  ypos 618
 }
push $N80d41800
 Dot {
  name Dot21
  label " "
  xpos 1534
  ypos -318
 }
 Expression {
  temp_name0 logr
  temp_expr0 "log10( max(r, 5.96046448e-08 ))"
  temp_name1 logg
  temp_expr1 "log10( max(g, 5.96046448e-08 ))"
  temp_name2 logb
  temp_expr2 "log10( max(b, 5.96046448e-08 ))"
  channel0 {rgba.red -rgba.green -rgba.blue none}
  expr0 "logr * maxPoint.z + ( log10(maxPoint.y) - maxPoint.z * log10(maxPoint.x) )"
  expr1 "logg * maxPoint.z + ( log10(maxPoint.y) - maxPoint.z * log10(maxPoint.x) )"
  expr2 "logb* maxPoint.z + ( log10(maxPoint.y) - maxPoint.z * log10(maxPoint.x) )"
  expr3 1
  name proc_low1
  label Expression
  xpos 1500
  ypos -160
 }
 Merge2 {
  inputs 2
  operation multiply
  also_merge all
  name Multiply4
  xpos 1500
  ypos 614
 }
 Dot {
  name Dot30
  xpos 1534
  ypos 810
 }
 Merge2 {
  inputs 4+1
  operation plus
  bbox B
  output rgb
  name Merge3
  xpos 510
  ypos 1118
 }
 Expression {
  channel0 {rgba.red -rgba.green -rgba.blue none}
  expr0 pow(10,r)
  expr1 pow(10,g)
  expr2 pow(10,b)
  name Expression13
  xpos 510
  ypos 1238
 }
 Copy {
  inputs 2
  from0 rgba.alpha
  to0 rgba.alpha
  name Copy1
  xpos 510
  ypos 1496
 }
 Output {
  name Output1
  xpos 510
  ypos 1814
 }
end_group
Multiply {
 value 0.01
 name Multiply5
 xpos 231
 ypos 180
}
Expression {
 expr0 "y==floor(r(x, pos.y)*height*mult)?1:0"
 expr1 "y==floor(g(x, pos.y)*height*mult)?1:0"
 expr2 "y==floor(b(x, pos.y)*height*mult)?1:0"
 channel3 alpha
 name PlotScanline1
 xpos 231
 ypos 224
 addUserKnob {20 User}
 addUserKnob {12 pos}
 addUserKnob {7 mult R 0 5}
 mult 1
}
push $N31c47000
Shuffle2 {
 fromInput1 {{0} B}
 in1 zcam_J
 fromInput2 {{0} B}
 in2 zcam_M
 mappings "4 black -1 -1 rgba.red 0 0 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3 zcam_M.green 1 1 rgba.green 0 1"
 name Shuffle7
 xpos -30
 ypos 228
}
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 in2 zcam_h
 mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.alpha 0 3 rgba.alpha 0 3 zcam_h.blue 1 2 rgba.blue 0 2"
 name Shuffle8
 xpos -30
 ypos 252
}
push $N7f4ba400
Shuffle2 {
 fromInput1 {{0} B}
 in1 zcam_M
 fromInput2 {{0} B}
 in2 zcam_h
 mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3 zcam_M.green 0 1 rgba.green 0 1"
 name Shuffle14
 xpos -34
 ypos 285
}
StickyNote {
 inputs 0
 name StickyNote1
 label "node = nuke.selectedNode()\n\nnodeToSample = nuke.selectedNode()\n\nvrange = range(0,1023)\n\nlutKnob = node.knob('lut')\n\nfor xPos in range(0,1024):\n    for yPos in reversed(range(0,1023)):\n        sample = nodeToSample.sample('rgba.green',xPos,yPos)\n        if sample > 0.00001:\n            print(sample)\n            node.knob('lut').setValueAt(sample,xPos,2)\n            break\n\n    print(xPos)\n    node.knob('lut').setValueAt(.5,xPos,2)"
 xpos -602
 ypos 318
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/aces-exr-1920/christophe-brejon/macbeth_spheres_001_lin_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read2
 xpos 1359
 ypos -573
}
push $N314e2b00
Dot {
 name Dot7
 xpos 398
 ypos 35
}
Saturation {
 saturation 0
 mode Average
 name Saturation1
 xpos 364
 ypos 146
}
Grade {
 channels rgba
 multiply 0.001
 name Grade5
 xpos 364
 ypos 175
}
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
 name Shuffle4
 xpos 364
 ypos 225
}
push $N7f84c400
Expression {
 temp_name0 limit
 temp_expr0 clipped709_JMh.lut.green((g/360)+.5)*limitScale
 temp_name1 scaledVal
 temp_expr1 b/limit
 temp_name2 scale
 temp_expr2 1-thr
 expr2 "(scaledVal>thr? ( ((scaledVal-thr)/scale) / (((scaledVal-thr)/scale)+1) * scale + thr  )   : scaledVal ) * limit"
 channel3 alpha
 expr3 limit
 name clipToLimit
 xpos 858
 ypos 341
 addUserKnob {20 User}
 addUserKnob {7 limitScale R 0 100}
 limitScale 1.5
 addUserKnob {7 thr}
 thr 1
}
Shuffle2 {
 fromInput1 {{0} B}
 out1 zcam_M
 fromInput2 {{0} B}
 mappings "4 rgba.blue 0 2 zcam_M.red 0 0 rgba.blue 0 2 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.alpha 0 3"
 name Shuffle15
 xpos 858
 ypos 365
}
push $N318aec00
Copy {
 inputs 2
 from0 -rgba.alpha
 to0 -rgba.alpha
 channels zcam_M
 name Copy3
 xpos 706
 ypos 393
}
Grade {
 inputs 1+1
 channels zcam_M
 multiply 0
 name Grade4
 xpos 706
 ypos 451
}
Expression {
 temp_expr0 zcam_M.red
 temp_name1 max_at_h
 temp_expr1 Sampler1.lut.green(zcam_h.red)
 channel0 zcam_M
 expr0 Sampler1.lut.red(r)
 expr2 zcam_M.red>Sampler1.lut.green?r*1:zcam_M.red
 name Expression5
 xpos 706
 ypos 491
}
Group {
 name ZCAM1
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos 706
 ypos 515
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 direction inverse
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 inverseData1 M,h
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set N80a8ec00 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set N80a8d800 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $N80a8d800
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set N80a6cf00 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $N80a6cf00
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set N80a0f800 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set N80a0f400 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $N80a0f800
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set N80a0e800 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set N80a0e400 [stack 0]
push $N80a0f800
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set N80a0e000 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set N80a0dc00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set N80a0d800 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set N80a0d400 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $N80a0f400
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $N80a0f800
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $N80a0f800
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $N80a0f800
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $N80a8ec00
push $N80a0f400
push $N80a0e800
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set N809a3400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $N809a3400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $N80a0f400
push $N80a0e400
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set N809a2000 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $N809a2000
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $N80a0f400
push $N80a0e000
push $N80a0e800
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set N809a0800 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set N809a0400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $N809a0400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $N80a0d800
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $N809a0800
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $N80a0d800
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $N80a0d400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $N809a0800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $N80a0e400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $N80a0dc00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $N80a0e800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $N80a0e000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $N80a0f400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $N80a8ec00
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set N80c46c00 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set N80c46000 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $N80c46000
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $N80c46c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $N80c46c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $N80c46c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set N80c44800 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set N80bfb800 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $N80bfb800
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $N80bfb800
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set N80bfa800 [stack 0]
push $N80bfa800
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $N80c46c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $N80c46c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $N80c44800
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set N80b9f800 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $N80b9f800
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $N80b9f800
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set N80990f00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set N80b9e800 [stack 0]
 Dot {
  name Dot44
  label C,h
  selected true
  xpos -1673
  ypos 2768
 }
push $N80990f00
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set N80b9e000 [stack 0]
 Dot {
  name Dot20
  label M,h
  selected true
  xpos -1737
  ypos 2767
 }
push $N80990f00
push $N80c46c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set N80b9d400 [stack 0]
push $N80c46c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set N80b9c800 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set N80990800 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $N80b9e800
push $N80b9e000
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set N80f52800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $N80f52800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $N80990800
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set N80f50800 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $N80f50800
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set N80ee3900 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $N80ee3900
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $N80c46c00
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $N80c46c00
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $N80c46c00
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $N80990800
push $N80c46c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $N80c44800
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $N80b9d400
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $N80b9c800
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $N80990f00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
Multiply {
 value {{1/parent.Multiply3.value}}
 name Multiply2
 label "Div by 100 to go from nits"
 xpos 706
 ypos 567
}
Colorspace {
 colorspace_in CIE-XYZ
 name Colorspace6
 label "XYZ to sRGB Prims"
 xpos 706
 ypos 630
}
set N80e6e000 [stack 0]
Reformat {
 format "1024 1024 0 0 1024 1024 1 square_1K"
 resize height
 name Reformat7
 xpos 706
 ypos 769
}
set N8100f000 [stack 0]
push $N8100f000
Group {
 name PlotWaveform
 xpos 589
 ypos 825
 addUserKnob {20 Waveform_tab l Waveform}
 addUserKnob {41 useGPUIfAvailable l "Use GPU if available" T WaveForm.useGPUIfAvailable}
 addUserKnob {41 vectorize l "Vectorize on CPU" -STARTLINE T WaveForm.vectorize}
 addUserKnob {26 ""}
 addUserKnob {4 style M {fill add right bottom pip "" ""}}
 addUserKnob {6 guides t "draw guides at integer values (0, 1, 2 etc), and 0.18" -STARTLINE}
 guides true
 addUserKnob {6 split_rgb l "split rgb" t "separate rgb" -STARTLINE}
 addUserKnob {41 specifiedFormat l format t "specify the output format. Otherwise the input format will be used." -STARTLINE T WaveForm.specifiedFormat}
 addUserKnob {41 format l "" -STARTLINE T WaveForm.format}
 addUserKnob {6 log_transform l "log transform" t "display waveform in log (generic log2 shaper)" +STARTLINE}
 addUserKnob {6 antialias t "enable antialiasing" -STARTLINE}
 addUserKnob {7 max_value l "max value" t "The value to map to the top of frame. For example you may want to set this to the max pixel value in the image." R 1 25}
 max_value 1.5
 addUserKnob {7 min_value l "min value" R -1 0}
 addUserKnob {7 brightness t "multiply the brightness of the waveform"}
 brightness 0.2
 addUserKnob {22 set_max l "set max" t "Set's the max slider to the max pixel value on the current frame of the input image." T "n = nuke.thisNode()\nnuke.root().begin()\nn.begin()\nct = nuke.toNode('CT')\nnuke.execute(ct, nuke.frame(), nuke.frame())\nmaxpx = ct\['maxlumapixvalue'].getValue()\nave = (maxpx\[0] + maxpx\[1] + maxpx\[2])/3\nn\['max_value'].setValue(ave)" +STARTLINE}
 addUserKnob {41 box_size l pip_size t "set the picture in picture size" T Reformat3.box_size}
}
 Input {
  inputs 0
  name Input
  xpos 70
  ypos -226
 }
 AddChannels {
  name AddChannels1
  xpos 70
  ypos -184
 }
 Dot {
  name Dot1
  label " "
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 104
  ypos -102
 }
set N8100e000 [stack 0]
 Reformat {
  format {{{parent.WaveForm.format}}}
  resize distort
  filter impulse
  name ReScale
  xpos 70
  ypos -58
  disable {{!parent.specifiedFormat}}
 }
set N8100dc00 [stack 0]
 CurveTool {
  operation "Max Luma Pixel"
  ROI {0 0 {input.width} {input.height}}
  autocropdata {0 0 {input.width} {input.height}}
  maxlumapixdata {{curve x1 1047 x14 1800} {curve x1 2212 x14 436}}
  maxlumapixvalue {{curve x1 5.210135937 x14 3.869687557} {curve x1 10.19536495 x14 4.130000114} {curve x1 9.513872147 x14 3.160937548}}
  minlumapixdata {{curve x1 0 x14 380} {curve x1 26 x14 0}}
  minlumapixvalue {{curve x1 0.01240783278 x14 0} {curve x1 0.00967685692 x14 0} {curve x1 0.02308944985 x14 0}}
  name CT
  xpos -40
  ypos -58
 }
push $N8100dc00
 BlinkScript {
  recompileCount 39
  KernelDescription "2 \"PlotWaveform\" iterate pixelWise 88b7f52352ee7ffcbd8d6465ec4ac2ee10c040557f69f3c5cce1cf1b8c43cde4 2 \"src\" Read Random \"dst\" Write Random 10 \"max_value\" Float 1 AAAAAA== \"min_value\" Float 1 AAAAAA== \"tolerance\" Float 1 AAAAAA== \"mult\" Float 1 AAAAAA== \"log_min\" Float 1 AAAAAA== \"log_max\" Float 1 AAAAAA== \"enable_log_transform\" Bool 1 AA== \"antialias\" Bool 1 AA== \"draw_lines\" Bool 1 AA== \"lines_color\" Float 4 AAAAAAAAAAAAAAAAAAAAAA== 10 \"max_value\" 1 1 \"min_value\" 1 1 \"tolerance\" 1 1 \"mult\" 1 1 \"log_min\" 1 1 \"log_max\" 1 1 \"enable_log_transform\" 1 1 \"antialias\" 1 1 \"draw_lines\" 1 1 \"lines_color\" 4 1 1 \"yscale\" Float 1 1 AAAAAA=="
  kernelSource "kernel PlotWaveform : public ImageComputationKernel<ePixelWise>\n\{\n  Image<eRead, eAccessRandom, eEdgeClamped> src;\n  Image<eWrite, eAccessRandom> dst;\n\n  param:\n    float max_value;\n    float min_value;\n    float tolerance;\n    float mult;\n    float log_min;\n    float log_max;\n    bool enable_log_transform;\n    bool antialias;\n    bool draw_lines;\n    float4 lines_color;\n\n  local:\n    float yscale;\n\n  void init() \{\n    yscale = dst.bounds.height() / max_value;\n  \}\n\n  float gaussian(float d, float a, float expv) \{\n    return max(0.0f, exp(-a*d*d)-expv);\n  \}\n\n  float gaussian_filter(float x, float y, float r) \{\n    // return gaussian weighted distance from origin (0, 0)\n    // given coordinate (x, y) and radius r\n    float a = 1.5f; // rate falloff\n    float expv = exp(-a*r*r);\n    return gaussian(x, a, expv) * gaussian(y, a, expv);\n  \}\n\n  void write(float x, float y, int k, float c) \{\n    // Write cubic antialiased pixel value c in channel k at continuous float position x, y\n    int n = 2;\n    int u0 = round(x);\n    int v0 = round(y);\n    // skip if center pixel weight is greater than tolerance\n    if ( dst.bounds.inside(u0, v0)) \{\n      if (dst(u0, v0, 3) >= tolerance) return;\n    \}\n    // loop over neighborhood\n    for (int j = -n; j <= n; j++) \{\n      int v = v0 + j;\n      for (int i = -n; i <= n; i++) \{\n        int u = u0 + i;\n        if ( dst.bounds.inside(u, v)) \{\n          // get filter weight for coord (u,v)\n          float w = gaussian_filter(u-x, v-y, float(n));\n          float c0 = dst(u, v, k); // existing color\n          // merge current color sample over existing color sample\n          dst(u, v, k) = c*w*mult+c0;\n          // merge current weight over existing weight\n          float w0 = dst(u, v, 3);\n          dst(u, v, 3) = w+w0*(1-w);\n        \}\n      \}\n    \}\n  \}\n\n  float log_transform(float x) \{\n    return x > 0.0f ? (log( x / 0.18f)/log(2.0f) - log_min) / (log_max - log_min) : x;\n  \}\n\n  void process(int2 pos) \{\n    float4 source = src(pos.x, pos.y);\n    if (enable_log_transform) \{\n      for (int k = 0; k < 3; k++)\{\n        source\[k] = log_transform(source\[k]);\n      \}\n    \}\n    float4 source_scaled = (source - min_value) * yscale;\n    if (antialias) \{\n      for (int k = 0; k < 3; k++)\{\n        write(pos.x, source_scaled\[k], k, source\[k]);\n      \}\n    \} else \{\n      for (int k = 0; k < 3; k++)\{\n        if ( dst.bounds.inside(pos.x, source_scaled\[k])) \{\n          dst(pos.x, source_scaled\[k], k) = source\[k]*mult + dst(pos.x, source_scaled\[k], k);\n          dst(pos.x, source_scaled\[k], 3) = 1.0f;\n        \}\n      \}\n    \}\n    if (draw_lines) \{\n      if (pos.x > 0 && pos.y > 0) return; // only draw the lines once\n      for (int i = 0; i < 50; i++) \{\n        float val = i;\n        if (enable_log_transform) val = log_transform(i);\n        for (int k = 0; k < 3; k++) \{\n          write(pos.x, (val - min_value)*yscale, k, lines_color\[k]);\n        \}\n      \}\n    \}\n  \}\n\};"
  rebuild ""
  PlotWaveform_max_value {{"parent.log_transform ? 1.01 : (parent.max_value+parent.min_value)"}}
  PlotWaveform_min_value {{parent.min_value}}
  PlotWaveform_tolerance 2
  PlotWaveform_mult {{parent.brightness}}
  PlotWaveform_log_min -6.5
  PlotWaveform_log_max 6.5
  PlotWaveform_enable_log_transform {{parent.log_transform}}
  PlotWaveform_antialias {{parent.antialias}}
  PlotWaveform_draw_lines {{parent.guides}}
  PlotWaveform_lines_color {0.6 0 0.02 1}
  format "2048 2048 0 0 2048 2048 1 square_2K"
  rebuild_finalise ""
  name WaveForm
  xpos 70
  ypos 32
 }
 Group {
  name RGB_Split
  selected true
  xpos 70
  ypos 110
  disable {{!parent.split_rgb}}
 }
  Input {
   inputs 0
   name Input
   xpos 45
   ypos -59
  }
  Reformat {
   type "to box"
   box_width {{rint(input.width/3)}}
   box_height {{input.height}}
   scale {1 1}
   resize none
   name Reformat4
   xpos 45
   ypos 1
  }
  Dot {
   name Dot18
   label " "
   note_font_size 24
   note_font_color 0xa5a5a501
   xpos 79
   ypos 53
  }
set N80fb7c00 [stack 0]
  Dot {
   name Dot19
   label " "
   note_font_size 24
   note_font_color 0xa5a5a501
   xpos 189
   ypos 53
  }
  Expression {
   expr0 0
   expr1 0
   expr2 b
   expr3 a
   name Expression3
   xpos 155
   ypos 97
  }
push $N80fb7c00
  Expression {
   expr0 0
   expr1 g
   expr2 0
   expr3 a
   name Expression2
   xpos 45
   ypos 97
  }
push $N80fb7c00
  Dot {
   name Dot17
   label " "
   note_font_size 24
   note_font_color 0xa5a5a501
   xpos -31
   ypos 53
  }
  Expression {
   expr0 r
   expr1 0
   expr2 0
   expr3 a
   name Expression1
   xpos -65
   ypos 97
  }
  ContactSheet {
   inputs 3
   width {{parent.input.width}}
   height {{parent.input.height}}
   rows 1
   columns 3
   roworder TopBottom
   name ContactSheet1
   selected true
   xpos 45
   ypos 152
  }
  Output {
   name Output
   xpos 45
   ypos 241
  }
 end_group
 Keyer {
  operation "luminance key"
  name Keyer1
  xpos 70
  ypos 176
 }
 Dot {
  name Dot5
  label " "
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 104
  ypos 234
 }
set N80fb5800 [stack 0]
 Dot {
  name Dot3
  label " Fill"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 104
  ypos 378
 }
 Dot {
  name Dot13
  label " "
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 104
  ypos 444
 }
set N80fb5000 [stack 0]
 Shuffle {
  alpha white
  name Shuffle1
  label "\[value in] -> \[value out]"
  xpos 747
  ypos 420
 }
 Reformat {
  type "to box"
  box_width {{"min(input.width, parent.Input.width*box_size)"}}
  scale 0.5
  filter notch
  black_outside true
  pbb true
  name Reformat3
  xpos 747
  ypos 465
  addUserKnob {20 User}
  addUserKnob {7 box_size R 0.05 0.6}
  box_size 0.3
 }
push $N8100e000
 Dot {
  name Dot8
  label " "
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 324
  ypos -102
 }
set N80f73c00 [stack 0]
 Dot {
  name Dot2
  label " "
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 544
  ypos -102
 }
 BlackOutside {
  name BlackOutside2
  xpos 510
  ypos 14
 }
set N80f73400 [stack 0]
 Dot {
  name Dot7
  label " "
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 764
  ypos 18
 }
set N80f73000 [stack 0]
 Dot {
  name Dot14
  label " "
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 874
  ypos 18
 }
 Merge2 {
  inputs 2
  bbox B
  name Merge4
  xpos 840
  ypos 518
 }
 Dot {
  name Dot11
  label PIP
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 874
  ypos 570
 }
push $N80fb5800
 Dot {
  name Dot9
  label " "
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 214
  ypos 234
 }
set N80f72000 [stack 0]
 Reformat {
  type "to box"
  box_width {{parent.Input.width}}
  box_height {{parent.Input.height}}
  box_fixed true
  resize none
  center false
  black_outside true
  name Reformat1
  xpos 400
  ypos 230
 }
 BlackOutside {
  name BlackOutside1
  xpos 400
  ypos 254
 }
set N80f71400 [stack 0]
 Position {
  translate {0 {-parent.input.height}}
  name MoveDown
  xpos 620
  ypos 254
  disable true
 }
push $N80f73000
 Crop {
  box {0 {-parent.input.height} {input.width} {input.height}}
  reformat true
  crop false
  name Crop2
  xpos 730
  ypos 182
 }
 Merge2 {
  inputs 2
  name Merge2
  xpos 730
  ypos 326
 }
 Dot {
  name Dot6
  label " Bottom"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 764
  ypos 378
 }
push $N80f71400
 Position {
  translate {{parent.input.width} 0}
  name MoveRight
  xpos 400
  ypos 278
 }
push $N80f73400
 Crop {
  box {0 0 {parent.MoveRight.bbox.r} {input.height}}
  reformat true
  crop false
  name Crop1
  xpos 510
  ypos 278
 }
 Merge2 {
  inputs 2
  name Merge1
  xpos 510
  ypos 326
 }
 Dot {
  name Dot4
  label " Right"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 544
  ypos 378
 }
push $N80f72000
 Reformat {
  type "to box"
  box_width {{parent.input.width}}
  box_height {{parent.input.height}}
  box_fixed true
  resize distort
  center false
  black_outside true
  name Reformat2
  xpos 180
  ypos 279
 }
push $N80f73c00
 Dot {
  name Dot12
  label " "
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 324
  ypos 190
 }
 Merge2 {
  inputs 2
  bbox B
  name Merge3
  xpos 290
  ypos 279
 }
 Dot {
  name Dot10
  label " Add"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 324
  ypos 378
 }
push $N80fb5000
 Switch {
  inputs 5
  which {{parent.style}}
  name SwitchStyle
  xpos 70
  ypos 566
 }
 Output {
  name Output
  xpos 70
  ypos 710
 }
end_group
ContactSheet {
 inputs 2
 width 2048
 height 1024
 rows 1
 columns 2
 name ContactSheet3
 xpos 706
 ypos 892
}
Colorspace {
 colorspace_out sRGB
 name Colorspace12
 xpos 706
 ypos 916
}
Write {
 file /Users/afry/GitHub/nukeZCAM/images/examples/ramp_Colour_histo_v001.png
 raw true
 file_type png
 checkHashOnRead false
 version 4
 in_colorspace scene_linear
 out_colorspace scene_linear
 name Write3
 xpos 706
 ypos 960
}
push $N314ee400
Colorspace {
 colorspace_in CIE-XYZ
 name Colorspace7
 label "XYZ to sRGB Prims"
 xpos 880
 ypos -95
}
push $N314e2b00
LayerContactSheet {
 width {{input.width*columns}}
 height {{input.height*rows}}
 rows 5
 autodims false
 showLayerNames true
 name LayerContactSheet1
 xpos 881
 ypos 13
}
Group {
 inputs 0
 name ZCAM4
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos 2872
 ypos 438
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set N812b3400 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set N812b2000 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $N812b2000
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set N812b9d00 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $N812b9d00
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set N812b0400 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set N81247c00 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $N812b0400
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set N81247000 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set N81246c00 [stack 0]
push $N812b0400
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set N81246800 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set N81246400 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set N81246000 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set N81245c00 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $N81247c00
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $N812b0400
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $N812b0400
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $N812b0400
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $N812b3400
push $N81247c00
push $N81247000
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set N811dbc00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $N811dbc00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $N81247c00
push $N81246c00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set N811da800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $N811da800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $N81247c00
push $N81246800
push $N81247000
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set N811d9000 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set N811d8c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $N811d8c00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $N81246000
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $N811d9000
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $N81246000
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $N81245c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $N811d9000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $N81246c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $N81246400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $N81247000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $N81246800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $N81247c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $N812b3400
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set N81087400 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set N81086800 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $N81086800
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $N81087400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $N81087400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $N81087400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set N81085000 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set N81084400 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $N81084400
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $N81084400
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set N8175f000 [stack 0]
push $N8175f000
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $N81087400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $N81087400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $N81085000
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set N8175c400 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $N8175c400
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $N8175c400
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set N811d5d00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set N8170f000 [stack 0]
 Dot {
  name Dot44
  label C,h
  selected true
  xpos -1673
  ypos 2768
 }
push $N811d5d00
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set N8170e800 [stack 0]
 Dot {
  name Dot20
  label M,h
  selected true
  xpos -1737
  ypos 2767
 }
push $N811d5d00
push $N81087400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set N8170dc00 [stack 0]
push $N81087400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set N8170d000 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set N811d5600 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $N8170f000
push $N8170e800
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set N816af000 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $N816af000
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $N811d5600
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set N816ad000 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $N816ad000
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set N811d4800 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $N811d4800
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $N81087400
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $N81087400
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $N81087400
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $N811d5600
push $N81087400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $N81085000
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $N8170dc00
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $N8170d000
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $N811d5d00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
Group {
 inputs 0
 name ZCAM5
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos 2871
 ypos 543
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 direction inverse
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 inverseData1 M,h
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set N819d2400 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set N819d1000 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $N819d1000
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set N81992b00 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $N81992b00
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set N81953000 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set N81952c00 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $N81953000
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set N81952000 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set N81951c00 [stack 0]
push $N81953000
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set N81951800 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set N81951400 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set N81951000 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set N81950c00 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $N81952c00
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $N81953000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $N81953000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $N81953000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $N819d2400
push $N81952c00
push $N81952000
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set N818e6c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $N818e6c00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $N81952c00
push $N81951c00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set N818e5800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $N818e5800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $N81952c00
push $N81951800
push $N81952000
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set N81873c00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set N81873800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $N81873800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $N81951000
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $N81873c00
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $N81951000
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $N81950c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $N81873c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $N81951c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $N81951400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $N81952000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $N81951800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $N81952c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $N819d2400
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set N81792400 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set N81791800 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $N81791800
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $N81792400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $N81792400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $N81792400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set N81b2bc00 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set N81b2b000 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $N81b2b000
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $N81b2b000
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set N81b2a000 [stack 0]
push $N81b2a000
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $N81792400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $N81792400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $N81b2bc00
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set N81aeb000 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $N81aeb000
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $N81aeb000
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set N81b3eb00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set N81aea000 [stack 0]
 Dot {
  name Dot44
  label C,h
  xpos -1673
  ypos 2768
 }
push $N81b3eb00
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set N81ae9800 [stack 0]
 Dot {
  name Dot20
  label M,h
  xpos -1737
  ypos 2767
 }
push $N81b3eb00
push $N81792400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set N81ae8c00 [stack 0]
push $N81792400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set N81a9bc00 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set N81b3e400 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $N81aea000
push $N81ae9800
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set N81a9a000 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $N81a9a000
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $N81b3e400
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set N81e1fc00 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $N81e1fc00
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set N81b3d600 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $N81b3d600
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $N81792400
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $N81792400
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $N81792400
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $N81b3e400
push $N81792400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $N81b2bc00
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $N81ae8c00
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $N81a9bc00
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $N81b3eb00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
Constant {
 inputs 0
 channels rgb
 color {1 1 1 0}
 name Constant4
 xpos 1407
 ypos 1021
}
Group {
 name ZCAM7
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos 1413
 ypos 1122
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set N81d2fc00 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set N81d2e800 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $N81d2e800
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set N81d3e400 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $N81d3e400
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set N81d2cc00 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set N81d2c800 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $N81d2cc00
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set N81ccf800 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set N81ccf400 [stack 0]
push $N81d2cc00
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set N81ccf000 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set N81ccec00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set N81cce800 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set N81cce400 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $N81d2c800
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $N81d2cc00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $N81d2cc00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $N81d2cc00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $N81d2fc00
push $N81d2c800
push $N81ccf800
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set N81ccc800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $N81ccc800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $N81d2c800
push $N81ccf400
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set N81c57000 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $N81c57000
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $N81d2c800
push $N81ccf000
push $N81ccf800
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set N81c55800 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set N81c55400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $N81c55400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $N81cce800
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $N81c55800
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $N81cce800
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $N81cce400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $N81c55800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $N81ccf400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $N81ccec00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $N81ccf800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $N81ccf000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $N81d2c800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $N81d2fc00
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set N81f0bc00 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set N81f0b000 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $N81f0b000
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $N81f0bc00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $N81f0bc00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $N81f0bc00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set N81f09800 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set N81f08c00 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $N81f08c00
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $N81f08c00
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set N81ecb800 [stack 0]
push $N81ecb800
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $N81f0bc00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $N81f0bc00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $N81f09800
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set N81ec8c00 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $N81ec8c00
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $N81ec8c00
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set N81f0e400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set N82273800 [stack 0]
 Dot {
  name Dot44
  label C,h
  selected true
  xpos -1673
  ypos 2768
 }
push $N81f0e400
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set N82273000 [stack 0]
 Dot {
  name Dot20
  label M,h
  selected true
  xpos -1737
  ypos 2767
 }
push $N81f0e400
push $N81f0bc00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set N82272400 [stack 0]
push $N81f0bc00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set N82271800 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set N81f0dd00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $N82273800
push $N82273000
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set N82213800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $N82213800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $N81f0dd00
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set N82211800 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $N82211800
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set N81f0cf00 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $N81f0cf00
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $N81f0bc00
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $N81f0bc00
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $N81f0bc00
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $N81f0dd00
push $N81f0bc00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $N81f09800
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $N82272400
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $N82271800
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $N81f0e400
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
Shuffle2 {
 fromInput1 {{0} B}
 in1 zcam_M
 fromInput2 {{0} B}
 mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
 name Shuffle27
 xpos 1413
 ypos 1204
}
push $N7f84d400
ColorLookup {
 lut {master {}
   red {}
   green {curve 35.93902588 35.93735504 35.93753433 35.83887863 35.84093094 35.83343124 35.83169174 35.8393631 35.74020004 35.74031067 35.74192429 35.73725891 35.74119949 35.73592377 35.74422836 35.64019394 35.64123917 35.64620209 35.63986588 35.64028549 35.64251328 35.64444351 35.64264679 35.64365768 35.64627838 35.6400528 35.64422607 35.6402359 35.64598846 35.64023209 35.64229584 35.64193344 35.64261246 35.64746094 35.63682556 35.64370728 35.74347687 35.74534988 35.74236679 35.73675537 35.73838425 35.74174118 35.73894882 35.83584213 35.8412323 35.84160233 35.83996201 35.93353271 35.93379593 35.9345932 35.93690109 35.9334259 36.02864838 36.02735901 36.03026199 36.13125229 36.12955475 36.1228981 36.22369385 36.23100662 36.23028183 36.32764435 36.32866287 36.32495499 36.42479706 36.43197632 36.51892853 36.52161789 36.62269974 36.62142944 36.72122574 36.71898651 36.81211853 36.81745148 36.91525269 36.91080475 37.00736618 37.01118469 37.11250305 37.10976791 37.20728302 37.302845 37.30813217 37.40581512 37.49928665 37.49621201 37.59971619 37.69556808 37.69856644 37.7942009 37.89320374 37.8953743 37.9887886 38.0848999 38.18097687 38.28239059 38.27840424 38.37966919 38.47603607 38.57341003 38.67168808 38.76914978 38.86764526 38.96129608 39.06372833 39.0587883 39.16090012 39.25426865 39.35076523 39.54669952 39.65062332 39.74605942 39.84653854 39.94113922 40.04415131 40.13307953 40.23431778 40.33208847 40.53032684 40.62407303 40.72422791 40.81940079 41.0147171 41.11276627 41.205616 41.40884781 41.50452805 41.59882736 41.79209137 41.89821625 42.08958435 42.18856049 42.38302612 42.47993469 42.67907715 42.87290573 42.97105789 43.16693115 43.35734177 43.45572662 43.65342712 43.84939194 44.04508972 44.23981476 44.33708954 44.52936935 44.72503662 44.91989517 45.11779785 45.31217575 45.50875854 45.802948 45.9931488 46.19252777 46.38772964 46.6788559 46.87607193 47.06939697 47.36288071 47.56106949 47.85041046 48.04606628 48.33797073 48.63450241 48.8302803 49.12152863 49.41314697 49.70755768 50.00176239 50.29244232 50.58903885 50.88072586 51.26889801 51.55887222 51.85607529 52.24630737 52.53870773 52.92798233 53.32294083 53.70902634 54.10313034 54.4930191 54.8834877 55.27364731 55.76058578 56.14982986 56.63882065 57.02841568 57.52117157 58.00784683 58.59671783 59.08158493 59.66658783 60.15639496 60.74389267 61.42667007 62.0124588 62.69457626 63.37681198 64.06443024 64.74681854 65.52774048 66.31021881 67.18876648 68.06681061 69.04246521 70.01992035 71.0954361 72.26702881 73.5359726 75.00061798 76.46730042 78.22219849 80.27219391 82.81466675 86.32720947 92.77294159 92.47978973 92.18859863 91.79653168 91.50267029 91.20867157 90.91717529 90.62378693 90.33008575 90.03785706 89.74498749 89.45091248 89.16085052 88.86864471 88.67375946 88.37815094 88.085495 87.79483795 87.59604645 87.30580902 87.0121994 86.81477356 86.52365112 86.23173523 86.03422546 85.74343109 85.54766846 85.25550842 85.06121063 84.76651764 84.57078552 84.2778244 84.08197021 83.88652039 83.59406281 83.39922333 83.20137787 82.91230011 82.71536255 82.5194397 82.32489014 82.12976074 81.83760071 81.63871002 81.44684601 81.25106812 81.05558777 80.85884857 80.66533661 80.46903229 80.27294922 80.07853699 79.88320923 79.68422699 79.49024963 79.29807281 79.09967804 78.90900421 78.71144867 78.5160141 78.41762543 78.22486877 78.02793121 77.8327713 77.63743591 77.538414 77.34404755 77.14785004 76.95386505 76.85432434 76.66082001 76.46557617 76.36669922 76.17180634 75.97953033 75.87796783 75.68638611 75.58480835 75.39293671 75.19451904 75.09546661 74.90167236 74.80386353 74.60942078 74.51292419 74.31633759 74.22088623 74.02400208 73.9262619 73.82820129 73.63532257 73.5329361 73.34237671 73.24393463 73.14796448 72.94664001 72.85445404 72.75701141 72.55846405 72.46213531 72.36598969 72.16790009 72.06879425 71.97034454 71.87717438 71.68063354 71.58218384 71.48220062 71.38748932 71.18919373 71.09493256 70.99671173 70.89975739 70.80356598 70.70063019 70.50937653 70.41379547 70.31585693 70.21424103 70.11564636 70.02377319 69.92427826 69.82659912 69.72718811 69.52993011 69.43439484 69.33586884 69.23802185 69.14391327 69.04188538 68.94511414 68.85124969 68.75066376 68.65606689 68.55521393 68.45934296 68.36096954 68.25971222 68.16757965 68.16598511 68.0719986 67.96924591 67.87125397 67.77245331 67.67298126 67.58018494 67.48213196 67.38024139 67.28182983 67.28593445 67.18592072 67.08972931 66.98931122 66.89664459 66.79805756 66.79642487 66.70214081 66.59933472 66.50008392 66.41074371 66.40585327 66.3109436 66.20988464 66.1124649 66.11530304 66.0152359 65.91700745 65.8237381 65.81882477 65.72261047 65.63230896 65.52981567 65.52659607 65.43000031 65.33524323 65.33707428 65.23472595 65.13607788 65.1364212 65.04023743 64.94284821 64.9420929 64.84729767 64.7466507 64.74583435 64.65124512 64.64472961 64.55191803 64.45690918 64.45206451 64.35195923 64.35571289 64.25643158 64.16059113 64.16474915 64.06148529 64.06513977 63.97050858 63.9621048 63.86985397 63.8689003 63.77021408 63.77110672 63.67314148 63.67557907 63.57141876 63.57269287 63.47716904 63.47528076 63.37807083 63.38178635 63.28870773 63.28250885 63.18983078 63.17935944 63.08506393 63.08610153 63.08560181 62.98813629 62.98815918 62.89539337 62.89074326 62.89227676 62.79391861 62.80060577 62.69675446 62.69349289 62.6987114 62.59804153 62.60001373 62.59631348 62.50022888 62.49723434 62.50081253 62.40248871 62.40455627 62.40127182 62.30357361 62.30435562 62.30903625 62.20350266 62.20768356 62.20788956 62.21188354 62.11141586 62.10919189 62.10776138 62.10743332 62.01356506 62.01385498 62.01596069 62.00792313 62.00862503 61.91064835 61.9157753 61.91419601 61.91669464 61.91671753 61.82128525 61.82202148 61.8179512 61.81774902 61.82175064 61.81283188 61.8212204 61.72205734 61.71910858 61.71814346 61.71916962 61.71774292 61.7182312 61.71863937 61.72136688 61.71554947 61.71817398 61.62194443 61.62340546 61.62140274 61.62311172 61.62061691 61.61877823 61.62100601 61.62590027 61.623703 61.6206665 61.6184845 61.6190834 61.62500381 61.61876297 61.62221146 61.62573624 61.6214447 61.72372818 61.71715546 61.71935272 61.72673798 61.71169281 61.72066116 61.72264099 61.71887207 61.72253418 61.72341156 61.81517792 61.81740189 61.81483459 61.81319809 61.8238678 61.82185364 61.81326675 61.91387558 61.91043091 61.91744995 61.91103363 61.91780472 62.01591873 62.01387787 62.01602554 62.01297379 62.11548996 62.1067276 62.11439133 62.11171722 62.20619965 62.20685196 62.20759964 62.30322266 62.31111908 62.30070496 62.40403748 62.40358353 62.4039917 62.50132751 62.49913025 62.60264587 62.59640503 62.59876633 62.69623947 62.69539261 62.79282761 62.79143906 62.79136276 62.8872757 62.89276123 62.98524094 62.98807907 63.09153748 63.08860397 63.18286896 63.18919754 63.28068161 63.38180542 63.38282013 63.47850037 63.47373581 63.5747261 63.57614136 63.66799927 63.76377106 63.76695633 63.86920547 63.8690834 63.96191788 64.0622406 64.06108093 64.16133118 64.2569809 64.3600769 64.3585434 64.45617676 64.55487823 64.55782318 64.64794922 64.74227905 64.84680939 64.94369507 64.94055939 65.04627228 65.13388062 65.23962402 65.33287811 65.4275589 65.52989197 65.53150177 65.62509918 65.7230835 65.81693268 65.91795349 66.01490021 66.11055756 66.21057129 66.30930328 66.40958405 66.50550079 66.59815979 66.70316315 66.79588318 66.89571381 66.99430847 67.08624268 67.19080353 67.38208771 67.4837265 67.58010864 67.68003082 67.77623749 67.87133026 67.96807098 68.16547394 68.26278687 68.36183167 68.45191193 68.65579987 68.75180817 68.84950256 69.0428009 69.14099884 69.23834229 69.43442535 69.53222656 69.632164 69.82555389 69.92132568 70.11766052 70.11710358 69.63220978 69.24219513 68.75249481 68.36241913 67.87065887 67.47970581 67.09386444 66.60186768 66.20877838 65.81997681 65.42755127 65.03684998 64.65388489 64.35582733 63.96272278 63.57807922 63.18227768 62.88772202 62.50184631 62.20812607 61.81761932 61.52979279 61.13270569 60.8433075 60.54949188 60.24839401 59.86664963 59.57280731 59.27680588 58.98794174 58.69143295 58.395401 58.10408783 57.81227493 57.52017593 57.22842026 56.93185806 56.73752975 56.44951248 56.15695953 55.8586235 55.66687393 55.37416458 55.17963409 54.88437271 54.5905571 54.39528656 54.09878922 53.90460968 53.6129303 53.41859436 53.22289658 52.93015289 52.73370361 52.5394783 52.24549103 52.04938126 51.85460281 51.66251755 51.36879349 51.17526627 50.97798538 50.78419113 50.59011459 50.29180908 50.09874725 49.9030304 49.70691299 49.51330948 49.31416321 49.12406921 48.93008041 48.73166275 48.5334053 48.34260941 48.1462822 47.9478035 47.75603104 47.56013489 47.36261749 47.26512909 47.07024765 46.8780098 46.67582703 46.48662567 46.28880692 46.18995285 45.99759293 45.79856491 45.60540009 45.40980911 45.31474304 45.11869049 44.92122269 44.82301712 44.62847519 44.43479538 44.23583221 44.14387131 43.94570923 43.75009537 43.6511879 43.45724106 43.3602829 43.16654968 43.06821442 42.87141037 42.77432632 42.57572937 42.48049927 42.28443146 42.18509674 42.09146881 41.89381027 41.79674149 41.70076752 41.60007095 41.4064827 41.30747986 41.21148682 41.11444473 41.01685715 41.01596832 40.91708374 40.8192215 40.72195816 40.72220612 40.62486267 40.62443542 40.62629318 40.52801132 40.52706528 40.52642441 40.52826309 40.52755737 40.52542496 40.62447739 40.62583542 40.62650299 40.72006607 40.722332 40.82121658 40.91996765 40.9183197 41.01393509 41.11212921 41.20765305 41.30715561 41.40750504 41.50414658 41.60311508 41.69623566 41.79405594 41.89445114 41.99298477 42.08938599 42.28832626 42.38425064 42.48408127 42.57555771 42.67367172 42.87223816 42.96618271 43.06409073 43.25631714 43.35832977 43.45511246 43.65016556 43.75005341 43.85033035 44.04236984 44.14174652 44.23405457 44.43339539 44.53247452 44.72551727 44.82435226 45.01816177 45.1144371 45.21289062 45.40856552 45.5055809 45.70195007 45.79958725 45.99597549 46.09237671 46.28448486 46.3854866 46.58003998 46.68035126 46.87126541 46.97217941 47.16590118 47.36387634 47.45806503 47.65653992 47.75207901 47.9508667 48.14645004 48.23873138 48.43315125 48.63419724 48.7325592 48.92672729 49.12291336 49.21957779 49.41174698 49.60598373 49.80088806 49.90135193 50.09980774 50.29282761 50.49066162 50.68149948 50.88059235 50.97676849 51.16749191 51.3680687 51.56032944 51.75828552 51.95176697 52.14532471 52.34380341 52.54034042 52.73302078 52.9310379 53.12508392 53.32193756 53.51812363 53.80844879 54.00219727 54.19412994 54.39422607 54.68812943 54.8812294 55.07985687 55.27775192 55.56428146 55.75908279 56.05290985 56.2503891 56.44662857 56.74081802 56.93344116 57.22630692 57.51855469 57.71522141 58.00474548 58.29778671 58.4928894 58.10174942 57.51724243 57.02995682 56.54502487 56.05408478 55.66115189 55.17497635 54.78374481 54.29734039 53.89680481 53.51512146 53.12183762 52.73596191 52.34302139 51.95048523 51.6583519 51.26992416 50.97431564 50.58506012 50.29478836 50.00054169 49.70521164 49.41481781 49.12256622 48.82258987 48.528759 48.23807907 47.94736099 47.65626907 47.45898438 47.16497421 46.96705246 46.67845535 46.48375702 46.19107056 45.99602509 45.80202484 45.51155853 45.31067276 45.11905289 44.92168808 44.72563934 44.53132248 44.33517075 44.13421631 43.941185 43.75241852 43.55344391 43.35908508 43.15803528 43.06006241 42.87314987 42.67250443 42.57690048 42.37783051 42.18070602 42.09049988 41.89379883 41.79845428 41.60339737 41.50534439 41.31389618 41.20898438 41.11144638 40.91736603 40.82047653 40.72212219 40.52598953 40.42882156 40.33652496 40.23299789 40.03804779 39.9419899 39.84508514 39.74180603 39.64971542 39.5467186 39.44969177 39.35247803 39.25508881 39.0634079 38.96280289 38.86997223 38.8663559 38.77120209 38.67147827 38.56869125 38.48201752 38.37813187 38.28376007 38.18398285 38.07896805 38.08473587 37.98754883 37.89468384 37.79115295 37.79249573 37.692276 37.59499741 37.49941254 37.50154114 37.40305328 37.30319977 37.29952621 37.20677948 37.10554123 37.11078262 37.009758 37.01052094 36.90775299 36.91514587 36.81627274 36.80949402 36.71221542 36.71870422 36.62062454 36.6251297 36.5263443 36.52375793 36.42905426 36.42491913 36.32607269 36.32991409 36.32505417 36.22491074 36.2259407 36.22787094 36.13265228 36.13449478 36.1322937 36.03222275 36.02610779 36.03511047 35.93461227 x1125.702881 0}
   blue {}
   alpha {}}
 name clipped709_JMh
 xpos 160
 ypos 442
}
push $N7f84dc00
Multiply {
 value 0.01
 name Multiply8
 xpos 171
 ypos 320
}
push $N7f84d400
Sampler {
 sampler {0 1024}
 lut {red {curve 0.4999994338 x0.0009775171056 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.0175953079 0.4999994338 0.4999994338 x0.01955034211 0.4999994338 0.4999994338 x0.02150537632 0.4999994338 0.4999994338 x0.02346041054 0.4999994338 0.4999994338 x0.02541544475 0.4999994338 0.4999994338 x0.02737047896 0.4999994338 0.4999994338 x0.02932551317 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.03421309963 0.4999994338 x0.0351906158 0.4999994338 0.4999994338 x0.03714565188 0.4999994338 x0.03812316805 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.04203323647 0.4999994338 x0.04301075265 0.4999994338 0.4999994338 x0.04496578872 0.4999994338 x0.0459433049 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.04985337332 0.4999994338 x0.05083088949 0.4999994338 0.4999994338 x0.05278592557 0.4999994338 x0.05376344174 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.05767351016 0.4999994338 x0.05865102634 0.4999994338 0.4999994338 x0.06060606241 0.4999994338 x0.06158357859 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.06744868308 0.4999994338 x0.06842619926 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.07429130375 0.4999994338 x0.07526881993 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.08308895677 0.4999994338 x0.08406647295 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.08993157744 0.4999994338 x0.09090909362 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.09872923046 0.4999994338 x0.09970674664 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.1055718511 0.4999994338 x0.1065493673 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.1143695042 0.4999994338 x0.1153470203 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.1212121248 0.4999994338 x0.122189641 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.13391985 0.4999994338 x0.1348973662 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.1485826075 0.4999994338 x0.1495601237 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.1652003974 0.4999994338 x0.1661779135 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.1798631549 0.4999994338 x0.1808406711 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.1964809448 0.4999994338 x0.1974584609 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.2111437023 0.4999994338 x0.2121212184 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.2277614921 0.4999994338 x0.2287390083 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.2424242496 0.4999994338 x0.2434017658 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.2668621838 0.50000453 x0.2678397 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.297165215 0.4999994338 x0.2981427312 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.3294232786 0.4999994338 x0.3304007947 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.3597263098 0.4999994338 x0.360703826 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.3919843733 0.4999994338 x0.3929618895 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999943078 0.4999994338 0.4999994338 0.4999994338 x0.4222874045 0.50000453 x0.4232649207 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999943078 0.50000453 0.4999994338 x0.4545454681 0.4999994338 x0.4555229843 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 x0.4848484993 0.4999994338 x0.4858260155 0.4999994338 0.50000453 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.50000453 0.4999994338 0.4999994338 0.4999994338 x0.5327468514 0.4999994338 x0.5337243676 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999943078 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.50000453 0.50000453 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.50000453 0.50000453 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.59433043 0.50000453 x0.5953079462 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.50000453 0.50000453 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.50000453 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999943078 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.50000453 x0.657869041 0.50000453 x0.6588465571 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 x0.7194526196 0.4999994338 x0.7204301357 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.7829912305 0.4999994338 x0.7839687467 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.8445748091 0.4999994338 x0.8455523252 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.90811342 0.4999994338 x0.9090909362 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.9696969986 0.4999994338 x0.9706745148 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338}
   green {curve L 31.83551025 x0.2008529007 67.20974731 x0.4523992836 48.30766296 x0.7116855383 55.49045563 x1 32.42992401}
   blue {curve 176.3074646 x0.0009775171056 177.0280914 177.7571869 178.4942322 179.2392273 179.9922638 -179.2472992 -178.479187 -177.7039795 -176.9217072 -176.1325684 -175.3365326 -174.5341339 -173.7257385 -172.9119873 -172.0919952 -171.266983 -170.4371643 x0.0175953079 -169.602829 -168.7641754 x0.01955034211 -167.9215698 -167.0754852 x0.02150537632 -166.2264252 -165.3747406 x0.02346041054 -164.5200958 -163.6639252 x0.02541544475 -162.8060608 -161.9472046 x0.02737047896 -161.0873566 -160.2277985 x0.02932551317 -159.3677216 -158.5079498 -157.6496429 -156.7921448 -155.9369202 x0.03421309963 -155.0839233 x0.0351906158 -154.2322235 -153.3852234 x0.03714565188 -152.5402985 x0.03812316805 -151.6991882 -150.8624268 -150.0299683 -149.2024078 x0.04203323647 -148.3795776 x0.04301075265 -147.5618591 -146.750412 x0.04496578872 -145.9447327 x0.0459433049 -145.1459045 -144.3528137 -143.5679016 -142.7877045 x0.04985337332 -142.0164185 x0.05083088949 -141.2518311 -140.4963074 x0.05278592557 -139.7462158 x0.05376344174 -139.005249 -138.2719269 -137.548172 -136.8309937 x0.05767351016 -136.1222534 x0.05865102634 -135.4241028 -134.7341309 x0.06060606241 -134.05159 x0.06158357859 -133.3782196 -132.7133179 -132.0571442 -131.4104004 -130.7727966 -130.1426239 x0.06744868308 -129.522522 x0.06842619926 -128.9105835 -128.3085022 -127.7154312 -127.1300583 -126.5534363 -125.9847031 x0.07429130375 -125.425354 x0.07526881993 -124.8750687 -124.3319931 -123.7979813 -123.2726822 -122.7547607 -122.2436981 -121.7437973 -121.2499313 x0.08308895677 -120.7644043 x0.08406647295 -120.2854309 -119.8148041 -119.3534775 -118.8982086 -118.448616 -118.008667 x0.08993157744 -117.5756378 x0.09090909362 -117.1491013 -116.729454 -116.3167343 -115.9108429 -115.51091 -115.119072 -114.7330475 -114.3529434 x0.09872923046 -113.9781723 x0.09970674664 -113.6104889 -113.249382 -112.8935471 -112.5442276 -112.2000732 -111.8623428 x0.1055718511 -111.52845 x0.1065493673 -111.2017288 -110.8795624 -110.5628052 -110.2510147 -109.9444885 -109.6428528 -109.3468246 -109.055542 x0.1143695042 -108.7678223 x0.1153470203 -108.4855499 -108.2086868 -107.9344864 -107.6659698 -107.4015884 -107.1413269 x0.1212121248 -106.8857956 x0.122189641 -106.6342621 -106.3863449 -106.1434937 -105.9036942 -105.6673813 -105.4352646 -105.2072678 -104.981575 -104.7609863 -104.543251 -104.3295898 -104.1191254 x0.13391985 -103.9121552 x0.1348973662 -103.7073288 -103.5073776 -103.3097305 -103.1152573 -102.9236908 -102.7361832 -102.5513687 -102.3686981 -102.1893463 -102.0124664 -101.8391266 -101.6685944 -101.500885 -101.3352051 x0.1485826075 -101.1719742 x0.1495601237 -101.0114288 -100.8541794 -100.698967 -100.5457458 -100.3954391 -100.2480164 -100.1019135 -99.9582901 -99.81784821 -99.67919922 -99.54303741 -99.40869141 -99.27676392 -99.14633179 -99.0191803 -98.89281464 x0.1652003974 -98.76908875 x0.1661779135 -98.64769745 -98.52738953 -98.409935 -98.29354858 -98.17910767 -98.06780243 -97.95747375 -97.84875488 -97.74217224 -97.63750458 -97.53403473 -97.43332672 -97.3335495 -97.23551941 x0.1798631549 -97.13896942 x0.1808406711 -97.04425049 -96.95212555 -96.85972595 -96.77013397 -96.68202972 -96.59484863 -96.50952148 -96.42649841 -96.3445816 -96.26344299 -96.18431091 -96.10641479 -96.02996063 -95.95507812 -95.88117981 -95.80950928 x0.1964809448 -95.73854828 x0.1974584609 -95.66920471 -95.60133362 -95.53430176 -95.46897888 -95.40502167 -95.34222412 -95.28018951 -95.22046661 -95.16082001 -95.1035614 -95.04668427 -94.99155426 -94.93701935 -94.88400269 x0.2111437023 -94.83301544 x0.2121212184 -94.78235626 -94.73234558 -94.684021 -94.63742828 -94.59171295 -94.54663849 -94.503479 -94.46068573 -94.41899109 -94.37902069 -94.33952332 -94.3017807 -94.26459503 -94.22827148 -94.19332123 -94.15947723 x0.2277614921 -94.1269455 x0.2287390083 -94.09528351 -94.06499481 -94.03471375 -94.00635529 -93.97930908 -93.95225525 -93.92682648 -93.90250397 -93.87891388 -93.85614777 -93.83475494 -93.81443787 -93.51556396 -93.16397858 x0.2424242496 -92.81221008 x0.2434017658 -92.46097565 -92.10933685 -91.75797272 -91.40596771 -91.05480957 -90.703125 -90.35197449 -90.00005341 -89.64833069 -89.29642487 -88.94536591 -88.59345245 -88.24186707 -87.89083862 -87.53879547 -87.18766022 -86.83607483 -86.48445892 -86.13298798 -85.78100586 -85.42920685 -85.0778656 -84.72644806 -84.37506104 x0.2668621838 -84.02339172 x0.2678397 -83.67183685 -83.32027435 -82.96880341 -82.61690521 -82.26573944 -81.91412354 -81.56270599 -81.21089172 -80.85932922 -80.50782013 -80.15628815 -79.80454254 -79.45318604 -79.10142517 -78.74991608 -78.39840698 -78.04681396 -77.69528198 -77.34365082 -76.99221802 -76.64073944 -76.28916168 -75.93722534 -75.5863266 -75.23439026 -74.88256073 -74.53091431 -74.17945099 -73.82816315 -73.4765625 x0.297165215 -73.12471771 x0.2981427312 -72.77326965 -72.42196655 -72.07049561 -71.71871185 -71.36724091 -71.01579285 -70.66396332 -70.31231689 -69.96099091 -69.60956573 -69.2578125 -68.90632629 -68.55438995 -68.2033844 -67.85182953 -67.49979401 -67.14846039 -66.79668427 -66.44523621 -66.09378815 -65.74243164 -65.39041138 -65.03909302 -64.68755341 -64.33565521 -63.98432159 -63.63277817 -63.28139877 -62.92975235 -62.57808685 -62.22626495 -61.87521362 x0.3294232786 -61.52323914 x0.3304007947 -61.17179871 -60.8200798 -60.46903992 -60.11749649 -59.76571655 -59.41381073 -59.06235504 -58.71113586 -58.35943985 -58.00794601 -57.65601349 -57.30449677 -56.95283508 -56.60138321 -56.24978256 -55.89867401 -55.54664612 -55.19552231 -54.8441124 -54.49192429 -54.14077377 -53.78865814 -53.43777084 -53.08612442 -52.73423004 -52.38290405 -52.03130341 -51.67964554 -51.32822418 -50.97655487 x0.3597263098 -50.62523651 x0.360703826 -50.27373886 -49.92136383 -49.57020569 -49.21824646 -48.86746979 -48.51581192 -48.16392136 -47.81227493 -47.46107483 -47.10931015 -46.75773239 -46.40627289 -46.05514526 -45.70356369 -45.35123062 -45.00028229 -44.64833832 -44.29677582 -43.94533157 -43.59440231 -43.24197006 -42.89065933 -42.53913116 -42.18762589 -41.83597183 -41.4846077 -41.13315964 -40.78186035 -40.4301796 -40.07788467 -39.72669983 -39.37467957 x0.3919843733 -39.02323532 x0.3929618895 -38.67201614 -38.32023621 -37.96833801 -37.61686707 -37.26586151 -36.91412354 -36.56280899 -36.2108345 -35.85923767 -35.50828552 -35.15553665 -34.80471802 -34.45311737 -34.1014595 -33.74998856 -33.39873886 -33.0466423 -32.69543839 -32.34375381 -31.99185944 -31.64094925 -31.28888321 -30.93751526 -30.58550644 -30.23398399 -29.88276291 -29.53146172 -29.17924309 -28.82774162 -28.47654533 x0.4222874045 -28.12514305 x0.4232649207 -27.7735157 -27.42168236 -27.07026482 -26.7183342 -26.36751366 -26.01599503 -25.66420746 -25.31237411 -24.96137238 -24.60906029 -24.25840759 -23.90583611 -23.55424309 -23.20311356 -22.85111237 -22.50030518 -22.14834595 -21.79711342 -21.44508553 -21.09440613 -20.74219131 -20.39069748 -20.03963661 -19.68751907 -19.33540535 -18.98475838 -18.63292122 -18.28107452 -17.92967224 -17.57847595 -17.22660446 -16.87447739 x0.4545454681 -16.52266884 x0.4555229843 -16.17162704 -15.81982899 -15.46895218 -15.11732864 -14.76584053 -14.41400719 -14.06231976 -13.71068954 -13.35957909 -13.0074749 -12.65591812 -12.30516243 -11.95309639 -11.60125065 -11.25000668 -10.89822578 -10.54682636 -10.19559765 -9.843922615 -9.492348671 -9.140686989 -8.789406776 -8.437381744 -8.085835457 -7.734455585 -7.382839203 -7.031270504 -6.679451466 -6.32804966 -5.976819038 x0.4848484993 -5.625026703 x0.4858260155 -5.273333073 -4.921647549 -4.57044363 -4.218632698 -3.867095709 -3.515827417 -3.164312601 -2.812455177 -2.460875273 -2.109203339 -1.757820725 -1.406288385 -1.054721594 -0.703020215 -0.351698637 2.427518484e-05 0.351539582 0.7031132579 1.054671168 1.406401992 1.757814407 2.109508276 2.460862875 2.812501192 3.1641469 3.515648365 3.86716795 4.218748093 4.570329666 4.921858311 5.273546219 5.62499094 5.976554871 6.328083038 6.67969799 7.031258106 7.382876396 7.734297276 8.086149216 8.43764019 8.788971901 9.140665054 9.492019653 9.843785286 10.19538403 10.54692459 10.89831448 11.25000858 x0.5327468514 11.60141277 x0.5337243676 11.95334053 12.30476189 12.64957047 12.63229656 12.61542606 12.5992651 12.58302784 12.56738091 12.55178356 12.53700256 12.52237129 12.50777245 12.4943037 12.48087788 12.46780968 12.45454407 12.44208622 12.42996883 12.41788578 12.40637112 12.39531708 12.38438988 12.37391949 12.36345577 12.35368633 12.34412766 12.33449745 12.32584286 12.31720734 12.30891991 12.3007412 12.29322052 12.28550148 12.2786541 12.27191925 12.26561928 12.25934505 12.25370121 12.24818611 12.24267864 12.23802185 12.23327923 12.22885895 12.22486591 12.22131062 12.2177639 12.21453381 12.21204472 12.2092495 12.20731449 12.2048502 12.20345211 12.20226097 12.20119762 12.20044899 12.20011425 12.19968891 12.20000744 12.20022106 12.20108509 12.20226765 12.20367146 x0.59433043 12.20527172 x0.5953079462 12.20732117 12.20968151 12.2119503 12.21496582 12.21839619 12.22162724 12.22562885 12.2296114 12.2337122 12.23867226 12.24354076 12.2488451 12.25424194 12.2605257 12.26670361 12.27299595 12.27985001 12.28734684 12.29462528 12.30215836 12.31044292 12.31896591 12.32770443 12.33679199 12.34632301 12.35598278 12.36599064 12.37634373 12.38736057 12.39807892 12.4094696 12.42130947 12.43330669 12.44586086 12.45855331 12.47171211 12.48513126 12.49901295 12.51314831 12.52766514 12.54265022 12.55799675 12.57305431 12.58925819 12.60562992 12.62225533 12.63950729 12.65712166 12.67502117 12.69342995 12.71166039 12.73073769 12.75033092 12.77009106 12.79049015 12.81129742 12.83240032 12.85391617 12.87572002 12.89819336 12.92097759 12.94406319 12.96782017 12.99224949 x0.657869041 13.01676655 x0.6588465571 13.04185009 13.06726551 13.09335136 13.11979771 13.14682388 13.17429352 13.2022562 13.23055935 13.25972748 13.28924465 13.31914234 13.34964085 13.38064766 13.41217518 13.44444561 13.47763252 13.51070118 13.54442024 13.57921028 13.61415291 13.64988518 13.68620396 13.72333622 13.76036453 13.79904366 13.83752918 13.87725925 13.91745949 13.95826149 14.00037861 14.04242897 14.08552933 14.12913609 14.17437649 14.21944904 14.26519203 14.31247044 14.35972881 14.40854263 14.45823383 14.50835228 14.55995464 14.61200714 14.6652813 14.71902275 14.77446651 14.83057499 14.88763809 14.94602394 15.00507927 15.06549263 15.12709713 15.18992138 15.25429916 15.31963158 15.38607979 15.45447731 15.52437019 15.59562969 15.66778755 15.74201965 15.81735134 x0.7194526196 15.89535332 x0.7204301357 15.97485924 16.05641365 16.13975143 16.22486496 16.31268501 16.40259171 16.49495697 16.59004211 16.68808365 16.78915405 16.89317894 16.99999237 17.1102581 17.22484207 17.34291458 17.46552467 17.59222794 17.72416687 17.86110497 18.00336456 18.1518116 18.30620575 18.46718216 18.63565063 18.81143188 18.99529648 19.18823051 19.38946342 19.60097122 19.82253265 20.05530548 20.29905128 20.55480576 20.8236618 21.10634041 21.40266037 21.71334457 22.03974342 22.38178062 22.74096107 23.11727333 23.51199913 23.92589378 24.3593483 24.81386948 25.28886604 25.78739548 26.30896759 26.85493469 27.42675018 28.02640915 28.65293503 29.3106823 29.99875641 30.7193985 31.47564125 32.26753616 33.09830475 33.97034836 34.88492584 35.8452301 36.85400391 37.9134407 39.02717209 x0.7829912305 40.19839478 x0.7839687467 41.43107986 42.72550201 44.08901978 45.52266693 47.03256607 48.6194191 50.28736877 52.04463959 53.88686371 55.82282257 57.84971237 59.97327805 62.19246674 64.50495911 66.91353607 69.41324615 71.9929657 74.65518951 77.38815308 80.17959595 83.02291107 85.90283203 88.80589294 91.71356964 94.6157608 97.49390411 100.3399277 103.1342468 105.8708191 108.5346069 111.1200333 113.6238785 116.0333939 118.3508987 120.5743179 122.7002029 124.7342758 126.67099 128.5195923 130.2785187 131.9514618 133.5428467 135.0563812 136.495285 137.862381 139.1619568 140.3997955 141.5757141 142.6951904 143.7622528 144.7778625 145.746048 146.6695557 147.5508423 148.3922272 149.1962738 149.9644318 150.6999817 151.4039001 152.0779877 152.724472 153.3438416 x0.8445748091 153.9387512 x0.8455523252 154.5097961 155.05867 155.5861359 156.0935974 156.5820312 157.052475 157.5056305 157.9426727 158.3641357 158.7709961 159.1637573 159.5432434 159.9098511 160.2645111 160.6075745 160.9397125 161.2611542 161.572525 161.8743286 162.1669159 162.4507141 162.7260284 162.9932404 163.2527161 163.5046997 163.7496033 163.9876099 164.2190094 164.4440918 164.6630707 164.8761749 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 x0.90811342 164.9063263 x0.9090909362 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 x0.9696969986 164.9063263 x0.9706745148 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 165.3670959 165.9415283 166.5244751 167.1159363 167.716095 168.3247681 168.9422455 169.5683289 170.2032623 170.8468018 171.499115 172.1601105 172.8298187 173.5082855 174.195343 174.8907471 175.5949707}}
 name clipped709_JMh_01
 xpos 164
 ypos 382
}
Constant {
 inputs 0
 channels rgb
 color 0.05
 name Constant5
 xpos 2210
 ypos 1516
}
CMSTestPattern {
 inputs 0
 cube_size 16
 name CMSTestPattern1
 xpos 1789
 ypos 1020
}
Reformat {
 type scale
 scale 0.1428571429
 filter impulse
 name Reformat10
 xpos 1789
 ypos 1092
}
set N82ff5c00 [stack 0]
Colorspace {
 colorspace_out CIE-XYZ
 name Colorspace26
 xpos 1789
 ypos 1116
}
Multiply {
 value 100
 name Multiply14
 label "Mult by 100 to put in absolute nits"
 xpos 1789
 ypos 1140
}
Group {
 name ZCAM12
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos 1789
 ypos 1182
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 inverseData1 M,h
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set N82ff4400 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set N82f8ec00 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $N82f8ec00
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set N83353200 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $N83353200
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set N82f8d000 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set N82f8cc00 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $N82f8d000
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set N83317c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set N83317800 [stack 0]
push $N82f8d000
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set N83317400 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set N83317000 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set N83316c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set N83316800 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $N82f8cc00
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $N82f8d000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $N82f8d000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $N82f8d000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  surrounds dark
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $N82ff4400
push $N82f8cc00
push $N83317c00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set N83314c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $N83314c00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $N82f8cc00
push $N83317800
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set N832a3400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $N832a3400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $N82f8cc00
push $N83317400
push $N83317c00
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set N832a1c00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set N832a1800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $N832a1800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $N83316c00
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $N832a1c00
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $N83316c00
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $N83316800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $N832a1c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $N83317800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $N83317000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $N83317c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $N83317400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $N82f8cc00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $N82ff4400
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set N831d4400 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set N83157400 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $N83157400
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $N831d4400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $N831d4400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $N831d4400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set N83155c00 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set N83155000 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $N83155000
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $N83155000
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set N83103c00 [stack 0]
push $N83103c00
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $N831d4400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $N831d4400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  selected true
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $N83155c00
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set N83101000 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $N83101000
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $N83101000
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set N8310b200 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set N830b3c00 [stack 0]
 Dot {
  name Dot44
  label C,h
  xpos -1673
  ypos 2768
 }
push $N8310b200
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set N830b3400 [stack 0]
 Dot {
  name Dot20
  label M,h
  xpos -1737
  ypos 2767
 }
push $N8310b200
push $N831d4400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set N830b2800 [stack 0]
push $N831d4400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set N830b1c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set N8310ab00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $N830b3c00
push $N830b3400
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set N8345bc00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $N8345bc00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $N8310ab00
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set N83459c00 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $N83459c00
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set N83109d00 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $N83109d00
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $N831d4400
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $N831d4400
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $N831d4400
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $N8310ab00
push $N831d4400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $N83155c00
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $N830b2800
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $N830b1c00
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $N8310b200
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
Group {
 name ZCAM13
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos 1789
 ypos 1319
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 direction inverse
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 inverseData1 M,h
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set N83393000 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set N83391c00 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $N83391c00
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set N83780100 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $N83780100
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set N83717c00 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set N83717800 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $N83717c00
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set N83716c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set N83716800 [stack 0]
push $N83717c00
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set N83716400 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set N83716000 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set N83715c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set N83715800 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $N83717800
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $N83717c00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $N83717c00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $N83717c00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  surrounds dark
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $N83393000
push $N83717800
push $N83716c00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set N836a7800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $N836a7800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $N83717800
push $N83716800
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set N836a6400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $N836a6400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $N83717800
push $N83716400
push $N83716c00
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set N836a4c00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set N836a4800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $N836a4800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $N83715c00
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $N836a4c00
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $N83715c00
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $N83715800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $N836a4c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $N83716800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $N83716000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $N83716c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $N83716400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $N83717800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $N83393000
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set N8354b000 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set N8354a400 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $N8354a400
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $N8354b000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $N8354b000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $N8354b000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set N83548c00 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set N834ffc00 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $N834ffc00
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $N834ffc00
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set N834fec00 [stack 0]
push $N834fec00
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $N8354b000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $N8354b000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  selected true
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $N83548c00
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set N834abc00 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $N834abc00
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $N834abc00
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set N8371c100 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set N834aac00 [stack 0]
 Dot {
  name Dot44
  label C,h
  xpos -1673
  ypos 2768
 }
push $N8371c100
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set N834aa400 [stack 0]
 Dot {
  name Dot20
  label M,h
  xpos -1737
  ypos 2767
 }
push $N8371c100
push $N8354b000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set N834a9800 [stack 0]
push $N8354b000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set N834a8c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set N8385b900 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $N834aac00
push $N834aa400
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set N8384ac00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $N8384ac00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $N8385b900
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set N83848c00 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $N83848c00
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set N8385ab00 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $N8385ab00
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $N8354b000
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $N8354b000
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $N8354b000
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $N8385b900
push $N8354b000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $N83548c00
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $N834a9800
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $N834a8c00
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $N8371c100
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
Multiply {
 value 0.01
 name Multiply15
 label "Div by 100 to go from nits"
 xpos 1789
 ypos 1371
}
Colorspace {
 colorspace_in CIE-XYZ
 name Colorspace27
 xpos 1789
 ypos 1413
}
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.blue 0 2 white -1 -1 rgba.alpha 0 3"
 name Shuffle40
 xpos 1789
 ypos 1546
}
set N83b76000 [stack 0]
push $N82ff5c00
Difference {
 inputs 2
 name Difference2
 xpos 2074
 ypos 1326
}
push $N314eec00
Group {
 name ACES_OutputTransform_v1_2_1
 tile_color 0xa57aaaff
 xpos 1339
 ypos 10
 addUserKnob {20 ACES_OutputTransform_tab l "ACES OutputTransform"}
 addUserKnob {41 gamut l "input gamut" T GamutToXYZ_lite.gamut}
 addUserKnob {26 ""}
 addUserKnob {35 presets t "display output presets." M {display/sRGB "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 0 limiting_pri 0 eotf 0 stretch_black 0 d60_sim 0 force_d65_cat 0 dark_to_dim 1 legal_range 0 label \"sRGB\"\}" "display/sRGB D60 sim." "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 0 limiting_pri 0 eotf 0 stretch_black 0 d60_sim 1 force_d65_cat 0 dark_to_dim 1 legal_range 0 label \"sRGB D60 sim.\"\}" display/Rec.709 "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 0 limiting_pri 0 eotf 1 stretch_black 0 d60_sim 0 force_d65_cat 0 dark_to_dim 1 legal_range 0 label \"Rec.709\"\}" "display/Rec.709 D60 sim." "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 0 limiting_pri 0 eotf 1 stretch_black 0 d60_sim 1 force_d65_cat 0 dark_to_dim 1 legal_range 0 label \"Rec.709 D60 sim.\"\}" display/Rec.2020 "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 1 limiting_pri 1 eotf 1 stretch_black 0 d60_sim 0 force_d65_cat 0 dark_to_dim 1 legal_range 0 label \"Rec.2020\"\}" display/P3D60 "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 4 limiting_pri 4 eotf 4 stretch_black 0 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3D60\"\}" display/P3D65 "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 2 limiting_pri 2 eotf 4 stretch_black 0 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3D65\"\}" "display/P3D65 D60 sim." "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 2 limiting_pri 2 eotf 4 stretch_black 0 d60_sim 1 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3D65 D60 sim.\"\}" display/P3DCI "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 3 limiting_pri 3 eotf 4 stretch_black 0 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3DCI\"\}" "display/P3DCI D60 sim." "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 3 limiting_pri 3 eotf 4 stretch_black 0 d60_sim 1 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3DCI D60 sim.\"\}" "display/P3DCI D65 sim." "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 3 limiting_pri 3 eotf 4 stretch_black 0 d60_sim 0 force_d65_cat 1 dark_to_dim 0 legal_range 0 label \"P3DCI D65 sim.\"\}" display/DCDM "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 7 limiting_pri 7 eotf 5 stretch_black 0 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"DCDM\"\}" "display/P3D65 ST2084 108nits 7.2nits" "knobs this \{lum \{0.0001 7.2 108\} override_ssts_params 0 use_c9 0 display_pri 2 limiting_pri 2 eotf 6 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3D65 ST2084 108nits 7.2nits\"\}" "display/P3D65 ST2084 1000nits 15nits" "knobs this \{lum \{0.0001 15 1000\} override_ssts_params 0 use_c9 0 display_pri 2 limiting_pri 2 eotf 6 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3D65 ST2084 1000nits 15nits\"\}" "display/P3D65 ST2084 2000nits 15nits" "knobs this \{lum \{0.0001 15 2000\} override_ssts_params 0 use_c9 0 display_pri 2 limiting_pri 2 eotf 6 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3D65 ST2084 2000nits 15nits\"\}" "display/P3D65 ST2084 2000nits 15nits" "knobs this \{lum \{0.0001 15 2000\} override_ssts_params 0 use_c9 0 display_pri 2 limiting_pri 2 eotf 6 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3D65 ST2084 2000nits 15nits\"\}" "display/P3D65 ST2084 4000nits 15nits" "knobs this \{lum \{0.0001 15 4000\} override_ssts_params 0 use_c9 0 display_pri 2 limiting_pri 2 eotf 6 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3D65 ST2084 4000nits 15nits\"\}" display/Rec2020_HLG_1000nits_15nits "knobs this \{lum \{0.0001 15 1000\} override_ssts_params 0 use_c9 0 display_pri 1 limiting_pri 1 eotf 7 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"Rec2020_HLG_1000nits_15nits\"\}" display/Rec2020_ST2084_1000nits_15nits "knobs this \{lum \{0.0001 15 1000\} override_ssts_params 0 use_c9 0 display_pri 1 limiting_pri 1 eotf 6 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"Rec2020_ST2084_1000nits_15nits\"\}" display/Rec2020_ST2084_2000nits_15nits "knobs this \{lum \{0.0001 15 2000\} override_ssts_params 0 use_c9 0 display_pri 1 limiting_pri 1 eotf 6 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"Rec2020_ST2084_2000nits_15nits\"\}" display/Rec2020_ST2084_4000nits_15nits "knobs this \{lum \{0.0001 15 4000\} override_ssts_params 0 use_c9 0 display_pri 1 limiting_pri 1 eotf 6 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"Rec2020_ST2084_4000nits_15nits\"\}" display/OCES "knobs this \{lum \{0.0001 4.8 10000\} override_ssts_params 0 use_c9 0 display_pri 6 limiting_pri 6 eotf 9 stretch_black 0 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"OCES\"\}" "" ""}}
 addUserKnob {26 display_label l " " T "<b>Display Settings</b>"}
 addUserKnob {78 lum l luminance t "<b>SSTS Display Luminance</b>: \ny_min y_mid y_max\n\nAccording to Zach Lewis's ACES_OT\nhttps://gist.github.com/zachlewis/786c0be941868644c993fde1c3515c2c\n\n<b>Standard Cinema</b>: \n0.02 4.8 48\n<b>Dolby Cinema</b>: \n0.0001 7.2 108\n<b>Dolby Pulsar</b>: \n0.005 15 4000\n<b>Dolby PRR-4220</b>: \n0.005 10 600\n<b>Sony BVM-X300</b>: \n0.0001 10 1000\n<b>ACES OCES</b>: \n0.0001 4.8 10000\n\n" n 3}
 lum {0.02 4.8 48}
 addUserKnob {20 ssts_params_grp l "SSTS Parameters" n 1}
 ssts_params_grp 0
 addUserKnob {6 override_ssts_params l "override ssts params" t "Enable overrides of SSTS params.\n\nOtherwise the values will be calculated automatically by the algorithm." +STARTLINE}
 addUserKnob {35 presets_ssts_param l presets t "If you want to override the default SSTS parameters and play around, here are some useful starting points." M {contrast/default "knobs this \{override_ssts_params 0 pctLow 0.35 pctHigh 0.89 slope \{0 1.5 0.\} exposure 0.0 use_c9 0\}" contrast/sdr "knobs this \{override_ssts_params 1 pctLow 0.35 pctHigh 0.89 slope \{0.1 1.6 0.01\} exposure 0.0 use_c9 0\}" contrast/high "knobs this \{override_ssts_params 1 pctLow 0.2 pctHigh 0.89 slope \{0.28 1.75 0.01\} exposure 0.0 use_c9 0\}" contrast/med "knobs this \{override_ssts_params 1 pctLow 0.40 pctHigh 0.89 slope \{0.38 1.3 0.01\} exposure 0.0 use_c9 0\}" contrast/med-low "knobs this \{override_ssts_params 1 pctLow 0.40 pctHigh 0.80 slope \{0.38 1.42 0.01\} exposure 0.0 use_c9 0\}" contrast/low "knobs this \{override_ssts_params 1 pctLow 0.40 pctHigh 0.80 slope \{0.38 1.2 0.01\} exposure 0.0 use_c9 0\}" ""}}
 addUserKnob {7 exposure R -5 5}
 addUserKnob {7 pctLow l knee}
 pctLow 0.35
 addUserKnob {7 pctHigh l shoulder}
 pctHigh 0.89
 addUserKnob {78 slope n 3}
 slope {0.38 1.501 0.01}
 addUserKnob {20 endGroup n -1}
 addUserKnob {6 use_c9 l "use SegmentedSpline_c9" t "In ACES 1.1 the Output Transform was re-written for HDR tonescales. \n\nIn ACES 1.1, HDR transforms use the new SSTS (Single Stage Tone Scale), while SDR transforms continue to use the old SegmentedSpline_c5 -> OCES -> SegmentedSpline_c9 -> ODT transform.\n\nIf this is enabled, the SegmentedSpline_c9 transform is used to maintain compatibility with the ACES SDR output transforms and enable a 1:1 match with the AMPAS CTL.\n\nIf you are curious, turn use_c9 off and play around with the SSTS Parameters." +STARTLINE}
 use_c9 true
 addUserKnob {26 ""}
 addUserKnob {4 display_pri l "display pri" t "Display encoding primaries." M {Rec709 Rec2020 P3D65 P3DCI P3D60 ACEScg ACES XYZ}}
 addUserKnob {4 limiting_pri l "limiting pri" t "Limiting primaries for the output transform." -STARTLINE M {Rec709 Rec2020 P3D65 P3DCI P3D60 ACEScg ACES XYZ}}
 addUserKnob {4 eotf l EOTF t "Electrical to Optical Transfer Function of the monitor." M {sRGB BT.1886 "Gamma 2.2" "Gamma 2.4" "Gamma 2.6" DCDM "ST-2084 (PQ)" HLG Linear OCES ""}}
 eotf Linear
 addUserKnob {6 stretch_black l "stretch black" t "For hdr outputs: stretch black luminance to a PQ code value of 0" +STARTLINE}
 addUserKnob {6 d60_sim l "d60 sim" t "d60 whitepoint simulation." +STARTLINE}
 addUserKnob {6 force_d65_cat l "force d60 to d65 cat" -STARTLINE}
 addUserKnob {6 dark_to_dim l "dark to dim surround" t "Apply gamma adjustment to compensate for \"Dark to Dim\" surround. For SDR outputs only." +STARTLINE}
 addUserKnob {6 legal_range l "legal range" t "Output legal range." +STARTLINE}
}
 BackdropNode {
  inputs 0
  name Electrical_Optical_Transfer_Function
  tile_color 0x151515ff
  label "ACESlib.OutputTransforms.ctl : 185\n// EOTF"
  note_font_size 12
  xpos -2025
  ypos 2294
  bdwidth 3391
  bdheight 740
  z_order -10
 }
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x272727ff
  label "HDR EOTFs"
  note_font_size 42
  xpos 425
  ypos 2379
  bdwidth 910
  bdheight 617
  z_order -5
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x272727ff
  label "SDR EOTFs"
  note_font_size 42
  xpos -1158
  ypos 2384
  bdwidth 1436
  bdheight 608
  z_order -5
 }
 BackdropNode {
  inputs 0
  name AP1_to_XYZ
  tile_color 0x555b5cff
  label "ACESlib.OutputTransforms.ctl : 90\n// Rendering primaries to XYZ\n"
  note_font_size 12
  xpos -1400
  ypos 906
  bdwidth 380
  bdheight 156
 }
 BackdropNode {
  inputs 0
  name AP1_to_XYZ1
  tile_color 0x555a5cff
  label "// Apply desaturation to compensate for luminance difference\nlinearCV = mult_f3_f33( linearCV, ODT_SAT_MAT);\n( SDR only)"
  note_font_size 12
  xpos -1412
  ypos 669
  bdwidth 439
  bdheight 186
 }
 BackdropNode {
  inputs 0
  name D60_whitepoint_simulation
  tile_color 0x232323ff
  label "ACESlib.OutputTransforms.ctl : 150\n// Scale to avoid clipping when device calibration is different from D60. \n// To simulate D60, unequal code values are sent to the display.\n"
  note_font_size 12
  xpos -1399
  ypos 176
  bdwidth 818
  bdheight 463
 }
 BackdropNode {
  inputs 0
  name Luminance_to_Linear_Code_Values
  tile_color 0x272727ff
  label "ACESlib.OutputTransforms.ctl : 87\n/*  Scale absolute luminance to linear code value  */\n"
  note_font_size 12
  xpos -1367
  ypos -50
  bdwidth 315
  bdheight 148
 }
 BackdropNode {
  inputs 0
  name Output_Color_Encoding_Specification
  tile_color 0x1d1d1dff
  label "<font size=12>OCES\n<font size=0.1>\n- ACES Output Output Color Encoding Specification \n- An idealized reference display with 0.0001 / 4.8 / 10000 luma\n w/ ACES AP0 Primaries."
  note_font_size 27.4
  xpos -1833
  ypos 2379
  bdwidth 367
  bdheight 377
 }
 BackdropNode {
  inputs 0
  name Output_Legal_Range
  tile_color 0x272727ff
  label "ACESlib.OutputTransforms.ctl : 216\n"
  note_font_size 12
  xpos -1369
  ypos 3128
  bdwidth 318
  bdheight 176
 }
 BackdropNode {
  inputs 0
  name Single_Stage_Tone_Scale
  tile_color 0x272727ff
  label "<b>Single Stage Tone Scale : ACESlib.OutputTransforms.ctl : 82</b><pre>// Apply the tonescale independently in rendering-space RGB\nfloat rgbPost\[3] = ssts_f3( rgbPre, PARAMS);\n\nIf output is SDR, output OCES from SSTS and use SegmentedSpline_c9."
  note_font_size 12
  xpos -1502
  ypos -653
  bdwidth 609
  bdheight 533
 }
 BackdropNode {
  inputs 0
  name clamp_negatives
  tile_color 0x272727ff
  label "ACESlib.OutputTransforms.ctl : 174\n// Clip values < 0 (i.e. projecting outside the display primaries)\nNote: Also clamping values > 1 here."
  note_font_size 12
  xpos -1393
  ypos 2087
  bdwidth 386
  bdheight 120
 }
 BackdropNode {
  inputs 0
  name dim_surround_gamma_adjustment
  tile_color 0x272727ff
  label "ACESlib.OutputTransforms.ctl : 92\n// Apply gamma adjustment to compensate for dim surround\n"
  note_font_size 12
  xpos -1407
  ypos 1063
  bdwidth 395
  bdheight 258
 }
 BackdropNode {
  inputs 0
  name limit_primaries
  tile_color 0x555a5cff
  label "ACESlib.OutputTransforms.ctl : 130\n// Gamut limit to limiting primaries\n"
  note_font_size 12
  xpos -1408
  ypos 1655
  bdwidth 396
  bdheight 194
 }
 BackdropNode {
  inputs 0
  name limit_primaries1
  tile_color 0x555a5cff
  label "ACESlib.OutputTransforms.ctl : 144\n// CIE XYZ to display encoding primaries\n"
  note_font_size 12
  xpos -1402
  ypos 1892
  bdwidth 384
  bdheight 151
 }
 BackdropNode {
  inputs 0
  name limit_primaries2
  tile_color 0x555a5cff
  label "ACESlib.OutputTransforms.ctl : 130\n    // Apply CAT from ACES white point to assumed observer adapted white point\n    // TODO: Needs to expand from just supporting D60 sim to allow for any\n    // observer adapted white point.\n"
  note_font_size 12
  xpos -1407
  ypos 1337
  bdwidth 467
  bdheight 301
 }
 BackdropNode {
  inputs 0
  name rrt_sweeteners_
  tile_color 0x555a5cff
  label "<b>RRT Sweeteners : ACESlib.OutputTransforms.ctl : 79</b><pre>// RRT sweeteners\nfloat rgbPre\[3] = rrt_sweeteners( in);\n"
  note_font_size 18
  xpos -1469
  ypos -1234
  bdwidth 519
  bdheight 548
 }
 Input {
  inputs 0
  name Input
  xpos -1250
  ypos -1450
 }
 AddChannels {
  channels rgba
  name AddChannels
  xpos -1250
  ypos -1415
 }
 Group {
  name GamutToXYZ_lite
  xpos -1250
  ypos -1373
  addUserKnob {20 GamutToXYZ_lite_tab l GamutToXYZ_lite}
  addUserKnob {4 gamut t "Choose gamut" M {XYZ ACES ACEScg "Filmlight E-Gamut" "DaVinci WG" Rec709 Rec2020 P3D60 P3D65 P3DCI "Arri AlexaWideGamut" REDDRAGONcolor REDDRAGONcolor2 REDcolor REDcolor2 REDcolor3 REDcolor4 REDWideGamutRGB "GoPro Protune Native" CanonCinemaGamut SonySGamut SonySGamut3Cine PanasonicVGamut "DJI D-Gamut" "Fujifilm F-Gamut" BMDFilmV1 BMD4kFilmV1 BMD4kFilmV3 BMD46kFilmV1 BMD46kFilmV3 BMDWideGamutV4 "AdobeRGB\t" AdobeWideGamutRGB ROMM RIMM ERIMM ProPhotoRGB RusselRGB SharpRGB AppleRGB BestRGB}}
  gamut ACES
  addUserKnob {6 invert +STARTLINE}
  addUserKnob {26 ""}
  addUserKnob {26 chromaticity_coordinates_label l " " T "<b>Chromaticity Coordinates</b>"}
  addUserKnob {20 chromaticities_grp l "" +STARTLINE n 1}
  addUserKnob {41 rxy T ColorMatrix.rxy}
  addUserKnob {41 gxy T ColorMatrix.gxy}
  addUserKnob {41 bxy T ColorMatrix.bxy}
  addUserKnob {41 wxy T ColorMatrix.wxy}
  addUserKnob {41 matrix T ColorMatrix.matrix}
  addUserKnob {20 endGroup n -1}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -10
  }
  ColorMatrix {
   matrix {
       {{curve(which) 1 0.9525524378 0.6624541879 0.7053968906 0.4123907983 0.6369580626 0.5049495697 0.4865709841 0.4451698363 0.6380076408 0.5070186853 0.4462202489 0.4300414324 0.4581649601 0.4878340662 0.4517004192 0.7352752686 0.5022571683 0.7160496712 0.7064827085 0.5990839601 0.6796444654 0.6481720209 0.6369580626 0.6390493512 0.6141571999 0.3724023998 0.60689044 0.4017650783 0.6065810919 0.5766690373 0.7165006995 0.797760427 0.797760427 0.797760427 0.7976718545 0.7015837431 0.8156226277 0.4496616423 0.6318944097} {curve(which) 0 0 0.1340042055 0.1640413404 0.3575843275 0.1446169019 0.2646814585 0.2656676769 0.2771343887 0.2147038579 0.3587769568 0.3157556653 0.3700728714 0.3832037449 0.3432727158 0.3178463876 0.06860940903 0.2929667532 0.1296834797 0.1288010478 0.2489254922 0.1522114277 0.1940581352 0.1446169019 0.1578372866 0.2825684249 0.4324877858 0.2193847299 0.4560420811 0.2203479856 0.1855582297 0.1010205746 0.1351858526 0.1351858526 0.1351858526 0.1351878047 0.1554162204 0.04716260359 0.3162561059 0.2053879201} {curve(which) 0 9.367863095e-05 0.1561876982 0.08101774752 0.180480808 0.1688809693 0.1830150485 0.1982172877 0.1722826511 0.09774444997 0.0868505761 0.190669477 0.152531758 0.1112773567 0.1215386018 0.1830992699 0.1465712637 0.1552320272 0.1047228053 0.1151721701 0.1024464965 0.1186000481 0.108225815 0.1688809693 0.1516760886 0.05183707923 0.1436725408 0.124180764 0.09264881909 0.123526901 0.1882286519 0.1467743814 0.03134934977 0.03134934977 0.03134934977 0.03133957833 0.09979832917 0.1372147948 0.1845382005 0.1270133406}}
       {{curve(which) 0 0.3439664543 0.2722287476 0.2801307142 0.2126390189 0.2627002299 0.237623319 0.2289745659 0.209491685 0.2919537723 0.2207257152 0.1942579001 0.2022213936 0.1694435924 0.2289056629 0.2119505703 0.2866941094 0.1387997568 0.2612613738 0.2709796727 0.2150758505 0.2606855333 0.2830046713 0.2627002299 0.1743051857 0.2365771234 0.1383759677 0.1973138005 0.1721783578 0.2680045366 0.2973450124 0.258728236 0.2880711257 0.2880711257 0.2880711257 0.2880405784 0.3152042925 0.3790788651 0.2446159422 0.2276017666} {curve(which) 1 0.7281661034 0.6740817428 0.8202066422 0.7151686549 0.6779980659 0.6891706586 0.6917385459 0.7215952873 0.8238410354 0.839184761 0.7385566831 0.7585275769 0.8648257852 0.7808576822 0.7230190039 0.8429791331 0.910841465 0.8696421385 0.786606431 0.8850684762 0.7748944759 0.8131960034 0.6779980659 0.951146543 0.8896810412 0.911518693 0.943950057 0.8553914428 0.8326833844 0.6273635626 0.7246823311 0.7118432522 0.7118432522 0.7118432522 0.7118694782 0.6648360491 0.5769088268 0.6720442176 0.7383946776} {curve(which) 0 -0.07213255018 0.05368951708 -0.1003373638 0.07219231874 0.05930171534 0.07320601493 0.07928691059 0.06891305745 -0.1157948226 -0.05991046131 0.06718540192 0.03925102949 -0.03426937759 -0.009763340466 0.06503042579 -0.1296732277 -0.04964122549 -0.1309035122 -0.05758608505 -0.1001443192 -0.03558001295 -0.09620071948 0.05930171534 -0.1254517138 -0.1262581497 -0.04989464581 -0.1412638426 -0.02756982669 -0.1006879359 0.07529145479 0.01658944227 8.565396274e-05 8.565396274e-05 8.565396274e-05 8.991353388e-05 0.01995966583 0.04401229322 0.08333983272 0.0340035744}}
       {{curve(which) 0 -3.863927134e-08 -0.005574660841 -0.1037815213 0.01933082007 0 0 0 0 0.0027982709 -0.0544523783 -0.04792318866 -0.0176958181 -0.1061859056 -0.02100777067 -0.01945115253 -0.07968087494 0.07801423222 -0.009676366113 -0.009677864611 -0.03206583485 -0.009310216643 -0.01825834997 0 -0.11669112 -0.02325225808 -0.1602820009 -0.1427432895 -0.10720893 -0.02941203304 0.02703136392 -2.906408625e-08 -3.236030111e-08 -3.236030111e-08 -3.236030111e-08 0 0 -0.01229703799 0.02518104948 0} {curve(which) 0 0 0.004060741514 -0.07290724665 0.1191947311 0.0280726999 0.0449459292 0.04511339962 0.04706057906 -0.06703422964 -0.0003228379355 -0.0002844714036 0.08768811822 0.02554347552 0.01782695204 0.01650637016 -0.3473432064 -0.3148325086 -0.2364816219 0.004600019194 -0.02765839547 -0.004612449091 -0.08316776901 0.0280726999 -0.5518454909 -0.4897170365 -0.171635136 -0.4278847873 0.07809129357 -0.08659287542 0.07068887353 0.05121183768 1.2621717e-08 1.2621717e-08 1.2621717e-08 -1.262213711e-08 0.04317118227 0.01672476344 0.1411857158 0.01001892332} {curve(which) 1 1.008825183 1.010339141 1.265746474 0.950532198 1.060985088 0.9638792276 1.043944359 0.9073553085 1.153293729 1.063571215 1.057001948 0.9388025999 1.089437366 1.01197505 1.011739731 1.51608181 1.325875998 1.335215807 1.094135642 1.148782015 1.102980375 1.190483928 1.060985088 1.745692492 1.590125084 1.409072995 1.65968585 1.118175387 1.205062628 0.9913375378 0.7738927603 0.8251045942 0.8251045942 0.8251045942 0.8248898983 0.8782252669 0.9955722094 0.9226909876 0.8150856495}}
     }
   invert {{parent.invert}}
   name ColorMatrix
   label "RGB to XYZ"
   xpos -40
   ypos 32
   addUserKnob {20 Gamut}
   addUserKnob {3 which}
   which {{parent.gamut}}
   addUserKnob {12 rxy}
   rxy {{curve(which) 1 0.7347 0.713 0.8 0.8 0.64 0.708 0.68 0.68 0.68 0.684 0.7530442228 0.7530444911 0.6997470013 0.8786825105 0.7011810359 0.7011805919 0.780308 0.69848046 0.74 0.73 0.766 0.73 0.71 0.708 0.9173 0.7422 1.0625 0.9175 0.8608 0.7177 0.64 0.7347 0.7347 0.7347 0.7347 0.734699 0.69 0.6898 0.625 0.7351916376} {curve(which) 0 0.2653 0.293 0.3177 0.313 0.33 0.292 0.32 0.32 0.32 0.313 0.3278305767 0.3278310295 0.3290469303 0.3249640074 0.3290141556 0.3290136991 0.304253 0.19302645 0.27 0.28 0.275 0.28 0.31 0.292 0.2502 0.2859 0.3948 0.2983 0.3689 0.3171 0.33 0.2653 0.2653 0.2653 0.2653 0.265301 0.31 0.3206 0.34 0.2648083624}}
   addUserKnob {12 gxy}
   gxy {{curve(which) 0 0 0.165 0.18 0.1682 0.3 0.17 0.265 0.265 0.265 0.221 0.2995702285 0.2995704905 0.304264039 0.3008887144 0.3006003047 0.3006003955 0.121595 0.32955538 0.17 0.14 0.225 0.165 0.21 0.17 0.2833 0.414 0.3689 0.2983 0.3282 0.228 0.21 0.1152 0.1596 0.1596 0.1596 0.159597 0.18 0.0736 0.28 0.2153361345} {curve(which) 1 1 0.83 0.9 0.9877 0.6 0.797 0.69 0.69 0.69 0.848 0.700699322 0.7006994156 0.6236411451 0.6790547558 0.6837888343 0.6837888243 1.493994 1.02459662 1.14 0.855 0.8 0.84 0.88 0.797 1.7072 1.3035 0.7775 1.2835 0.6156 0.8616 0.71 0.8264 0.8404 0.8404 0.8404 0.840403 0.77 0.9003 0.595 0.7741596639}}
   addUserKnob {12 bxy}
   bxy {{curve(which) 0 0.0001 0.128 0.065 0.079 0.15 0.131 0.15 0.15 0.15 0.0861 0.07964206674 0.1450115843 0.1349139613 0.09539869461 0.1081544556 0.1453319462 0.095612 0.10844263 0.08 0.1 0.089 0.1 0.09 0.131 0.0856 0.0342 0.0956 0.0756 0.0783 0.1006 0.15 0.1566 0.0366 0.0366 0.0366 0.036598 0.1 0.1166 0.155 0.1301229508} {curve(which) 0 -0.077 0.044 -0.0805 -0.1155 0.06 0.046 0.06 0.06 0.06 -0.102 -0.05493795109 0.05109712509 0.03471744128 -0.02937932683 -0.008688175787 0.05161680362 -0.084589 -0.03467857 -0.1 -0.05 -0.087 -0.03 -0.08 0.046 -0.0708 -0.0833 -0.0332 -0.086 -0.0233 -0.082 0.06 0.0177 0.0001 0.0001 0.0001 0.000105 0.02 0.0374 0.07 0.03483606557}}
   addUserKnob {12 wxy}
   wxy {{curve(which) 0.33333333 0.32168 0.32168 0.3127 0.3127 0.3127 0.3127 0.32168 0.3127 0.314 0.3127 0.3216831877 0.3216832104 0.3216832894 0.3216832894 0.3216832104 0.3216832894 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3135 0.3135 0.3135 0.3127 0.3127 0.3127 0.3127 0.3457 0.3457 0.3457 0.3457 0.345704 0.33243 0.33333333 0.3127 0.3457} {curve(which) 0.33333333 0.33767 0.33767 0.329 0.329 0.329 0.329 0.33767 0.329 0.351 0.329 0.337673316 0.3376736101 0.3376734472 0.3376734472 0.3376736101 0.3376734472 0.329 0.329 0.329 0.329 0.329 0.329 0.329 0.329 0.3305 0.3305 0.3305 0.329 0.329 0.329 0.329 0.3585 0.3585 0.3585 0.3585 0.35854 0.34744 0.33333333 0.329 0.3585}}
  }
  Output {
   name Output
   xpos -40
   ypos 86
  }
 end_group
 ColorMatrix {
  matrix {
      {1.049811006 0 -9.748453158e-05}
      {-0.4959030151 1.373313069 0.09824004024}
      {4.020908051e-08 0 0.9912520051}
    }
  name ColorMatrix4
  label "XYZ to ACES"
  note_font Helvetica
  xpos -1250
  ypos -1338
 }
 Dot {
  name Dot7
  label " ACES 2065-1 IN"
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1216
  ypos -1268
 }
 Group {
  name glow_module1
  note_font Helvetica
  xpos -1250
  ypos -1089
  addUserKnob {20 Params_tab l Params}
  addUserKnob {7 RRT_GLOW_GAIN}
  RRT_GLOW_GAIN 0.05
  addUserKnob {7 RRT_GLOW_MID}
  RRT_GLOW_MID 0.08
  addUserKnob {6 invert +STARTLINE}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -562
  }
  Dot {
   name Dot2
   xpos -6
   ypos -510
  }
set N7fb29c00 [stack 0]
  Dot {
   name Dot4
   xpos -116
   ypos -510
  }
set N7fb29800 [stack 0]
  Expression {
   temp_name0 chroma
   temp_expr0 sqrt(b*(b-g)+g*(g-r)+r*(r-b))
   temp_name1 ycRadiusWeight
   temp_expr1 1.75
   channel0 {-rgba.red rgba.green -rgba.blue none}
   expr0 "( b + g + r + ycRadiusWeight * chroma) / 3.0"
   channel1 {rgba.red -rgba.green -rgba.blue none}
   expr1 0
   expr2 0
   name rgb_2_yc1
   xpos -150
   ypos -466
  }
push 0
push $N7fb29800
  Dot {
   name Dot3
   xpos -226
   ypos -510
  }
  Expression {
   temp_name0 TINY
   temp_expr0 1e-10
   temp_name1 min_f3
   temp_expr1 min(r,min(g,b))
   temp_name2 max_f3
   temp_expr2 max(r,max(g,b))
   expr0 "(max( max_f3, TINY) - max( min_f3, TINY)) / max( max_f3, 1e-2)"
   expr1 0
   expr2 0
   name rgb_2_saturation1
   xpos -260
   ypos -466
  }
set N7fb28c00 [stack 0]
  Expression {
   channel0 {rgba.red rgba.green rgba.blue none}
   expr0 "(r - 0.4) / 0.2"
   name Expression1
   xpos -370
   ypos -466
  }
  Expression {
   temp_name0 t
   temp_expr0 "max( 1.0 - fabs( r / 2.0), 0.0)"
   temp_name1 sign
   temp_expr1 r>0?1:r<0?-1:0
   temp_name2 valy
   temp_expr2 "1.0 + sign * (1.0 - t * t)"
   channel0 {-rgba.red -rgba.green rgba.blue none}
   expr0 "valy / 2"
   channel1 {rgba.red rgba.green -rgba.blue none}
   expr1 0
   channel2 {-rgba.red rgba.green rgba.blue none}
   expr2 0
   name sigmoid_shaper1
   xpos -370
   ypos -442
  }
push $N7fb28c00
  Merge2 {
   inputs 3+1
   operation plus
   bbox B
   output rgb
   name Merge2
   note_font Helvetica
   xpos -260
   ypos -393
  }
set N7fad3c00 [stack 0]
  Expression {
   temp_name0 ycOut
   temp_expr0 g
   temp_name1 glowGainIn
   temp_expr1 "RRT_GLOW_GAIN * b"
   temp_name2 glowMid
   temp_expr2 RRT_GLOW_MID
   channel0 rgb
   expr0 "1 + ((ycOut <= ((1 + glowGainIn) * 2./3. * glowMid)) ? -glowGainIn / (1 + glowGainIn) : ( ycOut >= (2. * glowMid)) ? 0 : glowGainIn * (glowMid / ycOut - 1./2.) / (glowGainIn / 2. - 1.))"
   channel1 none
   channel2 none
   name glow_inv
   xpos -150
   ypos -346
  }
push $N7fad3c00
  Expression {
   temp_name0 ycIn
   temp_expr0 g
   temp_name1 glowGainIn
   temp_expr1 "RRT_GLOW_GAIN * b"
   temp_name2 glowMid
   temp_expr2 RRT_GLOW_MID
   channel0 rgb
   expr0 "1 + ( ycIn <= 2./3. * glowMid ? glowGainIn : ycIn >= 2. * glowMid ? 0 : glowGainIn * (glowMid / ycIn - 1./2.) )"
   channel1 none
   channel2 none
   name glow_fwd
   xpos -370
   ypos -346
  }
  Switch {
   inputs 2
   which {{parent.invert}}
   name Switch_direction
   note_font Helvetica
   xpos -260
   ypos -297
  }
  Dot {
   name Dot5
   xpos -226
   ypos -246
  }
push $N7fb29c00
  Merge2 {
   inputs 2
   operation multiply
   bbox B
   output rgb
   name Merge3
   note_font Helvetica
   xpos -40
   ypos -249
  }
  Output {
   name Output
   xpos -40
   ypos -178
  }
 end_group
 Group {
  name red_modifier1
  note_font Helvetica
  xpos -1250
  ypos -1041
  addUserKnob {20 Params_tab l Params}
  addUserKnob {7 RRT_RED_SCALE}
  RRT_RED_SCALE 0.82
  addUserKnob {7 RRT_RED_PIVOT}
  RRT_RED_PIVOT 0.03
  addUserKnob {7 RRT_RED_HUE}
  addUserKnob {7 RRT_RED_WIDTH R 0 360}
  RRT_RED_WIDTH 135
  addUserKnob {6 invert +STARTLINE}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -10
  }
  Dot {
   name Dot1
   xpos -6
   ypos 42
  }
set N7fad2000 [stack 0]
  Dot {
   name Dot2
   xpos -226
   ypos 42
  }
set N7fad1c00 [stack 0]
  Expression {
   temp_name0 TINY
   temp_expr0 1e-10
   temp_name1 min_f3
   temp_expr1 min(r,min(g,b))
   temp_name2 max_f3
   temp_expr2 max(r,max(g,b))
   channel0 rgb
   expr0 "(max( max_f3, TINY) - max( min_f3, TINY)) / max( max_f3, 1e-2)"
   channel1 none
   expr1 0
   channel2 none
   expr2 0
   name rgb_2_saturation
   xpos -260
   ypos 86
  }
push $N7fad1c00
  Dot {
   name Dot3
   xpos -336
   ypos 42
  }
  Expression {
   temp_name0 hue
   temp_expr0 "(r==g&&g==b)?0:(180/pi) * atan2( sqrt(3)*(g-b), 2*r-g-b)"
   channel0 {rgba.red -rgba.green -rgba.blue -rgba.alpha}
   expr0 "hue < 0 ? hue + 360 : hue"
   channel1 {-rgba.red rgba.green -rgba.blue none}
   expr1 0
   expr2 0
   name rgb_2_hue
   xpos -370
   ypos 86
  }
  Expression {
   temp_name0 hue
   temp_expr0 r
   temp_name1 centerH
   temp_expr1 RRT_RED_HUE
   temp_name2 hueCentered
   temp_expr2 hue-centerH
   channel0 {-rgba.red rgba.green -rgba.blue -rgba.alpha}
   expr0 "hueCentered < -180.0 ? hueCentered + 360.0 : (hueCentered > 180.0) ? hueCentered - 360.0 : hueCentered"
   name center_hue
   xpos -370
   ypos 134
  }
  Expression {
   temp_name0 centeredHue
   temp_expr0 g
   temp_name1 knot_coord
   temp_expr1 "(centeredHue - knots.0) * 4.0/w"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   channel0 {rgba.red -rgba.green -rgba.blue -rgba.alpha}
   expr0 "(min((centeredHue > knots.0?1:0) , (centeredHue < knots.4?1:0)) ? j == 3 ? t*t*t * -1./6 + t*t * 3./6 +  t * -3./6 + 1 * 1./6 : j == 2 ? t*t*t * 3./6 + t*t * -6./6 + t * 0./6 + 1. *4./6 : j == 1 ? t*t*t * -3./6 + t*t * 3./6 + t * 3./6 + 1. * 1./6 : j == 0 ? t*t*t * 1./6 + t*t * 0./6 + t * 0./6 + 1. * 0./6 : 0 : 0) * 3/2"
   channel1 none
   channel2 none
   name cubic_basis_shaper
   xpos -370
   ypos 182
   addUserKnob {20 param}
   addUserKnob {7 w R 0 360}
   w {{parent.RRT_RED_WIDTH}}
   addUserKnob {78 knots n 5}
   knots {{-w/2} {-w/4} 0 {w/4} {w/2}}
  }
  Dot {
   name Dot4
   xpos -336
   ypos 234
  }
  Copy {
   inputs 2
   from0 rgba.blue
   to0 rgba.blue
   name Copy4
   note_font Helvetica
   xpos -260
   ypos 226
  }
  Dot {
   name Dot6
   label " r : hueWeight\n g : centeredHue\n b : saturation"
   note_font "Helvetica \[pyrs]"
   note_font_size 12
   note_font_color 0xff
   xpos -226
   ypos 282
  }
  Dot {
   name Dot7
   xpos -226
   ypos 330
  }
set N7fe5b400 [stack 0]
push $N7fad2000
  Dot {
   name Dot8
   xpos -6
   ypos 258
  }
set N7fe5b000 [stack 0]
  MergeExpression {
   inputs 2
   temp_name0 minChan
   temp_expr0 "Ag < 0 ? Bg : Bb"
   temp_name1 a_
   temp_expr1 "Ar * (1. - RRT_RED_SCALE) - 1."
   temp_name2 b
   temp_expr2 "Br - Ar* (RRT_RED_PIVOT + minChan) * (1. - RRT_RED_SCALE)"
   temp_name3 c
   temp_expr3 "Ar * RRT_RED_PIVOT * minChan * (1. - RRT_RED_SCALE)"
   expr0 "( -b - sqrt( b * b - 4. * a_ * c)) / ( 2. * a_)"
   name red_modifier_rev
   note_font Helvetica
   xpos -150
   ypos 351
  }
push $N7fe5b400
push $N7fe5b000
  MergeExpression {
   inputs 2
   expr0 "r + Ar * Ab * (RRT_RED_PIVOT - r) * (1. - RRT_RED_SCALE)"
   name red_modifier_fwd
   note_font Helvetica
   xpos -40
   ypos 327
  }
  Switch {
   inputs 2
   which {{parent.invert}}
   name Switch_direction
   note_font Helvetica
   xpos -40
   ypos 423
  }
  Output {
   name Output
   xpos -40
   ypos 494
  }
 end_group
 Clamp {
  channels rgb
  maximum_enable false
  name clamp_f3_min
  label "Clamp Negative Values"
  xpos -1250
  ypos -976
 }
 ColorMatrix {
  matrix {
      {1.451439381 -0.2365107685 -0.2149285674}
      {-0.07655383646 1.176229835 -0.09967593104}
      {0.008316127583 -0.0060324613 0.997716248}
    }
  name ColorMatrix15
  label "ACES to ACEScg"
  xpos -1250
  ypos -928
 }
 Clamp {
  channels rgb
  maximum 65535
  name clamp_f3_
  label "clamp to HALF_MAX"
  xpos -1250
  ypos -880
 }
 ColorMatrix {
  matrix {
      {{"(1.0 - sat) * rgb2Y.x + sat"} {"(1.0 - sat) * rgb2Y.y"} {"(1.0 - sat) * rgb2Y.z"}}
      {{"(1.0 - sat) * rgb2Y.x"} {"(1.0 - sat) * rgb2Y.y + sat"} {"(1.0 - sat) * rgb2Y.z"}}
      {{"(1.0 - sat) * rgb2Y.x"} {"(1.0 - sat) * rgb2Y.y"} {"(1.0 - sat) * rgb2Y.z + sat"}}
    }
  name ColorMatrix
  label "// --- Global desaturation --- //\nrgbPre = mult_f3_f33( rgbPre, RRT_SAT_MAT);"
  xpos -1250
  ypos -790
  addUserKnob {20 params}
  addUserKnob {13 rgb2Y}
  rgb2Y {0.27222875 0.67408174 0.05368952}
  addUserKnob {7 sat}
  sat 0.96
 }
 Dot {
  name Dot29
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xff
  xpos -1216
  ypos -558
 }
set N7fe59000 [stack 0]
 Group {
  name ssts
  xpos -1250
  ypos -514
  addUserKnob {20 ssts_tab l ssts}
  addUserKnob {26 display_label l " " T "<b>Display Settings</b>"}
  addUserKnob {78 lum l luminance t "<b>SSTS Display Luminance</b>: \ny_min y_mid y_max\n\nAccording to Zach Lewis's ACES_OT\nhttps://gist.github.com/zachlewis/786c0be941868644c993fde1c3515c2c\n\n<b>Standard Cinema</b>: \n0.02 4.8 48\n<b>Dolby Cinema</b>: \n0.0001 7.2 108\n<b>Dolby Pulsar</b>: \n0.005 15 4000\n<b>Dolby PRR-4220</b>: \n0.005 10 600\n<b>Sony BVM-X300</b>: \n0.0001 10 1000\n<b>ACES OCES</b>: \n0.0001 4.8 10000\n\n" n 3}
  lum {{"use_c9 ? 0.0001 : parent.lum"} {parent.lum} {"use_c9 ? 10000 : parent.lum"}}
  addUserKnob {6 override_ssts_params l "override ssts params" t "Enable overrides of SSTS params.\n\nOtherwise the values will be calculated automatically by the algorithm." +STARTLINE}
  override_ssts_params {{parent.override_ssts_params}}
  addUserKnob {7 exposure R -5 5}
  exposure {{parent.exposure}}
  addUserKnob {7 knee}
  knee {{parent.pctLow}}
  addUserKnob {7 shoulder}
  shoulder {{parent.pctHigh}}
  addUserKnob {78 slope n 3}
  slope {{parent.slope} {parent.slope} {parent.slope}}
  addUserKnob {20 TsParams_tab l TsParams}
  addUserKnob {7 mid_lum l "mid lum" R 0 20}
  mid_lum {{parent.lum.1}}
  addUserKnob {7 expShift R -4 4}
  expShift {{"(parent.override_ssts_params ? exposure : 0) + (mid_lum<= 4.8 ? 0 : \[sample parent.expShift r 0 0] )"}}
  addUserKnob {13 minPoint t "x;        // ACES\ny;        // luminance\nz;        // slope"}
  minPoint {{"pow(2, log(0.18*pow(2, MIN_STOP_RRT+((MIN_STOP_SDR-MIN_STOP_RRT)/(log10(MIN_LUM_SDR)-log10(MIN_LUM_RRT)))*(log10(minPoint.y)-log10(MIN_LUM_RRT))))/log(2)-expShift)"} {lum.0} {override_ssts_params?slope.0:0}}
  addUserKnob {13 midPoint t "x;        // ACES\ny;        // luminance\nz;        // slope"}
  midPoint {{"pow(2, ((log(0.18)/log(2)-expShift)))"} 4.8 {override_ssts_params?slope.1:1.55}}
  addUserKnob {13 maxPoint t "x;        // ACES\ny;        // luminance\nz;        // slope"}
  maxPoint {{"pow(2, log(0.18*pow(2, (MAX_STOP_SDR + (MAX_STOP_RRT-MAX_STOP_SDR) / (log10(MAX_LUM_RRT)-log10(MAX_LUM_SDR)) * (log10(maxPoint.y)-log10(MAX_LUM_SDR)))))/log(2)-expShift)"} {lum.2} {override_ssts_params?slope.2:0}}
  addUserKnob {7 knotIncLow}
  knotIncLow {{"(log10(midPoint.x) - log10(minPoint.x)) / 3.0"}}
  addUserKnob {7 knotIncHigh}
  knotIncHigh {{"(log10(maxPoint.x) - log10(midPoint.x)) / 3.0"}}
  addUserKnob {7 pctLow}
  pctLow {{0.18+(0.35-0.18)/(MIN_STOP_SDR-MIN_STOP_RRT)*(log(minPoint.x/0.18)/log(2)-MIN_STOP_RRT)}}
  addUserKnob {7 pctHigh}
  pctHigh {{0.89+(0.90-0.89)/(MAX_STOP_SDR-MAX_STOP_RRT)*(log(maxPoint.x/0.89)/log(2)-MAX_STOP_RRT)}}
  addUserKnob {78 coefsLow n 5}
  coefsLow {{"(minPoint.z * (log10(minPoint.x)-0.5*knotIncLow)) + ( log10(minPoint.y) - minPoint.z * log10(minPoint.x))"} {"(minPoint.z * (log10(minPoint.x)+0.5*knotIncLow)) + ( log10(minPoint.y) - minPoint.z * log10(minPoint.x))"} {log10(minPoint.y)+pctLow*(log10(midPoint.y)-log10(minPoint.y))} {"(midPoint.z * (log10(midPoint.x)-0.5*knotIncLow)) + ( log10(midPoint.y) - midPoint.z * log10(midPoint.x))"} {"(midPoint.z * (log10(midPoint.x)+0.5*knotIncLow)) + ( log10(midPoint.y) - midPoint.z * log10(midPoint.x))"}}
  addUserKnob {78 coefsHigh n 5}
  coefsHigh {{"(midPoint.z * (log10(midPoint.x)-0.5*knotIncHigh)) + ( log10(midPoint.y) - midPoint.z * log10(midPoint.x))"} {"(midPoint.z * (log10(midPoint.x)+0.5*knotIncHigh)) + ( log10(midPoint.y) - midPoint.z * log10(midPoint.x))"} {log10(midPoint.y)+pctHigh*(log10(maxPoint.y)-log10(midPoint.y))} {"(maxPoint.z * (log10(maxPoint.x)-0.5*knotIncHigh)) + ( log10(maxPoint.y) - maxPoint.z * log10(maxPoint.x))"} {"(maxPoint.z * (log10(maxPoint.x)+0.5*knotIncHigh)) + ( log10(maxPoint.y) - maxPoint.z * log10(maxPoint.x))"}}
  addUserKnob {20 Constants_tab l const}
  addUserKnob {3 N_KNOTS_LOW}
  N_KNOTS_LOW 4
  addUserKnob {3 N_KNOTS_HIGH}
  N_KNOTS_HIGH 4
  addUserKnob {7 MIN_STOP_SDR R -20 20}
  MIN_STOP_SDR -6.5
  addUserKnob {7 MAX_STOP_SDR R -20 20}
  MAX_STOP_SDR 6.5
  addUserKnob {7 MIN_STOP_RRT R -20 20}
  MIN_STOP_RRT -15
  addUserKnob {7 MAX_STOP_RRT R -20 20}
  MAX_STOP_RRT 18
  addUserKnob {7 MIN_LUM_SDR R 0 0.1}
  MIN_LUM_SDR 0.02
  addUserKnob {7 MAX_LUM_SDR R 0 100}
  MAX_LUM_SDR 48
  addUserKnob {7 MIN_LUM_RRT R 0 0.1}
  MIN_LUM_RRT 0.0001
  addUserKnob {7 MAX_LUM_RRT R 0 10000}
  MAX_LUM_RRT 10000
 }
  Input {
   inputs 0
   name Input
   xpos -1030
   ypos -634
  }
  Dot {
   name Dot25
   label " "
   xpos -996
   ypos -318
  }
set N7fe58800 [stack 0]
  Dot {
   name Dot26
   label " "
   xpos -996
   ypos 1506
  }
push $N7fe58800
  Dot {
   name Dot4
   label " "
   xpos -886
   ypos -318
  }
set N7fe07c00 [stack 0]
  Dot {
   name Dot5
   label " "
   xpos -776
   ypos -318
  }
set N7fe07800 [stack 0]
  Dot {
   name Dot2
   label " "
   xpos -666
   ypos -318
  }
set N7fe07400 [stack 0]
  Dot {
   name Dot3
   label " "
   xpos -556
   ypos -318
  }
set N7fe07000 [stack 0]
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   expr0 "logr <= log10(minPoint.x)"
   expr1 "logg <= log10(minPoint.x)"
   expr2 "logb <= log10(minPoint.x)"
   name segment_bottom
   xpos -590
   ypos -178
  }
  Dot {
   name Dot1
   label " "
   xpos -556
   ypos 162
  }
push $N7fe07000
  Dot {
   name Dot7
   label " "
   xpos -336
   ypos -318
  }
set N7fe06400 [stack 0]
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 "logr * minPoint.z + ( log10(minPoint.y) - minPoint.z * log10(minPoint.x) )"
   expr1 "logg * minPoint.z + ( log10(minPoint.y) - minPoint.z * log10(minPoint.x) )"
   expr2 "logb* minPoint.z + ( log10(minPoint.y) - minPoint.z * log10(minPoint.x) )"
   expr3 1
   name Expression
   xpos -370
   ypos -178
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply3
   xpos -370
   ypos 158
  }
  Dot {
   name Dot27
   label " "
   xpos -336
   ypos 786
  }
push $N7fe07400
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   expr0 "( logr > log10(minPoint.x) ) * ( logr < log10(midPoint.x) )"
   expr1 "( logg > log10(minPoint.x) ) * ( logg < log10(midPoint.x) )"
   expr2 "( logb > log10(minPoint.x) ) * ( logb < log10(midPoint.x) )"
   name segment_low
   xpos -700
   ypos -178
  }
  Dot {
   name Dot22
   label " "
   xpos -666
   ypos 354
  }
push $N7fe06400
  Dot {
   name Dot9
   label " "
   xpos -6
   ypos -318
  }
set N7fe04c00 [stack 0]
  Dot {
   name Dot6
   label " "
   xpos -6
   ypos -198
  }
set N7fe04800 [stack 0]
  Dot {
   name Dot8
   label " "
   xpos 214
   ypos -198
  }
set N7fe04400 [stack 0]
  Dot {
   name Dot13
   label " "
   xpos 434
   ypos -198
  }
  Dot {
   name Dot12
   label " "
   xpos 434
   ypos -78
  }
set N7fdc7800 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsLow.0 : j == 1 ? coefsLow.1 : j == 2 ? coefsLow.2 :j == 3 ? coefsLow.3 : j == 4 ? coefsLow.4 : 0"
   expr1 "j == 0 ? coefsLow.1 : j == 1 ? coefsLow.2 : j == 2 ? coefsLow.3 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
   expr2 "j == 0 ? coefsLow.2 : j == 1 ? coefsLow.3 : j == 2 ? coefsLow.4 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
   name Expression5
   xpos 290
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix3
   label "mult_f3_f33( cf, M)"
   xpos 290
   ypos 8
  }
push $N7fdc7800
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression6
   xpos 400
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 0
   expr1 0
   expr2 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   name dot_f3_f2
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 400
   ypos 8
  }
push 0
push $N7fe04400
  Dot {
   name Dot11
   label " "
   xpos 214
   ypos -78
  }
set N7fdc6400 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsLow.0 : j == 1 ? coefsLow.1 : j == 2 ? coefsLow.2 :j == 3 ? coefsLow.3 : j == 4 ? coefsLow.4 : 0"
   expr1 "j == 0 ? coefsLow.1 : j == 1 ? coefsLow.2 : j == 2 ? coefsLow.3 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
   expr2 "j == 0 ? coefsLow.2 : j == 1 ? coefsLow.3 : j == 2 ? coefsLow.4 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
   name Expression3
   xpos 70
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix1
   label "mult_f3_f33( cf, M)"
   xpos 70
   ypos 8
  }
push $N7fdc6400
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression4
   xpos 180
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 0
   expr1 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   expr2 0
   name dot_f3_f7
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 180
   ypos 8
  }
push $N7fe04800
  Dot {
   name Dot10
   label " "
   xpos -6
   ypos -78
  }
set N7fdc5000 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsLow.0 : j == 1 ? coefsLow.1 : j == 2 ? coefsLow.2 :j == 3 ? coefsLow.3 : j == 4 ? coefsLow.4 : 0"
   expr1 "j == 0 ? coefsLow.1 : j == 1 ? coefsLow.2 : j == 2 ? coefsLow.3 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
   expr2 "j == 0 ? coefsLow.2 : j == 1 ? coefsLow.3 : j == 2 ? coefsLow.4 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
   name Expression1
   xpos -150
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix2
   label "mult_f3_f33( cf, M)"
   xpos -150
   ypos 8
  }
push $N7fdc5000
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression2
   xpos -40
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   expr1 0
   expr2 0
   name dot_f3_f1
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos -40
   ypos 8
  }
  Merge2 {
   inputs 3+1
   operation plus
   bbox B
   output rgb
   name Merge1
   xpos 180
   ypos 158
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply1
   xpos 180
   ypos 350
  }
  Dot {
   name Dot28
   label " "
   xpos 214
   ypos 786
  }
push 0
push $N7fe07800
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   expr0 "( logr >= log10(midPoint.x) ) * ( logr < log10(maxPoint.x) )"
   expr1 "( logg >= log10(midPoint.x) ) * ( logg < log10(maxPoint.x) )"
   expr2 "( logb >= log10(midPoint.x) ) * ( logb < log10(maxPoint.x) )"
   name segment_high
   xpos -810
   ypos -178
  }
  Dot {
   name Dot23
   label " "
   xpos -776
   ypos 474
  }
push $N7fe04c00
  Dot {
   name Dot14
   label " "
   xpos 764
   ypos -318
  }
set N7fd56400 [stack 0]
  Dot {
   name Dot15
   label " "
   xpos 764
   ypos -198
  }
set N7fd56000 [stack 0]
  Dot {
   name Dot17
   label " "
   xpos 984
   ypos -198
  }
set N7fd55c00 [stack 0]
  Dot {
   name Dot20
   label " "
   xpos 1204
   ypos -198
  }
  Dot {
   name Dot19
   label " "
   xpos 1204
   ypos -78
  }
set N7fd55400 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsHigh.0 : j == 1 ? coefsHigh.1 : j == 2 ? coefsHigh.2 :j == 3 ? coefsHigh.3 : j == 4 ? coefsHigh.4 : 0"
   expr1 "j == 0 ? coefsHigh.1 : j == 1 ? coefsHigh.2 : j == 2 ? coefsHigh.3 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
   expr2 "j == 0 ? coefsHigh.2 : j == 1 ? coefsHigh.3 : j == 2 ? coefsHigh.4 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
   expr3 j
   name Expression11
   xpos 1060
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix6
   label "mult_f3_f33( cf, M)"
   xpos 1060
   ypos 8
  }
push $N7fd55400
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression12
   xpos 1170
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 0
   expr1 0
   expr2 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   name dot_f3_f6
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 1170
   ypos 8
  }
push 0
push $N7fd55c00
  Dot {
   name Dot18
   label " "
   xpos 984
   ypos -78
  }
set N7fcf3c00 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsHigh.0 : j == 1 ? coefsHigh.1 : j == 2 ? coefsHigh.2 :j == 3 ? coefsHigh.3 : j == 4 ? coefsHigh.4 : 0"
   expr1 "j == 0 ? coefsHigh.1 : j == 1 ? coefsHigh.2 : j == 2 ? coefsHigh.3 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
   expr2 "j == 0 ? coefsHigh.2 : j == 1 ? coefsHigh.3 : j == 2 ? coefsHigh.4 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
   expr3 j
   name Expression9
   xpos 840
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix5
   label "mult_f3_f33( cf, M)"
   xpos 840
   ypos 8
  }
push $N7fcf3c00
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression10
   xpos 950
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 0
   expr1 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   expr2 0
   name dot_f3_f5
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 950
   ypos 8
  }
push $N7fd56000
  Dot {
   name Dot16
   label " "
   xpos 764
   ypos -78
  }
set N7fcf2800 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsHigh.0 : j == 1 ? coefsHigh.1 : j == 2 ? coefsHigh.2 :j == 3 ? coefsHigh.3 : j == 4 ? coefsHigh.4 : 0"
   expr1 "j == 0 ? coefsHigh.1 : j == 1 ? coefsHigh.2 : j == 2 ? coefsHigh.3 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
   expr2 "j == 0 ? coefsHigh.2 : j == 1 ? coefsHigh.3 : j == 2 ? coefsHigh.4 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
   expr3 j
   name Expression7
   xpos 620
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix4
   label "mult_f3_f33( cf, M)"
   xpos 620
   ypos 8
  }
push $N7fcf2800
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression8
   xpos 730
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   expr1 0
   expr2 0
   name dot_f3_f4
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 730
   ypos 8
  }
  Merge2 {
   inputs 3+1
   operation plus
   bbox B
   output rgb
   name Merge2
   xpos 950
   ypos 158
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply2
   xpos 950
   ypos 470
  }
  Dot {
   name Dot29
   label " "
   xpos 984
   ypos 786
  }
push $N7fe07c00
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   expr0 "logr >= log10(maxPoint.x) ? 1 : 0"
   expr1 "logg >= log10(maxPoint.x) ? 1 : 0"
   expr2 "logb >= log10(maxPoint.x) ? 1 : 0"
   name segment_peak
   xpos -920
   ypos -178
  }
  Dot {
   name Dot24
   label " "
   xpos -886
   ypos 618
  }
push $N7fd56400
  Dot {
   name Dot21
   label " "
   xpos 1534
   ypos -318
  }
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 "logr * maxPoint.z + ( log10(maxPoint.y) - maxPoint.z * log10(maxPoint.x) )"
   expr1 "logg * maxPoint.z + ( log10(maxPoint.y) - maxPoint.z * log10(maxPoint.x) )"
   expr2 "logb* maxPoint.z + ( log10(maxPoint.y) - maxPoint.z * log10(maxPoint.x) )"
   expr3 1
   name proc_low1
   label Expression
   xpos 1500
   ypos -160
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply4
   xpos 1500
   ypos 614
  }
  Dot {
   name Dot30
   xpos 1534
   ypos 810
  }
  Merge2 {
   inputs 4+1
   operation plus
   bbox B
   output rgb
   name Merge3
   xpos 510
   ypos 1118
  }
  Expression {
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 pow(10,r)
   expr1 pow(10,g)
   expr2 pow(10,b)
   name Expression13
   xpos 510
   ypos 1238
  }
  Copy {
   inputs 2
   from0 rgba.alpha
   to0 rgba.alpha
   name Copy1
   xpos 510
   ypos 1496
  }
  Output {
   name Output1
   xpos 510
   ypos 1814
  }
 end_group
 Dot {
  name Dot23
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1216
  ypos -462
 }
set N7fc95c00 [stack 0]
 Dot {
  name Dot22
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1656
  ypos -462
 }
 ColorMatrix {
  matrix {
      {0.6954522133 0.1406786889 0.163869068}
      {0.04479461163 0.8596711159 0.09553432465}
      {-0.005525866989 0.004025223665 1.001500726}
    }
  name ColorMatrix7
  label "ACEScg to ACES"
  note_font Helvetica
  xpos -1690
  ypos -398
 }
 Dot {
  name Dot21
  label " OCES"
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1656
  ypos 2658
 }
push $N7fc95c00
 Dot {
  name Dot28
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1216
  ypos -342
 }
set N7fc94c00 [stack 0]
 Group {
  name segmented_spline_c9_fwd
  xpos -1140
  ypos -346
  addUserKnob {20 SegmentedSplineParams_c9_tab l SegmentedSplineParams_c9}
  addUserKnob {78 coefsLow n 10}
  coefsLow {-1.698970004 -1.698970004 -1.4779 -1.2291 -0.8648 -0.448 0.00518 0.4511080334 0.9113744414 0.9113744414}
  addUserKnob {78 coefsHigh n 10}
  coefsHigh {0.5154386965 0.8470437783 1.1358 1.3802 1.5197 1.5985 1.6467 1.674609136 1.687873339 1.687873339}
  addUserKnob {12 minPoint}
  minPoint {0.0028799 0.02}
  addUserKnob {12 midPoint}
  midPoint {4.79999924 4.8}
  addUserKnob {12 maxPoint}
  maxPoint {1005.719116 48}
  addUserKnob {7 slopeLow}
  addUserKnob {7 slopeHigh}
  slopeHigh 0.04
  addUserKnob {3 N_KNOTS_LOW}
  N_KNOTS_LOW 8
  addUserKnob {3 N_KNOTS_HIGH}
  N_KNOTS_HIGH 8
 }
  Input {
   inputs 0
   name Input
   xpos -1030
   ypos -634
  }
  Dot {
   name Dot25
   label " "
   xpos -996
   ypos -318
  }
set N7fc94400 [stack 0]
  Dot {
   name Dot26
   label " "
   xpos -996
   ypos 1506
  }
push $N7fc94400
  Dot {
   name Dot4
   label " "
   xpos -886
   ypos -318
  }
set N7fc33800 [stack 0]
  Dot {
   name Dot5
   label " "
   xpos -776
   ypos -318
  }
set N7fc33400 [stack 0]
  Dot {
   name Dot2
   label " "
   xpos -666
   ypos -318
  }
set N7fc33000 [stack 0]
  Dot {
   name Dot3
   label " "
   xpos -556
   ypos -318
  }
set N7fc32c00 [stack 0]
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   expr0 "logr <= log10(minPoint.x)"
   expr1 "logg <= log10(minPoint.x)"
   expr2 "logb <= log10(minPoint.x)"
   name segment_bottom
   xpos -590
   ypos -178
  }
  Dot {
   name Dot1
   label " "
   xpos -556
   ypos 162
  }
push $N7fc32c00
  Dot {
   name Dot7
   label " "
   xpos -336
   ypos -318
  }
set N7fc32000 [stack 0]
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 "logr * slopeLow + ( log10(minPoint.y) - slopeLow * log10(minPoint.x) )"
   expr1 "logg * slopeLow + ( log10(minPoint.y) - slopeLow * log10(minPoint.x) )"
   expr2 "logb* slopeLow + ( log10(minPoint.y) - slopeLow * log10(minPoint.x) )"
   expr3 1
   name Expression
   xpos -370
   ypos -178
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply3
   xpos -370
   ypos 158
  }
  Dot {
   name Dot27
   label " "
   xpos -336
   ypos 786
  }
push $N7fc33000
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   expr0 "( logr > log10(minPoint.x) ) * ( logr < log10(midPoint.x) )"
   expr1 "( logg > log10(minPoint.x) ) * ( logg < log10(midPoint.x) )"
   expr2 "( logb > log10(minPoint.x) ) * ( logb < log10(midPoint.x) )"
   name segment_low
   xpos -700
   ypos -178
  }
  Dot {
   name Dot22
   label " "
   xpos -666
   ypos 354
  }
push $N7fc32000
  Dot {
   name Dot9
   label " "
   xpos -6
   ypos -318
  }
set N7fc30800 [stack 0]
  Dot {
   name Dot6
   label " "
   xpos -6
   ypos -198
  }
set N7fc30400 [stack 0]
  Dot {
   name Dot8
   label " "
   xpos 214
   ypos -198
  }
set N7fbf7c00 [stack 0]
  Dot {
   name Dot13
   label " "
   xpos 434
   ypos -198
  }
  Dot {
   name Dot12
   label " "
   xpos 434
   ypos -78
  }
set N7fbf7400 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsLow.0 : j == 1 ? coefsLow.1 : j == 2 ? coefsLow.2 :j == 3 ? coefsLow.3 : j == 4 ? coefsLow.4 : j == 5 ? coefsLow.5 : j == 6 ? coefsLow.6 : j == 7 ? coefsLow.7 : j == 8 ? coefsLow.8 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr1 "j == 0 ? coefsLow.1 : j == 1 ? coefsLow.2 : j == 2 ? coefsLow.3 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.5 : j == 5 ? coefsLow.6 : j == 6 ? coefsLow.7 : j == 7 ? coefsLow.8 : j == 8 ? coefsLow.9 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr2 "j == 0 ? coefsLow.2 : j == 1 ? coefsLow.3 : j == 2 ? coefsLow.4 :j == 3 ? coefsLow.5 : j == 4 ? coefsLow.6 : j == 5 ? coefsLow.7 : j == 6 ? coefsLow.8 : j == 7 ? coefsLow.9 : j == 8 ? coefsLow.9 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr3 j
   name Expression15
   xpos 290
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix3
   label "mult_f3_f33( cf, M)"
   xpos 290
   ypos 8
  }
push $N7fbf7400
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression6
   xpos 400
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 0
   expr1 0
   expr2 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   name dot_f3_f2
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 400
   ypos 8
  }
push 0
push $N7fbf7c00
  Dot {
   name Dot11
   label " "
   xpos 214
   ypos -78
  }
set N7fbf6000 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsLow.0 : j == 1 ? coefsLow.1 : j == 2 ? coefsLow.2 :j == 3 ? coefsLow.3 : j == 4 ? coefsLow.4 : j == 5 ? coefsLow.5 : j == 6 ? coefsLow.6 : j == 7 ? coefsLow.7 : j == 8 ? coefsLow.8 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr1 "j == 0 ? coefsLow.1 : j == 1 ? coefsLow.2 : j == 2 ? coefsLow.3 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.5 : j == 5 ? coefsLow.6 : j == 6 ? coefsLow.7 : j == 7 ? coefsLow.8 : j == 8 ? coefsLow.9 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr2 "j == 0 ? coefsLow.2 : j == 1 ? coefsLow.3 : j == 2 ? coefsLow.4 :j == 3 ? coefsLow.5 : j == 4 ? coefsLow.6 : j == 5 ? coefsLow.7 : j == 6 ? coefsLow.8 : j == 7 ? coefsLow.9 : j == 8 ? coefsLow.9 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr3 j
   name Expression14
   xpos 70
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix1
   label "mult_f3_f33( cf, M)"
   xpos 70
   ypos 8
  }
push $N7fbf6000
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression4
   xpos 180
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 0
   expr1 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   expr2 0
   name dot_f3_f7
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 180
   ypos 8
  }
push $N7fc30400
  Dot {
   name Dot10
   label " "
   xpos -6
   ypos -78
  }
set N7fbf4c00 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsLow.0 : j == 1 ? coefsLow.1 : j == 2 ? coefsLow.2 :j == 3 ? coefsLow.3 : j == 4 ? coefsLow.4 : j == 5 ? coefsLow.5 : j == 6 ? coefsLow.6 : j == 7 ? coefsLow.7 : j == 8 ? coefsLow.8 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr1 "j == 0 ? coefsLow.1 : j == 1 ? coefsLow.2 : j == 2 ? coefsLow.3 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.5 : j == 5 ? coefsLow.6 : j == 6 ? coefsLow.7 : j == 7 ? coefsLow.8 : j == 8 ? coefsLow.9 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr2 "j == 0 ? coefsLow.2 : j == 1 ? coefsLow.3 : j == 2 ? coefsLow.4 :j == 3 ? coefsLow.5 : j == 4 ? coefsLow.6 : j == 5 ? coefsLow.7 : j == 6 ? coefsLow.8 : j == 7 ? coefsLow.9 : j == 8 ? coefsLow.9 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr3 j
   name Expression1
   xpos -150
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix2
   label "mult_f3_f33( cf, M)"
   xpos -150
   ypos 8
  }
push $N7fbf4c00
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression2
   xpos -40
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   expr1 0
   expr2 0
   name dot_f3_f1
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos -40
   ypos 8
  }
  Merge2 {
   inputs 3+1
   operation plus
   bbox B
   output rgb
   name Merge1
   xpos 180
   ypos 158
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply1
   xpos 180
   ypos 350
  }
  Dot {
   name Dot28
   label " "
   xpos 214
   ypos 786
  }
push 0
push $N7fc33400
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   expr0 "( logr >= log10(midPoint.x) ) * ( logr < log10(maxPoint.x) )"
   expr1 "( logg >= log10(midPoint.x) ) * ( logg < log10(maxPoint.x) )"
   expr2 "( logb >= log10(midPoint.x) ) * ( logb < log10(maxPoint.x) )"
   name segment_high
   xpos -810
   ypos -178
  }
  Dot {
   name Dot23
   label " "
   xpos -776
   ypos 474
  }
push $N7fc30800
  Dot {
   name Dot14
   label " "
   xpos 764
   ypos -318
  }
set N7fb8a000 [stack 0]
  Dot {
   name Dot15
   label " "
   xpos 764
   ypos -198
  }
set N7fb89c00 [stack 0]
  Dot {
   name Dot17
   label " "
   xpos 984
   ypos -198
  }
set N7fb89800 [stack 0]
  Dot {
   name Dot20
   label " "
   xpos 1204
   ypos -198
  }
  Dot {
   name Dot19
   label " "
   xpos 1204
   ypos -78
  }
set N7fb89000 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsHigh.0 : j == 1 ? coefsHigh.1 : j == 2 ? coefsHigh.2 :j == 3 ? coefsHigh.3 : j == 4 ? coefsHigh.4 : j == 5 ? coefsHigh.5 : j == 6 ? coefsHigh.6 : j == 7 ? coefsHigh.7 : j == 8 ? coefsHigh.8 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr1 "j == 0 ? coefsHigh.1 : j == 1 ? coefsHigh.2 : j == 2 ? coefsHigh.3 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.5 : j == 5 ? coefsHigh.6 : j == 6 ? coefsHigh.7 : j == 7 ? coefsHigh.8 : j == 8 ? coefsHigh.9 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr2 "j == 0 ? coefsHigh.2 : j == 1 ? coefsHigh.3 : j == 2 ? coefsHigh.4 :j == 3 ? coefsHigh.5 : j == 4 ? coefsHigh.6 : j == 5 ? coefsHigh.7 : j == 6 ? coefsHigh.8 : j == 7 ? coefsHigh.9 : j == 8 ? coefsHigh.9 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr3 j
   name Expression3
   xpos 1060
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix6
   label "mult_f3_f33( cf, M)"
   xpos 1060
   ypos 8
  }
push $N7fb89000
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression12
   xpos 1170
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 0
   expr1 0
   expr2 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   name dot_f3_f6
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 1170
   ypos 8
  }
push 0
push $N7fb89800
  Dot {
   name Dot18
   label " "
   xpos 984
   ypos -78
  }
set N7ff2b800 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsHigh.0 : j == 1 ? coefsHigh.1 : j == 2 ? coefsHigh.2 :j == 3 ? coefsHigh.3 : j == 4 ? coefsHigh.4 : j == 5 ? coefsHigh.5 : j == 6 ? coefsHigh.6 : j == 7 ? coefsHigh.7 : j == 8 ? coefsHigh.8 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr1 "j == 0 ? coefsHigh.1 : j == 1 ? coefsHigh.2 : j == 2 ? coefsHigh.3 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.5 : j == 5 ? coefsHigh.6 : j == 6 ? coefsHigh.7 : j == 7 ? coefsHigh.8 : j == 8 ? coefsHigh.9 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr2 "j == 0 ? coefsHigh.2 : j == 1 ? coefsHigh.3 : j == 2 ? coefsHigh.4 :j == 3 ? coefsHigh.5 : j == 4 ? coefsHigh.6 : j == 5 ? coefsHigh.7 : j == 6 ? coefsHigh.8 : j == 7 ? coefsHigh.9 : j == 8 ? coefsHigh.9 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr3 j
   name Expression5
   xpos 840
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix5
   label "mult_f3_f33( cf, M)"
   xpos 840
   ypos 8
  }
push $N7ff2b800
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression10
   xpos 950
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 0
   expr1 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   expr2 0
   name dot_f3_f5
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 950
   ypos 8
  }
push $N7fb89c00
  Dot {
   name Dot16
   label " "
   xpos 764
   ypos -78
  }
set N7ff2a400 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsHigh.0 : j == 1 ? coefsHigh.1 : j == 2 ? coefsHigh.2 :j == 3 ? coefsHigh.3 : j == 4 ? coefsHigh.4 : j == 5 ? coefsHigh.5 : j == 6 ? coefsHigh.6 : j == 7 ? coefsHigh.7 : j == 8 ? coefsHigh.8 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr1 "j == 0 ? coefsHigh.1 : j == 1 ? coefsHigh.2 : j == 2 ? coefsHigh.3 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.5 : j == 5 ? coefsHigh.6 : j == 6 ? coefsHigh.7 : j == 7 ? coefsHigh.8 : j == 8 ? coefsHigh.9 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr2 "j == 0 ? coefsHigh.2 : j == 1 ? coefsHigh.3 : j == 2 ? coefsHigh.4 :j == 3 ? coefsHigh.5 : j == 4 ? coefsHigh.6 : j == 5 ? coefsHigh.7 : j == 6 ? coefsHigh.8 : j == 7 ? coefsHigh.9 : j == 8 ? coefsHigh.9 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr3 j
   name Expression16
   xpos 620
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix4
   label "mult_f3_f33( cf, M)"
   xpos 620
   ypos 8
  }
push $N7ff2a400
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression8
   xpos 730
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   expr1 0
   expr2 0
   name dot_f3_f4
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 730
   ypos 8
  }
  Merge2 {
   inputs 3+1
   operation plus
   bbox B
   output rgb
   name Merge2
   xpos 950
   ypos 158
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply2
   xpos 950
   ypos 470
  }
  Dot {
   name Dot29
   label " "
   xpos 984
   ypos 786
  }
push $N7fc33800
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   expr0 "logr >= log10(maxPoint.x) ? 1 : 0"
   expr1 "logg >= log10(maxPoint.x) ? 1 : 0"
   expr2 "logb >= log10(maxPoint.x) ? 1 : 0"
   name segment_peak
   xpos -920
   ypos -178
  }
  Dot {
   name Dot24
   label " "
   xpos -886
   ypos 618
  }
push $N7fb8a000
  Dot {
   name Dot21
   label " "
   xpos 1534
   ypos -318
  }
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 "logr * slopeHigh + ( log10(maxPoint.y) - slopeHigh * log10(maxPoint.x) )"
   expr1 "logg * slopeHigh + ( log10(maxPoint.y) - slopeHigh * log10(maxPoint.x) )"
   expr2 "logb* slopeHigh + ( log10(maxPoint.y) - slopeHigh * log10(maxPoint.x) )"
   expr3 1
   name proc_low1
   label Expression
   xpos 1500
   ypos -202
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply4
   xpos 1500
   ypos 614
  }
  Merge2 {
   inputs 4+1
   operation plus
   bbox B
   output rgb
   name Merge3
   xpos 510
   ypos 1118
  }
  Expression {
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 pow(10,r)
   expr1 pow(10,g)
   expr2 pow(10,b)
   name Expression13
   xpos 510
   ypos 1238
  }
  Copy {
   inputs 2
   from0 rgba.alpha
   to0 rgba.alpha
   name Copy1
   xpos 510
   ypos 1496
  }
  Output {
   name Output1
   xpos 510
   ypos 1814
  }
 end_group
push $N7fc94c00
 Switch {
  inputs 2
  which {{parent.use_c9}}
  name Switch_c9
  xpos -1250
  ypos -298
 }
 Expression {
  expr0 "(r - Ymin) / (Ymax - Ymin)"
  expr1 "(g - Ymin) / (Ymax - Ymin)"
  expr2 "(b - Ymin) / (Ymax - Ymin)"
  expr3 1
  name Y_2_linCV_f3_
  xpos -1250
  ypos 38
  addUserKnob {20 Luminance}
  addUserKnob {7 Ymin R 0.0001 0.02}
  Ymin {{parent.lum.0}}
  addUserKnob {7 Ymax R 48 10000}
  Ymax {{parent.lum.2}}
 }
 Dot {
  name Dot12
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1216
  ypos 282
 }
set N7fec5800 [stack 0]
 Dot {
  name Dot15
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1106
  ypos 282
 }
set N7fec5400 [stack 0]
 Dot {
  name Dot13
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -886
  ypos 282
 }
 Dot {
  name Dot16
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -886
  ypos 354
 }
set N7fec4c00 [stack 0]
 Expression {
  temp_name0 tr
  temp_expr0 "(-r - c_x_0) / (c_x_1 - c_x_0)"
  temp_name1 tg
  temp_expr1 "(-g - c_x_0) / (c_x_1 - c_x_0)"
  temp_name2 tb
  temp_expr2 "(-b - c_x_0) / (c_x_1 - c_x_0)"
  expr0 "tr < 0.0 ? -(tr * c_b + c_c) : tr > 1.0 ? r : -(( tr * c_a + c_b) * tr + c_c)"
  expr1 "tg < 0.0 ? -(tg * c_b + c_c) : tg > 1.0 ? g : -(( tg * c_a + c_b) * tg + c_c)"
  expr2 "tb < 0.0 ? -(tb * c_b + c_c) : tb > 1.0 ? b : -(( tb * c_a + c_b) * tb + c_c)"
  name roll_white_fwd_1
  xpos -920
  ypos 398
  addUserKnob {20 Params}
  addUserKnob {7 new_wht}
  new_wht 0.918
  addUserKnob {7 c_width}
  c_width 0.5
  addUserKnob {7 c_x_0 +DISABLED}
  c_x_0 -1
  addUserKnob {7 c_x_1 +DISABLED}
  c_x_1 {{"c_x_0 + c_width"}}
  addUserKnob {7 c_y0 +DISABLED}
  c_y0 {{-new_wht}}
  addUserKnob {7 c_y1 +DISABLED}
  c_y1 {{c_x_1}}
  addUserKnob {7 c_m1 +DISABLED}
  c_m1 {{"(c_x_1 - c_x_0)"}}
  addUserKnob {7 c_a +DISABLED}
  c_a {{"c_y0 - c_y1 + c_m1"}}
  addUserKnob {7 c_b +DISABLED}
  c_b {{"2 * (c_y1 - c_y0) - c_m1"}}
  addUserKnob {7 c_c +DISABLED}
  c_c {{c_y0}}
 }
 Expression {
  temp_name0 SCALE
  temp_expr0 0.96
  temp_name1 NEW_WHT
  temp_expr1 0.918
  expr0 "min( r, NEW_WHT) * SCALE"
  expr1 "min( g, NEW_WHT) * SCALE"
  expr2 "min( b, NEW_WHT) * SCALE"
  name Expression2
  label "// Scale and clamp white to avoid casted highlights due to D60 simulation"
  xpos -920
  ypos 440
 }
 Dot {
  name Dot11
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -886
  ypos 498
 }
push $N7fec4c00
 Expression {
  temp_name0 SCALE
  temp_expr0 0.96362
  expr0 "r * SCALE"
  expr1 "g * SCALE"
  expr2 "b * SCALE"
  name mult_f_f3_
  label D65
  xpos -1030
  ypos 344
 }
push $N7fec5400
 Switch {
  inputs 2
  which {{"parent.display_pri < 3"}}
  name switch_wp_is_d65_
  xpos -1140
  ypos 350
 }
 Dot {
  name Dot14
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1106
  ypos 426
 }
push $N7fec5800
 Switch {
  inputs 2
  which {{parent.d60_sim}}
  name d60_sim_switch1
  xpos -1250
  ypos 422
 }
 Switch {
  inputs 2
  which {{"parent.display_pri == 3"}}
  name switch_wp_is_dci_
  xpos -1250
  ypos 494
 }
 Dot {
  name Dot26
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1216
  ypos 762
 }
set N8025f000 [stack 0]
 ColorMatrix {
  matrix {
      {{"(1.0 - sat) * rgb2Y.x + sat"} {"(1.0 - sat) * rgb2Y.y"} {"(1.0 - sat) * rgb2Y.z"}}
      {{"(1.0 - sat) * rgb2Y.x"} {"(1.0 - sat) * rgb2Y.y + sat"} {"(1.0 - sat) * rgb2Y.z"}}
      {{"(1.0 - sat) * rgb2Y.x"} {"(1.0 - sat) * rgb2Y.y"} {"(1.0 - sat) * rgb2Y.z + sat"}}
    }
  name ColorMatrix3
  label "// Apply desaturation to compensate \nfor luminance difference"
  xpos -1140
  ypos 746
  addUserKnob {20 params}
  addUserKnob {13 rgb2Y}
  rgb2Y {0.27222875 0.67408174 0.05368952}
  addUserKnob {7 sat}
  sat 0.93
 }
push $N8025f000
 Switch {
  inputs 2
  which {{"parent.eotf < 5 && display_pri < 2"}}
  name Switch_eotf
  label "Use if output is SDR"
  xpos -1250
  ypos 800
 }
 ColorMatrix {
  matrix {
      {0.6624541879 0.1340042055 0.1561876982}
      {0.2722287476 0.6740817428 0.05368951708}
      {-0.005574660841 0.004060741514 1.010339141}
    }
  name ColorMatrix1
  label "ACES AP1 to XYZ"
  xpos -1250
  ypos 968
 }
 Dot {
  name Dot8
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1216
  ypos 1146
 }
set N8025e400 [stack 0]
 Colorspace {
  colorspace_in CIE-XYZ
  colorspace_out CIE-Yxy
  name Colorspace2
  label "\[value colorspace_in] -> \[value colorspace_out]"
  xpos -1140
  ypos 1136
 }
 Clamp {
  channels {rgba.red -rgba.green -rgba.blue none}
  maximum_enable false
  name ClampMin4
  xpos -1140
  ypos 1190
 }
 Expression {
  expr0 "pow(r, DIM_SURROUND_GAMMA)"
  expr1 g
  expr2 b
  channel3 none
  name dark_to_dim3
  xpos -1140
  ypos 1214
  addUserKnob {20 Params}
  addUserKnob {7 DIM_SURROUND_GAMMA}
  DIM_SURROUND_GAMMA 0.9811
 }
 Colorspace {
  colorspace_in CIE-Yxy
  colorspace_out CIE-XYZ
  name Colorspace4
  label "\[value colorspace_in] -> \[value colorspace_out]"
  xpos -1140
  ypos 1256
 }
push $N8025e400
 Switch {
  inputs 2
  which {{"(parent.eotf <= 4) ? parent.dark_to_dim : 0"}}
  name DarkToDim_Switch
  label "enable if sdr\nand dark_to_dim enabled"
  xpos -1250
  ypos 1250
 }
 Dot {
  name Dot19
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1216
  ypos 1434
 }
set N8025d000 [stack 0]
 Dot {
  name Dot9
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1106
  ypos 1434
 }
set N8025cc00 [stack 0]
 ColorMatrix {
  matrix {
      {0.9872254133 -0.006114810705 0.01592640579}
      {-0.007603884675 1.001874804 0.005322027951}
      {0.003066040576 -0.005084238946 1.081519246}
    }
  name ColorMatrix2
  label "CAT: Bradford\n D60 to D65"
  xpos -1140
  ypos 1466
 }
set N8025c800 [stack 0]
push $N8025cc00
 Dot {
  name Dot10
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -996
  ypos 1434
 }
push $N8025c800
 Switch {
  inputs 2
  which {{parent.d60_sim}}
  name d60_sim_switch
  xpos -1140
  ypos 1550
 }
push $N8025d000
 Switch {
  inputs 2
  which {{"parent.display_pri < 3"}}
  name switch_wp_is_d65_1
  xpos -1250
  ypos 1550
 }
 Switch {
  inputs 2
  which {{parent.force_d65_cat}}
  name switch_force_d65_cat
  xpos -1250
  ypos 1598
 }
 Group {
  name limit_to_primaries
  label "Only enabled when display_pri != limiting_pri"
  xpos -1250
  ypos 1760
  disable {{"!(parent.display_pri != parent.limiting_pri)"}}
  addUserKnob {20 limit_to_primaries}
  addUserKnob {4 limiting_pri l "limiting pri" M {Rec709 Rec2020 P3D65 P3DCI P3D60 ACEScg ACES XYZ}}
  limiting_pri {{parent.limiting_pri}}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -298
  }
  Dot {
   name Dot1
   label " XYZ to limiting primaries"
   note_font "Helvetica Bold"
   note_font_size 24
   note_font_color 0xa5a5a501
   xpos -6
   ypos -198
  }
set N801d3800 [stack 0]
push $N801d3800
  ColorMatrix {
   matrix {
       {1.049811006 0 -9.748453158e-05}
       {-0.4959030151 1.373313069 0.09824004024}
       {4.020908051e-08 0 0.9912520051}
     }
   name ColorMatrix5
   label "XYZ to ACES"
   xpos 730
   ypos -136
  }
push $N801d3800
  ColorMatrix {
   matrix {
       {1.641023397 -0.3248033226 -0.2364246994}
       {-0.6636629701 1.615331769 0.01675636508}
       {0.01172191743 -0.008284457959 0.9883947968}
     }
   name ColorMatrix21
   label "XYZ to ACEScg"
   xpos 620
   ypos -136
  }
push $N801d3800
  ColorMatrix {
   matrix {
       {2.402741432 -0.8974840641 -0.3880533576}
       {-0.8325796723 1.769231915 0.02371272631}
       {0.03882339597 -0.08249972761 1.036368608}
     }
   name ColorMatrix15
   label "XYZ to P3D60"
   xpos 510
   ypos -136
  }
push $N801d3800
  ColorMatrix {
   matrix {
       {2.725393534 -1.018002748 -0.4401631057}
       {-0.795167923 1.689731717 0.02264718339}
       {0.04124190658 -0.0876390487 1.100929499}
     }
   name ColorMatrix19
   label "XYZ to P3DCI"
   xpos 400
   ypos -136
  }
push $N801d3800
  ColorMatrix {
   matrix {
       {2.493496418 -0.9313833117 -0.4027107358}
       {-0.8294888139 1.762663841 0.02362467349}
       {0.03584583849 -0.07617240399 0.9568845034}
     }
   name ColorMatrix17
   label "XYZ to P3D65"
   xpos 290
   ypos -136
  }
push $N801d3800
  ColorMatrix {
   matrix {
       {0.6954522133 0.1406786889 0.163869068}
       {0.04479461163 0.8596711159 0.09553432465}
       {-0.005525866989 0.004025223665 1.001500726}
     }
   name ColorMatrix12
   label "XYZ to Rec2020"
   xpos 180
   ypos -136
  }
push $N801d3800
  ColorMatrix {
   matrix {
       {3.240970135 -1.537383318 -0.4986107945}
       {-0.9692437053 1.875967622 0.04155509174}
       {0.0556300357 -0.2039768547 1.056971431}
     }
   name ColorMatrix2
   label "XYZ to Rec709"
   xpos 70
   ypos -136
  }
  Switch {
   inputs 8
   which {{parent.limiting_pri}}
   name limiting_primary_switch
   xpos -40
   ypos -34
  }
  Clamp {
   channels rgb
   name clamp_f3
   label "Clip any values outside the limiting primaries"
   xpos -40
   ypos 56
  }
  Dot {
   name Dot2
   label " Convert limited RGB to XYZ"
   note_font "Helvetica Bold"
   note_font_size 24
   note_font_color 0xa5a5a501
   xpos -6
   ypos 162
  }
set N801d1400 [stack 0]
push $N801d1400
  ColorMatrix {
   matrix {
       {0.9525524378 0 9.367863095e-05}
       {0.3439664543 0.7281661034 -0.07213255018}
       {-3.863927134e-08 0 1.008825183}
     }
   name ColorMatrix4
   label "ACES to XYZ"
   xpos 730
   ypos 224
  }
push $N801d1400
  ColorMatrix {
   matrix {
       {0.6624541879 0.1340042055 0.1561876982}
       {0.2722287476 0.6740817428 0.05368951708}
       {-0.005574660841 0.004060741514 1.010339141}
     }
   name ColorMatrix20
   label "ACEScg to XYZ"
   xpos 620
   ypos 224
  }
push $N801d1400
  ColorMatrix {
   matrix {
       {0.5049495697 0.2646814585 0.1830150485}
       {0.237623319 0.6891706586 0.07320601493}
       {0 0.0449459292 0.9638792276}
     }
   name ColorMatrix13
   label "P3D60 to XYZ"
   xpos 510
   ypos 224
  }
push $N801d1400
  ColorMatrix {
   matrix {
       {0.4451698363 0.2771343887 0.1722826511}
       {0.209491685 0.7215952873 0.06891305745}
       {0 0.04706057906 0.9073553085}
     }
   name ColorMatrix18
   label "P3DCI to XYZ"
   xpos 400
   ypos 224
  }
push $N801d1400
  ColorMatrix {
   matrix {
       {0.4865709841 0.2656676769 0.1982172877}
       {0.2289745659 0.6917385459 0.07928691059}
       {0 0.04511339962 1.043944359}
     }
   name ColorMatrix16
   label "P3D65 to XYZ"
   xpos 290
   ypos 224
  }
push $N801d1400
  ColorMatrix {
   matrix {
       {0.6369580626 0.1446169019 0.1688809693}
       {0.2627002299 0.6779980659 0.05930171534}
       {0 0.0280726999 1.060985088}
     }
   name ColorMatrix3
   label "Rec2020 to XYZ"
   xpos 180
   ypos 224
  }
push $N801d1400
  ColorMatrix {
   matrix {
       {0.4123907983 0.3575843275 0.180480808}
       {0.2126390189 0.7151686549 0.07219231874}
       {0.01933082007 0.1191947311 0.950532198}
     }
   name ColorMatrix1
   label "Rec709 to XYZ"
   xpos 70
   ypos 224
  }
  Switch {
   inputs 8
   which {{parent.limiting_pri}}
   name limiting_primary_switch1
   xpos -40
   ypos 326
  }
  Output {
   name Output
   xpos -40
   ypos 446
  }
 end_group
 Group {
  name XYZ_2_DISPLAY_PRI
  label "CIE XYZ to display encoding primaries"
  xpos -1250
  ypos 1976
  addUserKnob {20 XYZ_2_DISPLAY_PRI_tab l XYZ_2_DISPLAY_PRI}
  addUserKnob {4 display_pri l "display pri" M {Rec709 Rec2020 P3D65 P3DCI P3D60 ACEScg ACES XYZ}}
  display_pri {{parent.display_pri}}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -298
  }
  Dot {
   name Dot1
   label " XYZ to display primaries"
   note_font "Helvetica Bold"
   note_font_size 24
   note_font_color 0xa5a5a501
   xpos -6
   ypos -198
  }
set N80162800 [stack 0]
push $N80162800
  ColorMatrix {
   matrix {
       {1.049811006 0 -9.748453158e-05}
       {-0.4959030151 1.373313069 0.09824004024}
       {4.020908051e-08 0 0.9912520051}
     }
   name ColorMatrix3
   label "XYZ to ACES"
   xpos 730
   ypos -136
  }
push $N80162800
  ColorMatrix {
   matrix {
       {1.641023397 -0.3248033226 -0.2364246994}
       {-0.6636629701 1.615331769 0.01675636508}
       {0.01172191743 -0.008284457959 0.9883947968}
     }
   name ColorMatrix21
   label "XYZ to ACEScg"
   xpos 620
   ypos -136
  }
push $N80162800
  ColorMatrix {
   matrix {
       {2.402741432 -0.8974840641 -0.3880533576}
       {-0.8325796723 1.769231915 0.02371272631}
       {0.03882339597 -0.08249972761 1.036368608}
     }
   name ColorMatrix15
   label "XYZ to P3D60"
   xpos 510
   ypos -136
  }
push $N80162800
  ColorMatrix {
   matrix {
       {2.725393534 -1.018002748 -0.4401631057}
       {-0.795167923 1.689731717 0.02264718339}
       {0.04124190658 -0.0876390487 1.100929499}
     }
   name ColorMatrix19
   label "XYZ to P3DCI"
   xpos 400
   ypos -136
  }
push $N80162800
  ColorMatrix {
   matrix {
       {2.493496418 -0.9313833117 -0.4027107358}
       {-0.8294888139 1.762663841 0.02362467349}
       {0.03584583849 -0.07617240399 0.9568845034}
     }
   name ColorMatrix17
   label "XYZ to P3D65"
   xpos 290
   ypos -136
  }
push $N80162800
  ColorMatrix {
   matrix {
       {1.71665132 -0.3556708097 -0.2533662617}
       {-0.6666844487 1.616481304 0.01576855592}
       {0.01763986237 -0.04277062416 0.9421030879}
     }
   name ColorMatrix12
   label "XYZ to Rec2020"
   xpos 180
   ypos -136
  }
push $N80162800
  ColorMatrix {
   matrix {
       {3.240970135 -1.537383318 -0.4986107945}
       {-0.9692437053 1.875967622 0.04155509174}
       {0.0556300357 -0.2039768547 1.056971431}
     }
   name ColorMatrix2
   label "XYZ to Rec709"
   xpos 70
   ypos -136
  }
  Switch {
   inputs 8
   which {{parent.display_pri}}
   name limiting_primary_switch
   xpos -40
   ypos -34
  }
  Output {
   name Output
   xpos -40
   ypos 86
  }
 end_group
 Clamp {
  channels rgb
  name clamp_f3_all
  xpos -1250
  ypos 2164
 }
 Dot {
  name Dot1
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1216
  ypos 2514
 }
set N800f3c00 [stack 0]
push $N800f3c00
 Dot {
  name Dot3
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -886
  ypos 2514
 }
set N800f3800 [stack 0]
 Dot {
  name Dot4
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -666
  ypos 2514
 }
set N800f3400 [stack 0]
 Dot {
  name Dot6
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -446
  ypos 2514
 }
set N800f3000 [stack 0]
 Dot {
  name Dot18
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -226
  ypos 2514
 }
set N800f2c00 [stack 0]
 Dot {
  name Dot20
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -6
  ypos 2514
 }
set N800f2800 [stack 0]
 Dot {
  name Dot25
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 214
  ypos 2514
 }
set N800f2400 [stack 0]
 Dot {
  name Dot24
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 654
  ypos 2514
 }
 Dot {
  name Dot2
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 654
  ypos 2610
 }
set N800f1c00 [stack 0]
 Expression {
  expr0 "r * (Ymax - Ymin) + Ymin"
  expr1 "g * (Ymax - Ymin) + Ymin"
  expr2 "b * (Ymax - Ymin) + Ymin"
  name linCV_2_Y_f3_hdr
  label "stretch_black = True"
  xpos 510
  ypos 2672
  addUserKnob {20 Luminance}
  addUserKnob {7 Ymin R 0.0001 0.02}
  addUserKnob {7 Ymax R 48 10000}
  Ymax {{parent.lum.2}}
 }
push $N800f1c00
 Expression {
  expr0 "r * (Ymax - Ymin) + Ymin"
  expr1 "g * (Ymax - Ymin) + Ymin"
  expr2 "b * (Ymax - Ymin) + Ymin"
  name linCV_2_Y_f3_hdr2
  label "stretch_black = False"
  xpos 620
  ypos 2672
  addUserKnob {20 Luminance}
  addUserKnob {7 Ymin R 0.0001 0.02}
  Ymin {{parent.lum.0}}
  addUserKnob {7 Ymax R 48 10000}
  Ymax {{parent.lum.2}}
 }
 Switch {
  inputs 2
  which {{parent.stretch_black}}
  name StretchBlacks_Switch
  xpos 620
  ypos 2750
 }
 Clamp {
  channels rgb
  maximum 65535
  name clamp_f3__
  xpos 620
  ypos 2822
 }
 Expression {
  temp_name0 Lm_r
  temp_expr0 "pow((r / pq_C), pq_m1)"
  temp_name1 Lm_g
  temp_expr1 "pow((g / pq_C), pq_m1)"
  temp_name2 Lm_b
  temp_expr2 "pow((b / pq_C), pq_m1)"
  expr0 "pow(( pq_c1 + pq_c2 * Lm_r ) / ( 1.0 + pq_c3 * Lm_r ), pq_m2)"
  expr1 "pow(( pq_c1 + pq_c2 * Lm_g ) / ( 1.0 + pq_c3 * Lm_g ), pq_m2)"
  expr2 "pow(( pq_c1 + pq_c2 * Lm_b ) / ( 1.0 + pq_c3 * Lm_b ), pq_m2)"
  name Y_2_ST2084_
  label "ACESlib.OutputTransforms.ctl : 243 \nACESlib.Utilities_Color.ctl : 425"
  xpos 620
  ypos 2882
  addUserKnob {20 SMPTE_ST2084-2014_Constants_tab l "Constants from SMPTE ST 2084-2014"}
  addUserKnob {7 pq_m1 t " ( 2610.0 / 4096.0 ) / 4.0;" +DISABLED R 0 100}
  pq_m1 0.1593017578
  addUserKnob {7 pq_m2 t " ( 2523.0 / 4096.0 ) * 128.0;" +DISABLED R 0 100}
  pq_m2 78.84375
  addUserKnob {7 pq_c1 t " 3424.0 / 4096.0 or pq_c3 - pq_c2 + 1.0;" +DISABLED R 0 100}
  pq_c1 0.8359375
  addUserKnob {7 pq_c2 t " ( 2413.0 / 4096.0 ) * 32.0;" +DISABLED R 0 100}
  pq_c2 18.8515625
  addUserKnob {7 pq_c3 t " ( 2392.0 / 4096.0 ) * 32.0;" +DISABLED R 0 100}
  pq_c3 18.6875
  addUserKnob {7 pq_C +DISABLED R 0 100}
  pq_C 10000
 }
set N800f0c00 [stack 0]
 Dot {
  name Dot5
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 984
  ypos 2514
 }
 Expression {
  temp_name0 Np_r
  temp_expr0 "pow( r, 1.0 / pq_m2 )"
  temp_name1 Np_g
  temp_expr1 "pow( g, 1.0 / pq_m2 )"
  temp_name2 Np_b
  temp_expr2 "pow( b, 1.0 / pq_m2 )"
  expr0 "r < 0 ? 0 : pow((Np_r - pq_c1) / ( pq_c2 - pq_c3 * Np_r ), 1.0/pq_m1) * pq_C"
  expr1 "g < 0 ? 0 : pow((Np_g - pq_c1) / ( pq_c2 - pq_c3 * Np_g ), 1.0/pq_m1) * pq_C"
  expr2 "b < 0 ? 0 : pow((Np_b - pq_c1) / ( pq_c2 - pq_c3 * Np_b ), 1.0/pq_m1) * pq_C"
  name ST2084_2_Y_f3_
  label "ACESlib.Utilities_Color.ctl : 408\n// Converts from the non-linear perceptually quantized space to linear cd/m^2"
  xpos 950
  ypos 2618
  addUserKnob {20 SMPTE_ST2084-2014_Constants_tab l "Constants from SMPTE ST 2084-2014"}
  addUserKnob {7 pq_m1 t " ( 2610.0 / 4096.0 ) / 4.0;" +DISABLED R 0 100}
  pq_m1 0.1593017578
  addUserKnob {7 pq_m2 t " ( 2523.0 / 4096.0 ) * 128.0;" +DISABLED R 0 100}
  pq_m2 78.84375
  addUserKnob {7 pq_c1 t " 3424.0 / 4096.0 or pq_c3 - pq_c2 + 1.0;" +DISABLED R 0 100}
  pq_c1 0.8359375
  addUserKnob {7 pq_c2 t " ( 2413.0 / 4096.0 ) * 32.0;" +DISABLED R 0 100}
  pq_c2 18.8515625
  addUserKnob {7 pq_c3 t " ( 2392.0 / 4096.0 ) * 32.0;" +DISABLED R 0 100}
  pq_c3 18.6875
  addUserKnob {7 pq_C +DISABLED R 0 100}
  pq_C 10000
 }
 Expression {
  temp_name0 Y_d
  temp_expr0 "0.2627*r + 0.6780*g + 0.0593*b"
  expr0 "Y_d == 0 ? 0 : pow( (Y_d-c_beta)/c_alpha, (1-c_gamma)/c_gamma) * ((r-c_beta)/c_alpha)"
  expr1 "Y_d == 0 ? 0 : pow( (Y_d-c_beta)/c_alpha, (1-c_gamma)/c_gamma) * ((g-c_beta)/c_alpha)"
  expr2 "Y_d == 0 ? 0 : pow( (Y_d-c_beta)/c_alpha, (1-c_gamma)/c_gamma) * ((b-c_beta)/c_alpha)"
  name ST2084_2_HLG_1000nits_f3_3
  label "ACESlib.Utilities_Color.ctl : 469\n// HLG Inverse EOTF (i.e. HLG inverse OOTF followed by the HLG OETF)\n// HLG Inverse OOTF (display linear to scene linear)"
  xpos 950
  ypos 2732
  addUserKnob {20 Constants_tab l Constants}
  addUserKnob {7 L_w +DISABLED}
  L_w 1000
  addUserKnob {7 L_b +DISABLED}
  addUserKnob {7 c_alpha +DISABLED}
  c_alpha {{L_w-L_b}}
  addUserKnob {7 c_beta +DISABLED}
  c_beta {{L_b}}
  addUserKnob {7 c_gamma +DISABLED}
  c_gamma 1.2
 }
 Expression {
  channel0 {rgba.red -rgba.green -rgba.blue none}
  expr0 "r <= 1.0/12 ? sqrt(3.0*r) : c_a * log(12.0 * r - c_b) + c_c"
  expr1 "g <= 1.0/12 ? sqrt(3.0*g) : c_a * log(12.0 * g- c_b) + c_c"
  expr2 "b <= 1.0/12 ? sqrt(3.0*b) : c_a * log(12.0 * b - c_b) + c_c"
  name ST2084_2_HLG_1000nits_f3_
  label "ACESlib.Utilities_Color.ctl : 493\n// HLG OETF (scene linear to non-linear signal value)"
  xpos 950
  ypos 2834
  addUserKnob {20 Constants_tab l Constants}
  addUserKnob {7 c_a +DISABLED}
  c_a 0.17883277
  addUserKnob {7 c_b t 1.-4.*a +DISABLED}
  c_b 0.28466892
  addUserKnob {7 c_c t 0.5-a*log(4.*a) +DISABLED}
  c_c 0.55991073
 }
 Dot {
  name Dot17
  label " HLG"
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 984
  ypos 2970
 }
push $N800f0c00
 Dot {
  name Dot27
  label " PQ"
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 654
  ypos 2970
 }
push $N800f2400
 Expression {
  expr0 "pow( (48./52.37) * r, 1./2.6)"
  expr1 "pow( (48./52.37) * g, 1./2.6)"
  expr2 "pow( (48./52.37) * b, 1./2.6)"
  expr3 1
  name dcdm_encode
  xpos 180
  ypos 2702
 }
push $N800f2800
 Expression {
  expr0 pow(r,1/gamma)
  expr1 pow(g,1/gamma)
  expr2 pow(b,1/gamma)
  name pow_f3_gamma_26_
  label "ACESlib.Utilities_Color.ctl : 260\n// Gamma 2.6"
  xpos -40
  ypos 2690
  addUserKnob {20 Gamma_tab l Gamma}
  addUserKnob {7 gamma R 0 4}
  gamma 2.6
 }
push $N800f2c00
 Expression {
  expr0 pow(r,1/gamma)
  expr1 pow(g,1/gamma)
  expr2 pow(b,1/gamma)
  name pow_f3_gamma_24_
  label "ACESlib.Utilities_Color.ctl : 260\n// Gamma 2.4"
  xpos -260
  ypos 2690
  addUserKnob {20 Gamma_tab l Gamma}
  addUserKnob {7 gamma R 0 4}
  gamma 2.4
 }
push $N800f3000
 Expression {
  expr0 pow(r,1/gamma)
  expr1 pow(g,1/gamma)
  expr2 pow(b,1/gamma)
  name pow_f3_gamma_22_
  label "ACESlib.Utilities_Color.ctl : 260\n// Gamma 2.2"
  xpos -480
  ypos 2690
  addUserKnob {20 Gamma_tab l Gamma}
  addUserKnob {7 gamma R 0 4}
  gamma 2.2
 }
push $N800f3400
 Expression {
  temp_name0 c_a
  temp_expr0 "pow( pow( Lw, 1./gamma) - pow( Lb, 1./gamma), gamma)"
  temp_name1 c_b
  temp_expr1 "pow( Lb, 1./gamma) / ( pow( Lw, 1./gamma) - pow( Lb, 1./gamma))"
  expr0 "pow( max( r / c_a, 0.), 1.0/gamma) - c_b"
  expr1 "pow( max( g / c_a, 0.), 1.0/gamma) - c_b"
  expr2 "pow( max( b / c_a, 0.), 1.0/gamma) - c_b"
  name bt1886_r_f3
  label "ACESlib.Utilities_Color.ctl : 301\n// The reference EOTF specified in Rec. ITU-R BT.1886\n// L = a(max\[(V+b),0])^g"
  xpos -700
  ypos 2684
  addUserKnob {20 Luminance}
  addUserKnob {7 Lw R 48 10000}
  Lw 1
  addUserKnob {7 Lb R 0.0001 0.02}
  addUserKnob {7 gamma R 1 4}
  gamma 2.4
 }
push $N800f3800
 Expression {
  temp_name0 yb
  temp_expr0 "pow( offs * gamma / ( ( gamma - 1.0) * ( 1.0 + offs)), gamma)"
  temp_name1 rs
  temp_expr1 "pow( ( gamma - 1.0) / offs, gamma - 1.0) * pow( ( 1.0 + offs) / gamma, gamma)"
  expr0 "r >= yb ? ( 1.0 + offs) * pow( r, 1.0 / gamma) - offs : r * rs"
  expr1 "g >= yb ? ( 1.0 + offs) * pow( g, 1.0 / gamma) - offs : g * rs"
  expr2 "b >= yb ? ( 1.0 + offs) * pow( b, 1.0 / gamma) - offs : b * rs"
  name moncurve_r_f3_
  label "ACESlib.Utilities_Color.ctl : 260\nmoncurve_r with gamma of 2.4 and offset of 0.055 matches the EOTF found in IEC 61966-2-1:1999 (sRGB)"
  xpos -920
  ypos 2690
  addUserKnob {20 Luminance}
  addUserKnob {7 gamma R 0 4}
  gamma 2.4
  addUserKnob {7 offs}
  offs 0.055
 }
 Switch {
  inputs 10
  which {{parent.eotf}}
  name EOTF_Switch
  xpos -1250
  ypos 2966
 }
 Expression {
  temp_name0 REFBLACK
  temp_expr0 "64 / 1023"
  temp_name1 REFWHITE
  temp_expr1 "940 / 1023"
  expr0 "r * ( REFWHITE - REFBLACK) + REFBLACK"
  expr1 "g * ( REFWHITE - REFBLACK) + REFBLACK"
  expr2 "b * ( REFWHITE - REFBLACK) + REFBLACK"
  name fullRange_to_smpteRange_f3_
  label "ACESlib.OutputTransforms.ctl : 216"
  xpos -1250
  ypos 3224
  disable {{!parent.legal_range}}
 }
 Output {
  name Output
  xpos -1250
  ypos 3446
 }
 StickyNote {
  inputs 0
  name StickyNote1
  tile_color 0x535a61ff
  label "\n<b>ACESlib.RRT_Common.ctl : 135</b>\n<pre>\nfloat\[3] rrt_sweeteners( float in\[3])\n\{\n    float aces\[3] = in;\n    \n    // --- Glow module --- //\n    float saturation = rgb_2_saturation( aces);\n    float ycIn = rgb_2_yc( aces);\n    float s = sigmoid_shaper( (saturation - 0.4) / 0.2);\n    float addedGlow = 1. + glow_fwd( ycIn, RRT_GLOW_GAIN * s, RRT_GLOW_MID);\n\n    aces = mult_f_f3( addedGlow, aces);\n\n    // --- Red modifier --- //\n    float hue = rgb_2_hue( aces);\n    float centeredHue = center_hue( hue, RRT_RED_HUE);\n    float hueWeight = cubic_basis_shaper( centeredHue, RRT_RED_WIDTH);\n\n    aces\[0] = aces\[0] + hueWeight * saturation * (RRT_RED_PIVOT - aces\[0]) * (1. - RRT_RED_SCALE);\n\n    // --- ACES to RGB rendering space --- //\n    aces = clamp_f3( aces, 0., HALF_POS_INF);\n    float rgbPre\[3] = mult_f3_f44( aces, AP0_2_AP1_MAT);\n    rgbPre = clamp_f3( rgbPre, 0., HALF_MAX);\n    \n    // --- Global desaturation --- //\n    rgbPre = mult_f3_f33( rgbPre, RRT_SAT_MAT);\n    return rgbPre;\n\}\n\n\n\n"
  note_font_size 10
  xpos -825
  ypos -1204
 }
 StickyNote {
  inputs 0
  name StickyNote2
  tile_color 0x535a61ff
  label "\n\n<b>ACESlib.SSTS.ctl : 163</b><pre>float ssts\n( \n    varying float x,\n    varying TsParams C\n)\n\{\n    const int N_KNOTS_LOW = 4;\n    const int N_KNOTS_HIGH = 4;\n\n    // Check for negatives or zero before taking the log. If negative or zero,\n    // set to HALF_MIN.\n    float logx = log10( max(x, HALF_MIN )); \n\n    float logy;\n\n    if ( logx <= log10(C.Min.x) ) \{ \n\n        logy = logx * C.Min.slope + ( log10(C.Min.y) - C.Min.slope * log10(C.Min.x) );\n\n    \} else if (( logx > log10(C.Min.x) ) && ( logx < log10(C.Mid.x) )) \{\n\n        float knot_coord = (N_KNOTS_LOW-1) * (logx-log10(C.Min.x))/(log10(C.Mid.x)-log10(C.Min.x));\n        int j = knot_coord;\n        float t = knot_coord - j;\n\n        float cf\[ 3] = \{ C.coefsLow\[ j], C.coefsLow\[ j + 1], C.coefsLow\[ j + 2]\};\n\n        float monomials\[ 3] = \{ t * t, t, 1. \};\n        logy = dot_f3_f3( monomials, mult_f3_f33( cf, M1));\n\n    \} else if (( logx >= log10(C.Mid.x) ) && ( logx < log10(C.Max.x) )) \{\n\n        float knot_coord = (N_KNOTS_HIGH-1) * (logx-log10(C.Mid.x))/(log10(C.Max.x)-log10(C.Mid.x));\n        int j = knot_coord;\n        float t = knot_coord - j;\n\n        float cf\[ 3] = \{ C.coefsHigh\[ j], C.coefsHigh\[ j + 1], C.coefsHigh\[ j + 2]\}; \n\n        float monomials\[ 3] = \{ t * t, t, 1. \};\n        logy = dot_f3_f3( monomials, mult_f3_f33( cf, M1));\n\n    \} else \{ //if ( logIn >= log10(C.Max.x) ) \{ \n\n        logy = logx * C.Max.slope + ( log10(C.Max.y) - C.Max.slope * log10(C.Max.x) );\n\n    \}\n\n    return pow10(logy);\n\n\}"
  note_font_size 10
  xpos -830
  ypos -664
 }
 StickyNote {
  inputs 0
  name StickyNote3
  tile_color 0x535a61ff
  label "\n\n<b>ACESlib.Tonescales.ctl : 271</b><pre>float segmented_spline_c9_fwd\n  ( \n    varying float x,\n    varying SegmentedSplineParams_c9 C = ODT_48nits\n  )\n\{    \n  const int N_KNOTS_LOW = 8;\n  const int N_KNOTS_HIGH = 8;\n\n  // Check for negatives or zero before taking the log. If negative or zero,\n  // set to HALF_MIN.\n  float logx = log10( max(x, HALF_MIN )); \n\n  float logy;\n\n  if ( logx <= log10(C.minPoint.x) ) \{ \n\n    logy = logx * C.slopeLow + ( log10(C.minPoint.y) - C.slopeLow * log10(C.minPoint.x) );\n\n  \} else if (( logx > log10(C.minPoint.x) ) && ( logx < log10(C.midPoint.x) )) \{\n\n    float knot_coord = (N_KNOTS_LOW-1) * (logx-log10(C.minPoint.x))/(log10(C.midPoint.x)-log10(C.minPoint.x));\n    int j = knot_coord;\n    float t = knot_coord - j;\n\n    float cf\[ 3] = \{ C.coefsLow\[ j], C.coefsLow\[ j + 1], C.coefsLow\[ j + 2]\};\n    \n    float monomials\[ 3] = \{ t * t, t, 1. \};\n    logy = dot_f3_f3( monomials, mult_f3_f33( cf, M));\n\n  \} else if (( logx >= log10(C.midPoint.x) ) && ( logx < log10(C.maxPoint.x) )) \{\n\n    float knot_coord = (N_KNOTS_HIGH-1) * (logx-log10(C.midPoint.x))/(log10(C.maxPoint.x)-log10(C.midPoint.x));\n    int j = knot_coord;\n    float t = knot_coord - j;\n\n    float cf\[ 3] = \{ C.coefsHigh\[ j], C.coefsHigh\[ j + 1], C.coefsHigh\[ j + 2]\}; \n\n    float monomials\[ 3] = \{ t * t, t, 1. \};\n    logy = dot_f3_f3( monomials, mult_f3_f33( cf, M));\n\n  \} else \{ //if ( logIn >= log10(C.maxPoint.x) ) \{ \n\n    logy = logx * C.slopeHigh + ( log10(C.maxPoint.y) - C.slopeHigh * log10(C.maxPoint.x) );\n\n  \}\n\n  return pow10(logy);\n  \n\}"
  note_font_size 10
  xpos -200
  ypos -660
 }
push $N7fe59000
 Reformat {
  type "to box"
  box_width 4
  box_height 4
  box_fixed true
  name Reformat1
  note_font Helvetica
  xpos -1140
  ypos -561
 }
 Fill {
  output rgb
  color {{parent.ssts.mid_lum}}
  name Fill1
  note_font Helvetica
  xpos -1140
  ypos -537
 }
 Group {
  name inv_ssts
  xpos -1140
  ypos -514
  addUserKnob {20 ssts_tab l ssts}
  addUserKnob {78 lum l luminance t "<b>SSTS Display Luminance</b>: \ny_min y_mid y_max\n\nAccording to Zach Lewis's ACES_OT\nhttps://gist.github.com/zachlewis/786c0be941868644c993fde1c3515c2c\n\n<b>Standard Cinema</b>: \n0.02 4.8 48\n<b>Dolby Cinema</b>: \n0.0001 7.2 108\n<b>Dolby Pulsar</b>: \n0.005 15 4000\n<b>Dolby PRR-4220</b>: \n0.005 10 600\n<b>Sony BVM-X300</b>: \n0.0001 10 1000\n<b>ACES OCES</b>: \n0.0001 4.8 10000\n\n" n 3}
  lum {{"use_c9 ? 0.0001 : parent.lum"} 4.8 {"use_c9 ? 10000 : parent.lum"}}
  addUserKnob {6 override_ssts_params l "override ssts params" t "Enable overrides of SSTS params.\n\nOtherwise the values will be calculated automatically by the algorithm." +STARTLINE}
  override_ssts_params {{parent.ACES_SSTS.AcesSSTSKernel_override_curve_params}}
  addUserKnob {7 exposure R -5 5}
  exposure {{parent.exposure}}
  addUserKnob {7 knee}
  knee {{parent.pctLow}}
  addUserKnob {7 shoulder}
  shoulder {{parent.pctHigh}}
  addUserKnob {78 slope n 3}
  slope {{parent.slope} {parent.slope} {parent.slope}}
  addUserKnob {20 TsParams_tab l TsParams}
  addUserKnob {7 expShift R -4 4}
  expShift {{"override_ssts_params ? exposure : 0"}}
  addUserKnob {13 minPoint t "x;        // ACES\ny;        // luminance\nz;        // slope"}
  minPoint {{"pow(2, log(0.18*pow(2, MIN_STOP_RRT+((MIN_STOP_SDR-MIN_STOP_RRT)/(log10(MIN_LUM_SDR)-log10(MIN_LUM_RRT)))*(log10(minPoint.y)-log10(MIN_LUM_RRT))))/log(2)-expShift)"} {lum.0} {override_ssts_params?slope.0:0}}
  addUserKnob {13 midPoint t "x;        // ACES\ny;        // luminance\nz;        // slope"}
  midPoint {{"pow(2, ((log(0.18)/log(2)-expShift)))"} {lum.1} {override_ssts_params?slope.1:1.55}}
  addUserKnob {13 maxPoint t "x;        // ACES\ny;        // luminance\nz;        // slope"}
  maxPoint {{"pow(2, log(0.18*pow(2, (MAX_STOP_SDR+(MAX_STOP_RRT-MAX_STOP_SDR)/(log10(MAX_LUM_RRT)-log10(MAX_LUM_SDR))*(log10(maxPoint.y)-log10(MAX_LUM_SDR)))))/log(2)-expShift)"} {lum.2} {override_ssts_params?slope.2:0}}
  addUserKnob {7 knotIncLow}
  knotIncLow {{"(log10(midPoint.x) - log10(minPoint.x)) / 3.0"}}
  addUserKnob {7 knotIncHigh}
  knotIncHigh {{"(log10(maxPoint.x) - log10(midPoint.x)) / 3.0"}}
  addUserKnob {7 pctLow}
  pctLow {{0.18+(0.35-0.18)/(MIN_STOP_SDR-MIN_STOP_RRT)*(log(minPoint.x/0.18)/log(2)-MIN_STOP_RRT)}}
  addUserKnob {7 pctHigh}
  pctHigh {{0.89+(0.90-0.89)/(MAX_STOP_SDR-MAX_STOP_RRT)*(log(maxPoint.x/0.89)/log(2)-MAX_STOP_RRT)}}
  addUserKnob {78 coefsLow n 5}
  coefsLow {{"(minPoint.z * (log10(minPoint.x)-0.5*knotIncLow)) + ( log10(minPoint.y) - minPoint.z * log10(minPoint.x))"} {"(minPoint.z * (log10(minPoint.x)+0.5*knotIncLow)) + ( log10(minPoint.y) - minPoint.z * log10(minPoint.x))"} {log10(minPoint.y)+pctLow*(log10(midPoint.y)-log10(minPoint.y))} {"(midPoint.z * (log10(midPoint.x)-0.5*knotIncLow)) + ( log10(midPoint.y) - midPoint.z * log10(midPoint.x))"} {"(midPoint.z * (log10(midPoint.x)+0.5*knotIncLow)) + ( log10(midPoint.y) - midPoint.z * log10(midPoint.x))"}}
  addUserKnob {78 coefsHigh n 5}
  coefsHigh {{"(midPoint.z * (log10(midPoint.x)-0.5*knotIncHigh)) + ( log10(midPoint.y) - midPoint.z * log10(midPoint.x))"} {"(midPoint.z * (log10(midPoint.x)+0.5*knotIncHigh)) + ( log10(midPoint.y) - midPoint.z * log10(midPoint.x))"} {log10(midPoint.y)+pctHigh*(log10(maxPoint.y)-log10(midPoint.y))} {"(maxPoint.z * (log10(maxPoint.x)-0.5*knotIncHigh)) + ( log10(maxPoint.y) - maxPoint.z * log10(maxPoint.x))"} {"(maxPoint.z * (log10(maxPoint.x)+0.5*knotIncHigh)) + ( log10(maxPoint.y) - maxPoint.z * log10(maxPoint.x))"}}
  addUserKnob {7 KNOT_INC_LOW}
  KNOT_INC_LOW {{"(log10(midPoint.x) - log10(minPoint.x)) / (N_KNOTS_LOW - 1)"}}
  addUserKnob {7 KNOT_INC_HIGH}
  KNOT_INC_HIGH {{"(log10(maxPoint.x) - log10(midPoint.x)) / (N_KNOTS_HIGH - 1)"}}
  addUserKnob {78 KNOT_Y_LOW n 4}
  KNOT_Y_LOW {{"(coefsLow.0 + coefsLow.1) / 2"} {"(coefsLow.1 + coefsLow.2) / 2"} {"(coefsLow.2 + coefsLow.3) / 2"} {"(coefsLow.3 + coefsLow.4) / 2"}}
  addUserKnob {78 KNOT_Y_HIGH n 4}
  KNOT_Y_HIGH {{"(coefsHigh.0 + coefsHigh.1) / 2"} {"(coefsHigh.1 + coefsHigh.2) / 2"} {"(coefsHigh.2 + coefsHigh.3) / 2"} {"(coefsHigh.3 + coefsHigh.4) / 2"}}
  addUserKnob {20 Constants_tab l const}
  addUserKnob {3 N_KNOTS_LOW}
  N_KNOTS_LOW 4
  addUserKnob {3 N_KNOTS_HIGH}
  N_KNOTS_HIGH 4
  addUserKnob {7 MIN_STOP_SDR R -20 20}
  MIN_STOP_SDR -6.5
  addUserKnob {7 MAX_STOP_SDR R -20 20}
  MAX_STOP_SDR 6.5
  addUserKnob {7 MIN_STOP_RRT R -20 20}
  MIN_STOP_RRT -15
  addUserKnob {7 MAX_STOP_RRT R -20 20}
  MAX_STOP_RRT 18
  addUserKnob {7 MIN_LUM_SDR R 0 0.1}
  MIN_LUM_SDR 0.02
  addUserKnob {7 MAX_LUM_SDR R 0 100}
  MAX_LUM_SDR 48
  addUserKnob {7 MIN_LUM_RRT R 0 0.1}
  MIN_LUM_RRT 0.0001
  addUserKnob {7 MAX_LUM_RRT R 0 10000}
  MAX_LUM_RRT 10000
 }
  Input {
   inputs 0
   name Input
   xpos -1030
   ypos -634
  }
  Dot {
   name Dot25
   label " "
   xpos -996
   ypos -318
  }
set N80032c00 [stack 0]
  Dot {
   name Dot26
   label " "
   xpos -996
   ypos 1506
  }
push $N80032c00
  Dot {
   name Dot4
   label " "
   xpos -886
   ypos -318
  }
set N80032400 [stack 0]
  Dot {
   name Dot5
   label " "
   xpos -776
   ypos -318
  }
set N80032000 [stack 0]
  Dot {
   name Dot2
   label " "
   xpos -666
   ypos -318
  }
set N80031c00 [stack 0]
  Dot {
   name Dot3
   label " "
   xpos -556
   ypos -318
  }
set N80031800 [stack 0]
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 1e-10 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 1e-10 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 1e-10 ))"
   expr0 "logr <= log10(minPoint.y)"
   expr1 "logg <= log10(minPoint.y)"
   expr2 "logb <= log10(minPoint.y)"
   name segment_bottom
   xpos -590
   ypos -202
  }
  Dot {
   name Dot1
   label " "
   xpos -556
   ypos 162
  }
push $N80031800
  Dot {
   name Dot7
   label " "
   xpos -336
   ypos -318
  }
set N80030c00 [stack 0]
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 1e-10 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 1e-10 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 1e-10 ))"
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 log10(minPoint.x)
   expr1 log10(minPoint.x)
   expr2 log10(minPoint.x)
   expr3 1
   name Expression
   xpos -370
   ypos -202
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply3
   xpos -370
   ypos 158
  }
  Dot {
   name Dot27
   label " "
   xpos -336
   ypos 786
  }
push $N80031c00
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 1e-10 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 1e-10 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 1e-10 ))"
   expr0 "( logr > log10(minPoint.y) ) && ( logr <= log10(midPoint.y) )"
   expr1 "( logg > log10(minPoint.y) ) && ( logg <= log10(midPoint.y) )"
   expr2 "( logb > log10(minPoint.y) ) && ( logb <= log10(midPoint.y) )"
   name segment_low
   xpos -700
   ypos -202
  }
  Dot {
   name Dot22
   label " "
   xpos -666
   ypos 354
  }
push $N80030c00
  Dot {
   name Dot9
   label " "
   xpos -6
   ypos -318
  }
set N7ffe7000 [stack 0]
  Dot {
   name Dot6
   label " "
   xpos -6
   ypos -174
  }
set N7ffe6c00 [stack 0]
  Dot {
   name Dot8
   label " "
   xpos 214
   ypos -174
  }
set N7ffe6800 [stack 0]
  Dot {
   name Dot13
   label " "
   xpos 434
   ypos -174
  }
  Dot {
   name Dot19
   xpos 434
   ypos -78
  }
set N7ffe6000 [stack 0]
  Expression {
   temp_name0 logy
   temp_expr0 "log10( max(b, 1e-10 ))"
   temp_name1 low
   temp_expr1 "(logy > KNOT_Y_LOW.0) && (logy <= KNOT_Y_LOW.1)"
   temp_name2 mid
   temp_expr2 "(logy > KNOT_Y_LOW.1) && (logy <= KNOT_Y_LOW.2)"
   temp_name3 high
   temp_expr3 "(logy > KNOT_Y_LOW.2) && (logy <= KNOT_Y_LOW.3)"
   expr0 "low ? coefsLow.0 : mid ? coefsLow.1 : coefsLow.2"
   expr1 "low ? coefsLow.1 : mid ? coefsLow.2 : coefsLow.3"
   expr2 "low ? coefsLow.2 : mid ? coefsLow.3 : coefsLow.4"
   expr3 "low ? 0 : mid ? 1 : high ? 2 : 0"
   name inv_cfLow5
   xpos 290
   ypos -82
  }
  ColorMatrix {
   channels {rgba.red rgba.green rgba.blue -rgba.alpha}
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name inv_basis_low5
   xpos 290
   ypos -34
  }
push $N7ffe6000
  MergeExpression {
   inputs 2
   temp_name0 logy
   temp_expr0 "log10(max(Bb, 1e-10))"
   expr0 Ar
   expr1 Ag
   expr2 Ab-logy
   expr3 Aa
   name c_minus_logy5
   xpos 400
   ypos -34
  }
  Expression {
   temp_name0 j
   temp_expr0 a
   temp_name1 d
   temp_expr1 "sqrt(g*g - 4*r*b)"
   temp_name2 t
   temp_expr2 "(2.*b)/(-sqrt(g*g - 4*r*b)-g)"
   expr0 0
   channel1 {-rgba.red rgba.green -rgba.blue none}
   expr1 0
   channel2 {-rgba.red -rgba.green rgba.blue none}
   expr2 "log10(minPoint.x) + (t +j) * KNOT_INC_LOW"
   expr3 1
   maskChannelInput -rgba.alpha
   unpremult -rgba.alpha
   name inv_knot_vals4
   xpos 400
   ypos 14
   addUserKnob {20 User}
   addUserKnob {7 knotIncLow}
   knotIncLow {{parent.knotIncLow}}
   addUserKnob {13 min l Min}
   min {{parent.min.x} {parent.min.y} {parent.minSlope}}
  }
push 0
push $N7ffe6c00
  Dot {
   name Dot10
   xpos -6
   ypos -78
  }
set N7ffe4c00 [stack 0]
  Expression {
   temp_name0 logy
   temp_expr0 "log10( max(r, 1e-10 ))"
   temp_name1 low
   temp_expr1 "(logy > KNOT_Y_LOW.0) && (logy <= KNOT_Y_LOW.1)"
   temp_name2 mid
   temp_expr2 "(logy > KNOT_Y_LOW.1) && (logy <= KNOT_Y_LOW.2)"
   temp_name3 high
   temp_expr3 "(logy > KNOT_Y_LOW.2) && (logy <= KNOT_Y_LOW.3)"
   expr0 "low ? coefsLow.0 : mid ? coefsLow.1 : coefsLow.2"
   expr1 "low ? coefsLow.1 : mid ? coefsLow.2 : coefsLow.3"
   expr2 "low ? coefsLow.2 : mid ? coefsLow.3 : coefsLow.4"
   expr3 "low ? 0 : mid ? 1 : high ? 2 : 0"
   name inv_cfLow
   xpos -150
   ypos -82
  }
  ColorMatrix {
   channels {rgba.red rgba.green rgba.blue -rgba.alpha}
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name inv_basis_low
   xpos -150
   ypos -34
  }
push $N7ffe4c00
  MergeExpression {
   inputs 2
   temp_name0 logy
   temp_expr0 "log10(max(Br, 1e-10))"
   expr0 Ar
   expr1 Ag
   expr2 Ab-logy
   expr3 Aa
   name c_minus_logy
   xpos -40
   ypos -34
  }
  Expression {
   temp_name0 j
   temp_expr0 a
   temp_name1 d
   temp_expr1 "sqrt(g*g - 4*r*b)"
   temp_name2 t
   temp_expr2 "(2.*b)/(-sqrt(g*g - 4*r*b)-g)"
   expr0 "log10(minPoint.x) + (t +j) * KNOT_INC_LOW"
   channel1 {-rgba.red rgba.green -rgba.blue none}
   expr1 0
   channel2 {-rgba.red -rgba.green rgba.blue none}
   expr2 0
   expr3 1
   maskChannelInput -rgba.alpha
   unpremult -rgba.alpha
   name inv_knot_vals
   xpos -40
   ypos 14
   addUserKnob {20 User}
   addUserKnob {7 knotIncLow}
   knotIncLow {{parent.knotIncLow}}
   addUserKnob {13 min l Min}
   min {{parent.min.x} {parent.min.y} {parent.minSlope}}
  }
push $N7ffe6800
  Dot {
   name Dot18
   xpos 214
   ypos -78
  }
set N7ff93400 [stack 0]
  Expression {
   temp_name0 logy
   temp_expr0 "log10( max(g, 1e-10 ))"
   temp_name1 low
   temp_expr1 "(logy > KNOT_Y_LOW.0) && (logy <= KNOT_Y_LOW.1)"
   temp_name2 mid
   temp_expr2 "(logy > KNOT_Y_LOW.1) && (logy <= KNOT_Y_LOW.2)"
   temp_name3 high
   temp_expr3 "(logy > KNOT_Y_LOW.2) && (logy <= KNOT_Y_LOW.3)"
   expr0 "low ? coefsLow.0 : mid ? coefsLow.1 : coefsLow.2"
   expr1 "low ? coefsLow.1 : mid ? coefsLow.2 : coefsLow.3"
   expr2 "low ? coefsLow.2 : mid ? coefsLow.3 : coefsLow.4"
   expr3 "low ? 0 : mid ? 1 : high ? 2 : 0"
   name inv_cfLow4
   xpos 70
   ypos -82
  }
  ColorMatrix {
   channels {rgba.red rgba.green rgba.blue -rgba.alpha}
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name inv_basis_low4
   xpos 70
   ypos -34
  }
push $N7ff93400
  MergeExpression {
   inputs 2
   temp_name0 logy
   temp_expr0 "log10(max(Bg, 1e-10))"
   expr0 Ar
   expr1 Ag
   expr2 Ab-logy
   expr3 Aa
   name c_minus_logy4
   xpos 180
   ypos -34
  }
  Expression {
   temp_name0 j
   temp_expr0 a
   temp_name1 d
   temp_expr1 "sqrt(g*g - 4*r*b)"
   temp_name2 t
   temp_expr2 "(2.*b)/(-sqrt(g*g - 4*r*b)-g)"
   expr0 0
   channel1 {-rgba.red rgba.green -rgba.blue none}
   expr1 "log10(minPoint.x) + (t +j) * KNOT_INC_LOW"
   channel2 {-rgba.red -rgba.green rgba.blue none}
   expr2 0
   expr3 1
   maskChannelInput -rgba.alpha
   unpremult -rgba.alpha
   name inv_knot_vals5
   xpos 180
   ypos 14
   addUserKnob {20 User}
   addUserKnob {7 knotIncLow}
   knotIncLow {{parent.knotIncLow}}
   addUserKnob {13 min l Min}
   min {{parent.min.x} {parent.min.y} {parent.minSlope}}
  }
  Merge2 {
   inputs 3+1
   operation plus
   bbox B
   name Merge2
   xpos 180
   ypos 134
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply1
   xpos 180
   ypos 350
  }
  Dot {
   name Dot28
   label " "
   xpos 214
   ypos 786
  }
push 0
push $N80032000
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 1e-10 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 1e-10 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 1e-10 ))"
   expr0 "( logr >= log10(midPoint.y) ) && ( logr < log10(maxPoint.y) )"
   expr1 "( logg >= log10(midPoint.y) ) && ( logg < log10(maxPoint.y) )"
   expr2 "( logb >= log10(midPoint.y) ) && ( logb < log10(maxPoint.y) )"
   name segment_high
   xpos -810
   ypos -202
  }
  Dot {
   name Dot23
   label " "
   xpos -776
   ypos 474
  }
push $N7ffe7000
  Dot {
   name Dot14
   label " "
   xpos 764
   ypos -318
  }
set N7ff90c00 [stack 0]
  Dot {
   name Dot15
   label " "
   xpos 764
   ypos -174
  }
set N7ff90800 [stack 0]
  Dot {
   name Dot17
   label " "
   xpos 984
   ypos -174
  }
set N7ff90400 [stack 0]
  Dot {
   name Dot20
   label " "
   xpos 1204
   ypos -174
  }
  Dot {
   name Dot16
   xpos 1204
   ypos -78
  }
set N80323800 [stack 0]
  Expression {
   temp_name0 logy
   temp_expr0 "log10( max(b, 1e-10 ))"
   temp_name1 low
   temp_expr1 "(logy > KNOT_Y_HIGH.0) && (logy <= KNOT_Y_HIGH.1)"
   temp_name2 mid
   temp_expr2 "(logy > KNOT_Y_HIGH.1) && (logy <= KNOT_Y_HIGH.2)"
   temp_name3 high
   temp_expr3 "(logy > KNOT_Y_HIGH.2) && (logy <= KNOT_Y_HIGH.3)"
   expr0 "low ? coefsHigh.0 : mid ? coefsHigh.1 : coefsHigh.2"
   expr1 "low ? coefsHigh.1 : mid ? coefsHigh.2 : coefsHigh.3"
   expr2 "low ? coefsHigh.2 : mid ? coefsHigh.3 : coefsHigh.4"
   expr3 "low ? 0 : mid ? 1 : high ? 2 : 0"
   name inv_cfLow3
   xpos 1060
   ypos -82
  }
  ColorMatrix {
   channels {rgba.red rgba.green rgba.blue -rgba.alpha}
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name inv_basis_low3
   xpos 1060
   ypos -34
  }
push $N80323800
  MergeExpression {
   inputs 2
   temp_name0 logy
   temp_expr0 "log10(max(Bb, 1e-10))"
   expr0 Ar
   expr1 Ag
   expr2 Ab-logy
   expr3 Aa
   name c_minus_logy3
   xpos 1170
   ypos -34
  }
  Expression {
   temp_name0 j
   temp_expr0 a
   temp_name1 d
   temp_expr1 "sqrt(g*g - 4*r*b)"
   temp_name2 t
   temp_expr2 "(2.*b) / (-sqrt(g*g - 4*r*b) - g)"
   expr0 0
   channel1 {-rgba.red rgba.green -rgba.blue none}
   expr1 0
   channel2 {-rgba.red -rgba.green rgba.blue none}
   expr2 "log10(midPoint.x) + (t +j) * KNOT_INC_HIGH"
   expr3 1
   maskChannelInput -rgba.alpha
   unpremult -rgba.alpha
   name inv_knot_vals3
   xpos 1170
   ypos 14
  }
push 0
push $N7ff90800
  Dot {
   name Dot11
   xpos 764
   ypos -78
  }
set N80322400 [stack 0]
  Expression {
   temp_name0 logy
   temp_expr0 "log10( max(r, 1e-10 ))"
   temp_name1 low
   temp_expr1 "(logy > KNOT_Y_HIGH.0) && (logy <= KNOT_Y_HIGH.1)"
   temp_name2 mid
   temp_expr2 "(logy > KNOT_Y_HIGH.1) && (logy <= KNOT_Y_HIGH.2)"
   temp_name3 high
   temp_expr3 "(logy > KNOT_Y_HIGH.2) && (logy <= KNOT_Y_HIGH.3)"
   expr0 "low ? coefsHigh.0 : mid ? coefsHigh.1 : coefsHigh.2"
   expr1 "low ? coefsHigh.1 : mid ? coefsHigh.2 : coefsHigh.3"
   expr2 "low ? coefsHigh.2 : mid ? coefsHigh.3 : coefsHigh.4"
   expr3 "low ? 0 : mid ? 1 : high ? 2 : 0"
   name inv_cfLow1
   xpos 620
   ypos -82
  }
  ColorMatrix {
   channels {rgba.red rgba.green rgba.blue -rgba.alpha}
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name inv_basis_low1
   xpos 620
   ypos -34
  }
push $N80322400
  MergeExpression {
   inputs 2
   temp_name0 logy
   temp_expr0 "log10(max(Br, 1e-10))"
   expr0 Ar
   expr1 Ag
   expr2 Ab-logy
   expr3 Aa
   name c_minus_logy1
   xpos 730
   ypos -34
  }
  Expression {
   temp_name0 j
   temp_expr0 a
   temp_name1 d
   temp_expr1 "sqrt(g*g - 4*r*b)"
   temp_name2 t
   temp_expr2 "(2.*b) / (-sqrt(g*g - 4*r*b) - g)"
   expr0 "log10(midPoint.x) + (t +j) * KNOT_INC_HIGH"
   channel1 {-rgba.red rgba.green -rgba.blue none}
   expr1 0
   channel2 {-rgba.red -rgba.green rgba.blue none}
   expr2 0
   expr3 1
   maskChannelInput -rgba.alpha
   unpremult -rgba.alpha
   name inv_knot_vals1
   xpos 730
   ypos 14
  }
push $N7ff90400
  Dot {
   name Dot12
   xpos 984
   ypos -78
  }
set N80321000 [stack 0]
  Expression {
   temp_name0 logy
   temp_expr0 "log10( max(g, 1e-10 ))"
   temp_name1 low
   temp_expr1 "(logy > KNOT_Y_HIGH.0) && (logy <= KNOT_Y_HIGH.1)"
   temp_name2 mid
   temp_expr2 "(logy > KNOT_Y_HIGH.1) && (logy <= KNOT_Y_HIGH.2)"
   temp_name3 high
   temp_expr3 "(logy > KNOT_Y_HIGH.2) && (logy <= KNOT_Y_HIGH.3)"
   expr0 "low ? coefsHigh.0 : mid ? coefsHigh.1 : coefsHigh.2"
   expr1 "low ? coefsHigh.1 : mid ? coefsHigh.2 : coefsHigh.3"
   expr2 "low ? coefsHigh.2 : mid ? coefsHigh.3 : coefsHigh.4"
   expr3 "low ? 0 : mid ? 1 : high ? 2 : 0"
   name inv_cfLow2
   xpos 840
   ypos -82
  }
  ColorMatrix {
   channels {rgba.red rgba.green rgba.blue -rgba.alpha}
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name inv_basis_low2
   xpos 840
   ypos -34
  }
push $N80321000
  MergeExpression {
   inputs 2
   temp_name0 logy
   temp_expr0 "log10(max(Bg, 1e-10))"
   expr0 Ar
   expr1 Ag
   expr2 Ab-logy
   expr3 Aa
   name c_minus_logy2
   xpos 950
   ypos -34
  }
  Expression {
   temp_name0 j
   temp_expr0 a
   temp_name1 d
   temp_expr1 "sqrt(g*g - 4*r*b)"
   temp_name2 t
   temp_expr2 "(2.*b) / (-sqrt(g*g - 4*r*b) - g)"
   expr0 0
   channel1 {-rgba.red rgba.green -rgba.blue none}
   expr1 "log10(midPoint.x) + (t +j) * KNOT_INC_HIGH"
   channel2 {-rgba.red -rgba.green rgba.blue none}
   expr2 0
   expr3 1
   maskChannelInput -rgba.alpha
   unpremult -rgba.alpha
   name inv_knot_vals2
   xpos 950
   ypos 14
  }
  Merge2 {
   inputs 3+1
   operation plus
   bbox B
   output rgb
   name Merge1
   xpos 950
   ypos 134
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply2
   xpos 950
   ypos 470
  }
  Dot {
   name Dot29
   label " "
   xpos 984
   ypos 786
  }
push $N80032400
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 1e-10 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 1e-10 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 1e-10 ))"
   expr0 "logr >= log10(maxPoint.y) ? 1 : 0"
   expr1 "logg >= log10(maxPoint.y) ? 1 : 0"
   expr2 "logb >= log10(maxPoint.y) ? 1 : 0"
   name segment_peak
   xpos -920
   ypos -202
  }
  Dot {
   name Dot24
   label " "
   xpos -886
   ypos 618
  }
push $N7ff90c00
  Dot {
   name Dot21
   label " "
   xpos 1534
   ypos -318
  }
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 1e-10 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 1e-10 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 1e-10 ))"
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 log10(maxPoint.x)
   expr1 log10(maxPoint.x)
   expr2 log10(maxPoint.x)
   expr3 1
   name proc_low1
   label Expression
   xpos 1500
   ypos -208
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply4
   xpos 1500
   ypos 614
  }
  Merge2 {
   inputs 4+1
   operation plus
   bbox B
   output rgb
   name Merge3
   xpos 510
   ypos 1118
  }
  Expression {
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 pow(10,r)
   expr1 pow(10,g)
   expr2 pow(10,b)
   name Expression13
   xpos 510
   ypos 1238
  }
  Copy {
   inputs 2
   from0 rgba.alpha
   to0 rgba.alpha
   name Copy1
   xpos 510
   ypos 1496
  }
  Output {
   name Output1
   xpos 510
   ypos 1814
  }
 end_group
 Expression {
  channel0 rgb
  expr0 log(r)/log(2)-log(0.18)/log(2)
  name expShift
  note_font Helvetica
  xpos -1140
  ypos -489
 }
end_group
set N7f794800 [stack 0]
Dot {
 name Dot8
 xpos 1719
 ypos 51
}
set N83b75800 [stack 0]
Colorspace {
 colorspace_out CIE-XYZ
 name Colorspace16
 label "sRGb Lin to XYZ"
 xpos 1791
 ypos 57
}
Multiply {
 value 100
 name Multiply10
 label "Mult by 100 to put in absolute nits"
 xpos 1791
 ypos 89
}
Group {
 name ZCAM8
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos 1791
 ypos 146
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set N83b74400 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set N83afec00 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $N83afec00
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set N83b24100 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $N83b24100
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set N83afd000 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set N83afcc00 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $N83afd000
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set N83a97c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set N83a97800 [stack 0]
push $N83afd000
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set N83a97400 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set N83a97000 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set N83a96c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set N83a96800 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $N83afcc00
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $N83afd000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $N83afd000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $N83afd000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  surrounds dark
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $N83b74400
push $N83afcc00
push $N83a97c00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set N83a94c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $N83a94c00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $N83afcc00
push $N83a97800
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set N83a1f400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $N83a1f400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $N83afcc00
push $N83a97400
push $N83a97c00
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set N83a1dc00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set N83a1d800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $N83a1d800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $N83a96c00
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $N83a1dc00
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $N83a96c00
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $N83a96800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $N83a1dc00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $N83a97800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $N83a97000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $N83a97c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $N83a97400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $N83afcc00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $N83b74400
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set N8394c400 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set N838cf400 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $N838cf400
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $N8394c400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $N8394c400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $N8394c400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set N838cdc00 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set N838cd000 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $N838cd000
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $N838cd000
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set N83c7bc00 [stack 0]
push $N83c7bc00
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $N8394c400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $N8394c400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $N838cdc00
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set N83c79000 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $N83c79000
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $N83c79000
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set N83ab4100 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set N83c2bc00 [stack 0]
 Dot {
  name Dot44
  label C,h
  selected true
  xpos -1673
  ypos 2768
 }
push $N83ab4100
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set N83c2b400 [stack 0]
 Dot {
  name Dot20
  label M,h
  selected true
  xpos -1737
  ypos 2767
 }
push $N83ab4100
push $N8394c400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set N83c2a800 [stack 0]
push $N8394c400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set N83c29c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set N83bff900 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $N83c2bc00
push $N83c2b400
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set N83bc7c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $N83bc7c00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $N83bff900
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set N83bc5c00 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $N83bc5c00
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set N83bfeb00 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $N83bfeb00
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $N8394c400
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $N8394c400
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $N8394c400
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $N83bff900
push $N8394c400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $N838cdc00
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $N83c2a800
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $N83c29c00
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $N83ab4100
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
Group {
 name ZCAM9
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos 1791
 ypos 198
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 direction inverse
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 inverseData1 M,h
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set N83eef000 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set N83eedc00 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $N83eedc00
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set N83edcf00 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $N83edcf00
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set N83e77c00 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set N83e77800 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $N83e77c00
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set N83e76c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set N83e76800 [stack 0]
push $N83e77c00
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set N83e76400 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set N83e76000 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set N83e75c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set N83e75800 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $N83e77800
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $N83e77c00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $N83e77c00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $N83e77c00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  surrounds dim
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $N83eef000
push $N83e77800
push $N83e76c00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set N83e07800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $N83e07800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $N83e77800
push $N83e76800
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set N83e06400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $N83e06400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $N83e77800
push $N83e76400
push $N83e76c00
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set N83e04c00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set N83e04800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $N83e04800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $N83e75c00
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $N83e04c00
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $N83e75c00
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $N83e75800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $N83e04c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $N83e76800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $N83e76000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $N83e76c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $N83e76400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $N83e77800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $N83eef000
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set N83cb3000 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set N83cb2400 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $N83cb2400
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $N83cb3000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $N83cb3000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $N83cb3000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set N83cb0c00 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set N84053c00 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $N84053c00
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $N84053c00
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set N84052c00 [stack 0]
push $N84052c00
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $N83cb3000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $N83cb3000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $N83cb0c00
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set N84003c00 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $N84003c00
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $N84003c00
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set N83dfcf00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set N84002c00 [stack 0]
 Dot {
  name Dot44
  label C,h
  selected true
  xpos -1673
  ypos 2768
 }
push $N83dfcf00
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set N84002400 [stack 0]
 Dot {
  name Dot20
  label M,h
  selected true
  xpos -1737
  ypos 2767
 }
push $N83dfcf00
push $N83cb3000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set N84001800 [stack 0]
push $N83cb3000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set N84000c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set N83dfc800 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $N84002c00
push $N84002400
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set N83fbec00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $N83fbec00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $N83dfc800
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set N83fbcc00 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $N83fbcc00
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set N84347900 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $N84347900
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $N83cb3000
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $N83cb3000
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $N83cb3000
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $N83dfc800
push $N83cb3000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $N83cb0c00
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $N84001800
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $N84000c00
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $N83dfcf00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
Multiply {
 value 0.01
 name Multiply11
 label "Mult by 100 to put in absolute nits"
 xpos 1791
 ypos 250
}
Colorspace {
 colorspace_in CIE-XYZ
 name Colorspace17
 label "XYZ to sRGB lin"
 xpos 1791
 ypos 301
}
Colorspace {
 colorspace_out sRGB
 name Colorspace15
 xpos 1791
 ypos 375
}
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.blue 0 2 white -1 -1 rgba.alpha 0 3"
 name Shuffle30
 xpos 1791
 ypos 399
}
Reformat {
 type scale
 scale 1.5
 resize none
 black_outside true
 name Reformat8
 xpos 1791
 ypos 420
}
set N842dd800 [stack 0]
push $N842dd800
Expression {
 channel0 rgba
 expr0 .1
 name Expression9
 xpos 1928
 ypos 420
}
Colorspace {
 colorspace_out sRGB
 name Colorspace19
 xpos 1928
 ypos 444
}
Merge2 {
 inputs 2
 name Merge1
 xpos 1825
 ypos 503
}
Crop {
 box {0 0 {width} {height}}
 name Crop2
 xpos 1825
 ypos 527
}
push $N83b75800
Colorspace {
 colorspace_out sRGB
 name Colorspace18
 xpos 1692
 ypos 380
}
Reformat {
 type scale
 scale 1.5
 resize none
 black_outside true
 name Reformat9
 xpos 1692
 ypos 506
}
ContactSheet {
 inputs 2
 width {{input.width*columns}}
 height {{input.height*rows}}
 rows 2
 columns 1
 name ContactSheet4
 xpos 1819
 ypos 586
}
Constant {
 inputs 0
 channels rgb
 color {100 33 0 0}
 format "1024 1024 0 0 1024 1024 1 square_1K"
 name Constant3
 xpos 1241
 ypos 954
}
Expression {
 expr0 (y/(height-1))*r
 expr2 cx*180
 name Expression8
 xpos 1241
 ypos 1065
}
Shuffle2 {
 fromInput1 {{0} B}
 out1 zcam_J
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.red 0 0 zcam_J.blue 0 2 rgba.red 0 0 zcam_J.alpha 0 3"
 name Shuffle17
 xpos 1241
 ypos 1089
}
Shuffle2 {
 fromInput1 {{0} B}
 out1 zcam_Q
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.red 0 0 zcam_Q.blue 0 2 rgba.red 0 0 zcam_Q.alpha 0 3"
 name Shuffle29
 xpos 1241
 ypos 1113
}
Shuffle2 {
 fromInput1 {{0} B}
 out1 zcam_M
 fromInput2 {{0} B}
 mappings "4 rgba.green 0 1 zcam_M.green 0 1 rgba.green 0 1 zcam_M.red 0 0 rgba.green 0 1 zcam_M.blue 0 2 rgba.green 0 1 zcam_M.alpha 0 3"
 name Shuffle25
 xpos 1241
 ypos 1135
}
Shuffle2 {
 fromInput1 {{0} B}
 out1 zcam_h
 fromInput2 {{0} B}
 mappings "4 rgba.blue 0 2 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.red 0 0 rgba.blue 0 2 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.alpha 0 3"
 name Shuffle26
 xpos 1241
 ypos 1159
}
Group {
 name ZCAM6
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos 1241
 ypos 1188
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 direction inverse
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 inverseData1 M,h
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set N82043c00 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set N82042800 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $N82042800
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set N8204a400 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $N8204a400
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set N82040c00 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set N82040800 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $N82040c00
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set N81fcf800 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set N81fcf400 [stack 0]
push $N82040c00
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set N81fcf000 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set N81fcec00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set N81fce800 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set N81fce400 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $N82040800
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $N82040c00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $N82040c00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $N82040c00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $N82043c00
push $N82040800
push $N81fcf800
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set N81fcc800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $N81fcc800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $N82040800
push $N81fcf400
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set N8243f000 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $N8243f000
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $N82040800
push $N81fcf000
push $N81fcf800
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set N8243d800 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set N8243d400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $N8243d400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $N81fce800
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $N8243d800
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $N81fce800
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $N81fce400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $N8243d800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $N81fcf400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $N81fcec00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $N81fcf800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $N81fcf000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $N82040800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $N82043c00
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set N826e3c00 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set N826e3000 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $N826e3000
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $N826e3c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $N826e3c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $N826e3c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set N826e1800 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set N826e0c00 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $N826e0c00
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $N826e0c00
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set N8269b800 [stack 0]
push $N8269b800
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $N826e3c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $N826e3c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  selected true
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $N826e1800
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set N82698c00 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $N82698c00
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $N82698c00
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set N826ee400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set N8264b800 [stack 0]
 Dot {
  name Dot44
  label C,h
  xpos -1673
  ypos 2768
 }
push $N826ee400
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set N8264b000 [stack 0]
 Dot {
  name Dot20
  label M,h
  xpos -1737
  ypos 2767
 }
push $N826ee400
push $N826e3c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set N8264a400 [stack 0]
push $N826e3c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set N82649800 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set N826edd00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $N8264b800
push $N8264b000
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set N825e7800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $N825e7800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $N826edd00
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set N825e5800 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $N825e5800
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set N826ecf00 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $N826ecf00
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $N826e3c00
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $N826e3c00
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $N826e3c00
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $N826edd00
push $N826e3c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $N826e1800
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $N8264a400
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $N82649800
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $N826ee400
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
Multiply {
 value 0.01
 name Multiply9
 label "Div by 100 to go from nits"
 xpos 1241
 ypos 1247
}
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.blue 0 2 white -1 -1 rgba.alpha 0 3"
 name Shuffle28
 xpos 1241
 ypos 1289
}
Colorspace {
 colorspace_in CIE-XYZ
 name Colorspace13
 label "XYZ to sRGB Prims"
 xpos 1241
 ypos 1313
}
set N8250ec00 [stack 0]
Shuffle2 {
 fromInput1 {{0} B}
 in1 zcam_M
 fromInput2 {{0} B}
 mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
 name Shuffle33
 xpos 1449
 ypos 1480
}
push $N83b76000
PositionToPoints2 {
 display textured
 render_mode textured
 P_channel rgb
 detail 1
 name PositionToPoints5
 xpos 1789
 ypos 1570
}
Constant {
 inputs 0
 channels rgb
 color {100 {frame/1023*100} 0 0}
 format "1024 1024 0 0 1024 1024 1 square_1K"
 name Constant6
 xpos 344
 ypos 985
}
Expression {
 expr0 (y/(height-1))*r
 expr2 cx*180
 name Expression13
 xpos 344
 ypos 1096
}
Shuffle2 {
 fromInput1 {{0} B}
 out1 zcam_J
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.red 0 0 zcam_J.blue 0 2 rgba.red 0 0 zcam_J.alpha 0 3"
 name Shuffle42
 xpos 344
 ypos 1120
}
Shuffle2 {
 fromInput1 {{0} B}
 out1 zcam_Q
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.red 0 0 zcam_Q.blue 0 2 rgba.red 0 0 zcam_Q.alpha 0 3"
 name Shuffle43
 xpos 344
 ypos 1144
}
Shuffle2 {
 fromInput1 {{0} B}
 out1 zcam_M
 fromInput2 {{0} B}
 mappings "4 rgba.green 0 1 zcam_M.green 0 1 rgba.green 0 1 zcam_M.red 0 0 rgba.green 0 1 zcam_M.blue 0 2 rgba.green 0 1 zcam_M.alpha 0 3"
 name Shuffle44
 xpos 344
 ypos 1166
}
Shuffle2 {
 fromInput1 {{0} B}
 out1 zcam_h
 fromInput2 {{0} B}
 mappings "4 rgba.blue 0 2 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.red 0 0 rgba.blue 0 2 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.alpha 0 3"
 name Shuffle45
 xpos 344
 ypos 1190
}
Group {
 name ZCAM14
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos 344
 ypos 1242
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 direction inverse
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 inverseData1 M,h
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set N84264400 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set N841f2c00 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $N841f2c00
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set N84210f00 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $N84210f00
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set N841f1000 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set N841f0c00 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $N841f1000
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set N84183c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set N84183800 [stack 0]
push $N841f1000
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set N84183400 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set N84183000 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set N84182c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set N84182800 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $N841f0c00
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $N841f1000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $N841f1000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $N841f1000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $N84264400
push $N841f0c00
push $N84183c00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set N84180c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $N84180c00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $N841f0c00
push $N84183800
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set N8411f400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $N8411f400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $N841f0c00
push $N84183400
push $N84183c00
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set N8411dc00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set N8411d800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $N8411d800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $N84182c00
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $N8411dc00
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $N84182c00
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $N84182800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $N8411dc00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $N84183800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $N84183000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $N84183c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $N84183400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $N841f0c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $N84264400
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set N84444400 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set N843c3400 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $N843c3400
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $N84444400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $N84444400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $N84444400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set N843c1c00 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set N843c1000 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $N843c1000
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $N843c1000
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set N84773c00 [stack 0]
push $N84773c00
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $N84444400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $N84444400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  selected true
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $N843c1c00
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set N84771000 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $N84771000
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $N84771000
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set N84134f00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set N8472fc00 [stack 0]
 Dot {
  name Dot44
  label C,h
  xpos -1673
  ypos 2768
 }
push $N84134f00
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set N8472f400 [stack 0]
 Dot {
  name Dot20
  label M,h
  xpos -1737
  ypos 2767
 }
push $N84134f00
push $N84444400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set N8472e800 [stack 0]
push $N84444400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set N8472dc00 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set N84134800 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $N8472fc00
push $N8472f400
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set N846c7c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $N846c7c00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $N84134800
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set N846c5c00 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $N846c5c00
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set N84673900 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $N84673900
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $N84444400
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $N84444400
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $N84444400
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $N84134800
push $N84444400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $N843c1c00
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $N8472e800
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $N8472dc00
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $N84134f00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
Multiply {
 value 0.01
 name Multiply17
 label "Div by 100 to go from nits"
 xpos 344
 ypos 1324
}
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.blue 0 2 white -1 -1 rgba.alpha 0 3"
 name Shuffle46
 xpos 344
 ypos 1366
}
Colorspace {
 colorspace_in CIE-XYZ
 name Colorspace28
 label "XYZ to sRGB Prims"
 xpos 344
 ypos 1390
}
Dot {
 name Dot9
 xpos 378
 ypos 1439
}
set N845eec00 [stack 0]
Dot {
 name Dot11
 xpos 505
 ypos 1465
}
set N845ee800 [stack 0]
Expression {
 channel0 rgba
 expr0 min((r<0?0:1),(g<0?0:1),(b<0?0:1))
 name Expression10
 xpos 428
 ypos 1490
}
push $N845ee800
Expression {
 channel0 rgba
 expr0 min((r>1?0:1),(g>1?0:1),(b>1?0:1))
 name Expression12
 xpos 533
 ypos 1488
}
Merge2 {
 inputs 2
 operation multiply
 name Multiply16
 xpos 470
 ypos 1520
}
push $N845eec00
Copy {
 inputs 2
 from0 rgba.alpha
 to0 rgba.alpha
 name Copy8
 xpos 344
 ypos 1576
}
Premult {
 name Premult1
 xpos 344
 ypos 1603
}
Dot {
 name Dot10
 xpos 378
 ypos 1715
}
set N8456b800 [stack 0]
Group {
 name FrameBlendMerge
 help http://richardfrazer.com/tools-tutorials/frameblendmerge/
 knobChanged "\nn = nuke.thisNode()\nk = nuke.thisKnob()\n#print n\['customframerange'].getValue()\nif k.name()==\"customframerange\":\n    n\['framerangestart'].setEnabled((n\['customframerange'].getValue())!=0)\n    n\['framerangeend'].setEnabled(n\['customframerange'].getValue()!=0)\n    n\['numberframes'].setEnabled((1-n\['customframerange'].getValue())!=0)\nif k.name()==\"invertalpha\":\n    n\['defaultinvert'].setValue((n\['invertalpha'].getValue())!=0)\nif k.name()==\"method\":\n    n\['vectordetail'].setVisible((n\['method'].getValue())!=0)\n    n\['smooth'].setVisible(n\['method'].getValue()!=0)\n    if n\['method'].getValue()==0:\n        n\['invertalpha'].setValue(n\['defaultinvert'].getValue())\n    if n\['method'].getValue()==1:\n        n\['invertalpha'].setValue(0)\n"
 xpos 344
 ypos 2007
 disable true
 addUserKnob {20 User}
 addUserKnob {4 operation M {atop average color-burn color-dodge conjoint-over copy difference disjoint-over divide exclusion from geometric hard-light hypot in mask matte max min minus multiply out over overlay plus screen soft-light stencil under xor}}
 operation over
 addUserKnob {26 ""}
 addUserKnob {26 text2 l "" +STARTLINE T "Frame blend\n"}
 addUserKnob {3 framerangestart l "Frame Range"}
 addUserKnob {3 framerangeend l "" -STARTLINE}
 framerangeend 750
 addUserKnob {22 InputRange l "Input Range" -STARTLINE T "n = nuke.thisNode()\nf = n.firstFrame()\nl = n.lastFrame() \n\nn\['framerangestart'].setValue(f)\nn\['framerangeend'].setValue(l)"}
 addUserKnob {26 ""}
 addUserKnob {22 update l Update T "t = nuke.thisNode()\n\n\ntname = t.name()\n\n\n#print ('tname: ' + tname)\n\n\n\nnuke.thisNode().begin()\n\n\nframestart = int(t\['framerangestart'].value())\nframeend = int(t\['framerangeend'].value())\n\n\np = -1000\n\n\nfor d in nuke.allNodes():\n    if (d.Class() == 'FrameHold') or (d.Class() == 'Merge2'):\n         nuke.delete(d) \n    #else:\n    #     print (\"Ignore this\" + d.Class() )\n\n\n\nfor x in range(framestart, frameend):\n    nname = 'FrameHoldMerge' +str(x)\n    if(nuke.exists( nname )):\n        #print (nname + \" exists\")\n        k = nuke.toNode ( nname ) \n        nuke.delete ( k )\n    n = nuke.createNode( 'FrameHold' )              \n    n\['name'].setValue( nname )\n    n\['first_frame'].setValue( x )\n    n.setXYpos( p, 600 )\n    n.setInput(0, nuke.toNode( 'inputDot' ))\n    p = p + 100\n\n\nnewMerge = nuke.createNode('Merge2')\nnewMerge\['name'].setValue( 'MergeFrames' )\nnewMerge.setXYpos( -900, 700 )  \n\n\ni = 0\n\n\nfor x in range(framestart, frameend):\n    nname = 'FrameHoldMerge' +str(x)\n    n = nuke.toNode( nname )\n    if(i==2):\n        i=i+1\n    #print(\"connecting input \" + str(i))\n    newMerge.setInput(i, nuke.toNode( nname ))\n    i=i+1\n\n\nnewMerge.setInput(2, nuke.toNode( \"mask_dot\" ))\n\n\ntoperation = t\['operation'].value()\nnewMerge\['operation'].setValue( toperation )\n\n\no = nuke.toNode( 'OutputBlend' )\no.setInput(0, newMerge)\n\n\nnewMerge.hideControlPanel()\n\n\nnuke.thisNode().end()\n\n\nt = nuke.toNode( tname )\n\n\n#print ('t: ' +  t.name() )\n\n\nnuke.show(t)\n\n" +STARTLINE}
 addUserKnob {20 About}
 addUserKnob {26 textabout l "" +STARTLINE T "FrameBlendMerge v1.4 by Richard Frazer\nwww.richardfrazer.com/tools-tutorials/frameblendmerge/\n"}
}
 Input {
  inputs 0
  name Input
  xpos -905
  ypos 395
 }
 Dot {
  name inputDot
  xpos -871
  ypos 495
 }
set N8456a800 [stack 0]
 FrameHold {
  firstFrame 99
  name FrameHoldMerge99
  xpos 8800
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 98
  name FrameHoldMerge98
  xpos 8700
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 97
  name FrameHoldMerge97
  xpos 8600
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 96
  name FrameHoldMerge96
  xpos 8500
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 95
  name FrameHoldMerge95
  xpos 8400
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 94
  name FrameHoldMerge94
  xpos 8300
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 93
  name FrameHoldMerge93
  xpos 8200
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 92
  name FrameHoldMerge92
  xpos 8100
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 91
  name FrameHoldMerge91
  xpos 8000
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 90
  name FrameHoldMerge90
  xpos 7900
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 89
  name FrameHoldMerge89
  xpos 7800
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 88
  name FrameHoldMerge88
  xpos 7700
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 87
  name FrameHoldMerge87
  xpos 7600
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 86
  name FrameHoldMerge86
  xpos 7500
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 85
  name FrameHoldMerge85
  xpos 7400
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 84
  name FrameHoldMerge84
  xpos 7300
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 83
  name FrameHoldMerge83
  xpos 7200
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 82
  name FrameHoldMerge82
  xpos 7100
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 81
  name FrameHoldMerge81
  xpos 7000
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 80
  name FrameHoldMerge80
  xpos 6900
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 79
  name FrameHoldMerge79
  xpos 6800
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 78
  name FrameHoldMerge78
  xpos 6700
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 77
  name FrameHoldMerge77
  xpos 6600
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 76
  name FrameHoldMerge76
  xpos 6500
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 75
  name FrameHoldMerge75
  xpos 6400
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 74
  name FrameHoldMerge74
  xpos 6300
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 73
  name FrameHoldMerge73
  xpos 6200
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 72
  name FrameHoldMerge72
  xpos 6100
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 71
  name FrameHoldMerge71
  xpos 6000
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 70
  name FrameHoldMerge70
  xpos 5900
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 69
  name FrameHoldMerge69
  xpos 5800
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 68
  name FrameHoldMerge68
  xpos 5700
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 67
  name FrameHoldMerge67
  xpos 5600
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 66
  name FrameHoldMerge66
  xpos 5500
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 65
  name FrameHoldMerge65
  xpos 5400
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 64
  name FrameHoldMerge64
  xpos 5300
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 63
  name FrameHoldMerge63
  xpos 5200
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 62
  name FrameHoldMerge62
  xpos 5100
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 61
  name FrameHoldMerge61
  xpos 5000
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 60
  name FrameHoldMerge60
  xpos 4900
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 59
  name FrameHoldMerge59
  xpos 4800
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 58
  name FrameHoldMerge58
  xpos 4700
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 57
  name FrameHoldMerge57
  xpos 4600
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 56
  name FrameHoldMerge56
  xpos 4500
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 55
  name FrameHoldMerge55
  xpos 4400
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 54
  name FrameHoldMerge54
  xpos 4300
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 53
  name FrameHoldMerge53
  xpos 4200
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 52
  name FrameHoldMerge52
  xpos 4100
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 51
  name FrameHoldMerge51
  xpos 4000
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 50
  name FrameHoldMerge50
  xpos 3900
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 49
  name FrameHoldMerge49
  xpos 3800
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 48
  name FrameHoldMerge48
  xpos 3700
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 47
  name FrameHoldMerge47
  xpos 3600
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 46
  name FrameHoldMerge46
  xpos 3500
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 45
  name FrameHoldMerge45
  xpos 3400
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 44
  name FrameHoldMerge44
  xpos 3300
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 43
  name FrameHoldMerge43
  xpos 3200
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 42
  name FrameHoldMerge42
  xpos 3100
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 41
  name FrameHoldMerge41
  xpos 3000
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 40
  name FrameHoldMerge40
  xpos 2900
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 39
  name FrameHoldMerge39
  xpos 2800
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 38
  name FrameHoldMerge38
  xpos 2700
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 37
  name FrameHoldMerge37
  xpos 2600
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 36
  name FrameHoldMerge36
  xpos 2500
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 35
  name FrameHoldMerge35
  xpos 2400
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 34
  name FrameHoldMerge34
  xpos 2300
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 33
  name FrameHoldMerge33
  xpos 2200
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 32
  name FrameHoldMerge32
  xpos 2100
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 31
  name FrameHoldMerge31
  xpos 2000
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 30
  name FrameHoldMerge30
  xpos 1900
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 29
  name FrameHoldMerge29
  xpos 1800
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 28
  name FrameHoldMerge28
  xpos 1700
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 27
  name FrameHoldMerge27
  xpos 1600
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 26
  name FrameHoldMerge26
  xpos 1500
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 25
  name FrameHoldMerge25
  xpos 1400
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 24
  name FrameHoldMerge24
  xpos 1300
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 23
  name FrameHoldMerge23
  xpos 1200
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 22
  name FrameHoldMerge22
  xpos 1100
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 21
  name FrameHoldMerge21
  xpos 1000
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 20
  name FrameHoldMerge20
  xpos 900
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 19
  name FrameHoldMerge19
  xpos 800
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 18
  name FrameHoldMerge18
  xpos 700
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 17
  name FrameHoldMerge17
  xpos 600
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 16
  name FrameHoldMerge16
  xpos 500
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 15
  name FrameHoldMerge15
  xpos 400
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 14
  name FrameHoldMerge14
  xpos 300
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 13
  name FrameHoldMerge13
  xpos 200
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 12
  name FrameHoldMerge12
  xpos 100
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 11
  name FrameHoldMerge11
  xpos 0
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 10
  name FrameHoldMerge10
  xpos -100
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 9
  name FrameHoldMerge9
  xpos -200
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 8
  name FrameHoldMerge8
  xpos -300
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 7
  name FrameHoldMerge7
  xpos -400
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 6
  name FrameHoldMerge6
  xpos -500
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 5
  name FrameHoldMerge5
  xpos -600
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 4
  name FrameHoldMerge4
  xpos -700
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 3
  name FrameHoldMerge3
  xpos -800
  ypos 600
 }
 Input {
  inputs 0
  name Mask
  xpos -1349
  ypos 579
  number 1
 }
push $N8456a800
 Dot {
  name Dot2
  xpos -1202
  ypos 572
 }
 Remove {
  name Remove1
  xpos -1236
  ypos 604
 }
 Shuffle {
  red black
  green black
  blue black
  alpha white
  name Shuffle1
  xpos -1236
  ypos 638
 }
 Switch {
  inputs 2
  which {{"\[exists parent.input1]" i}}
  name Switch3
  xpos -1349
  ypos 647
 }
 Dot {
  name mask_dot
  xpos -1315
  ypos 703
 }
set N84569400 [stack 0]
push $N8456a800
 FrameHold {
  firstFrame 2
  name FrameHoldMerge2
  xpos -900
  ypos 600
 }
push $N8456a800
 FrameHold {
  firstFrame 1
  name FrameHoldMerge1
  xpos -1000
  ypos 600
 }
 Merge2 {
  inputs 99+1
  name MergeFrames
  selected true
  xpos -900
  ypos 700
 }
 Output {
  name OutputBlend
  xpos -900
  ypos 817
 }
push $N84569400
 Viewer {
  input_process false
  name Viewer1
  xpos -1341
  ypos 942
 }
end_group
push $N314eec00
EXPTool {
 mode Stops
 name Exposure2
 xpos 1061
 ypos 942
 disable true
}
Reformat {
 format "1024 1024 0 0 1024 1024 1 square_1K"
 black_outside true
 name Reformat11
 xpos 1061
 ypos 981
 disable true
}
Colorspace {
 primary_in ACES
 colorspace_out CIE-XYZ
 name Colorspace30
 label "ACES to XYZ"
 xpos 1060
 ypos 1024
}
Multiply {
 value 100
 name Multiply19
 label "Mult by 100 to put in absolute nits"
 xpos 1060
 ypos 1056
}
set Na3f21c00 [stack 0]
Group {
 name ZCAM10
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos 1251
 ypos 1608
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 inverseData1 M,h
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set N82473800 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set N82472400 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $N82472400
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set N82486b00 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $N82486b00
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set N82470800 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set N82470400 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $N82470800
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set N8281b400 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set N8281b000 [stack 0]
push $N82470800
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set N8281ac00 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set N8281a800 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set N8281a400 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set N8281a000 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $N82470400
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $N82470800
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $N82470800
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $N82470800
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $N82473800
push $N82470400
push $N8281b400
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set N82818400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $N82818400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $N82470400
push $N8281b000
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set N827bec00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $N827bec00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $N82470400
push $N8281ac00
push $N8281b400
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set N827bd400 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set N827bd000 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $N827bd000
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $N8281a400
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $N827bd400
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $N8281a400
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $N8281a000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $N827bd400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $N8281b000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $N8281a800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $N8281b400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $N8281ac00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $N82470400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $N82473800
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set N82a53800 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set N82a52c00 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $N82a52c00
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $N82a53800
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $N82a53800
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $N82a53800
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set N82a51400 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set N82a50800 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $N82a50800
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $N82a50800
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set N82a0f400 [stack 0]
push $N82a0f400
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $N82a53800
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $N82a53800
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  selected true
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $N82a51400
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set N82a0c800 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $N82a0c800
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $N82a0c800
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set N82a22b00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set N829bf400 [stack 0]
 Dot {
  name Dot44
  label C,h
  xpos -1673
  ypos 2768
 }
push $N82a22b00
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set N829bec00 [stack 0]
 Dot {
  name Dot20
  label M,h
  xpos -1737
  ypos 2767
 }
push $N82a22b00
push $N82a53800
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set N829be000 [stack 0]
push $N82a53800
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set N829bd400 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set N82a22400 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $N829bf400
push $N829bec00
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set N82953400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $N82953400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $N82a22400
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set N82951400 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $N82951400
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set N82a21600 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $N82a21600
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $N82a53800
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $N82a53800
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $N82a53800
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $N82a22400
push $N82a53800
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $N82a51400
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $N829be000
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $N829bd400
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $N82a22b00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
set N824a9d00 [stack 0]
Shuffle2 {
 fromInput1 {{0} B}
 in1 zcam_J
 fromInput2 {{0} B}
 mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
 name Shuffle51
 xpos 1493
 ypos 1622
}
Multiply {
 value {{1/parent.Multiply3.value}}
 name Multiply20
 label "Div by 100 to go from nits"
 xpos 1493
 ypos 1646
}
ColorLookup {
 channels all
 lut {master {curve x0.02407439426 0 x0.04948588461 5.620706361e-06 x0.0808724314 5.995634638e-05 x0.1089436561 0.0002520732232 x0.1538826674 0.0009655252215 x0.1705526412 0.001552375033 x0.1965807676 0.003411091166 x0.2212548852 0.005432802252 x0.2435974032 0.008078291081 x0.2744711637 0.01258628722 x0.335355252 0.02872310206 x0.3656598926 0.0391706787 x0.4067366123 0.05722413212 x0.451582104 0.08477441967 x0.5436673164 0.1626682729 x0.6915633678 0.3178558648 x0.7352961302 0.3736175299 x0.8164004087 0.4692641795 x0.8752408028 0.5275940299 x0.9309006333 0.5828329325 x0.9754681587 0.6187173724 x1.033632636 0.6637632847 x1.16960156 0.745464921 x1.235319972 0.7762671709 x1.356181145 0.8217196465 x1.508617401 0.8695153594 x1.637787938 0.8979744911 x1.822932601 0.9321763515 x1.905457973 0.9441890717 x2.068963289 0.9626951218 x2.316649675 0.9837986231 x2.455148697 0.9925647378 x2.621634722 1}
   red {}
   green {}
   blue {}
   alpha {}}
 name ColorLookup1
 xpos 1493
 ypos 1688
}
Gamma {
 value 2.2
 name Gamma2
 xpos 1493
 ypos 1720
}
Multiply {
 value {{parent.Multiply3.value}}
 name Multiply21
 label "Mult by 100 to put in absolute nits"
 xpos 1493
 ypos 1752
}
Shuffle2 {
 fromInput1 {{0} B}
 out1 zcam_J
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
 name Shuffle52
 xpos 1493
 ypos 1794
}
push $N824a9d00
Copy {
 inputs 2
 from0 -rgba.alpha
 to0 -rgba.alpha
 channels zcam_J
 name Copy10
 xpos 1247
 ypos 1785
}
Dot {
 name Dot13
 xpos 1281
 ypos 1882
}
set Ne95ea000 [stack 0]
Shuffle2 {
 fromInput1 {{0} B}
 in1 zcam_M
 fromInput2 {{0} B}
 mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
 name Shuffle38
 xpos 1081
 ypos 1631
}
push $Ne95ea000
Shuffle2 {
 fromInput1 {{0} B}
 in1 zcam_J
 fromInput2 {{0} B}
 mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
 name Shuffle37
 xpos 886
 ypos 1589
}
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 in2 zcam_M
 mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.blue 0 2 rgba.blue 0 2 rgba.alpha 0 3 rgba.alpha 0 3 zcam_M.green 1 1 rgba.green 0 1"
 name Shuffle48
 xpos 886
 ypos 1613
}
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 in2 zcam_h
 mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.alpha 0 3 rgba.alpha 0 3 zcam_h.blue 1 2 rgba.blue 0 2"
 name Shuffle49
 xpos 886
 ypos 1637
}
set Na3f23400 [stack 0]
Copy {
 inputs 2
 from0 rgba.green
 to0 rgba.green
 name Copy6
 xpos 1010
 ypos 1660
}
Expression {
 temp_name0 limit
 temp_expr0 g*limitScale
 temp_name1 scaledVal
 temp_expr1 b/limit
 temp_name2 scale
 temp_expr2 1-thr
 expr2 "(scaledVal>thr? ( ((scaledVal-thr)/scale) / (((scaledVal-thr)/scale)+1) * scale + thr  )   : scaledVal ) * limit"
 channel3 alpha
 expr3 limit
 name clipToLimit1
 xpos 1010
 ypos 1692
 addUserKnob {20 User}
 addUserKnob {7 limitScale R 0 100}
 limitScale 100
 addUserKnob {7 thr}
 thr 1
}
Read {
 inputs 0
 file_type exr
 file /Users/afry/GitHub/nukeZCAM/images/gamutBounds/sRGBgamutBound_tempImg.exr
 origset true
 version 23
 name Read69
 xpos 530
 ypos 1952
}
set N84ae7400 [stack 0]
Colorspace {
 colorspace_out CIE-XYZ
 name Colorspace29
 xpos 701
 ypos 2036
}
Multiply {
 value 100
 name Multiply18
 label "Mult by 100 to put in absolute nits"
 xpos 701
 ypos 2060
}
Group {
 name ZCAM15
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos 701
 ypos 2102
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 inverseData1 M,h
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set N84a66400 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set N84a65000 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $N84a65000
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set N922e6b00 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $N922e6b00
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set N922a3000 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set N922a2c00 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $N922a3000
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set N922a2000 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set N922a1c00 [stack 0]
push $N922a3000
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set N922a1800 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set N922a1400 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set N922a1000 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set N922a0c00 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $N922a2c00
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $N922a3000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $N922a3000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $N922a3000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $N84a66400
push $N922a2c00
push $N922a2000
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set N92a02c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $N92a02c00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $N922a2c00
push $N922a1c00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set N92a01800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $N92a01800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $N922a2c00
push $N922a1800
push $N922a2000
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set N9299bc00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set N9299b800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $N9299b800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $N922a1000
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $N9299bc00
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $N922a1000
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $N922a0c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $N9299bc00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $N922a1c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $N922a1400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $N922a2000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $N922a1800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $N922a2c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $N84a66400
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set N928d6400 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set N928d5800 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $N928d5800
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $N928d6400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $N928d6400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $N928d6400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set N92863c00 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set N92863000 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $N92863000
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $N92863000
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set N92862000 [stack 0]
push $N92862000
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $N928d6400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $N928d6400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  selected true
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $N92863c00
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set N92813000 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $N92813000
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $N92813000
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set N9286ab00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set N92812000 [stack 0]
 Dot {
  name Dot44
  label C,h
  xpos -1673
  ypos 2768
 }
push $N9286ab00
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set N92811800 [stack 0]
 Dot {
  name Dot20
  label M,h
  xpos -1737
  ypos 2767
 }
push $N9286ab00
push $N928d6400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set N92810c00 [stack 0]
push $N928d6400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set N927cbc00 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set N9286a400 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $N92812000
push $N92811800
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set N927ca000 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $N927ca000
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $N9286a400
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set N9274bc00 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $N9274bc00
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set N92869600 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $N92869600
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $N928d6400
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $N928d6400
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $N928d6400
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $N9286a400
push $N928d6400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $N92863c00
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $N92810c00
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $N927cbc00
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $N9286ab00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
Shuffle2 {
 fromInput1 {{0} B}
 in1 zcam_M
 fromInput2 {{0} B}
 mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
 name limitSampleNode
 xpos 701
 ypos 2161
}
set N926f1c00 [stack 0]
push $Na3f23400
Transform {
 rotate 20
 center {1024 778}
 name Transform1
 xpos 886
 ypos 1685
 disable true
}
Copy {
 inputs 2
 from0 rgba.red
 to0 rgba.alpha
 name Copy9
 xpos 886
 ypos 1804
}
set N926f0800 [stack 0]
Expression {
 temp_name0 limit
 temp_expr0 a(((b/360+.5)*width),(r/100*height))
 expr1 g>limit?limit:g
 name Expression14
 xpos 1040
 ypos 1778
}
push $N926f0800
Expression {
 temp_name0 limit
 temp_expr0 a(((b/360+.5)*width),(r/100*height))
 temp_name1 scaledVal
 temp_expr1 g/limit
 temp_name2 scale
 temp_expr2 1-thr
 expr2 "(scaledVal>thr? ( ((scaledVal-thr)/scale) / (((scaledVal-thr)/scale)+1) * scale + thr  )   : scaledVal ) * limit"
 channel3 alpha
 expr3 limit
 name clipToLimit3
 xpos 889
 ypos 1915
 addUserKnob {20 User}
 addUserKnob {7 limitScale R 0 100}
 limitScale 100
 addUserKnob {7 thr}
 thr 0.9
}
push $N7f794800
Expression {
 expr0 "y==floor(r(x, pos.y)*height*mult)?1:0"
 expr1 "y==floor(g(x, pos.y)*height*mult)?1:0"
 expr2 "y==floor(b(x, pos.y)*height*mult)?1:0"
 channel3 alpha
 name PlotScanline2
 xpos 1274
 ypos 668
 addUserKnob {20 User}
 addUserKnob {12 pos}
 addUserKnob {7 mult R 0 5}
 mult 1
}
push $N80e6e000
Expression {
 expr0 "y==floor(r(x, pos.y)*height*mult)?1:0"
 expr1 "y==floor(g(x, pos.y)*height*mult)?1:0"
 expr2 "y==floor(b(x, pos.y)*height*mult)?1:0"
 channel3 alpha
 name PlotScanline3
 xpos 1134
 ypos 671
 addUserKnob {20 User}
 addUserKnob {12 pos}
 addUserKnob {7 mult R 0 5}
 mult 1
}
Copy {
 inputs 2
 from0 rgba.red
 to0 rgba.red
 name Copy2
 xpos 1206
 ypos 710
}
Rectangle {
 area {{width/2-1} 0 {width/2+1} {height}}
 color 0.05
 name Rectangle1
 xpos 1206
 ypos 742
}
push $N7f794800
Gamma {
 value 3.4
 name Gamma4
 xpos 1881
 ypos 2077
 disable true
}
Expression {
 expr0 "y==floor(r(x, pos.y)*height*mult)?1:0"
 expr1 "y==floor(g(x, pos.y)*height*mult)?1:0"
 expr2 "y==floor(b(x, pos.y)*height*mult)?1:0"
 channel3 alpha
 name PlotScanline4
 xpos 1894
 ypos 2175
 addUserKnob {20 User}
 addUserKnob {12 pos}
 addUserKnob {7 mult R 0 5}
 mult 1
}
set Ne96b3c00 [stack 0]
push $N926f0800
Expression {
 temp_name0 limit
 temp_expr0 a(((b/360+.5)*1023),(r/100*1023))
 temp_name1 scaledVal
 temp_expr1 g/limit
 temp_name2 scale
 temp_expr2 1-thr
 expr2 "(scaledVal>thr? ( ((scaledVal-thr)/scale) / (((scaledVal-thr)/scale)+1) * scale + thr  )   : scaledVal ) * limit"
 channel3 alpha
 expr3 limit
 name clipToLimit2
 xpos 969
 ypos 1865
 addUserKnob {20 User}
 addUserKnob {7 limitScale R 0 100}
 limitScale 100
 addUserKnob {7 thr}
 thr 0.765
}
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.alpha 0 3"
 name Shuffle50
 xpos 969
 ypos 1894
}
Shuffle2 {
 fromInput1 {{0} B}
 out1 zcam_M
 fromInput2 {{0} B}
 mappings "4 rgba.green 0 1 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.green 0 1 zcam_M.alpha 0 3"
 name Shuffle39
 xpos 1098
 ypos 1945
}
push $Ne95ea000
Copy {
 inputs 2
 from0 -rgba.alpha
 to0 -rgba.alpha
 channels zcam_M
 name Copy7
 xpos 1259
 ypos 1991
}
Group {
 name ZCAM11
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos 1259
 ypos 2058
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 direction inverse
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 inverseData1 M,h
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set N82884800 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set N82c07000 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $N82c07000
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set N82bcf900 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $N82bcf900
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set N82c05400 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set N82c05000 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $N82c05400
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set N82c04400 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set N82b97c00 [stack 0]
push $N82c05400
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set N82b97800 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set N82b97400 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set N82b97000 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set N82b96c00 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $N82c05000
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $N82c05400
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $N82c05400
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $N82c05400
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $N82884800
push $N82c05000
push $N82c04400
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set N82b95000 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $N82b95000
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $N82c05000
push $N82b97c00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set N82f27800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $N82f27800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $N82c05000
push $N82b97800
push $N82c04400
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set N82f26000 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set N82f25c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $N82f25c00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $N82b97000
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $N82f26000
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $N82b97000
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $N82b96c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $N82f26000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $N82b97c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $N82b97400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $N82c04400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $N82b97800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $N82c05000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $N82884800
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set N82e48800 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set N82dd7800 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $N82dd7800
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $N82e48800
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $N82e48800
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $N82e48800
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set N82dd6000 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set N82dd5400 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $N82dd5400
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $N82dd5400
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set N82dd4400 [stack 0]
push $N82dd4400
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $N82e48800
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $N82e48800
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  selected true
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $N82dd6000
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set N82d89400 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $N82d89400
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $N82d89400
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set N82d47900 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set N82d88400 [stack 0]
 Dot {
  name Dot44
  label C,h
  xpos -1673
  ypos 2768
 }
push $N82d47900
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set N82d33800 [stack 0]
 Dot {
  name Dot20
  label M,h
  xpos -1737
  ypos 2767
 }
push $N82d47900
push $N82e48800
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set N82d32c00 [stack 0]
push $N82e48800
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set N82d32000 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set N82d47200 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $N82d88400
push $N82d33800
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set N82d30400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $N82d30400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $N82d47200
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set N82cc2000 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $N82cc2000
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set N82d46400 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $N82d46400
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $N82e48800
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $N82e48800
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $N82e48800
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $N82d47200
push $N82e48800
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $N82dd6000
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $N82d32c00
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $N82d32000
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $N82d47900
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
Multiply {
 value 0.01
 name Multiply13
 label "Div by 100 to go from nits"
 xpos 1259
 ypos 2110
}
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.blue 0 2 white -1 -1 rgba.alpha 0 3"
 name Shuffle36
 xpos 1259
 ypos 2152
}
Colorspace {
 colorspace_in CIE-XYZ
 name Colorspace25
 label "XYZ to sRGB Prims"
 xpos 1259
 ypos 2176
}
set N82ff7400 [stack 0]
Gamma {
 value 3.4
 name Gamma3
 xpos 1643
 ypos 2161
 disable true
}
Expression {
 expr0 "y==floor(r(x, pos.y)*height*mult)?1:0"
 expr1 "y==floor(g(x, pos.y)*height*mult)?1:0"
 expr2 "y==floor(b(x, pos.y)*height*mult)?1:0"
 channel3 alpha
 name PlotScanline5
 xpos 1747
 ypos 2186
 addUserKnob {20 User}
 addUserKnob {12 pos}
 pos {0 970}
 addUserKnob {7 mult R 0 5}
 mult 1
}
Copy {
 inputs 2
 from0 rgba.red
 to0 rgba.red
 name Copy4
 xpos 1830
 ypos 2219
}
Rectangle {
 area {{width/2-1} 0 {width/2+1} {height}}
 color 0.05
 name Rectangle2
 xpos 1825
 ypos 2250
}
TimeOffset {
 inputs 0
 time ""
 name TimeOffset1
 xpos -436
 ypos 1600
}
Constant {
 inputs 0
 channels rgb
 color {100 {frame/20*100} 0 0}
 format "1024 1024 0 0 1024 1024 1 square_1K"
 name Constant7
 xpos -26
 ypos 992
}
Expression {
 expr0 (y/(height-1))*r
 expr2 cx*180
 name Expression15
 xpos -26
 ypos 1103
}
Shuffle2 {
 fromInput1 {{0} B}
 out1 zcam_J
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.red 0 0 zcam_J.blue 0 2 rgba.red 0 0 zcam_J.alpha 0 3"
 name Shuffle31
 xpos -26
 ypos 1127
}
Shuffle2 {
 fromInput1 {{0} B}
 out1 zcam_Q
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.red 0 0 zcam_Q.blue 0 2 rgba.red 0 0 zcam_Q.alpha 0 3"
 name Shuffle32
 xpos -26
 ypos 1151
}
Shuffle2 {
 fromInput1 {{0} B}
 out1 zcam_M
 fromInput2 {{0} B}
 mappings "4 rgba.green 0 1 zcam_M.green 0 1 rgba.green 0 1 zcam_M.red 0 0 rgba.green 0 1 zcam_M.blue 0 2 rgba.green 0 1 zcam_M.alpha 0 3"
 name Shuffle47
 xpos -26
 ypos 1173
}
Shuffle2 {
 fromInput1 {{0} B}
 out1 zcam_h
 fromInput2 {{0} B}
 mappings "4 rgba.blue 0 2 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.red 0 0 rgba.blue 0 2 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.alpha 0 3"
 name Shuffle53
 xpos -26
 ypos 1197
}
Group {
 name ZCAM18
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos -26
 ypos 1249
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 direction inverse
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 inverseData1 M,h
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set N8daa8400 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set Naae9ec00 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $Naae9ec00
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set N4036b200 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $N4036b200
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set Naae9d000 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set Naae9cc00 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $Naae9d000
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set Ne3757c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set Ne3757800 [stack 0]
push $Naae9d000
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set Ne3757400 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set Ne3757000 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set Ne3756c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set Ne3756800 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $Naae9cc00
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $Naae9d000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $Naae9d000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $Naae9d000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $N8daa8400
push $Naae9cc00
push $Ne3757c00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set Ne3754c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $Ne3754c00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $Naae9cc00
push $Ne3757800
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set Nbea9f400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $Nbea9f400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $Naae9cc00
push $Ne3757400
push $Ne3757c00
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set Nbea9dc00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set Nbea9d800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $Nbea9d800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $Ne3756c00
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $Nbea9dc00
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $Ne3756c00
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $Ne3756800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $Nbea9dc00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $Ne3757800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $Ne3757000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $Ne3757c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $Ne3757400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $Naae9cc00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $N8daa8400
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set N50738400 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set Ncb1af400 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $Ncb1af400
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $N50738400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $N50738400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $N50738400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set Ncb1adc00 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set Ncb1ad000 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $Ncb1ad000
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $Ncb1ad000
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set Ndf403c00 [stack 0]
push $Ndf403c00
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $N50738400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $N50738400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  selected true
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $Ncb1adc00
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set Ndf401000 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $Ndf401000
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $Ndf401000
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set N6a527200 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set Nb0983c00 [stack 0]
 Dot {
  name Dot44
  label C,h
  xpos -1673
  ypos 2768
 }
push $N6a527200
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set Nb0983400 [stack 0]
 Dot {
  name Dot20
  label M,h
  xpos -1737
  ypos 2767
 }
push $N6a527200
push $N50738400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set Nb0982800 [stack 0]
push $N50738400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set Nb0981c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set N6a526b00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $Nb0983c00
push $Nb0983400
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set Nef78fc00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $Nef78fc00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $N6a526b00
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set Nef78dc00 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $Nef78dc00
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set N6a525d00 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $N6a525d00
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $N50738400
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $N50738400
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $N50738400
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $N6a526b00
push $N50738400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $Ncb1adc00
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $Nb0982800
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $Nb0981c00
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $N6a527200
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
Multiply {
 value 0.01
 name Multiply23
 label "Div by 100 to go from nits"
 xpos -26
 ypos 1331
}
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.blue 0 2 white -1 -1 rgba.alpha 0 3"
 name Shuffle54
 xpos -26
 ypos 1373
}
Colorspace {
 colorspace_in CIE-XYZ
 name Colorspace21
 label "XYZ to sRGB Prims"
 xpos -26
 ypos 1397
}
Dot {
 name Dot16
 xpos 8
 ypos 1446
}
set N7b6cac00 [stack 0]
Dot {
 name Dot17
 xpos 135
 ypos 1472
}
set N7b6ca800 [stack 0]
Expression {
 channel0 rgba
 expr0 min((r<0?0:1),(g<0?0:1),(b<0?0:1))
 name Expression16
 xpos 58
 ypos 1497
}
push $N7b6ca800
Expression {
 channel0 rgba
 expr0 min((r>1?0:1),(g>1?0:1),(b>1?0:1))
 name Expression17
 xpos 163
 ypos 1495
}
Merge2 {
 inputs 2
 operation multiply
 name Multiply24
 xpos 100
 ypos 1527
}
push $N7b6cac00
Copy {
 inputs 2
 from0 rgba.alpha
 to0 rgba.alpha
 name Copy5
 xpos -26
 ypos 1583
}
Premult {
 name Premult2
 xpos -26
 ypos 1615
}
Write {
 file /Users/afry/GitHub/nukeZCAM/images/gamutBounds/sRGBgamutBoundGif/sRGBgamutBoundGif_v001.%04d.png
 file_type png
 checkHashOnRead false
 version 1
 name Write5
 xpos -26
 ypos 1651
}
push $N8456b800
Read {
 inputs 0
 file_type exr
 file /Users/afry/GitHub/nukeZCAM/images/gamutBounds/sRGBgamutBound_tempImg.exr
 origset true
 version 1045
 name Read68
 xpos 492
 ypos 1683
}
set N84ae7000 [stack 0]
Merge2 {
 inputs 2
 name Merge5
 xpos 492
 ypos 1788
}
Write {
 file /Users/afry/GitHub/nukeZCAM/images/gamutBounds/sRGBgamutBound_tempImg.exr
 file_type exr
 first_part rgba
 version 1046
 in_colorspace scene_linear
 out_colorspace scene_linear
 name Write4
 xpos 492
 ypos 1829
}
push $N8250ec00
Colorspace {
 colorspace_out sRGB
 name Colorspace14
 xpos 998
 ypos 1393
 disable true
}
Clamp {
 name Clamp2
 xpos 998
 ypos 1434
 disable true
}
Write {
 file /Users/afry/GitHub/nukeZCAM/images/examples/ramp_J100_M25_v001.png
 colorspace texture_paint
 raw true
 file_type png
 checkHashOnRead false
 version 2
 in_colorspace scene_linear
 out_colorspace scene_linear
 name Write2
 xpos 998
 ypos 1503
}
push $N8250ec00
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.blue 0 2 white -1 -1 rgba.alpha 0 3"
 name Shuffle35
 xpos 1525
 ypos 2004
}
push $Na3f21c00
Group {
 name ZCAM16
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos 1060
 ypos 1190
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 inverseData1 M,h
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set Na3f20800 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set Ncbf13000 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $Ncbf13000
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set Ncbf35d00 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $Ncbf35d00
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set Ncbf11400 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set Ncbf11000 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $Ncbf11400
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set Ncbf10400 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set Ncbeb7c00 [stack 0]
push $Ncbf11400
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set Ncbeb7800 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set Ncbeb7400 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set Ncbeb7000 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set Ncbeb6c00 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $Ncbf11000
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $Ncbf11400
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $Ncbf11400
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $Ncbf11400
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $Na3f20800
push $Ncbf11000
push $Ncbf10400
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set Ncbeb5000 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $Ncbeb5000
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $Ncbf11000
push $Ncbeb7c00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set Ncbdcf800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $Ncbdcf800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $Ncbf11000
push $Ncbeb7800
push $Ncbf10400
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set Ncbdce000 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set Ncbdcdc00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $Ncbdcdc00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $Ncbeb7000
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $Ncbdce000
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $Ncbeb7000
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $Ncbeb6c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $Ncbdce000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $Ncbeb7c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $Ncbeb7400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $Ncbf10400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $Ncbeb7800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $Ncbf11000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $Na3f20800
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set Ncbcf0800 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set Ncbc87800 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $Ncbc87800
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $Ncbcf0800
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $Ncbcf0800
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $Ncbcf0800
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set Ncbc86000 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set Ncbc85400 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $Ncbc85400
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $Ncbc85400
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set Ncbc84400 [stack 0]
push $Ncbc84400
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $Ncbcf0800
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $Ncbcf0800
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  selected true
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $Ncbc86000
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set Ncbc39400 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $Ncbc39400
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $Ncbc39400
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set Ncbde1d00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set Ncbc38400 [stack 0]
 Dot {
  name Dot44
  label C,h
  xpos -1673
  ypos 2768
 }
push $Ncbde1d00
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set Ncbbef800 [stack 0]
 Dot {
  name Dot20
  label M,h
  xpos -1737
  ypos 2767
 }
push $Ncbde1d00
push $Ncbcf0800
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set Ncbbeec00 [stack 0]
push $Ncbcf0800
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set Ncbbee000 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set Ncbde1600 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $Ncbc38400
push $Ncbbef800
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set Ncbbec400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $Ncbbec400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $Ncbde1600
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set Ncbb86000 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $Ncbb86000
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set Ncbde0800 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $Ncbde0800
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $Ncbcf0800
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $Ncbcf0800
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $Ncbcf0800
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $Ncbde1600
push $Ncbcf0800
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $Ncbc86000
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $Ncbbeec00
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $Ncbbee000
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $Ncbde1d00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
push $N8250ec00
Colorspace {
 colorspace_out CIE-XYZ
 name Colorspace24
 label "XYZ to sRGB Prims"
 xpos 1241
 ypos 1508
}
Multiply {
 value 100
 name Multiply12
 label "Div by 100 to go from nits"
 xpos 1241
 ypos 1540
}
Cube {
 inputs 0
 display wireframe
 rows 1
 columns 1
 cube {0 0 0 1 1 1}
 name Cube1
 xpos 1652
 ypos 1966
}
push $N82ff7400
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.blue 0 2 white -1 -1 rgba.alpha 0 3"
 name Shuffle34
 xpos 1259
 ypos 2259
}
PositionToPoints2 {
 display textured
 render_mode textured
 P_channel rgb
 detail 1
 name PositionToPoints4
 xpos 1516
 ypos 2139
}
Scene {
 inputs 2
 name Scene1
 xpos 1600
 ypos 2084
}
push $N84ae7400
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.blue 0 2 white -1 -1 rgba.alpha 0 3"
 name Shuffle41
 xpos 530
 ypos 2032
}
PositionToPoints2 {
 display textured
 render_mode textured
 P_channel rgb
 detail 1
 name PositionToPoints6
 xpos 530
 ypos 2086
}
push $N926f1c00
Expression {
 expr0 r(x+100,y)
 name Expression11
 xpos 734
 ypos 2215
}
push $N84ae7000
Write {
 file /Users/afry/GitHub/nukeZCAM/images/gamutBounds/sRGBgamutBound_tempImg.png
 file_type png
 checkHashOnRead false
 version 1047
 name Write6
 xpos 606
 ypos 1836
}
push $N926f1c00
EXPTool {
 mode Stops
 red -6.3
 green -6.3
 blue -6.3
 name Exposure5
 xpos 615
 ypos 2207
}
Write {
 file /Users/afry/GitHub/nukeZCAM/images/gamutBounds/sRGBgamutBound_MLimitExample.png
 file_type png
 checkHashOnRead false
 version 1048
 name Write7
 xpos 615
 ypos 2231
}
push $Ne96b3c00
push $N7f794800
Crop {
 box {0 -74 {width} {height}}
 reformat true
 crop false
 name Crop5
 xpos 1639
 ypos 2323
 disable true
}
Rectangle {
 opacity 0.955
 area {782.4000244 6 1137.599976 67.80000305}
 color 0
 name Rectangle5
 xpos 1639
 ypos 2347
}
Text2 {
 font_size_toolbar 30
 font_width_toolbar 100
 font_height_toolbar 100
 message "ACES 1.2"
 old_message {{65 67 69 83 32 49 46 50}
   }
 box {0 16 1920 55}
 xjustify center
 yjustify center
 transforms {{0 2}
   }
 font_size_values {{0 30 1 30 2 30 3 30 4 30 5 30 6 30 7 30 0 99}
   }
 cursor_position 8
 font {{ Helvetica : Regular : Helvetica.ttc : 0 }}
 font_size 30
 center {960 540}
 cursor_initialised true
 autofit_bbox false
 initial_cursor_position {{717.6001587 112.7998962}
   }
 group_animations {{0} imported: 0 selected: items: "root transform/"}
 animation_layers {{1 11 960 540 0 0 1 1 0 0 0 0}
   }
 name Text3
 xpos 1634
 ypos 2375
}
push $N314eec00
Group {
 name OpenDRT
 xpos 1230
 ypos 11
 addUserKnob {20 OpenDRT}
 addUserKnob {26 about_label l " " T "<style> a:link \{ color: #ccc \}</style>\n<font color=#ccc>\n<b>OpenDRT</b> created by Jed Smith\n<br>v0.0.90b2 | <a href=https://github.com/jedypod/open-display-transform>documentation</a><br>"}
 addUserKnob {41 gamut l "in gamut" T InGamut_to_XYZ.gamut}
 addUserKnob {26 spacer l " " T ""}
 addUserKnob {35 presets l " " M {"presets/Rec.1886: 2.4 Power | Rec.709" "knobs this \{Lw 100 su 1 sat 1.2 wp 3 eotf 2 display_gamut 4\}" "presets/sRGB Display: 2.2 Power | Rec.709" "knobs this \{Lw 100 su 0 sat 1.2 wp 3 eotf 1 display_gamut 4\}" "presets/Apple Display P3: 2.2 Power | P3D65" "knobs this \{Lw 100 su 0 sat 1.2 wp 3 eotf 1 display_gamut 1\}" "presets/Rec.2020: 2.4 Power | Rec.2020" "knobs this \{Lw 100 su 1 sat 1.2 wp 3 eotf 2 display_gamut 0\}" "presets/Rec.2100: ST 2084 PQ | Rec.2020 | 100 nit" "knobs this \{Lw 100 su 1 sat 1.2 wp 3 eotf 4 display_gamut 0\}" "presets/Rec.2100: ST 2084 PQ | Rec.2020 | 600 nit" "knobs this \{Lw 600 su 2 sat 1 wp 3 eotf 4 display_gamut 0\}" "presets/Rec.2100: ST 2084 PQ | Rec.2020 | 1000 nit" "knobs this \{Lw 1000 su 2 sat 1 wp 3 eotf 4 display_gamut 0\}" "presets/Rec.2100: HLG | Rec.2020 | 1000 nit" "knobs this \{Lw 1000 su 2 sat 1 wp 3 eotf 5 display_gamut 0\}" "presets/Rec.2100: ST 2084 PQ | Rec.2020 | 2000 nit" "knobs this \{Lw 2000 su 2 sat 1 wp 3 eotf 4 display_gamut 0\}" "presets/Rec.2100: ST 2084 PQ | Rec.2020 | 4000 nit" "knobs this \{Lw 4000 su 2 sat 1 wp 3 eotf 4 display_gamut 0\}" "presets/Dolby: ST 2084 PQ | P3D65 | 100 nit" "knobs this \{Lw 100 su 1 sat 1.2 wp 3 eotf 4 display_gamut 1\}" "presets/Dolby: ST 2084 PQ | P3D65 | 600 nit" "knobs this \{Lw 600 su 2 sat 1 wp 3 eotf 4 display_gamut 1\}" "presets/Dolby: ST 2084 PQ | P3D65 | 1000 nit" "knobs this \{Lw 1000 su 2 sat 1 wp 3 eotf 4 display_gamut 1\}" "presets/Dolby: ST 2084 PQ | P3D65 | 2000 nit" "knobs this \{Lw 2000 su 2 sat 1 wp 3 eotf 4 display_gamut 1\}" "presets/Dolby: ST 2084 PQ | P3D65 | 4000 nit" "knobs this \{Lw 4000 su 2 sat 1 wp 3 eotf 4 display_gamut 1\}" "presets/DCI: 2.6 Power | P3 D60" "knobs this \{Lw 100 su 2 sat 1.2 wp 3 eotf 3 display_gamut 2\}" "presets/DCI: 2.6 Power | P3 D65" "knobs this \{Lw 100 su 2 sat 1.2 wp 3 eotf 3 display_gamut 1\}" "presets/DCI: 2.6 Power | P3 DCI" "knobs this \{Lw 100 su 2 sat 1.2 wp 3 eotf 3 display_gamut 3\}" "presets/DCI: 2.6 Power | DCDM XYZ" "knobs this \{Lw 100 su 2 sat 1.2 wp 3 eotf 3 display_gamut 5\}"}}
 addUserKnob {26 ""}
 addUserKnob {26 luminance_label l " " T <b>luminance</b>}
 addUserKnob {41 Lw T ToneScale.Lw}
 addUserKnob {41 su l surround T ToneScale.su}
 addUserKnob {26 chroma_label l " " T "<br/>\n<b>chroma</b>"}
 addUserKnob {41 dch l dechroma T ToneScale.dch}
 addUserKnob {41 sat l saturation T ToneScale.sat}
 addUserKnob {6 pdch l "perceptual dechroma" t "uses a perceptual colorspace to bias hue paths for chroma compression." +STARTLINE}
 pdch true
 addUserKnob {6 gcmp l "gamut compression" t "enable gamut compression" -STARTLINE}
 gcmp true
 addUserKnob {41 wp l whitepoint T Scale.wp}
 addUserKnob {26 ""}
 addUserKnob {26 display_encoding_label l " " T "<b>display encoding</b>"}
 addUserKnob {41 eotf T InverseEOTF.eotf}
 addUserKnob {41 display_gamut l gamut -STARTLINE T XYZ_to_DisplayGamut.gamut}
 addUserKnob {6 clamp t "clamp output to a 0-1 range" -STARTLINE}
 clamp true
 addUserKnob {26 ""}
 addUserKnob {4 direction M {forward inverse}}
}
 Input {
  inputs 0
  name Input
  xpos 180
  ypos -586
 }
set N8063bc00 [stack 0]
 Group {
  name EOTF
  xpos 510
  ypos -490
  addUserKnob {20 EOTF_tab l EOTF}
  addUserKnob {4 eotf l EOTF t "Choose the inverse EOTF to apply for the target display device." M {None "sRGB Display" BT.1886 "Gamma 2.6" PQ HLG ""}}
  eotf {{parent.InverseEOTF.eotf}}
 }
  Input {
   inputs 0
   name Input
   xpos 400
   ypos -130
  }
set N8063b800 [stack 0]
  Expression {
   expr0 r<=0.5?r*r/3:(exp((r-_c)/_a)+_b)/12
   expr1 g<=0.5?g*g/3:(exp((g-_c)/_a)+_b)/12
   expr2 b<=0.5?b*b/3:(exp((b-_c)/_a)+_b)/12
   name HLG_InverseOETF
   xpos 620
   ypos -58
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 _a t alpha}
   _a 0.17883277
   addUserKnob {7 _b t beta}
   _b {{1-4*_a}}
   addUserKnob {7 _c}
   _c {{0.5-_a*log(4*_a)}}
  }
  Expression {
   temp_name0 Ys
   temp_expr0 0.2627*r+0.6780*g+0.0593*b
   expr0 pow(Ys,_g-1)*r
   expr1 pow(Ys,_g-1)*g
   expr2 pow(Ys,_g-1)*b
   name HLG_OOTF
   xpos 620
   ypos -34
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 _g t "Gamma: Extended model for gamma variation according to peak display luminance and surround luminance: BT.2390-8 p32" R 0 2}
   _g {{1.2*pow(1.111,log(Lw/1000)/log(2))*pow(0.98,log(max(1e-6,Lamb)/5)/log(2))}}
   addUserKnob {7 Lw R 600 4000}
   Lw 1000
   addUserKnob {7 Lb}
   addUserKnob {7 Lamb t "ambient luminance level in nits" R 0 200}
   Lamb 5
  }
push $N8063b800
  Expression {
   temp_name0 rp
   temp_expr0 pow(r,1/m_2)
   temp_name1 gp
   temp_expr1 pow(g,1/m_2)
   temp_name2 bp
   temp_expr2 pow(b,1/m_2)
   expr0 pow((rp-c_1)/(c_2-c_3*rp),1/m_1)
   expr1 pow((gp-c_1)/(c_2-c_3*gp),1/m_1)
   expr2 pow((bp-c_1)/(c_2-c_3*bp),1/m_1)
   name ST2084_EOTF
   xpos 510
   ypos -58
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 m_1}
   m_1 {{2610/4096*(1/4)}}
   addUserKnob {7 m_2}
   m_2 {{2523/4096*128}}
   addUserKnob {7 c_1}
   c_1 {{107/128}}
   addUserKnob {7 c_2}
   c_2 {{2413/128}}
   addUserKnob {7 c_3}
   c_3 {{2392/128}}
  }
push $N8063b800
  Expression {
   expr0 sign(r)*pow(fabs(r),p)
   expr1 sign(g)*pow(fabs(g),p)
   expr2 sign(b)*pow(fabs(b),p)
   name Power
   xpos 400
   ypos -58
   addUserKnob {20 Params_tab l Params}
   addUserKnob {7 p l power R 0.2 2}
   p {{eotf?2+eotf*0.2:1}}
  }
  Switch {
   inputs 3
   which {{eotf-3}}
   name SwitchInverseEOTF
   xpos 400
   ypos -10
  }
  Output {
   name Output
   xpos 400
   ypos 62
  }
 end_group
 Expression {
  temp_name0 mx
  temp_expr0 dcdm?1:s
  expr0 parent.clamp?max(0,min(mx,r/s)):r/s
  expr1 parent.clamp?max(0,min(mx,g/s)):g/s
  expr2 parent.clamp?max(0,min(mx,b/s)):b/s
  name InvDisplayScale
  xpos 510
  ypos -442
  addUserKnob {20 Params}
  addUserKnob {6 pq +STARTLINE}
  pq {{eotf==4}}
  addUserKnob {6 hlg -STARTLINE}
  hlg {{eotf==5}}
  addUserKnob {6 dcdm -STARTLINE}
  dcdm {{eotf==3&&display_gamut==5}}
  addUserKnob {7 s}
  s {{pq?Lw/10000:hlg?Lw/1000:dcdm?48/52.37:1}}
 }
 ColorMatrix {
  matrix {
      {{parent.XYZ_to_DisplayGamut.ColorMatrix.matrix} {parent.XYZ_to_DisplayGamut.ColorMatrix.matrix} {parent.XYZ_to_DisplayGamut.ColorMatrix.matrix}}
      {{parent.XYZ_to_DisplayGamut.ColorMatrix.matrix} {parent.XYZ_to_DisplayGamut.ColorMatrix.matrix} {parent.XYZ_to_DisplayGamut.ColorMatrix.matrix}}
      {{parent.XYZ_to_DisplayGamut.ColorMatrix.matrix} {parent.XYZ_to_DisplayGamut.ColorMatrix.matrix} {parent.XYZ_to_DisplayGamut.ColorMatrix.matrix}}
    }
  invert true
  name Inv_XYZ_to_DisplayGamut
  xpos 510
  ypos -370
 }
 ColorMatrix {
  matrix {
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
    }
  name Inv_tlms_to_XYZ6
  xpos 510
  ypos -346
 }
 Expression {
  expr0 n*r/w.0
  expr1 n*g/w.1
  expr2 n*b/w.2
  name InvScale
  xpos 510
  ypos -322
  addUserKnob {20 Params}
  addUserKnob {78 w n 3}
  w {{parent.Scale.w} {parent.Scale.w} {parent.Scale.w}}
  addUserKnob {7 n R 0 4}
  n {{parent.Scale.wn}}
 }
set N80639400 [stack 0]
 Expression {
  expr0 r*w.0
  expr1 g*w.1
  expr2 b*w.2
  name InvNormalize1
  xpos 620
  ypos -178
  addUserKnob {20 Params}
  addUserKnob {78 w n 3}
  w {{parent.Normalize.w} {parent.Normalize.w} {parent.Normalize.w}}
 }
 ColorMatrix {
  matrix {
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
    }
  invert true
  name Inv_XYZ_to_tlms1
  xpos 620
  ypos -154
 }
 Group {
  name Colorspace_JzAzBz_Forward4
  xpos 620
  ypos -106
  addUserKnob {20 JzAzBz_tab l JzAzBz}
  addUserKnob {41 L_p T eotf_inverse_ST2084_.L_p}
  addUserKnob {6 JCh t "Lightness, Chroma, hue angle" +STARTLINE}
  JCh true
  addUserKnob {35 const_d_presets l "" +STARTLINE M {"const d/JzAzBz" "knobs this \{d -0.56\}" "const d/CAM16-UCS" "knobs this \{d 0\}" "const d/IPT" "knobs this \{d -0.64\}" "const d/ICtCp" "knobs this \{d 1.1\}"}}
  addUserKnob {7 d l "" t "the d constant which can can be adjusted to tune the lightness predictors to different colorspaces:\ndefault: -0.56\nCAM16-UCS: 0\nIPT: -0.64\nICtCp: 1.1" -STARTLINE R -1 1}
  d -0.56
 }
  StickyNote {
   inputs 0
   name StickyNote1
   tile_color 0x40454aff
   label "<left><b>JzAzBz Colorspace</b>\nSafdar, M., Cui, G., Kim, Y. J., & Luo, M. R. (2017).\n    Perceptually uniform color space for image signals including high dynamic\n    range and wide gamut. Optics Express, 25(13), 15131.\n    doi:10.1364/OE.25.015131\nhttps://www.osapublishing.org/oe/fulltext.cfm?uri=oe-25-13-15131&id=368272\nhttps://observablehq.com/@jrus/jzazbz"
   note_font_size 14
   xpos 107
   ypos -332
  }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -394
  }
  Expression {
   expr0 1.15*r-(1.15-1)*b
   expr1 0.66*g-(0.66-1)*r
   expr2 b
   name Expression3
   label "X_p Y_p Z"
   xpos -40
   ypos -333
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   name ColorMatrix6
   label XYZ_TO_LMS
   xpos -40
   ypos -295
  }
  Group {
   name eotf_inverse_ST2084_
   xpos -40
   ypos -250
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 m_1}
   m_1 {{2610/4096*(1/4)}}
   addUserKnob {7 m_2}
   m_2 {{1.7*2523/2**5}}
   addUserKnob {7 c_1}
   c_1 {{3424/4096}}
   addUserKnob {7 c_2}
   c_2 {{2413/4096*32}}
   addUserKnob {7 c_3}
   c_3 {{2392/4096*32}}
   addUserKnob {7 L_p R 100 10000}
   L_p 10000
  }
   Input {
    inputs 0
    name Input
    xpos -40
    ypos -290
   }
   Expression {
    expr0 "pow(r/L_p, m_1)"
    expr1 "pow(g/L_p, m_1)"
    expr2 "pow(b/L_p, m_1)"
    name Expression4
    label Y_p
    xpos -40
    ypos -255
   }
   Expression {
    expr0 "pow((c_1+c_2*r)/(c_3*r+1), m_2)"
    expr1 "pow((c_1+c_2*g)/(c_3*g+1), m_2)"
    expr2 "pow((c_1+c_2*b)/(c_3*b+1), m_2)"
    name Expression8
    label N
    xpos -40
    ypos -215
   }
   Output {
    name Output
    xpos -40
    ypos -170
   }
  end_group
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name ColorMatrix2
   label LMS_P_TO_IZAZBZ
   xpos -40
   ypos -224
  }
  Expression {
   temp_name0 d_0
   temp_expr0 1.6295499532821565e-11
   expr0 r*(1+d)/(1+d*r)-d_0
   expr1 g
   expr2 b
   name Expression1
   label Jz
   xpos -40
   ypos -184
  }
  Expression {
   expr0 r
   expr1 sqrt(g*g+b*b)
   expr2 atan2(b,g)
   channel3 none
   name Expression5
   label "JzAzBz to JCh"
   xpos -40
   ypos -136
   disable {{!parent.JCh}}
  }
  Output {
   name Output
   xpos -40
   ypos -58
  }
 end_group
push $N80639400
 Expression {
  temp_name0 n
  temp_expr0 sqrt(pow(w.0*r,2)+pow(w.1*g,2)+pow(w.2*b,2))/sum
  temp_name1 nt
  temp_expr1 (n+sqrt(n*(4*fl+n)))/2
  temp_name2 ns
  temp_expr2 (pow(nt/sy,1/p)/(1-pow(nt/sy,1/p)))*sx
  temp_name3 ccf
  temp_expr3 pow(ns==0?0:pow(nt,1/p)/(ns/sx),dch)*sat
  expr0 n==0?0:(n*(ccf-1)+r)/ccf*ns/n
  expr1 n==0?0:(n*(ccf-1)+g)/ccf*ns/n
  expr2 n==0?0:(n*(ccf-1)+b)/ccf*ns/n
  expr3 ccf
  name InvToneScale
  xpos 510
  ypos -250
  addUserKnob {20 Params}
  addUserKnob {7 Lw R 100 4000}
  Lw {{parent.ToneScale.Lw}}
  addUserKnob {7 p R 1 2}
  p {{parent.ToneScale.p}}
  addUserKnob {7 fl l flare R 0 0.01}
  fl {{1/Lw}}
  addUserKnob {7 sx R 0 10}
  sx {{0.016*pow(Lw,0.87)-0.17}}
  addUserKnob {7 sy R 0 4}
  sy {{1.036+5e-5*Lw}}
  addUserKnob {7 dch l dechroma}
  dch {{parent.ToneScale.dch}}
  addUserKnob {7 sat l saturation R 0.9 1.6}
  sat {{parent.ToneScale.sat}}
  addUserKnob {78 w n 3}
  w {0.24 0.1 0.09}
  addUserKnob {7 sum t "Normalize so achromatic in=out" R 0 2}
  sum {{sqrt(w.0*w.0+w.1*w.1+w.2*w.2)}}
 }
 Expression {
  expr0 r*w.0
  expr1 g*w.1
  expr2 b*w.2
  name InvNormalize
  xpos 510
  ypos -178
  addUserKnob {20 Params}
  addUserKnob {78 w n 3}
  w {{parent.Normalize.w} {parent.Normalize.w} {parent.Normalize.w}}
 }
 ColorMatrix {
  matrix {
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
    }
  invert true
  name Inv_XYZ_to_tlms
  xpos 510
  ypos -154
 }
 Group {
  name Colorspace_JzAzBz_Forward3
  xpos 510
  ypos -106
  addUserKnob {20 JzAzBz_tab l JzAzBz}
  addUserKnob {41 L_p T eotf_inverse_ST2084_.L_p}
  addUserKnob {6 JCh t "Lightness, Chroma, hue angle" +STARTLINE}
  JCh true
  addUserKnob {35 const_d_presets l "" +STARTLINE M {"const d/JzAzBz" "knobs this \{d -0.56\}" "const d/CAM16-UCS" "knobs this \{d 0\}" "const d/IPT" "knobs this \{d -0.64\}" "const d/ICtCp" "knobs this \{d 1.1\}"}}
  addUserKnob {7 d l "" t "the d constant which can can be adjusted to tune the lightness predictors to different colorspaces:\ndefault: -0.56\nCAM16-UCS: 0\nIPT: -0.64\nICtCp: 1.1" -STARTLINE R -1 1}
  d {{parent.Colorspace_JzAzBz_Forward4.d}}
 }
  StickyNote {
   inputs 0
   name StickyNote1
   tile_color 0x40454aff
   label "<left><b>JzAzBz Colorspace</b>\nSafdar, M., Cui, G., Kim, Y. J., & Luo, M. R. (2017).\n    Perceptually uniform color space for image signals including high dynamic\n    range and wide gamut. Optics Express, 25(13), 15131.\n    doi:10.1364/OE.25.015131\nhttps://www.osapublishing.org/oe/fulltext.cfm?uri=oe-25-13-15131&id=368272\nhttps://observablehq.com/@jrus/jzazbz"
   note_font_size 14
   xpos 107
   ypos -332
  }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -394
  }
  Expression {
   expr0 1.15*r-(1.15-1)*b
   expr1 0.66*g-(0.66-1)*r
   expr2 b
   name Expression3
   label "X_p Y_p Z"
   xpos -40
   ypos -333
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   name ColorMatrix6
   label XYZ_TO_LMS
   xpos -40
   ypos -295
  }
  Group {
   name eotf_inverse_ST2084_
   xpos -40
   ypos -250
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 m_1}
   m_1 {{2610/4096*(1/4)}}
   addUserKnob {7 m_2}
   m_2 {{1.7*2523/2**5}}
   addUserKnob {7 c_1}
   c_1 {{3424/4096}}
   addUserKnob {7 c_2}
   c_2 {{2413/4096*32}}
   addUserKnob {7 c_3}
   c_3 {{2392/4096*32}}
   addUserKnob {7 L_p R 100 10000}
   L_p {{parent.parent.Colorspace_JzAzBz_Forward4.eotf_inverse_ST2084_.L_p}}
  }
   Input {
    inputs 0
    name Input
    xpos -40
    ypos -290
   }
   Expression {
    expr0 "pow(r/L_p, m_1)"
    expr1 "pow(g/L_p, m_1)"
    expr2 "pow(b/L_p, m_1)"
    name Expression4
    label Y_p
    xpos -40
    ypos -255
   }
   Expression {
    expr0 "pow((c_1+c_2*r)/(c_3*r+1), m_2)"
    expr1 "pow((c_1+c_2*g)/(c_3*g+1), m_2)"
    expr2 "pow((c_1+c_2*b)/(c_3*b+1), m_2)"
    name Expression8
    label N
    xpos -40
    ypos -215
   }
   Output {
    name Output
    xpos -40
    ypos -170
   }
  end_group
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name ColorMatrix2
   label LMS_P_TO_IZAZBZ
   xpos -40
   ypos -224
  }
  Expression {
   temp_name0 d_0
   temp_expr0 1.6295499532821565e-11
   expr0 r*(1+d)/(1+d*r)-d_0
   expr1 g
   expr2 b
   name Expression1
   label Jz
   xpos -40
   ypos -184
  }
  Expression {
   expr0 r
   expr1 sqrt(g*g+b*b)
   expr2 atan2(b,g)
   channel3 none
   name Expression5
   label "JzAzBz to JCh"
   xpos -40
   ypos -136
   disable {{!parent.JCh}}
  }
  Output {
   name Output
   xpos -40
   ypos -58
  }
 end_group
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy1
  xpos 510
  ypos -64
  disable {{!pdch}}
 }
 Group {
  name Colorspace_JzAzBz_Inverse2
  xpos 510
  ypos -10
  addUserKnob {20 JzAzBz_tab l JzAzBz}
  addUserKnob {41 L_p T eotf_ST2084_.L_p}
  addUserKnob {6 JCh t "Lightness, Chroma, hue angle" +STARTLINE}
  JCh true
  addUserKnob {35 const_d_presets l "" +STARTLINE M {"const d/JzAzBz" "knobs this \{d -0.56\}" "const d/CAM16-UCS" "knobs this \{d 0\}" "const d/IPT" "knobs this \{d -0.64\}" "const d/ICtCp" "knobs this \{d 1.1\}"}}
  addUserKnob {7 d l "" t "the d constant which can can be adjusted to tune the lightness predictors to different colorspaces:\ndefault: -0.56\nCAM16-UCS: 0\nIPT: -0.64\nICtCp: 1.1" -STARTLINE R -1 1}
  d {{parent.Colorspace_JzAzBz_Forward4.d}}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -490
  }
  Expression {
   expr0 r
   expr1 g*cos(b)
   expr2 g*sin(b)
   channel3 none
   name Expression6
   label "JCh to JzAzBz"
   xpos -40
   ypos -376
   disable {{!parent.JCh}}
  }
  Expression {
   temp_name0 d_0
   temp_expr0 1.6295499532821565e-11
   expr0 (r+d_0)/(1+d-d*(r+d_0))
   expr1 g
   expr2 b
   name Expression4
   label Iz
   xpos -40
   ypos -328
  }
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   invert true
   name ColorMatrix4
   label IZAZBZ_TO_LMS_P
   xpos -40
   ypos -280
  }
  Group {
   name eotf_ST2084_
   xpos -40
   ypos -226
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 m_1}
   m_1 {{2610/4096*(1/4)}}
   addUserKnob {7 m_2}
   m_2 {{1.7*2523/2**5}}
   addUserKnob {7 c_1}
   c_1 {{3424/4096}}
   addUserKnob {7 c_2}
   c_2 {{2413/4096*32}}
   addUserKnob {7 c_3}
   c_3 {{2392/4096*32}}
   addUserKnob {7 L_p R 0 10000}
   L_p {{parent.parent.Colorspace_JzAzBz_Forward4.eotf_inverse_ST2084_.L_p}}
  }
   Input {
    inputs 0
    name Input
    xpos -40
    ypos -290
   }
   Expression {
    expr0 "pow(r, 1/m_2)"
    expr1 "pow(g, 1/m_2)"
    expr2 "pow(b, 1/m_2)"
    name Expression1
    label V_p
    xpos -40
    ypos -256
   }
   Expression {
    expr0 pow(((r-c_1)/(c_2-c_3*r)),1/m_1)*L_p
    expr1 pow(((g-c_1)/(c_2-c_3*g)),1/m_1)*L_p
    expr2 pow(((b-c_1)/(c_2-c_3*b)),1/m_1)*L_p
    name Expression2
    label C
    xpos -40
    ypos -218
   }
   Output {
    name Output
    xpos -40
    ypos -169
   }
  end_group
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   invert true
   name ColorMatrix5
   label LMS_TO_XYZ
   xpos -40
   ypos -184
  }
  Expression {
   expr0 (r+(1.15-1)*b)/1.15
   expr1 (g+(0.66-1)*((r+(1.15-1)*b)/1.15))/0.66
   expr2 b
   name Expression2
   label "X_p Y_p Z"
   xpos -40
   ypos -136
  }
  Output {
   name Output
   xpos -40
   ypos 42
  }
 end_group
 ColorMatrix {
  matrix {
      {{parent.InGamut_to_XYZ.ColorMatrix.matrix} {parent.InGamut_to_XYZ.ColorMatrix.matrix} {parent.InGamut_to_XYZ.ColorMatrix.matrix}}
      {{parent.InGamut_to_XYZ.ColorMatrix.matrix} {parent.InGamut_to_XYZ.ColorMatrix.matrix} {parent.InGamut_to_XYZ.ColorMatrix.matrix}}
      {{parent.InGamut_to_XYZ.ColorMatrix.matrix} {parent.InGamut_to_XYZ.ColorMatrix.matrix} {parent.InGamut_to_XYZ.ColorMatrix.matrix}}
    }
  invert true
  name Inv_InGamut_to_XYZ1
  xpos 510
  ypos 38
 }
push $N8063bc00
 Group {
  name InGamut_to_XYZ
  tile_color 0x429940ff
  xpos 180
  ypos -514
  addUserKnob {20 InputGamut_to_XYZ_tab l InputGamut_to_XYZ}
  addUserKnob {4 gamut l "in gamut" M {ACES ACEScg P3D65 Rec.2020 Rec.709 "Alexa WideGamut" "Red WideGamutRGB" "Sony SGamut3" "Filmlight E-Gamut" "DaVinci Wide Gamut" "" "" ""}}
  addUserKnob {41 matrix T ColorMatrix.matrix}
  addUserKnob {41 invert -STARTLINE T ColorMatrix.invert}
 }
  Input {
   inputs 0
   name Input
   xpos 290
   ypos -610
  }
  Dot {
   name Dot1
   xpos 324
   ypos -546
  }
set N804d9800 [stack 0]
  ColorMatrix {
   matrix {
       {{"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"}}
       {{"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"}}
       {{"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"}}
     }
   name ColorMatrix
   xpos 290
   ypos -370
  }
  Output {
   name Output
   xpos 290
   ypos -250
  }
push $N804d9800
  Dot {
   name Dot391
   label " *RGB to XYZ D65 CAT: XYZ Scaling"
   xpos 434
   ypos -546
  }
set N804d8c00 [stack 0]
  ColorMatrix {
   matrix {
       {0.7006223202 0.1487748027 0.101058729}
       {0.2741184831 0.8736317754 -0.1477504224}
       {-0.09896290302 -0.1378953159 1.325916052}
     }
   name ColorMatrix30
   label "DaVinci WG to XYZ D65"
   xpos 1390
   ypos -466
  }
push $N804d8c00
  ColorMatrix {
   matrix {
       {0.705396831 0.1640413404 0.08101775497}
       {0.2801307142 0.8202067018 -0.1003373787}
       {-0.1037815139 -0.07290726155 1.265746593}
     }
   name ColorMatrix29
   label "Filmlight E-Gamut to XYZ D65"
   xpos 1280
   ypos -466
  }
push $N804d8c00
  ColorMatrix {
   matrix {
       {0.5990839005 0.2489254922 0.1024464965}
       {0.2150758207 0.8850684166 -0.1001443192}
       {-0.03206584975 -0.02765838802 1.148782015}
     }
   name ColorMatrix31
   label "SonySGamut3 to XYZ D65"
   xpos 1170
   ypos -465
  }
push $N804d8c00
  ColorMatrix {
   matrix {
       {0.735275209 0.06860940903 0.1465712786}
       {0.2866940796 0.8429790735 -0.1296732426}
       {-0.07968084514 -0.3473432064 1.516081929}
     }
   name ColorMatrix22
   label "REDWideGamutRGB to XYZ D65"
   xpos 1060
   ypos -466
  }
push $N804d8c00
  ColorMatrix {
   matrix {
       {0.6380076408 0.2147038132 0.09774445742}
       {0.2919537723 0.8238408566 -0.1157948226}
       {0.002798279049 -0.06703422219 1.153293848}
     }
   name ColorMatrix21
   label "Arri AlexaWideGamut to XYZ D65"
   xpos 950
   ypos -466
  }
push $N804d8c00
  ColorMatrix {
   matrix {
       {0.4123909175 0.3575843573 0.1804807931}
       {0.2126390785 0.7151687145 0.07219231129}
       {0.01933082566 0.1191947833 0.9505321383}
     }
   name ColorMatrix18
   label "Rec709 to XYZ D65"
   xpos 840
   ypos -466
  }
push $N804d8c00
  ColorMatrix {
   matrix {
       {0.6369581223 0.1446169168 0.1688809693}
       {0.2627002299 0.6779981256 0.05930171534}
       {4.99410725e-17 0.02807269618 1.060985088}
     }
   name ColorMatrix17
   label "Rec2020 to XYZ D65"
   xpos 730
   ypos -466
  }
push $N804d8c00
  ColorMatrix {
   matrix {
       {0.4865711331 0.2656677067 0.1982173175}
       {0.2289746404 0.6917386055 0.07928691804}
       {-3.972076965e-17 0.04511338845 1.043944478}
     }
   name ColorMatrix16
   label "P3D65 to XYZ D65"
   xpos 620
   ypos -466
  }
push $N804d8c00
  ColorMatrix {
   matrix {
       {0.6609312296 0.1336961389 0.1558285803}
       {0.2722287476 0.6740817428 0.05368950963}
       {-0.006018006243 0.004383686464 1.090692043}
     }
   name ColorMatrix1
   label "ACEScg to XYZ D65"
   xpos 510
   ypos -466
  }
push $N804d8c00
  ColorMatrix {
   matrix {
       {0.9503623843 0 9.346324805e-05}
       {0.3439664543 0.728166163 -0.07213254273}
       {0 0 1.089057803}
     }
   name ColorMatrix2
   label "ACES to XYZ D65"
   xpos 400
   ypos -466
  }
  Switch {
   inputs 10
   which {{gamut}}
   name SwitchGamut
   xpos 400
   ypos -370
  }
 end_group
 ColorMatrix {
  matrix {
      {0.257085 0.859943 -0.031061}
      {-0.394427 1.1758 0.106423}
      {0.064856 -0.07625 0.559067}
    }
  name XYZ_to_tlms
  xpos 180
  ypos -490
 }
 Expression {
  expr0 r/w.0
  expr1 g/w.1
  expr2 b/w.2
  name Normalize
  xpos 180
  ypos -466
  addUserKnob {20 Params}
  addUserKnob {35 presets l "" +STARTLINE M {presets/D50 "knobs this \{w \{1.08221 0.883260 0.447579\}\}" presets/D55 "knobs this \{w \{1.07730 0.896467 0.500927\}\}" presets/D60 "knobs this \{w \{1.07344 0.907523 0.549381\}\}" presets/D65 "knobs this \{w \{1.07046 0.916817 0.594251\}\}" presets/D75 "knobs this \{w \{1.06600 0.931715 0.670839\}\}" presets/D93 "knobs this \{w \{1.06098 0.950462 0.776150\}\}"}}
  addUserKnob {78 w n 3}
  w {1.07046 0.916817 0.594251}
 }
set N80485800 [stack 0]
 Expression {
  expr0 r*w.0/n
  expr1 g*w.1/n
  expr2 b*w.2/n
  name Scale1
  xpos 70
  ypos -226
  addUserKnob {20 Params}
  addUserKnob {78 w n 3}
  w {{parent.Scale.w} {parent.Scale.w} {parent.Scale.w}}
  addUserKnob {7 n R 0 2}
  n {{parent.Scale.wn}}
 }
 ColorMatrix {
  matrix {
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
    }
  invert true
  name tlms_to_XYZ1
  xpos 70
  ypos -202
 }
 Group {
  name Colorspace_JzAzBz_Forward1
  xpos 70
  ypos -154
  addUserKnob {20 JzAzBz_tab l JzAzBz}
  addUserKnob {41 L_p T eotf_inverse_ST2084_.L_p}
  addUserKnob {6 JCh t "Lightness, Chroma, hue angle" +STARTLINE}
  JCh true
  addUserKnob {35 const_d_presets l "" +STARTLINE M {"const d/JzAzBz" "knobs this \{d -0.56\}" "const d/CAM16-UCS" "knobs this \{d 0\}" "const d/IPT" "knobs this \{d -0.64\}" "const d/ICtCp" "knobs this \{d 1.1\}"}}
  addUserKnob {7 d l "" t "the d constant which can can be adjusted to tune the lightness predictors to different colorspaces:\ndefault: -0.56\nCAM16-UCS: 0\nIPT: -0.64\nICtCp: 1.1" -STARTLINE R -1 1}
  d {{parent.Colorspace_JzAzBz_Forward2.d}}
 }
  StickyNote {
   inputs 0
   name StickyNote1
   tile_color 0x40454aff
   label "<left><b>JzAzBz Colorspace</b>\nSafdar, M., Cui, G., Kim, Y. J., & Luo, M. R. (2017).\n    Perceptually uniform color space for image signals including high dynamic\n    range and wide gamut. Optics Express, 25(13), 15131.\n    doi:10.1364/OE.25.015131\nhttps://www.osapublishing.org/oe/fulltext.cfm?uri=oe-25-13-15131&id=368272\nhttps://observablehq.com/@jrus/jzazbz"
   note_font_size 14
   xpos 107
   ypos -332
  }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -394
  }
  Expression {
   expr0 1.15*r-(1.15-1)*b
   expr1 0.66*g-(0.66-1)*r
   expr2 b
   name Expression3
   label "X_p Y_p Z"
   xpos -40
   ypos -333
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   name ColorMatrix6
   label XYZ_TO_LMS
   xpos -40
   ypos -295
  }
  Group {
   name eotf_inverse_ST2084_
   xpos -40
   ypos -250
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 m_1}
   m_1 {{2610/4096*(1/4)}}
   addUserKnob {7 m_2}
   m_2 {{1.7*2523/2**5}}
   addUserKnob {7 c_1}
   c_1 {{3424/4096}}
   addUserKnob {7 c_2}
   c_2 {{2413/4096*32}}
   addUserKnob {7 c_3}
   c_3 {{2392/4096*32}}
   addUserKnob {7 L_p R 100 10000}
   L_p {{parent.parent.Colorspace_JzAzBz_Forward2.eotf_inverse_ST2084_.L_p}}
  }
   Input {
    inputs 0
    name Input
    xpos -40
    ypos -290
   }
   Expression {
    expr0 "pow(r/L_p, m_1)"
    expr1 "pow(g/L_p, m_1)"
    expr2 "pow(b/L_p, m_1)"
    name Expression4
    label Y_p
    xpos -40
    ypos -255
   }
   Expression {
    expr0 "pow((c_1+c_2*r)/(c_3*r+1), m_2)"
    expr1 "pow((c_1+c_2*g)/(c_3*g+1), m_2)"
    expr2 "pow((c_1+c_2*b)/(c_3*b+1), m_2)"
    name Expression8
    label N
    xpos -40
    ypos -215
   }
   Output {
    name Output
    xpos -40
    ypos -170
   }
  end_group
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name ColorMatrix2
   label LMS_P_TO_IZAZBZ
   xpos -40
   ypos -224
  }
  Expression {
   temp_name0 d_0
   temp_expr0 1.6295499532821565e-11
   expr0 r*(1+d)/(1+d*r)-d_0
   expr1 g
   expr2 b
   name Expression1
   label Jz
   xpos -40
   ypos -184
  }
  Expression {
   expr0 r
   expr1 sqrt(g*g+b*b)
   expr2 atan2(b,g)
   channel3 none
   name Expression5
   label "JzAzBz to JCh"
   xpos -40
   ypos -136
   disable {{!parent.JCh}}
  }
  Output {
   name Output
   xpos -40
   ypos -58
  }
 end_group
push $N80485800
 Expression {
  temp_name0 n
  temp_expr0 max(1e-12,sqrt(pow(w.0*r,2)+pow(w.1*g,2)+pow(w.2*b,2))/sum)
  temp_name1 ns
  temp_expr1 sy*pow(n/(n+sx),p)
  temp_name2 nt
  temp_expr2 ns*ns/(ns+fl)
  temp_name3 ccf
  temp_expr3 pow(sx/(n+sx),dch)*sat
  expr0 nt*(1-ccf)+r*(nt/n)*ccf
  expr1 nt*(1-ccf)+g*(nt/n)*ccf
  expr2 nt*(1-ccf)+b*(nt/n)*ccf
  expr3 ccf
  name ToneScale
  xpos 180
  ypos -394
  addUserKnob {20 Params}
  addUserKnob {7 Lw R 100 4000}
  Lw 100
  addUserKnob {7 c l contrast R 0.8 2}
  c {{12*pow(Lw,-0.86)+1.17}}
  addUserKnob {4 su l surround t "dark = 1.0\ndim = 0.95\naverage = 0.90" M {average dim dark}}
  su dim
  addUserKnob {7 p R 1 2}
  p {{c*(0.9+0.05*su)}}
  addUserKnob {7 fl l flare R 0 0.01}
  fl {{1/Lw}}
  addUserKnob {7 sx R 0 10}
  sx {{0.016*pow(Lw,0.87)-0.17}}
  addUserKnob {7 sy R 0 4}
  sy {{1.036+5e-5*Lw}}
  addUserKnob {7 dch l dechroma}
  dch 0.5
  addUserKnob {7 sat l saturation R 0.9 1.6}
  sat 1.2
  addUserKnob {78 w n 3}
  w {0.24 0.1 0.09}
  addUserKnob {7 sum t "Normalize so achromatic in=out" R 0 2}
  sum {{sqrt(w.0*w.0+w.1*w.1+w.2*w.2)}}
 }
set N80409800 [stack 0]
 Group {
  name LMS_to_Yrg
  xpos 290
  ypos -346
 }
  Input {
   inputs 0
   name Input
   xpos 400
   ypos -346
  }
  Clamp {
   channels rgba
   maximum_enable false
   name ClampMin
   xpos 400
   ypos -320
  }
  Expression {
   temp_name0 _a
   temp_expr0 r+g+b
   temp_name1 l
   temp_expr1 _a==0?0:r/_a
   temp_name2 m
   temp_expr2 _a==0?0:g/_a
   expr0 0.68990272*r+0.34832189*g
   expr1 1.0671*l-0.6873*m+0.02062-0.14722
   expr2 -0.0362*l+1.7182*m-0.05155-0.50911666
   name LMS_to_Yrg
   xpos 400
   ypos -298
  }
  Expression {
   expr0 r
   expr1 hypot(g,b)
   expr2 atan2(b,g)
   name cartesian_to_polar1
   xpos 400
   ypos -274
  }
  Output {
   name Output
   xpos 400
   ypos -226
  }
 end_group
 Expression {
  expr1 g<t0?g:s*sqrt(g-ox)+oy
  maskChannelMask rgba.red
  name compress_parabolic
  xpos 290
  ypos -322
  addUserKnob {20 Params_tab l Params}
  addUserKnob {7 t0 t "threshold to start compression\n" R 0 2}
  t0 0.3
  addUserKnob {7 x0 t "x coordinate to compress to" R 0 2}
  x0 0.5
  addUserKnob {7 y0 t "y coordinate to compress to" R 0 2}
  y0 0.45
  addUserKnob {7 s}
  s {{(y0-t0)/sqrt(x0-y0)}}
  addUserKnob {7 ox R -2 2}
  ox {{t0-s*s/4}}
  addUserKnob {7 oy R -2 2}
  oy {{t0-s*sqrt(s*s/4)}}
 }
 Group {
  name Yrg_to_LMS
  xpos 290
  ypos -298
 }
  Input {
   inputs 0
   name Input
   xpos 510
   ypos -106
  }
  Expression {
   expr0 r
   expr1 g*cos(b)
   expr2 g*sin(b)
   name polar_to_cartesian
   xpos 510
   ypos -58
  }
  Expression {
   expr0 r
   expr1 g+0.14722
   expr2 b+0.50911666
   name offset_white1
   xpos 510
   ypos -34
  }
  Expression {
   temp_name0 l
   temp_expr0 0.95*g+0.38*b
   temp_name1 m
   temp_expr1 0.02*g+0.59*b+0.03
   temp_name2 _a
   temp_expr2 r/(0.68990272*l+0.34832189*m)
   expr0 l*_a
   expr1 m*_a
   expr2 (1-l-m)*_a
   name Yrg_to_LMS
   xpos 510
   ypos -10
  }
  Output {
   name Output
   xpos 510
   ypos 38
  }
 end_group
push $N80409800
 Switch {
  inputs 2
  which {{gcmp}}
  name Switch_gcmp
  xpos 180
  ypos -298
 }
 Expression {
  expr0 r*w.0/wn
  expr1 g*w.1/wn
  expr2 b*w.2/wn
  name Scale
  xpos 180
  ypos -226
  addUserKnob {20 Params}
  addUserKnob {4 wp M {D50 D55 D60 D65 D75 D93}}
  wp D65
  addUserKnob {78 w n 3}
  w {{curve(wp) 1.08221 1.0773 1.07344 1.07046 1.066 1.06098} {curve(wp) 0.88326 0.896467 0.907523 0.916817 0.931715 0.950462} {curve(wp) 0.447579 0.500927 0.549381 0.594251 0.670839 0.77615}}
  addUserKnob {7 wn R 0 2}
  wn {{curve(wp+6*display_gamut) 1.09063 1.05337 1.02355 1 1.12915 1.30631 1.1408 1.08334 1.037 1 1.13116 1.31116 1.09928 1.04391 1.00028 1.08307 1.22512 1.42007 1.2469 1.18409 1.13345 1.15054 1.30144 1.50853 1.17646 1.10416 1.0461 1 1.14486 1.34374 1 1 1 1 1 1}}
 }
 ColorMatrix {
  matrix {
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
    }
  invert true
  name tlms_to_XYZ
  xpos 180
  ypos -202
 }
 Group {
  name Colorspace_JzAzBz_Forward2
  xpos 180
  ypos -154
  addUserKnob {20 JzAzBz_tab l JzAzBz}
  addUserKnob {41 L_p T eotf_inverse_ST2084_.L_p}
  addUserKnob {6 JCh t "Lightness, Chroma, hue angle" +STARTLINE}
  JCh true
  addUserKnob {35 const_d_presets l "" +STARTLINE M {"const d/JzAzBz" "knobs this \{d -0.56\}" "const d/CAM16-UCS" "knobs this \{d 0\}" "const d/IPT" "knobs this \{d -0.64\}" "const d/ICtCp" "knobs this \{d 1.1\}"}}
  addUserKnob {7 d l "" t "the d constant which can can be adjusted to tune the lightness predictors to different colorspaces:\ndefault: -0.56\nCAM16-UCS: 0\nIPT: -0.64\nICtCp: 1.1" -STARTLINE R -1 1}
  d -0.56
 }
  StickyNote {
   inputs 0
   name StickyNote1
   tile_color 0x40454aff
   label "<left><b>JzAzBz Colorspace</b>\nSafdar, M., Cui, G., Kim, Y. J., & Luo, M. R. (2017).\n    Perceptually uniform color space for image signals including high dynamic\n    range and wide gamut. Optics Express, 25(13), 15131.\n    doi:10.1364/OE.25.015131\nhttps://www.osapublishing.org/oe/fulltext.cfm?uri=oe-25-13-15131&id=368272\nhttps://observablehq.com/@jrus/jzazbz"
   note_font_size 14
   xpos 107
   ypos -332
  }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -394
  }
  Expression {
   expr0 1.15*r-(1.15-1)*b
   expr1 0.66*g-(0.66-1)*r
   expr2 b
   name Expression3
   label "X_p Y_p Z"
   xpos -40
   ypos -333
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   name ColorMatrix6
   label XYZ_TO_LMS
   xpos -40
   ypos -295
  }
  Group {
   name eotf_inverse_ST2084_
   xpos -40
   ypos -250
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 m_1}
   m_1 {{2610/4096*(1/4)}}
   addUserKnob {7 m_2}
   m_2 {{1.7*2523/2**5}}
   addUserKnob {7 c_1}
   c_1 {{3424/4096}}
   addUserKnob {7 c_2}
   c_2 {{2413/4096*32}}
   addUserKnob {7 c_3}
   c_3 {{2392/4096*32}}
   addUserKnob {7 L_p R 100 10000}
   L_p 10000
  }
   Input {
    inputs 0
    name Input
    xpos -40
    ypos -290
   }
   Expression {
    expr0 "pow(r/L_p, m_1)"
    expr1 "pow(g/L_p, m_1)"
    expr2 "pow(b/L_p, m_1)"
    name Expression4
    label Y_p
    xpos -40
    ypos -255
   }
   Expression {
    expr0 "pow((c_1+c_2*r)/(c_3*r+1), m_2)"
    expr1 "pow((c_1+c_2*g)/(c_3*g+1), m_2)"
    expr2 "pow((c_1+c_2*b)/(c_3*b+1), m_2)"
    name Expression8
    label N
    xpos -40
    ypos -215
   }
   Output {
    name Output
    xpos -40
    ypos -170
   }
  end_group
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name ColorMatrix2
   label LMS_P_TO_IZAZBZ
   xpos -40
   ypos -224
  }
  Expression {
   temp_name0 d_0
   temp_expr0 1.6295499532821565e-11
   expr0 r*(1+d)/(1+d*r)-d_0
   expr1 g
   expr2 b
   name Expression1
   label Jz
   xpos -40
   ypos -184
  }
  Expression {
   expr0 r
   expr1 sqrt(g*g+b*b)
   expr2 atan2(b,g)
   channel3 none
   name Expression5
   label "JzAzBz to JCh"
   xpos -40
   ypos -136
   disable {{!parent.JCh}}
  }
  Output {
   name Output
   xpos -40
   ypos -58
  }
 end_group
 Expression {
  expr1 g<t0?g:s*sqrt(g-ox)+oy
  maskChannelMask rgba.red
  name compress_parabolic2
  xpos 180
  ypos -106
  disable {{!gcmp}}
  addUserKnob {20 Params_tab l Params}
  addUserKnob {7 t0 t "threshold to start compression\n" R 0 0.1}
  t0 0.016
  addUserKnob {7 x0 t "x coordinate to compress to" R 0 0.2}
  x0 0.05
  addUserKnob {7 y0 t "y coordinate to compress to" R 0 0.1}
  y0 0.02
  addUserKnob {7 s}
  s {{(y0-t0)/sqrt(x0-y0)}}
  addUserKnob {7 ox R -2 2}
  ox {{t0-s*s/4}}
  addUserKnob {7 oy R -2 2}
  oy {{t0-s*sqrt(s*s/4)}}
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy2
  xpos 180
  ypos -64
  disable {{!pdch}}
 }
 Group {
  name Colorspace_JzAzBz_Inverse1
  xpos 180
  ypos -10
  addUserKnob {20 JzAzBz_tab l JzAzBz}
  addUserKnob {41 L_p T eotf_ST2084_.L_p}
  addUserKnob {6 JCh t "Lightness, Chroma, hue angle" +STARTLINE}
  JCh true
  addUserKnob {35 const_d_presets l "" +STARTLINE M {"const d/JzAzBz" "knobs this \{d -0.56\}" "const d/CAM16-UCS" "knobs this \{d 0\}" "const d/IPT" "knobs this \{d -0.64\}" "const d/ICtCp" "knobs this \{d 1.1\}"}}
  addUserKnob {7 d l "" t "the d constant which can can be adjusted to tune the lightness predictors to different colorspaces:\ndefault: -0.56\nCAM16-UCS: 0\nIPT: -0.64\nICtCp: 1.1" -STARTLINE R -1 1}
  d {{parent.Colorspace_JzAzBz_Forward2.d}}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -490
  }
  Expression {
   expr0 r
   expr1 g*cos(b)
   expr2 g*sin(b)
   channel3 none
   name Expression6
   label "JCh to JzAzBz"
   xpos -40
   ypos -376
   disable {{!parent.JCh}}
  }
  Expression {
   temp_name0 d_0
   temp_expr0 1.6295499532821565e-11
   expr0 (r+d_0)/(1+d-d*(r+d_0))
   expr1 g
   expr2 b
   name Expression4
   label Iz
   xpos -40
   ypos -328
  }
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   invert true
   name ColorMatrix4
   label IZAZBZ_TO_LMS_P
   xpos -40
   ypos -280
  }
  Group {
   name eotf_ST2084_
   xpos -40
   ypos -226
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 m_1}
   m_1 {{2610/4096*(1/4)}}
   addUserKnob {7 m_2}
   m_2 {{1.7*2523/2**5}}
   addUserKnob {7 c_1}
   c_1 {{3424/4096}}
   addUserKnob {7 c_2}
   c_2 {{2413/4096*32}}
   addUserKnob {7 c_3}
   c_3 {{2392/4096*32}}
   addUserKnob {7 L_p R 0 10000}
   L_p {{parent.parent.Colorspace_JzAzBz_Forward2.eotf_inverse_ST2084_.L_p}}
  }
   Input {
    inputs 0
    name Input
    xpos -40
    ypos -290
   }
   Expression {
    expr0 "pow(r, 1/m_2)"
    expr1 "pow(g, 1/m_2)"
    expr2 "pow(b, 1/m_2)"
    name Expression1
    label V_p
    xpos -40
    ypos -256
   }
   Expression {
    expr0 pow(((r-c_1)/(c_2-c_3*r)),1/m_1)*L_p
    expr1 pow(((g-c_1)/(c_2-c_3*g)),1/m_1)*L_p
    expr2 pow(((b-c_1)/(c_2-c_3*b)),1/m_1)*L_p
    name Expression2
    label C
    xpos -40
    ypos -218
   }
   Output {
    name Output
    xpos -40
    ypos -169
   }
  end_group
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   invert true
   name ColorMatrix5
   label LMS_TO_XYZ
   xpos -40
   ypos -184
  }
  Expression {
   expr0 (r+(1.15-1)*b)/1.15
   expr1 (g+(0.66-1)*((r+(1.15-1)*b)/1.15))/0.66
   expr2 b
   name Expression2
   label "X_p Y_p Z"
   xpos -40
   ypos -136
  }
  Output {
   name Output
   xpos -40
   ypos 42
  }
 end_group
 Group {
  name XYZ_to_DisplayGamut
  tile_color 0x425440ff
  xpos 180
  ypos 38
  addUserKnob {20 XYZ_to_DisplayGamut_tab l XYZ_to_DisplayGamut}
  addUserKnob {4 gamut l "display gamut" t "Choose the target display device chromaticities." M {Rec.2020 "P3 D65" "P3 D60" "P3 DCI" Rec.709 "DCDM X'Y'Z'"}}
  gamut Rec.709
  addUserKnob {41 matrix T ColorMatrix.matrix}
  addUserKnob {41 invert -STARTLINE T ColorMatrix.invert}
 }
  Input {
   inputs 0
   name Input
   xpos 290
   ypos -580
  }
  Dot {
   name Dot391
   label " "
   xpos 324
   ypos -516
  }
set N80782c00 [stack 0]
  ColorMatrix {
   matrix {
       {{"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"}}
       {{"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"}}
       {{"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"}}
     }
   name ColorMatrix
   xpos 290
   ypos -399
  }
  Output {
   name Output
   xpos 290
   ypos -310
  }
push $N80782c00
  Dot {
   name Dot1
   label " XYZ D65 to *RGB CAT: XYZ Scaling"
   xpos 434
   ypos -516
  }
set N80782000 [stack 0]
  ColorMatrix {
   matrix {
       {1 0 0}
       {0 1 0}
       {0 0 1}
     }
   name ColorMatrix4
   label "XYZ D65 to XYZ E"
   xpos 950
   ypos -465
  }
push $N80782000
  ColorMatrix {
   matrix {
       {3.240968943 -1.537382722 -0.4986106157}
       {-0.9692435861 1.875967264 0.04155508429}
       {0.05563007668 -0.2039769441 1.056971431}
     }
   name ColorMatrix2
   label "XYZ D65 to Rec709"
   xpos 840
   ypos -465
  }
push $N80782000
  ColorMatrix {
   matrix {
       {2.72539258 -1.01800251 -0.4401629865}
       {-0.795167923 1.689731836 0.02264717408}
       {0.04124189168 -0.08763902634 1.100929379}
     }
   name ColorMatrix12
   label "XYZ D65 to P3DCI"
   xpos 730
   ypos -465
  }
push $N80782000
  ColorMatrix {
   matrix {
       {2.40274024 -0.8974836469 -0.3880532086}
       {-0.8325793743 1.769231319 0.02371269651}
       {0.03882337734 -0.0824996829 1.036368608}
     }
   name ColorMatrix11
   label "XYZ D65 to P3D60"
   xpos 620
   ypos -465
  }
push $N80782000
  ColorMatrix {
   matrix {
       {2.493495464 -0.9313831329 -0.4027105868}
       {-0.8294886947 1.762663484 0.02362468652}
       {0.03584581986 -0.07617236674 0.9568843246}
     }
   name ColorMatrix10
   label "XYZ D65 to P3D65"
   xpos 510
   ypos -465
  }
push $N80782000
  ColorMatrix {
   matrix {
       {1.716650844 -0.3556707203 -0.2533662021}
       {-0.6666842103 1.616480947 0.01576854289}
       {0.01763985492 -0.04277061298 0.9421030283}
     }
   name ColorMatrix5
   label "XYZ D65 to Rec2020"
   xpos 400
   ypos -465
  }
  Switch {
   inputs 6
   which {{gamut}}
   name SwitchGamut
   xpos 400
   ypos -399
  }
 end_group
 Expression {
  temp_name0 mx
  temp_expr0 dcdm?1:s
  expr0 parent.clamp?max(0,min(mx,r*s)):r*s
  expr1 parent.clamp?max(0,min(mx,g*s)):g*s
  expr2 parent.clamp?max(0,min(mx,b*s)):b*s
  name DisplayScale1
  xpos 180
  ypos 86
  addUserKnob {20 Params}
  addUserKnob {6 pq +STARTLINE}
  pq {{eotf==4}}
  addUserKnob {6 hlg -STARTLINE}
  hlg {{eotf==5}}
  addUserKnob {6 dcdm -STARTLINE}
  dcdm {{eotf==3&&display_gamut==5}}
  addUserKnob {7 s}
  s {{pq?Lw/10000:hlg?Lw/1000:dcdm?48/52.37:1}}
 }
 Group {
  name InverseEOTF
  xpos 180
  ypos 110
  addUserKnob {20 EOTF_tab l EOTF}
  addUserKnob {4 eotf t "Choose the inverse EOTF to apply for the target display device." M {None "sRGB Display" BT.1886 "Gamma 2.6" PQ HLG "" "" ""}}
 }
  Input {
   inputs 0
   name Input
   xpos 400
   ypos -130
  }
set N80b0fc00 [stack 0]
  Expression {
   temp_name0 Yd
   temp_expr0 0.2627*r+0.6780*g+0.0593*b
   expr0 r*pow(Yd,(1-_g)/_g)
   expr1 g*pow(Yd,(1-_g)/_g)
   expr2 b*pow(Yd,(1-_g)/_g)
   name HLG_InverseOOTF
   xpos 620
   ypos -58
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 _g t "Gamma: Extended model for gamma variation according to peak display luminance and surround luminance: BT.2390-8 p32" R 0 2}
   _g {{1.2*pow(1.111,log(Lw/1000)/log(2))*pow(0.98,log(max(1e-6,Lamb)/5)/log(2))}}
   addUserKnob {7 Lw R 600 4000}
   Lw {{parent.parent.Lw}}
   addUserKnob {7 Lamb t "ambient luminance level in nits" R 0 200}
   Lamb 5
  }
  Expression {
   expr0 r<=1/12?sqrt(3*r):_a*log(12*r-_b)+_c
   expr1 g<=1/12?sqrt(3*g):_a*log(12*g-_b)+_c
   expr2 b<=1/12?sqrt(3*b):_a*log(12*b-_b)+_c
   name HLG_OETF
   xpos 620
   ypos -34
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 _a t alpha}
   _a 0.17883277
   addUserKnob {7 _b t beta}
   _b {{1-4*_a}}
   addUserKnob {7 _c}
   _c {{0.5-_a*log(4*_a)}}
  }
push $N80b0fc00
  Expression {
   temp_name0 rp
   temp_expr0 pow(r,m_1)
   temp_name1 gp
   temp_expr1 pow(g,m_1)
   temp_name2 bp
   temp_expr2 pow(b,m_1)
   expr0 pow((c_1+c_2*rp)/(1+c_3*rp),m_2)
   expr1 pow((c_1+c_2*gp)/(1+c_3*gp),m_2)
   expr2 pow((c_1+c_2*bp)/(1+c_3*bp),m_2)
   name ST2084_InverseEOTF
   xpos 510
   ypos -58
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 m_1}
   m_1 {{2610/4096*(1/4)}}
   addUserKnob {7 m_2}
   m_2 {{2523/4096*128}}
   addUserKnob {7 c_1}
   c_1 {{107/128}}
   addUserKnob {7 c_2}
   c_2 {{2413/128}}
   addUserKnob {7 c_3}
   c_3 {{2392/128}}
  }
push $N80b0fc00
  Expression {
   expr0 sign(r)*pow(fabs(r),1/p)
   expr1 sign(g)*pow(fabs(g),1/p)
   expr2 sign(b)*pow(fabs(b),1/p)
   name power
   xpos 400
   ypos -58
   addUserKnob {20 Params_tab l Params}
   addUserKnob {7 p l power R 0.2 2}
   p {{eotf?2+eotf*0.2:1}}
  }
  Switch {
   inputs 3
   which {{eotf-3}}
   name SwitchInverseEOTF
   xpos 400
   ypos 14
  }
  Output {
   name Output
   xpos 400
   ypos 86
  }
 end_group
 Switch {
  inputs 2
  which {{parent.direction}}
  name SwitchDirection
  xpos 180
  ypos 206
 }
 Output {
  name Output
  xpos 180
  ypos 278
 }
end_group
Crop {
 box {0 -74 {width} {height}}
 reformat true
 crop false
 name Crop4
 xpos 1523
 ypos 2323
 disable true
}
Rectangle {
 opacity 0.955
 area {782.4000244 6 1137.599976 67.80000305}
 color 0
 name Rectangle4
 xpos 1523
 ypos 2347
}
Text2 {
 font_size_toolbar 30
 font_width_toolbar 100
 font_height_toolbar 100
 message "OpenDRT v0.0.90b2"
 old_message {{79 112 101 110 68 82 84 32 118 48 46 48 46 57 48 98 50}
   }
 box {0 16 1920 55}
 xjustify center
 yjustify center
 transforms {{0 2}
   }
 font_size_values {{0 30 1 30 2 30 3 30 4 30 5 30 6 30 7 30 8 30 9 30 10 30 11 30 12 30 13 30 14 30 15 30 16 30 8 99}
   }
 cursor_position 8
 font {{ Helvetica : Regular : Helvetica.ttc : 0 }}
 font_size 30
 center {960 540}
 cursor_initialised true
 autofit_bbox false
 initial_cursor_position {{717.6001587 112.7998962}
   }
 group_animations {{0} imported: 0 selected: items: "root transform/"}
 animation_layers {{1 11 960 540 0 0 1 1 0 0 0 0}
   }
 name Text2
 xpos 1537
 ypos 2374
}
push $N82ff7400
Dot {
 name Dot15
 xpos 1422
 ypos 2313
}
Crop {
 box {0 -74 {width} {height}}
 reformat true
 crop false
 name Crop3
 xpos 1388
 ypos 2331
 disable true
}
Rectangle {
 opacity 0.955
 area {782.4000244 6 1137.599976 67.80000305}
 color 0
 name Rectangle3
 xpos 1388
 ypos 2355
}
Text2 {
 font_size_toolbar 30
 font_width_toolbar 100
 font_height_toolbar 100
 message "ZCAMishDRT 0.3"
 old_message {{90 67 65 77 105 115 104 68 82 84 32 48 46 51}
   }
 box {0 16 1920 55}
 xjustify center
 yjustify center
 transforms {{0 2}
   }
 font_size_values {{0 30 1 30 2 30 3 30 4 30 5 30 6 30 7 30 8 30 9 30 10 30 11 30 12 30 13 30 0 99 1 99 2 99 3 99 4 99 5 99 6 99 7 99 8 99 9 99}
   }
 cursor_position 14
 font {{ Helvetica : Regular : Helvetica.ttc : 0 }}
 font_size 30
 center {960 540}
 cursor_initialised true
 autofit_bbox false
 initial_cursor_position {{717.6001587 112.7998962}
   }
 group_animations {{0} imported: 0 selected: items: "root transform/"}
 animation_layers {{1 11 960 540 0 0 1 1 0 0 0 0}
   }
 name Text1
 xpos 1420
 ypos 2387
}
ContactSheet {
 inputs 3
 width {{input.width*columns}}
 height {{input.height}}
 rows 1
 columns 3
 name ContactSheet1
 xpos 1537
 ypos 2454
}
Reformat {
 format "3840 2160 0 0 3840 2160 1 UHD_4K"
 scale 0.5
 name Reformat5
 xpos 1537
 ypos 2481
}
set N80e6d400 [stack 0]
Viewer {
 inputs 2
 frame 3
 frame_range 0-1023
 colour_sample_bbox {-0.015625 0.970703125 -0.013671875 0.97265625}
 samplepoints {{1.416015625 -0.658203125}
   }
 gl_buffer_depth half-float
 input_process false
 translate {-1.083500028 -0.07800000161}
 name Viewer1
 xpos 1206
 ypos 64
}
push $N80e6d400
Colorspace {
 colorspace_out sRGB
 name Colorspace9
 xpos 1537
 ypos 2513
}
Write {
 file /Users/afry/GitHub/nukeZCAM/images/comparisons/ZCAMishDRT_vs_v001/ZCAMishDRTv03_vs_v001.####.jpg
 colorspace texture_paint
 raw true
 file_type jpeg
 checkHashOnRead false
 version 6
 name Write1
 xpos 1537
 ypos 2568
}
