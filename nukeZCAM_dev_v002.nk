#! /Applications/Nuke13.0v3/Nuke13.0v3.app/Contents/MacOS/libnuke-13.0.3.dylib -nx
version 13.0 v3
define_window_layout_xml {<?xml version="1.0" encoding="UTF-8"?>
<layout version="1.0">
    <window x="0" y="25" w="2560" h="1470" maximized="1" screen="0">
        <splitter orientation="1">
            <split size="40"/>
            <dock id="" hideTitles="1" activePageId="Toolbar.1">
                <page id="Toolbar.1"/>
            </dock>
            <split size="1897" stretch="1"/>
            <splitter orientation="2">
                <split size="851"/>
                <dock id="" activePageId="Viewer.1">
                    <page id="Viewer.1"/>
                    <page id="Viewer.2"/>
                    <page id="Viewer.3"/>
                </dock>
                <split size="599"/>
                <dock id="" activePageId="DAG.1">
                    <page id="DAG.1"/>
                    <page id="Curve Editor.1"/>
                    <page id="DopeSheet.1"/>
                    <page id="DAG.2"/>
                </dock>
            </splitter>
            <split size="615"/>
            <dock id="" activePageId="Properties.1">
                <page id="Properties.1"/>
                <page id="uk.co.thefoundry.backgroundrenderview.1"/>
                <page id="uk.co.thefoundry.scripteditor.1"/>
                <page id="uk.co.thefoundry.monitorController.1"/>
            </dock>
        </splitter>
    </window>
</layout>
}
Root {
 inputs 0
 name /Users/afry/GitHub/nukeZCAM/nukeZCAM_dev_v002.nk
 mapsize {0.1093260188 0.09103641457}
 frame 78
 last_frame 480
 lock_range true
 format "2048 1556 0 0 2048 1556 1 2K_Super_35(full-ap)"
 proxy_type scale
 proxy_format "1024 778 0 0 1024 778 1 1K_Super_35(full-ap)"
 colorManagement Nuke
 OCIO_config custom
 customOCIOConfigPath /Users/afry/Documents/GitHub/OpenColorIO-Configs/aces_1.2/config.ocio
 workingSpaceLUT linear
 monitorLut sRGB
 monitorOutLUT rec709
 int8Lut sRGB
 int16Lut sRGB
 logLut Cineon
 floatLut linear
}
BackdropNode {
 inputs 0
 name BackdropNode1
 label "writeNode = nuke.toNode('Write4')\nreadNode = nuke.toNode('Read68')\n\n\nfor i in range(0,1024):\n    nuke.execute(writeNode, i, i)\n    readNode.knob('reload').execute()"
 xpos 663
 ypos 1681
 bdwidth 196
 bdheight 107
}
BackdropNode {
 inputs 0
 name BackdropNode2
 label "writeNode = nuke.toNode('Write4')\nreadNode = nuke.toNode('Read68')\n\n\nfor i in range(0,1024):\n    nuke.execute(writeNode, i, i)\n    readNode.knob('reload').execute()"
 xpos 108
 ypos 1690
 bdwidth 196
 bdheight 107
}
Shuffle2 {
 inputs 0
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 name Shuffle1
 xpos 1207
 ypos 189
}
Reformat {
 inputs 0
 type "to box"
 format "256 256 0 0 256 256 1 square_256"
 box_width 256
 box_height 256
 box_fixed true
 name Reformat1
 xpos -1424
 ypos 314
}
Ramp {
 p0 {0 0}
 p1 {{width i} 0}
 name Ramp2
 xpos -1424
 ypos 338
}
Grade {
 white {1.399999976 0.5600000024 1 1}
 gamma {0.6100000143 1.320000052 0.6499999762 1}
 name Grade2
 xpos -1424
 ypos 362
}
Expression {
 expr0 "y==floor(r(x, pos.y)*height*mult)?1:0"
 expr1 "y==floor(g(x, pos.y)*height*mult)?1:0"
 expr2 "y==floor(b(x, pos.y)*height*mult)?1:0"
 channel3 alpha
 name PlotScanline
 xpos -1424
 ypos 423
 addUserKnob {20 User}
 addUserKnob {12 pos}
 addUserKnob {7 mult R 0 5}
 mult 1
}
Constant {
 inputs 0
 channels rgb
 color 0.18
 name Constant2
 xpos 62
 ypos -684
}
set N1cd14c00 [stack 0]
EXPTool {
 mode Stops
 red 1
 green 1
 blue 1
 name Exposure1
 xpos -46
 ypos -611
}
push $N1cd14c00
Expression {
 temp_name0 stop
 temp_expr0 1
 channel0 rgba
 expr0 r*pow(2,1)
 name Expression2
 xpos 62
 ypos -612
}
Reformat {
 inputs 0
 format "1024 1024 0 0 1024 1024 1 square_1K"
 name Reformat2
 xpos 156
 ypos -685
}
Expression {
 channel0 rgba
 expr0 .18*pow(2,(cx*7))
 name Expression1
 xpos 156
 ypos -653
}
Ramp {
 p0 {0 0}
 p1 {{width} 0}
 color 20
 name Ramp1
 xpos 156
 ypos -612
 disable true
}
Read {
 inputs 0
 file_type exr
 file /Users/afry/Downloads/2018-acesreferenceimages-data/ACES_ref_Isabella.0.exr
 format "2880 1620 0 0 2880 1620 1 "
 origset true
 name Read80
 xpos 12044
 ypos -495
}
Read {
 inputs 0
 file_type exr
 file "/Users/afry/Downloads/Thomas Mansencal - EdisonBulb_ACES2065-1.exr"
 format "5634 3753 0 0 5634 3753 1 "
 origset true
 name Read79
 xpos 11933
 ypos -496
}
Read {
 inputs 0
 file_type exr
 file /Users/afry/Downloads/FS7_fire_lin_ap0.exr
 format "4096 2160 0 0 4096 2160 1 4K_DCP"
 origset true
 name Read78
 xpos 11772
 ypos -496
}
Read {
 inputs 0
 file_type exr
 file /Users/afry/Downloads/arri_ludwigstra√üe_take0000_lens_wide_open.exr
 format "2880 1620 0 0 2880 1620 1 "
 origset true
 name Read77
 xpos 11624
 ypos -497
}
Read {
 inputs 0
 file_type exr
 file /Users/afry/Downloads/B091C011_161004_R2XF.346.exr
 format "2048 1152 0 0 2048 1152 1 "
 origset true
 name Read76
 xpos 11514
 ypos -497
}
Read {
 inputs 0
 file_type exr
 file /Users/afry/Downloads/B091C011_161004_R2XF.532.exr
 format "2048 1152 0 0 2048 1152 1 "
 origset true
 name Read75
 xpos 11404
 ypos -497
}
Read {
 inputs 0
 file_type exr
 file /Users/afry/Downloads/B091C011_161004_R2XF.660.exr
 format "2048 1152 0 0 2048 1152 1 "
 origset true
 name Read74
 xpos 11294
 ypos -497
}
Read {
 inputs 0
 file_type tiff
 file /Users/afry/Downloads/martin-smekal/A004C007_190809_R39K_LogC_AlexaWideGamut.tif
 format "3414 2198 0 0 3414 2198 1 "
 origset true
 raw true
 name Read73
 xpos 11149
 ypos -530
}
OCIOColorSpace {
 in_colorspace "Input - ARRI - Curve - V3 LogC (EI800)"
 out_colorspace "ACES - ACES2065-1"
 name OCIOColorSpace14
 xpos 11149
 ypos -440
}
Read {
 inputs 0
 file_type tiff
 file /Users/afry/Downloads/martin-smekal/A016C009_191220_R19I_LogC_AlexaWideGamut.tif
 format "2880 1080 0 0 2880 1080 1 "
 origset true
 raw true
 name Read72
 xpos 11039
 ypos -530
}
OCIOColorSpace {
 in_colorspace "Input - ARRI - Curve - V3 LogC (EI800)"
 out_colorspace "ACES - ACES2065-1"
 name OCIOColorSpace13
 xpos 11039
 ypos -440
}
Read {
 inputs 0
 file_type tiff
 file /Users/afry/Downloads/martin-smekal/A009C002_190210_R0EI_LogC_AlexaWideGamut.tif
 format "3414 2198 0 0 3414 2198 1 "
 origset true
 raw true
 name Read71
 xpos 10929
 ypos -530
}
OCIOColorSpace {
 in_colorspace "Input - ARRI - Curve - V3 LogC (EI800)"
 out_colorspace "ACES - ACES2065-1"
 name OCIOColorSpace12
 xpos 10929
 ypos -440
}
Read {
 inputs 0
 file_type tiff
 file /Users/afry/Downloads/martin-smekal/A006C004_190809_R39K_LogC_AlexaWideGamut.tif
 format "3414 2198 0 0 3414 2198 1 "
 origset true
 raw true
 name Read70
 xpos 10819
 ypos -530
}
OCIOColorSpace {
 in_colorspace "Input - ARRI - Curve - V3 LogC (EI800)"
 out_colorspace "ACES - ACES2065-1"
 name OCIOColorSpace11
 xpos 10819
 ypos -440
}
Read {
 inputs 0
 file_type tiff
 file /Users/afry/Downloads/martin-smekal/A018C013_191220_R19I_02_LogC_AlexaWideGamut.tif
 format "2880 1080 0 0 2880 1080 1 "
 origset true
 raw true
 name Read69
 xpos 10709
 ypos -530
}
OCIOColorSpace {
 in_colorspace "Input - ARRI - Curve - V3 LogC (EI800)"
 out_colorspace "ACES - ACES2065-1"
 name OCIOColorSpace10
 xpos 10709
 ypos -440
}
Read {
 inputs 0
 file_type tiff
 file /Users/afry/Downloads/martin-smekal/A018C013_191220_R19I_03_LogC_AlexaWideGamut.tif
 format "2880 1080 0 0 2880 1080 1 "
 origset true
 raw true
 name Read67
 xpos 10599
 ypos -530
}
OCIOColorSpace {
 in_colorspace "Input - ARRI - Curve - V3 LogC (EI800)"
 out_colorspace "ACES - ACES2065-1"
 name OCIOColorSpace9
 xpos 10599
 ypos -440
}
Read {
 inputs 0
 file_type exr
 file /Users/afry/Downloads/thomas-mansencal/IMG_9957_3_MRF_AP0.exr
 format "5634 3753 0 0 5634 3753 1 "
 origset true
 name Read66
 xpos 10363
 ypos -529
}
Read {
 inputs 0
 file_type exr
 file "/Users/afry/Downloads/thomas-mansencal/5D Mark II - Spac-o-ween - 001.exr"
 format "5634 3753 0 0 5634 3753 1 "
 origset true
 name Read65
 xpos 10201
 ypos -527
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/aces-exr-1920/christophe-brejon/biped_jelly_001_lin_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read63
 xpos 9596
 ypos -233
}
Text {
 message "Rec709\n////////////"
 font "/Library/Fonts/Arial Unicode.ttf"
 size 60
 yjustify center
 box {1438 -176 2398 364}
 center {960 540}
 name Text18
 xpos 9596
 ypos -153
}
OCIOColorSpace {
 in_colorspace "ACES - ACES2065-1"
 out_colorspace scene_linear
 name OCIOColorSpace7
 xpos 9598
 ypos -94
}
OCIOColorSpace {
 in_colorspace "Utility - Linear - sRGB"
 out_colorspace "ACES - ACES2065-1"
 name OCIOColorSpace8
 xpos 9598
 ypos -70
}
Dot {
 name Dot13
 xpos 9638
 ypos -34
}
Reformat {
 inputs 0
 type "to box"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 box_width 274
 box_height 1080
 box_fixed true
 name Reformat12
 xpos 8675
 ypos -585
}
Radial {
 area {72.1875 902 203.8125 1034}
 softness 0
 name Radial1
 xpos 8675
 ypos -553
}
EXPTool {
 mode Stops
 red {{(frame-3)*2}}
 green {{red}}
 blue {{red}}
 name Exposure6
 xpos 8675
 ypos -529
}
Transform {
 translate {0 {(-frame+1)*(height/5) -0.1}}
 center {960 540}
 name Transform2
 xpos 8675
 ypos -505
}
TimeEcho {
 framesbehind 6
 name TimeEcho1
 xpos 8675
 ypos -481
}
set N1ccb5400 [stack 0]
Grade {
 multiply {0 0 1 1}
 multiply_panelDropped true
 name Grade9
 xpos 9191
 ypos -453
}
set N1ccb5000 [stack 0]
OCIOColorSpace {
 in_colorspace "ACES - ACEScg"
 out_colorspace "ACES - ACES2065-1"
 name OCIOColorSpace2
 xpos 9298
 ypos -431
}
Text {
 message "AP1\n0:0:1"
 font "/Library/Fonts/Arial Unicode.ttf"
 size 40
 xjustify center
 yjustify center
 box {56 466 216 610}
 center {1024 778}
 color 0
 name Text9
 xpos 9294
 ypos -383
}
push $N1ccb5000
Colorspace {
 primary_out ACES
 name Colorspace23
 xpos 9191
 ypos -429
}
Text {
 message "709\n0:0:1"
 font "/Library/Fonts/Arial Unicode.ttf"
 size 40
 xjustify center
 yjustify center
 box {56 466 216 610}
 center {1024 778}
 color 0
 name Text10
 xpos 9185
 ypos -381
}
push $N1ccb5400
Grade {
 multiply {0 1 0 1}
 multiply_panelDropped true
 name Grade6
 xpos 8981
 ypos -449
}
set N1cc4b000 [stack 0]
OCIOColorSpace {
 in_colorspace "ACES - ACEScg"
 out_colorspace "ACES - ACES2065-1"
 name OCIOColorSpace4
 xpos 9085
 ypos -433
}
Text {
 message "AP1\n0:1:0"
 font "/Library/Fonts/Arial Unicode.ttf"
 size 40
 xjustify center
 yjustify center
 box {56 466 216 610}
 center {1024 778}
 color 0
 name Text7
 xpos 9090
 ypos -387
}
push $N1cc4b000
Colorspace {
 primary_out ACES
 name Colorspace22
 xpos 8981
 ypos -425
}
Text {
 message "709\n0:1:0"
 font "/Library/Fonts/Arial Unicode.ttf"
 size 40
 xjustify center
 yjustify center
 box {56 466 216 610}
 center {1024 778}
 color 0
 name Text8
 xpos 8981
 ypos -401
}
push $N1ccb5400
Grade {
 multiply {1 0 0 1}
 multiply_panelDropped true
 name Grade1
 xpos 8764
 ypos -447
}
set N1cc49400 [stack 0]
OCIOColorSpace {
 in_colorspace "ACES - ACEScg"
 out_colorspace "ACES - ACES2065-1"
 name OCIOColorSpace1
 xpos 8872
 ypos -425
}
Text {
 message "AP1\n1:0:0"
 font "/Library/Fonts/Arial Unicode.ttf"
 size 40
 xjustify center
 yjustify center
 box {56 466 216 610}
 center {1024 778}
 color 0
 name Text6
 xpos 8872
 ypos -401
}
push $N1cc49400
Colorspace {
 primary_out ACES
 name Colorspace20
 xpos 8764
 ypos -423
}
Text {
 message "709\n1:0:0"
 font "/Library/Fonts/Arial Unicode.ttf"
 size 40
 xjustify center
 yjustify center
 box {56 466 216 610}
 center {1024 778}
 color 0
 name Text5
 xpos 8764
 ypos -399
}
push $N1ccb5400
Text {
 message 1:1:1
 font "/Library/Fonts/Arial Unicode.ttf"
 size 40
 xjustify center
 yjustify center
 box {56 466 216 610}
 center {1024 778}
 color 0
 name Text4
 xpos 8631
 ypos -395
}
ContactSheet {
 inputs 7
 width {{input.width*columns}}
 height {{input.height}}
 rows 1
 columns 7
 name ContactSheet6
 xpos 8687
 ypos -222
}
FrameHold {
 firstFrame 5
 name FrameHold1
 xpos 8687
 ypos -198
}
Group {
 name AF_WindsorExpBlur1
 tile_color 0x10e9efff
 xpos 8687
 ypos -166
 addUserKnob {20 User}
 addUserKnob {41 channels T Dissolve2.channels}
 addUserKnob {4 iterations M {1 2 3 4 5 6 7 8 9 10}}
 iterations 10
 addUserKnob {7 size l Size R 0 5}
 size 1.82
 addUserKnob {41 which T Dissolve2.which}
 addUserKnob {26 version l "" +STARTLINE T v001}
}
 Input {
  inputs 0
  name Input1
  xpos 784
  ypos 334
 }
 NoOp {
  name NoOp2
  xpos 784
  ypos 374
  addUserKnob {20 User}
  addUserKnob {7 size R 0 10}
  size {{parent.size}}
 }
set N1cfd6400 [stack 0]
 Blur {
  size {{pow(input.size,stepval)}}
  name Blur22
  xpos 1843
  ypos 480
  addUserKnob {20 User}
  addUserKnob {3 stepval l step}
  stepval 10
 }
 Multiply {
  value 0
  name Multiply9
  xpos 1843
  ypos 518
  disable {{parent.iterations<(input.stepval-1)?0:1}}
 }
push $N1cfd6400
 Blur {
  size {{pow(input.size,stepval)}}
  name Blur21
  xpos 1708
  ypos 483
  addUserKnob {20 User}
  addUserKnob {3 stepval l step}
  stepval 9
 }
 Multiply {
  value 0
  name Multiply8
  xpos 1708
  ypos 521
  disable {{parent.iterations<(input.stepval-1)?0:1}}
 }
push $N1cfd6400
 Blur {
  size {{pow(input.size,stepval)}}
  name Blur20
  xpos 1593
  ypos 481
  addUserKnob {20 User}
  addUserKnob {3 stepval l step}
  stepval 8
 }
 Multiply {
  value 0
  name Multiply7
  xpos 1593
  ypos 519
  disable {{parent.iterations<(input.stepval-1)?0:1}}
 }
push $N1cfd6400
 Blur {
  size {{pow(input.size,stepval)}}
  name Blur19
  xpos 1491
  ypos 481
  addUserKnob {20 User}
  addUserKnob {3 stepval l step}
  stepval 7
 }
 Multiply {
  value 0
  name Multiply6
  xpos 1491
  ypos 519
  disable {{parent.iterations<(input.stepval-1)?0:1}}
 }
push $N1cfd6400
 Blur {
  size {{pow(input.size,stepval)}}
  name Blur4
  xpos 1378
  ypos 483
  addUserKnob {20 User}
  addUserKnob {3 stepval l step}
  stepval 6
 }
 Multiply {
  value 0
  name Multiply5
  xpos 1378
  ypos 521
  disable {{parent.iterations<(input.stepval-1)?0:1}}
 }
push $N1cfd6400
 Blur {
  size {{pow(input.size,stepval)}}
  name Blur5
  xpos 1268
  ypos 481
  addUserKnob {20 User}
  addUserKnob {3 stepval l step}
  stepval 5
 }
 Multiply {
  value 0
  name Multiply4
  xpos 1268
  ypos 519
  disable {{parent.iterations<(input.stepval-1)?0:1}}
 }
push $N1cfd6400
 Blur {
  size {{pow(input.size,stepval)}}
  name Blur15
  xpos 1161
  ypos 487
  addUserKnob {20 User}
  addUserKnob {3 stepval l step}
  stepval 4
 }
 Multiply {
  value 0
  name Multiply3
  xpos 1161
  ypos 525
  disable {{parent.iterations<(input.stepval-1)?0:1}}
 }
push $N1cfd6400
 Blur {
  size {{pow(input.size,stepval)}}
  name Blur16
  xpos 1062
  ypos 485
  addUserKnob {20 User}
  addUserKnob {3 stepval l step}
  stepval 3
 }
 Multiply {
  value 0
  name Multiply2
  xpos 1062
  ypos 523
  disable {{parent.iterations<(input.stepval-1)?0:1}}
 }
push 0
push $N1cfd6400
 Blur {
  size {{pow(input.size,stepval)}}
  name Blur17
  xpos 877
  ypos 487
  addUserKnob {20 User}
  addUserKnob {3 stepval l step}
  stepval 1
 }
push $N1cfd6400
 Blur {
  size {{pow(input.size,stepval)}}
  name Blur18
  xpos 970
  ypos 488
  addUserKnob {20 User}
  addUserKnob {3 stepval l step}
  stepval 2
 }
 Multiply {
  value 0
  name Multiply1
  xpos 970
  ypos 526
  disable {{parent.iterations<(input.stepval-1)?0:1}}
 }
 Merge2 {
  inputs 10+1
  operation plus
  name Plus10
  xpos 877
  ypos 608
 }
 Multiply {
  value {{1/(parent.iterations+1)}}
  name Multiply14
  xpos 877
  ypos 634
 }
 Crop {
  box {0 0 {input.width} {input.height}}
  name Crop1
  xpos 877
  ypos 672
 }
push $N1cfd6400
 Dissolve {
  inputs 2
  channels rgb
  which 0.16
  name Dissolve2
  xpos 792
  ypos 775
 }
 Output {
  name Output1
  xpos 792
  ypos 875
 }
end_group
Reformat {
 inputs 0
 format "1024 1024 0 0 1024 1024 1 square_1K"
 name Reformat6
 xpos 7539
 ypos -514
}
set N1ceff800 [stack 0]
Crop {
 box {0 0 1024 {height/7}}
 reformat true
 crop false
 name Crop1
 xpos 7703
 ypos -494
}
set N1ceff000 [stack 0]
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 white -1 -1 rgba.red 0 0 white -1 -1 rgba.green 0 1 black -1 -1 rgba.blue 0 2 rgba.alpha 0 3 rgba.alpha 0 3"
 name Shuffle23
 xpos 8336
 ypos -449
}
push $N1ceff000
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 white -1 -1 rgba.red 0 0 black -1 -1 rgba.green 0 1 white -1 -1 rgba.blue 0 2 rgba.alpha 0 3 rgba.alpha 0 3"
 name Shuffle22
 xpos 8230
 ypos -444
}
push $N1ceff000
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 black -1 -1 rgba.red 0 0 white -1 -1 rgba.green 0 1 white -1 -1 rgba.blue 0 2 rgba.alpha 0 3 rgba.alpha 0 3"
 name Shuffle24
 xpos 8108
 ypos -438
}
push $N1ceff000
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 black -1 -1 rgba.red 0 0 black -1 -1 rgba.green 0 1 white -1 -1 rgba.blue 0 2 rgba.alpha 0 3 rgba.alpha 0 3"
 name Shuffle21
 xpos 7989
 ypos -440
}
push $N1ceff000
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 black -1 -1 rgba.red 0 0 white -1 -1 rgba.green 0 1 black -1 -1 rgba.blue 0 2 rgba.alpha 0 3 rgba.alpha 0 3"
 name Shuffle20
 xpos 7888
 ypos -442
}
push $N1ceff000
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 white -1 -1 rgba.red 0 0 black -1 -1 rgba.green 0 1 black -1 -1 rgba.blue 0 2 rgba.alpha 0 3 rgba.alpha 0 3"
 name Shuffle19
 xpos 7796
 ypos -440
}
push $N1ceff000
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 white -1 -1 rgba.red 0 0 white -1 -1 rgba.green 0 1 white -1 -1 rgba.blue 0 2 rgba.alpha 0 3 rgba.alpha 0 3"
 name Shuffle18
 xpos 7703
 ypos -440
}
ContactSheet {
 inputs 7
 width 1024
 height 1024
 rows 7
 columns 1
 name ContactSheet2
 xpos 7709
 ypos -367
}
push $N1ceff800
Expression {
 channel0 rgba
 expr0 .18*pow(2,(cx*7))
 name Expression7
 xpos 7539
 ypos -482
}
Merge2 {
 inputs 2
 operation multiply
 name Multiply
 xpos 7539
 ypos -362
}
Colorspace {
 primary_out ACES
 name Colorspace10
 xpos 7539
 ypos -338
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/troy-sobotka/ACEScg-notorious-primary-r-b.exr"
 format "960 540 0 0 960 540 1 "
 origset true
 name Read28
 xpos 7196
 ypos -520
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/troy-sobotka/ACEScg-notorious-primary-g.exr"
 format "960 540 0 0 960 540 1 "
 origset true
 name Read27
 xpos 7086
 ypos -520
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/troy-sobotka/ACEScg-notorious-primary-g-r.exr"
 format "960 540 0 0 960 540 1 "
 origset true
 name Read26
 xpos 6976
 ypos -520
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/troy-sobotka/ACEScg-notorious-primary-g-b.exr"
 format "960 540 0 0 960 540 1 "
 origset true
 name Read25
 xpos 6866
 ypos -520
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/troy-sobotka/ACEScg-notorious-primary-b.exr"
 format "960 540 0 0 960 540 1 "
 origset true
 name Read24
 xpos 6756
 ypos -520
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/troy-sobotka/ACEScg-notorious-primary-b-r.exr"
 format "960 540 0 0 960 540 1 "
 origset true
 name Read23
 xpos 6646
 ypos -520
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/troy-sobotka/ACEScg-notorious-primary-b-g.exr"
 format "960 540 0 0 960 540 1 "
 origset true
 name Read22
 xpos 6536
 ypos -520
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/troy-sobotka/ACEScg-notorious-primary-r.exr"
 format "960 540 0 0 960 540 1 "
 origset true
 name Read32
 xpos 6416
 ypos -517
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/troy-sobotka/ACEScg-notorious-primary-r-g.exr"
 format "960 540 0 0 960 540 1 "
 origset true
 name Read29
 xpos 6306
 ypos -517
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0022.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read59
 xpos 6131
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0021.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read58
 xpos 6021
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0020.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read57
 xpos 5911
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0019.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read56
 xpos 5801
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0018.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read55
 xpos 5691
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0017.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read54
 xpos 5581
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0016.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read53
 xpos 5471
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0015.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read52
 xpos 5361
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0014.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read51
 xpos 5251
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0013.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read50
 xpos 5141
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0012.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read49
 xpos 5031
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0011.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read48
 xpos 4921
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0010.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read47
 xpos 4811
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0009.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read46
 xpos 4701
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0008.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read45
 xpos 4591
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0007.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read44
 xpos 4481
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0006.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read43
 xpos 4371
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0005.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read42
 xpos 4261
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0004.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read41
 xpos 4151
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0003.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read40
 xpos 4041
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0002.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read38
 xpos 3931
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/daniel-brylka/210203_Prius_EXR_balance_ACESCentral_aces.0001.exr"
 format "5496 3670 0 0 5496 3670 1 "
 origset true
 name Read34
 xpos 3821
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/jed-smith/jedsmith_colorchecker24_streaks_flat.aces.exr"
 format "1152 576 0 0 1152 576 1 "
 origset true
 name Read39
 xpos 3642
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/jed-smith/acescg_hueswatches_24.aces.exr"
 format "2048 768 0 0 2048 768 1 "
 origset true
 name Read33
 xpos 3497
 ypos -519
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/jed-smith/jedsmith_colorchecker24_streaks_6ev.aces.exr"
 format "1152 576 0 0 1152 576 1 "
 origset true
 name Read37
 xpos 3339
 ypos -516
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/jed-smith/jedsmith_2020-08-20-06h43m50_riviere-au-tonnerre_sunrise.2048x1024.aces.exr"
 format "2048 1024 0 0 2048 1024 1 2K_LatLong"
 origset true
 name Read36
 xpos 3232
 ypos -515
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/jed-smith/jedsmith_2020-01-07-09h24_snowy_sunrise.2048x1024.aces.exr"
 format "2048 1024 0 0 2048 1024 1 2K_LatLong"
 origset true
 name Read35
 xpos 3122
 ypos -515
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/christophe-brejon/louise_sun_001_lin_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read31
 xpos 2989
 ypos -528
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/christophe-brejon/louise_concert_001_lin_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read30
 xpos 2856
 ypos -529
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/monsieur-lixm/fx_explosion_lookdev_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read21
 xpos 2715
 ypos -528
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/monsieur-lixm/dragonscene_ap0_v01_1003.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read20
 xpos 2605
 ypos -528
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/monsieur-lixm/dragonscene_ap0_v01_1002.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read19
 xpos 2495
 ypos -528
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/monsieur-lixm/dragonscene_ap0_v01_1001.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read18
 xpos 2385
 ypos -528
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/aces-exr-1920/christophe-brejon/sunny_spheres_001_lin_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read17
 xpos 2238
 ypos -530
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/aces-exr-1920/christophe-brejon/red_volumetric_002_lin_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read16
 xpos 2129
 ypos -531
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/aces-exr-1920/christophe-brejon/red_volumetric_001_lin_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read15
 xpos 2019
 ypos -531
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/aces-exr-1920/christophe-brejon/macbeth_spheres_001_lin_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read14
 xpos 1909
 ypos -531
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/aces-exr-1920/christophe-brejon/light_sabers_003_lin_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read13
 xpos 1799
 ypos -531
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/aces-exr-1920/christophe-brejon/light_sabers_002_lin_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read12
 xpos 1689
 ypos -531
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/aces-exr-1920/christophe-brejon/light_sabers_001_lin_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read11
 xpos 1579
 ypos -531
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/aces-exr-1920/christophe-brejon/glowing_spheres_002_lin_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read10
 xpos 1469
 ypos -531
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/aces-exr-1920/christophe-brejon/glowing_spheres_001_lin_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read9
 xpos 1359
 ypos -531
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/aces-exr-1920/christophe-brejon/cornell_box_001_lin_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read8
 xpos 1249
 ypos -531
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/aces-exr-1920/christophe-brejon/blue_volumetric_002_lin_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read7
 xpos 1139
 ypos -531
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/aces-exr-1920/christophe-brejon/blue_volumetric_001_lin_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read6
 xpos 1029
 ypos -531
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/aces-exr-1920/christophe-brejon/biped_jelly_001_lin_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read5
 xpos 915
 ypos -536
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/aces-exr-1920/aces_2048x1080_graded.00304.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read4
 xpos 806
 ypos -532
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/aces-exr-1920/RED_Christmas_ACES_via_RWG.exr"
 format "4096 2160 0 0 4096 2160 1 4K_DCP"
 origset true
 name Read3
 xpos 709
 ypos -528
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/images/TheLegoMovie_OT_VWG_zmk17_020_aces.0287.exr"
 format "2000 824 0 0 2000 824 1 kragle(Overscan)"
 origset true
 raw true
 name Read1
 xpos 613
 ypos -528
}
Switch {
 inputs 76
 which {{frame-1}}
 name Switch1
 label "\[value inputs]"
 xpos 710
 ypos -377
}
Reformat {
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 resize fit
 black_outside true
 name Reformat3
 xpos 710
 ypos -345
}
Saturation {
 saturation 4
 name Saturation3
 xpos 616
 ypos -303
 disable true
}
set N5d49a400 [stack 0]
EXPTool {
 mode Stops
 red 5
 green 5
 blue 5
 name Exposure4
 xpos 677
 ypos -246
}
push $N5d49a400
Dot {
 name Dot14
 xpos 648
 ypos -241
}
push $N5d49a400
EXPTool {
 mode Stops
 red -3
 green -3
 blue -3
 name Exposure3
 xpos 549
 ypos -246
}
ContactSheet {
 inputs 3
 width {{input.width*columns}}
 height {{input.height*rows}}
 columns 1
 roworder TopBottom
 name ContactSheet5
 xpos 614
 ypos -216
}
Dot {
 name Dot2
 xpos 739
 ypos -208
}
set N2c83bc00 [stack 0]
Colorspace {
 primary_in ACES
 colorspace_out CIE-XYZ
 name Colorspace3
 label "ACES to XYZ"
 xpos 705
 ypos -120
}
Dot {
 name Dot4
 xpos 739
 ypos -88
}
set N2c83b400 [stack 0]
Multiply {
 value 100
 name Multiply3
 label "Mult by 100 to put in absolute nits"
 xpos 705
 ypos -70
}
Dot {
 name Dot1
 xpos 739
 ypos -28
}
Group {
 name ZCAM
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos 705
 ypos -1
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set N2c83a000 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set N2c838c00 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $N2c838c00
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set N2c818f00 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $N2c818f00
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set N4b87ac00 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set N4b87a800 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $N4b87ac00
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set N4b879c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set N4b879800 [stack 0]
push $N4b87ac00
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set N4b879400 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set N4b879000 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set N4b878c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set N4b878800 [stack 0]
add_layer {zcam zcam.J zcam.Q zcam.M zcam.C}
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $N4b87a800
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $N4b87ac00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $N4b87ac00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $N4b87ac00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $N2c83a000
push $N4b87a800
push $N4b879c00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set N4b7fe800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
add_layer {zcam_bM zcam_bM.red zcam_bM.green zcam_bM.blue zcam_bM.alpha}
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $N4b7fe800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
add_layer {zcam_aM zcam_aM.red zcam_aM.green zcam_aM.blue zcam_aM.alpha}
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $N4b87a800
push $N4b879800
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set N4b7fd400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
add_layer {zcam_bC zcam_bC.red zcam_bC.green zcam_bC.blue zcam_bC.alpha}
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $N4b7fd400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
add_layer {zcam_aC zcam_aC.red zcam_aC.green zcam_aC.blue zcam_aC.alpha}
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $N4b87a800
push $N4b879400
push $N4b879c00
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set N4bb9b800 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set N4bb9b400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
add_layer {zcam_bS zcam_bS.red zcam_bS.green zcam_bS.blue zcam_bS.alpha}
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $N4bb9b400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
add_layer {zcam_aS zcam_aS.red zcam_aS.green zcam_aS.blue zcam_aS.alpha}
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $N4b878c00
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
add_layer {zcam_Vz zcam_Vz.red zcam_Vz.green zcam_Vz.blue zcam_Vz.alpha}
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $N4bb9b800
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
add_layer {zcam_Sz zcam_Sz.red zcam_Sz.green zcam_Sz.blue zcam_Sz.alpha}
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $N4b878c00
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
add_layer {zcam_Kz zcam_Kz.red zcam_Kz.green zcam_Kz.blue zcam_Kz.alpha}
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $N4b878800
add_layer {zcam_Wz zcam_Wz.red zcam_Wz.green zcam_Wz.blue zcam_Wz.alpha}
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $N4bb9b800
add_layer {zcam_s zcam_s.red zcam_s.green zcam_s.blue zcam_s.alpha}
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $N4b879800
add_layer {zcam_C zcam_C.red zcam_C.green zcam_C.blue zcam_C.alpha}
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $N4b879000
add_layer {zcam_J zcam_J.red zcam_J.green zcam_J.blue zcam_J.alpha}
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $N4b879c00
add_layer {zcam_M zcam_M.red zcam_M.green zcam_M.blue zcam_M.alpha}
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $N4b879400
add_layer {zcam_Q zcam_Q.red zcam_Q.green zcam_Q.blue zcam_Q.alpha}
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $N4b87a800
add_layer {zcam_h zcam_h.red zcam_h.green zcam_h.blue zcam_h.alpha}
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $N2c83a000
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set N4babe000 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set N4babd400 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $N4babd400
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $N4babe000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $N4babe000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $N4babe000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set N4ba57800 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set N4ba56c00 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $N4ba56c00
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $N4ba56c00
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set N4ba55c00 [stack 0]
push $N4ba55c00
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $N4babe000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $N4babe000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $N4ba57800
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set N4ba12c00 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $N4ba12c00
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $N4ba12c00
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set N4b7e4f00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set N4ba11c00 [stack 0]
 Dot {
  name Dot44
  label C,h
  selected true
  xpos -1673
  ypos 2768
 }
push $N4b7e4f00
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set N4ba11400 [stack 0]
 Dot {
  name Dot20
  label M,h
  selected true
  xpos -1737
  ypos 2767
 }
push $N4b7e4f00
push $N4babe000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set N4ba10800 [stack 0]
push $N4babe000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set N4b9c3800 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set N4b7e4800 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $N4ba11c00
push $N4ba11400
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set N4b9c1c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $N4b9c1c00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $N4b7e4800
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set N4b943800 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $N4b943800
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set N4b933900 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $N4b933900
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $N4babe000
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $N4babe000
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $N4babe000
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $N4b7e4800
push $N4babe000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $N4ba57800
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $N4ba10800
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $N4b9c3800
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $N4b7e4f00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
set N2c878100 [stack 0]
Shuffle2 {
 fromInput1 {{0} B}
 in1 zcam_J
 fromInput2 {{0} B}
 mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
 name Shuffle2
 xpos 493
 ypos 50
}
Multiply {
 value {{1/parent.Multiply3.value}}
 name Multiply1
 label "Div by 100 to go from nits"
 xpos 493
 ypos 74
}
set N4b8d5400 [stack 0]
ColorLookup {
 channels all
 lut {master {curve 0 x0.1089436561 0.0001599900424 x0.1538826674 0.0009879767895 x0.1697753966 0.001544326544 x0.1965807676 0.003412183374 x0.2212548852 0.005426112562 x0.2435974032 0.008081480861 x0.2744711637 0.01256972551 x0.335355252 0.02871714532 x0.3656598926 0.03916549683 x0.4067366123 0.05721262097 x0.451582104 0.08475825191 x0.5436673164 0.1626603603 x0.6915633678 0.3178277612 x0.7352961302 0.373636854 x0.8164004087 0.4692798555 x0.8752408028 0.5275940299 x0.9309006333 0.5828329325 x0.9754681587 0.6187173724 x1.033632636 0.6637632847 x1.16960156 0.745464921 x1.235319972 0.7762671709 x1.356181145 0.8217196465 x1.508617401 0.8695153594 x1.637787938 0.8979744911 x1.822932601 0.9321763515 x1.905457973 0.9441890717 x2.068963289 0.9626951218 x2.316649675 0.9837986231 x2.455148697 0.9925647378 x2.621634722 1}
   red {}
   green {}
   blue {}
   alpha {}}
 name ColorLookup4
 xpos 493
 ypos 116
}
Gamma {
 value 2.2
 name Gamma1
 xpos 493
 ypos 148
}
Multiply {
 value {{parent.Multiply3.value}}
 name Multiply4
 label "Mult by 100 to put in absolute nits"
 xpos 493
 ypos 180
}
Shuffle2 {
 fromInput1 {{0} B}
 out1 zcam_J
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
 name Shuffle3
 xpos 493
 ypos 222
}
push $N2c878100
Copy {
 inputs 2
 from0 -rgba.alpha
 to0 -rgba.alpha
 channels zcam_J
 name Copy1
 xpos 706
 ypos 213
}
set N4bc93c00 [stack 0]
Shuffle2 {
 fromInput1 {{0} B}
 in1 zcam_J
 fromInput2 {{0} B}
 in2 zcam_M
 mappings "4 black -1 -1 rgba.red 0 0 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3 zcam_M.green 1 1 rgba.green 0 1"
 name Shuffle5
 xpos 1002
 ypos 243
}
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 in2 zcam_h
 mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.alpha 0 3 rgba.alpha 0 3 zcam_h.blue 1 2 rgba.blue 0 2"
 name Shuffle6
 xpos 1002
 ypos 267
}
push $N2c83bc00
PositionToPoints2 {
 inputs 2
 display textured
 render_mode textured
 detail 1
 pointSize 1
 name PositionToPoints1
 xpos 1002
 ypos 326
}
Reformat {
 inputs 0
 format "1024 1024 0 0 1024 1024 1 square_1K"
 name Reformat4
 xpos -200
 ypos 89
}
Expression {
 channel0 zcam_J
 expr0 100
 channel1 zcam_M
 expr1 y/height*100
 channel2 zcam_h
 expr2 cx*180
 name Expression3
 xpos -200
 ypos 121
}
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.blue 0 2 white -1 -1 rgba.alpha 0 3"
 name Shuffle9
 xpos -200
 ypos 145
}
Group {
 name ZCAM2
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos -200
 ypos 169
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 direction inverse
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 inverseData1 M,h
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set N4bc91400 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set N4bc2fc00 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $N4bc2fc00
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set N4bc0f900 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $N4bc0f900
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set N4bc2e000 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set N4bc2dc00 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $N4bc2e000
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set N4bc2d000 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set N4bc2cc00 [stack 0]
push $N4bc2e000
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set N4bc2c800 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set N4bc2c400 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set N4bfabc00 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set N4bfab800 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $N4bc2dc00
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $N4bc2e000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $N4bc2e000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $N4bc2e000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $N4bc91400
push $N4bc2dc00
push $N4bc2d000
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set N4bfa9c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $N4bfa9c00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $N4bc2dc00
push $N4bc2cc00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set N4bfa8800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $N4bfa8800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $N4bc2dc00
push $N4bc2c800
push $N4bc2d000
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set N4bf46c00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set N4bf46800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $N4bf46800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $N4bfabc00
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $N4bf46c00
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $N4bfabc00
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $N4bfab800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $N4bf46c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $N4bc2cc00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $N4bc2c400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $N4bc2d000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $N4bc2c800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $N4bc2dc00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $N4bc91400
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set N4be6d400 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set N4be6c800 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $N4be6c800
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $N4be6d400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $N4be6d400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $N4be6d400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set N4be02c00 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set N4be02000 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $N4be02000
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $N4be02000
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set N4be01000 [stack 0]
push $N4be01000
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $N4be6d400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $N4be6d400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $N4be02c00
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set N4bdb2000 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $N4bdb2000
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $N4bdb2000
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set N4bd7f900 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set N4bdb1000 [stack 0]
 Dot {
  name Dot44
  label C,h
  selected true
  xpos -1673
  ypos 2768
 }
push $N4bd7f900
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set N4bdb0800 [stack 0]
 Dot {
  name Dot20
  label M,h
  selected true
  xpos -1737
  ypos 2767
 }
push $N4bd7f900
push $N4be6d400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set N4bd67800 [stack 0]
push $N4be6d400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set N4bd66c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set N4bd7f200 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $N4bdb1000
push $N4bdb0800
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set N4bd65000 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $N4bd65000
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $N4bd7f200
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set N4c106c00 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $N4c106c00
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set N4bd7e400 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $N4bd7e400
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $N4be6d400
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $N4be6d400
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $N4be6d400
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $N4bd7f200
push $N4be6d400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $N4be02c00
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $N4bd67800
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $N4bd66c00
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $N4bd7f900
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
Colorspace {
 colorspace_in CIE-XYZ
 name Colorspace2
 xpos -200
 ypos 221
}
set N4c0a8c00 [stack 0]
Expression {
 temp_name0 minChan
 temp_expr0 min(r,min(g,b)
 temp_name1 maxChan
 temp_expr1 max(r,max(g,b)
 expr0 max(r<0,g<0,b<0)?0:r
 expr1 max(r<0,g<0,b<0)?0:g
 expr2 max(r<0,g<0,b<0)?0:b
 name Expression4
 xpos -336
 ypos 261
}
Colorspace {
 colorspace_out CIE-XYZ
 name Colorspace8
 xpos -200
 ypos 296
}
set N4c0a8400 [stack 0]
Group {
 name ZCAM3
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos -200
 ypos 333
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set N4c027400 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set N4c026000 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $N4c026000
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set N4c048800 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $N4c048800
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set N4c024400 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set N4d50fc00 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $N4c024400
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set N4d50f000 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set N4d50ec00 [stack 0]
push $N4c024400
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set N4d50e800 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set N4d50e400 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set N4d50e000 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set N4d50dc00 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $N4d50fc00
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $N4c024400
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $N4c024400
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $N4c024400
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $N4c027400
push $N4d50fc00
push $N4d50f000
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set N4d49fc00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $N4d49fc00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $N4d50fc00
push $N4d50ec00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set N4d49e800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $N4d49e800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $N4d50fc00
push $N4d50e800
push $N4d50f000
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set N4d49d000 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set N4d49cc00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $N4d49cc00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $N4d50e000
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $N4d49d000
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $N4d50e000
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $N4d50dc00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $N4d49d000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $N4d50ec00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $N4d50e400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $N4d50f000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $N4d50e800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $N4d50fc00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $N4c027400
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set N4d347400 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set N4d346800 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $N4d346800
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $N4d347400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $N4d347400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $N4d347400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set N4d345000 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set N4d344400 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $N4d344400
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $N4d344400
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set N4d2f7000 [stack 0]
push $N4d2f7000
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $N4d347400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $N4d347400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $N4d345000
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set N4d2f4400 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $N4d2f4400
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $N4d2f4400
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set N4d498800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set N4d2a3000 [stack 0]
 Dot {
  name Dot44
  label C,h
  selected true
  xpos -1673
  ypos 2768
 }
push $N4d498800
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set N4d2a2800 [stack 0]
 Dot {
  name Dot20
  label M,h
  selected true
  xpos -1737
  ypos 2767
 }
push $N4d498800
push $N4d347400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set N4d2a1c00 [stack 0]
push $N4d347400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set N4d2a1000 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set N4d498100 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $N4d2a3000
push $N4d2a2800
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set N4d647000 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $N4d647000
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $N4d498100
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set N4d645000 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $N4d645000
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set N4d64f200 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $N4d64f200
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $N4d347400
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $N4d347400
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $N4d347400
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $N4d498100
push $N4d347400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $N4d345000
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $N4d2a1c00
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $N4d2a1000
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $N4d498800
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
set N4c04b900 [stack 0]
Dot {
 name Dot3
 xpos -10
 ypos 327
}
set N4d56ac00 [stack 0]
Shuffle2 {
 fromInput1 {{0} B}
 in1 zcam_J
 fromInput2 {{0} B}
 in2 zcam_M
 mappings "4 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3 zcam_M.green 1 1 rgba.green 0 1 zcam_J.red 0 0 rgba.red 0 0"
 name Shuffle11
 xpos -44
 ypos 345
}
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 in2 zcam_h
 mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.alpha 0 3 rgba.alpha 0 3 zcam_h.blue 1 2 rgba.blue 0 2"
 name Shuffle12
 xpos -44
 ypos 369
}
set N4d56a400 [stack 0]
push $N4c04b900
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.blue 0 2 white -1 -1 rgba.alpha 0 3"
 name Shuffle10
 xpos -200
 ypos 385
}
PositionToPoints2 {
 inputs 2
 display textured
 render_mode textured
 detail 1
 pointSize 1
 name PositionToPoints2
 xpos -44
 ypos 507
}
push $N4bc93c00
Shuffle2 {
 fromInput1 {{0} B}
 in1 zcam_M
 fromInput2 {{0} B}
 mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3 zcam_M.green 0 1 rgba.green 0 1"
 name Shuffle13
 xpos 858
 ypos 293
}
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 in2 zcam_h
 mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.blue 0 2 rgba.blue 0 2 rgba.alpha 0 3 rgba.alpha 0 3 zcam_h.green 1 1 rgba.green 0 1"
 name Shuffle16
 xpos 858
 ypos 317
}
set N4d569400 [stack 0]
Expression {
 channel0 rgba
 expr0 (g/360)+.5
 name Expression6
 xpos 959
 ypos 366
}
push $N4c0a8c00
Clamp {
 name Clamp1
 xpos -200
 ypos 252
 disable true
}
ColorWheel {
 inputs 0
 format "1024 1024 0 0 1024 1024 1 square_1K"
 gamma 0.45
 name ColorWheel1
 xpos 412
 ypos -674
}
set N4d568800 [stack 0]
Colorspace {
 colorspace_out CIE-XYZ
 name Colorspace5
 xpos 276
 ypos -665
}
Multiply {
 value 0.3
 name Multiply6
 xpos 276
 ypos -611
 disable true
}
Constant {
 inputs 0
 channels rgb
 color {1 0.4 0.4 1}
 color_panelDropped true
 name Constant1
 xpos -156
 ypos -680
}
Colorspace {
 colorspace_out CIE-XYZ
 name Colorspace1
 xpos -156
 ypos -608
}
Read {
 inputs 0
 file_type exr
 file /Users/afry/GitHub/nukeFnCoder24/fnCoder_samples_out.exr
 format "209 1 0 0 209 1 1 "
 origset true
 name Read60
 xpos -1270
 ypos 280
}
set N4d907000 [stack 0]
LayerContactSheet {
 showLayerNames true
 name LayerContactSheet2
 xpos -1270
 ypos 398
}
push $N4d907000
Dot {
 name Dot6
 xpos -1210
 ypos 454
}
Multiply {
 value {0.001 1 1 1}
 name Multiply7
 xpos -1203
 ypos 466
}
push $N4d907000
Dot {
 name Dot5
 xpos -1089
 ypos 354
}
Colorspace {
 colorspace_in CIE-Yxy
 name Colorspace11
 xpos -1123
 ypos 406
}
Grade {
 multiply 0.095
 name Grade7
 xpos -1123
 ypos 430
}
PositionToPoints2 {
 inputs 2
 display textured
 render_mode textured
 detail 1
 name PositionToPoints3
 xpos -1123
 ypos 519
}
push $N4b8d5400
Colorspace {
 colorspace_in st2084
 name Colorspace4
 xpos 231
 ypos 83
}
Group {
 name ssts
 xpos 231
 ypos 129
 addUserKnob {20 ssts_tab l ssts}
 addUserKnob {26 display_label l " " T "<b>Display Settings</b>"}
 addUserKnob {78 lum l luminance t "<b>SSTS Display Luminance</b>: \ny_min y_mid y_max\n\nAccording to Zach Lewis's ACES_OT\nhttps://gist.github.com/zachlewis/786c0be941868644c993fde1c3515c2c\n\n<b>Standard Cinema</b>: \n0.02 4.8 48\n<b>Dolby Cinema</b>: \n0.0001 7.2 108\n<b>Dolby Pulsar</b>: \n0.005 15 4000\n<b>Dolby PRR-4220</b>: \n0.005 10 600\n<b>Sony BVM-X300</b>: \n0.0001 10 1000\n<b>ACES OCES</b>: \n0.0001 4.8 10000\n\n" n 3}
 lum {0.0001 4.8 10000}
 addUserKnob {6 override_ssts_params l "override ssts params" t "Enable overrides of SSTS params.\n\nOtherwise the values will be calculated automatically by the algorithm." +STARTLINE}
 addUserKnob {7 exposure R -5 5}
 addUserKnob {7 knee}
 knee 0.35
 addUserKnob {7 shoulder}
 shoulder 0.89
 addUserKnob {78 slope n 3}
 slope {0.38 1.501 0.01}
 addUserKnob {20 TsParams_tab l TsParams}
 addUserKnob {7 mid_lum l "mid lum" R 0 20}
 mid_lum 4.8
 addUserKnob {7 expShift R -4 4}
 addUserKnob {13 minPoint t "x;        // ACES\ny;        // luminance\nz;        // slope"}
 minPoint {5.493164063e-06 0.0001 0}
 addUserKnob {13 midPoint t "x;        // ACES\ny;        // luminance\nz;        // slope"}
 midPoint {0.18 4.8 1.55}
 addUserKnob {13 maxPoint t "x;        // ACES\ny;        // luminance\nz;        // slope"}
 maxPoint {47185.92 10000 0}
 addUserKnob {7 knotIncLow}
 knotIncLow 1.505149978
 addUserKnob {7 knotIncHigh}
 knotIncHigh 1.806179974
 addUserKnob {7 pctLow}
 pctLow 0.18
 addUserKnob {7 pctHigh}
 pctHigh 0.8920050508
 addUserKnob {78 coefsLow n 5}
 coefsLow {-4 -4 -3.157376577 -0.4852499958 1.847732471}
 addUserKnob {78 coefsHigh n 5}
 coefsHigh {-0.7185482425 2.081030717 3.641590816 4 4}
 addUserKnob {20 Constants_tab l const}
 addUserKnob {3 N_KNOTS_LOW}
 N_KNOTS_LOW 4
 addUserKnob {3 N_KNOTS_HIGH}
 N_KNOTS_HIGH 4
 addUserKnob {7 MIN_STOP_SDR R -20 20}
 MIN_STOP_SDR -6.5
 addUserKnob {7 MAX_STOP_SDR R -20 20}
 MAX_STOP_SDR 6.5
 addUserKnob {7 MIN_STOP_RRT R -20 20}
 MIN_STOP_RRT -15
 addUserKnob {7 MAX_STOP_RRT R -20 20}
 MAX_STOP_RRT 18
 addUserKnob {7 MIN_LUM_SDR R 0 0.1}
 MIN_LUM_SDR 0.02
 addUserKnob {7 MAX_LUM_SDR R 0 100}
 MAX_LUM_SDR 48
 addUserKnob {7 MIN_LUM_RRT R 0 0.1}
 MIN_LUM_RRT 0.0001
 addUserKnob {7 MAX_LUM_RRT R 0 10000}
 MAX_LUM_RRT 10000
}
 Input {
  inputs 0
  name Input
  xpos -1030
  ypos -634
 }
 Dot {
  name Dot25
  label " "
  xpos -996
  ypos -318
 }
set N4d904800 [stack 0]
 Dot {
  name Dot26
  label " "
  xpos -996
  ypos 1506
 }
push $N4d904800
 Dot {
  name Dot4
  label " "
  xpos -886
  ypos -318
 }
set N4d89bc00 [stack 0]
 Dot {
  name Dot5
  label " "
  xpos -776
  ypos -318
 }
set N4d89b800 [stack 0]
 Dot {
  name Dot2
  label " "
  xpos -666
  ypos -318
 }
set N4d89b400 [stack 0]
 Dot {
  name Dot3
  label " "
  xpos -556
  ypos -318
 }
set N4d89b000 [stack 0]
 Expression {
  temp_name0 logr
  temp_expr0 "log10( max(r, 5.96046448e-08 ))"
  temp_name1 logg
  temp_expr1 "log10( max(g, 5.96046448e-08 ))"
  temp_name2 logb
  temp_expr2 "log10( max(b, 5.96046448e-08 ))"
  expr0 "logr <= log10(minPoint.x)"
  expr1 "logg <= log10(minPoint.x)"
  expr2 "logb <= log10(minPoint.x)"
  name segment_bottom
  xpos -590
  ypos -178
 }
 Dot {
  name Dot1
  label " "
  xpos -556
  ypos 162
 }
push $N4d89b000
 Dot {
  name Dot7
  label " "
  xpos -336
  ypos -318
 }
set N4d89a400 [stack 0]
 Expression {
  temp_name0 logr
  temp_expr0 "log10( max(r, 5.96046448e-08 ))"
  temp_name1 logg
  temp_expr1 "log10( max(g, 5.96046448e-08 ))"
  temp_name2 logb
  temp_expr2 "log10( max(b, 5.96046448e-08 ))"
  channel0 {rgba.red -rgba.green -rgba.blue none}
  expr0 "logr * minPoint.z + ( log10(minPoint.y) - minPoint.z * log10(minPoint.x) )"
  expr1 "logg * minPoint.z + ( log10(minPoint.y) - minPoint.z * log10(minPoint.x) )"
  expr2 "logb* minPoint.z + ( log10(minPoint.y) - minPoint.z * log10(minPoint.x) )"
  expr3 1
  name Expression
  xpos -370
  ypos -178
 }
 Merge2 {
  inputs 2
  operation multiply
  also_merge all
  name Multiply3
  xpos -370
  ypos 158
 }
 Dot {
  name Dot27
  label " "
  xpos -336
  ypos 786
 }
push $N4d89b400
 Expression {
  temp_name0 logr
  temp_expr0 "log10( max(r, 5.96046448e-08 ))"
  temp_name1 logg
  temp_expr1 "log10( max(g, 5.96046448e-08 ))"
  temp_name2 logb
  temp_expr2 "log10( max(b, 5.96046448e-08 ))"
  expr0 "( logr > log10(minPoint.x) ) * ( logr < log10(midPoint.x) )"
  expr1 "( logg > log10(minPoint.x) ) * ( logg < log10(midPoint.x) )"
  expr2 "( logb > log10(minPoint.x) ) * ( logb < log10(midPoint.x) )"
  name segment_low
  xpos -700
  ypos -178
 }
 Dot {
  name Dot22
  label " "
  xpos -666
  ypos 354
 }
push $N4d89a400
 Dot {
  name Dot9
  label " "
  xpos -6
  ypos -318
 }
set N4d898c00 [stack 0]
 Dot {
  name Dot6
  label " "
  xpos -6
  ypos -198
 }
set N4d898800 [stack 0]
 Dot {
  name Dot8
  label " "
  xpos 214
  ypos -198
 }
set N4d898400 [stack 0]
 Dot {
  name Dot13
  label " "
  xpos 434
  ypos -198
 }
 Dot {
  name Dot12
  label " "
  xpos 434
  ypos -78
 }
set N4d84b800 [stack 0]
 Expression {
  temp_name0 logx
  temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
  temp_name1 knot_coord
  temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
  temp_name2 j
  temp_expr2 int(knot_coord)
  temp_name3 t
  temp_expr3 "knot_coord - j"
  expr0 "j == 0 ? coefsLow.0 : j == 1 ? coefsLow.1 : j == 2 ? coefsLow.2 :j == 3 ? coefsLow.3 : j == 4 ? coefsLow.4 : 0"
  expr1 "j == 0 ? coefsLow.1 : j == 1 ? coefsLow.2 : j == 2 ? coefsLow.3 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
  expr2 "j == 0 ? coefsLow.2 : j == 1 ? coefsLow.3 : j == 2 ? coefsLow.4 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
  name Expression5
  xpos 290
  ypos -34
 }
 ColorMatrix {
  matrix {
      {0.5 -1 0.5}
      {-1 1 0}
      {0.5 0.5 0}
    }
  name ColorMatrix3
  label "mult_f3_f33( cf, M)"
  xpos 290
  ypos 8
 }
push $N4d84b800
 Expression {
  temp_name0 logx
  temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
  temp_name1 knot_coord
  temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
  temp_name2 j
  temp_expr2 int(knot_coord)
  temp_name3 t
  temp_expr3 "knot_coord - j"
  expr0 t*t
  expr1 t
  expr2 1
  expr3 1
  name Expression6
  xpos 400
  ypos -34
 }
 MergeExpression {
  inputs 2
  channel0 {rgba.red -rgba.green -rgba.blue none}
  expr0 0
  expr1 0
  expr2 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
  name dot_f3_f2
  label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
  xpos 400
  ypos 8
 }
push 0
push $N4d898400
 Dot {
  name Dot11
  label " "
  xpos 214
  ypos -78
 }
set N4d84a400 [stack 0]
 Expression {
  temp_name0 logx
  temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
  temp_name1 knot_coord
  temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
  temp_name2 j
  temp_expr2 int(knot_coord)
  temp_name3 t
  temp_expr3 "knot_coord - j"
  expr0 "j == 0 ? coefsLow.0 : j == 1 ? coefsLow.1 : j == 2 ? coefsLow.2 :j == 3 ? coefsLow.3 : j == 4 ? coefsLow.4 : 0"
  expr1 "j == 0 ? coefsLow.1 : j == 1 ? coefsLow.2 : j == 2 ? coefsLow.3 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
  expr2 "j == 0 ? coefsLow.2 : j == 1 ? coefsLow.3 : j == 2 ? coefsLow.4 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
  name Expression3
  xpos 70
  ypos -34
 }
 ColorMatrix {
  matrix {
      {0.5 -1 0.5}
      {-1 1 0}
      {0.5 0.5 0}
    }
  name ColorMatrix1
  label "mult_f3_f33( cf, M)"
  xpos 70
  ypos 8
 }
push $N4d84a400
 Expression {
  temp_name0 logx
  temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
  temp_name1 knot_coord
  temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
  temp_name2 j
  temp_expr2 int(knot_coord)
  temp_name3 t
  temp_expr3 "knot_coord - j"
  expr0 t*t
  expr1 t
  expr2 1
  expr3 1
  name Expression4
  xpos 180
  ypos -34
 }
 MergeExpression {
  inputs 2
  channel0 {rgba.red -rgba.green -rgba.blue none}
  expr0 0
  expr1 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
  expr2 0
  name dot_f3_f7
  label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
  xpos 180
  ypos 8
 }
push $N4d898800
 Dot {
  name Dot10
  label " "
  xpos -6
  ypos -78
 }
set N4d849000 [stack 0]
 Expression {
  temp_name0 logx
  temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
  temp_name1 knot_coord
  temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
  temp_name2 j
  temp_expr2 int(knot_coord)
  temp_name3 t
  temp_expr3 "knot_coord - j"
  expr0 "j == 0 ? coefsLow.0 : j == 1 ? coefsLow.1 : j == 2 ? coefsLow.2 :j == 3 ? coefsLow.3 : j == 4 ? coefsLow.4 : 0"
  expr1 "j == 0 ? coefsLow.1 : j == 1 ? coefsLow.2 : j == 2 ? coefsLow.3 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
  expr2 "j == 0 ? coefsLow.2 : j == 1 ? coefsLow.3 : j == 2 ? coefsLow.4 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
  name Expression1
  xpos -150
  ypos -34
 }
 ColorMatrix {
  matrix {
      {0.5 -1 0.5}
      {-1 1 0}
      {0.5 0.5 0}
    }
  name ColorMatrix2
  label "mult_f3_f33( cf, M)"
  xpos -150
  ypos 8
 }
push $N4d849000
 Expression {
  temp_name0 logx
  temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
  temp_name1 knot_coord
  temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
  temp_name2 j
  temp_expr2 int(knot_coord)
  temp_name3 t
  temp_expr3 "knot_coord - j"
  expr0 t*t
  expr1 t
  expr2 1
  expr3 1
  name Expression2
  xpos -40
  ypos -34
 }
 MergeExpression {
  inputs 2
  channel0 {rgba.red -rgba.green -rgba.blue none}
  expr0 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
  expr1 0
  expr2 0
  name dot_f3_f1
  label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
  xpos -40
  ypos 8
 }
 Merge2 {
  inputs 3+1
  operation plus
  bbox B
  output rgb
  name Merge1
  xpos 180
  ypos 158
 }
 Merge2 {
  inputs 2
  operation multiply
  also_merge all
  name Multiply1
  xpos 180
  ypos 350
 }
 Dot {
  name Dot28
  label " "
  xpos 214
  ypos 786
 }
push 0
push $N4d89b800
 Expression {
  temp_name0 logr
  temp_expr0 "log10( max(r, 5.96046448e-08 ))"
  temp_name1 logg
  temp_expr1 "log10( max(g, 5.96046448e-08 ))"
  temp_name2 logb
  temp_expr2 "log10( max(b, 5.96046448e-08 ))"
  expr0 "( logr >= log10(midPoint.x) ) * ( logr < log10(maxPoint.x) )"
  expr1 "( logg >= log10(midPoint.x) ) * ( logg < log10(maxPoint.x) )"
  expr2 "( logb >= log10(midPoint.x) ) * ( logb < log10(maxPoint.x) )"
  name segment_high
  xpos -810
  ypos -178
 }
 Dot {
  name Dot23
  label " "
  xpos -776
  ypos 474
 }
push $N4d898c00
 Dot {
  name Dot14
  label " "
  xpos 764
  ypos -318
 }
set N4d7e6400 [stack 0]
 Dot {
  name Dot15
  label " "
  xpos 764
  ypos -198
 }
set N4d7e6000 [stack 0]
 Dot {
  name Dot17
  label " "
  xpos 984
  ypos -198
 }
set N4d7e5c00 [stack 0]
 Dot {
  name Dot20
  label " "
  xpos 1204
  ypos -198
 }
 Dot {
  name Dot19
  label " "
  xpos 1204
  ypos -78
 }
set N4d7e5400 [stack 0]
 Expression {
  temp_name0 logx
  temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
  temp_name1 knot_coord
  temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
  temp_name2 j
  temp_expr2 int(knot_coord)
  temp_name3 t
  temp_expr3 "knot_coord - j"
  expr0 "j == 0 ? coefsHigh.0 : j == 1 ? coefsHigh.1 : j == 2 ? coefsHigh.2 :j == 3 ? coefsHigh.3 : j == 4 ? coefsHigh.4 : 0"
  expr1 "j == 0 ? coefsHigh.1 : j == 1 ? coefsHigh.2 : j == 2 ? coefsHigh.3 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
  expr2 "j == 0 ? coefsHigh.2 : j == 1 ? coefsHigh.3 : j == 2 ? coefsHigh.4 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
  expr3 j
  name Expression11
  xpos 1060
  ypos -34
 }
 ColorMatrix {
  matrix {
      {0.5 -1 0.5}
      {-1 1 0}
      {0.5 0.5 0}
    }
  name ColorMatrix6
  label "mult_f3_f33( cf, M)"
  xpos 1060
  ypos 8
 }
push $N4d7e5400
 Expression {
  temp_name0 logx
  temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
  temp_name1 knot_coord
  temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
  temp_name2 j
  temp_expr2 int(knot_coord)
  temp_name3 t
  temp_expr3 "knot_coord - j"
  expr0 t*t
  expr1 t
  expr2 1
  expr3 1
  name Expression12
  xpos 1170
  ypos -34
 }
 MergeExpression {
  inputs 2
  channel0 {rgba.red -rgba.green -rgba.blue none}
  expr0 0
  expr1 0
  expr2 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
  name dot_f3_f6
  label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
  xpos 1170
  ypos 8
 }
push 0
push $N4d7e5c00
 Dot {
  name Dot18
  label " "
  xpos 984
  ypos -78
 }
set N4d78fc00 [stack 0]
 Expression {
  temp_name0 logx
  temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
  temp_name1 knot_coord
  temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
  temp_name2 j
  temp_expr2 int(knot_coord)
  temp_name3 t
  temp_expr3 "knot_coord - j"
  expr0 "j == 0 ? coefsHigh.0 : j == 1 ? coefsHigh.1 : j == 2 ? coefsHigh.2 :j == 3 ? coefsHigh.3 : j == 4 ? coefsHigh.4 : 0"
  expr1 "j == 0 ? coefsHigh.1 : j == 1 ? coefsHigh.2 : j == 2 ? coefsHigh.3 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
  expr2 "j == 0 ? coefsHigh.2 : j == 1 ? coefsHigh.3 : j == 2 ? coefsHigh.4 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
  expr3 j
  name Expression9
  xpos 840
  ypos -34
 }
 ColorMatrix {
  matrix {
      {0.5 -1 0.5}
      {-1 1 0}
      {0.5 0.5 0}
    }
  name ColorMatrix5
  label "mult_f3_f33( cf, M)"
  xpos 840
  ypos 8
 }
push $N4d78fc00
 Expression {
  temp_name0 logx
  temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
  temp_name1 knot_coord
  temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
  temp_name2 j
  temp_expr2 int(knot_coord)
  temp_name3 t
  temp_expr3 "knot_coord - j"
  expr0 t*t
  expr1 t
  expr2 1
  expr3 1
  name Expression10
  xpos 950
  ypos -34
 }
 MergeExpression {
  inputs 2
  channel0 {rgba.red -rgba.green -rgba.blue none}
  expr0 0
  expr1 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
  expr2 0
  name dot_f3_f5
  label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
  xpos 950
  ypos 8
 }
push $N4d7e6000
 Dot {
  name Dot16
  label " "
  xpos 764
  ypos -78
 }
set N4d78e800 [stack 0]
 Expression {
  temp_name0 logx
  temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
  temp_name1 knot_coord
  temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
  temp_name2 j
  temp_expr2 int(knot_coord)
  temp_name3 t
  temp_expr3 "knot_coord - j"
  expr0 "j == 0 ? coefsHigh.0 : j == 1 ? coefsHigh.1 : j == 2 ? coefsHigh.2 :j == 3 ? coefsHigh.3 : j == 4 ? coefsHigh.4 : 0"
  expr1 "j == 0 ? coefsHigh.1 : j == 1 ? coefsHigh.2 : j == 2 ? coefsHigh.3 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
  expr2 "j == 0 ? coefsHigh.2 : j == 1 ? coefsHigh.3 : j == 2 ? coefsHigh.4 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
  expr3 j
  name Expression7
  xpos 620
  ypos -34
 }
 ColorMatrix {
  matrix {
      {0.5 -1 0.5}
      {-1 1 0}
      {0.5 0.5 0}
    }
  name ColorMatrix4
  label "mult_f3_f33( cf, M)"
  xpos 620
  ypos 8
 }
push $N4d78e800
 Expression {
  temp_name0 logx
  temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
  temp_name1 knot_coord
  temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
  temp_name2 j
  temp_expr2 int(knot_coord)
  temp_name3 t
  temp_expr3 "knot_coord - j"
  expr0 t*t
  expr1 t
  expr2 1
  expr3 1
  name Expression8
  xpos 730
  ypos -34
 }
 MergeExpression {
  inputs 2
  channel0 {rgba.red -rgba.green -rgba.blue none}
  expr0 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
  expr1 0
  expr2 0
  name dot_f3_f4
  label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
  xpos 730
  ypos 8
 }
 Merge2 {
  inputs 3+1
  operation plus
  bbox B
  output rgb
  name Merge2
  xpos 950
  ypos 158
 }
 Merge2 {
  inputs 2
  operation multiply
  also_merge all
  name Multiply2
  xpos 950
  ypos 470
 }
 Dot {
  name Dot29
  label " "
  xpos 984
  ypos 786
 }
push $N4d89bc00
 Expression {
  temp_name0 logr
  temp_expr0 "log10( max(r, 5.96046448e-08 ))"
  temp_name1 logg
  temp_expr1 "log10( max(g, 5.96046448e-08 ))"
  temp_name2 logb
  temp_expr2 "log10( max(b, 5.96046448e-08 ))"
  expr0 "logr >= log10(maxPoint.x) ? 1 : 0"
  expr1 "logg >= log10(maxPoint.x) ? 1 : 0"
  expr2 "logb >= log10(maxPoint.x) ? 1 : 0"
  name segment_peak
  xpos -920
  ypos -178
 }
 Dot {
  name Dot24
  label " "
  xpos -886
  ypos 618
 }
push $N4d7e6400
 Dot {
  name Dot21
  label " "
  xpos 1534
  ypos -318
 }
 Expression {
  temp_name0 logr
  temp_expr0 "log10( max(r, 5.96046448e-08 ))"
  temp_name1 logg
  temp_expr1 "log10( max(g, 5.96046448e-08 ))"
  temp_name2 logb
  temp_expr2 "log10( max(b, 5.96046448e-08 ))"
  channel0 {rgba.red -rgba.green -rgba.blue none}
  expr0 "logr * maxPoint.z + ( log10(maxPoint.y) - maxPoint.z * log10(maxPoint.x) )"
  expr1 "logg * maxPoint.z + ( log10(maxPoint.y) - maxPoint.z * log10(maxPoint.x) )"
  expr2 "logb* maxPoint.z + ( log10(maxPoint.y) - maxPoint.z * log10(maxPoint.x) )"
  expr3 1
  name proc_low1
  label Expression
  xpos 1500
  ypos -160
 }
 Merge2 {
  inputs 2
  operation multiply
  also_merge all
  name Multiply4
  xpos 1500
  ypos 614
 }
 Dot {
  name Dot30
  xpos 1534
  ypos 810
 }
 Merge2 {
  inputs 4+1
  operation plus
  bbox B
  output rgb
  name Merge3
  xpos 510
  ypos 1118
 }
 Expression {
  channel0 {rgba.red -rgba.green -rgba.blue none}
  expr0 pow(10,r)
  expr1 pow(10,g)
  expr2 pow(10,b)
  name Expression13
  xpos 510
  ypos 1238
 }
 Copy {
  inputs 2
  from0 rgba.alpha
  to0 rgba.alpha
  name Copy1
  xpos 510
  ypos 1496
 }
 Output {
  name Output1
  xpos 510
  ypos 1814
 }
end_group
Multiply {
 value 0.01
 name Multiply5
 xpos 231
 ypos 180
}
Expression {
 expr0 "y==floor(r(x, pos.y)*height*mult)?1:0"
 expr1 "y==floor(g(x, pos.y)*height*mult)?1:0"
 expr2 "y==floor(b(x, pos.y)*height*mult)?1:0"
 channel3 alpha
 name PlotScanline1
 xpos 231
 ypos 224
 addUserKnob {20 User}
 addUserKnob {12 pos}
 addUserKnob {7 mult R 0 5}
 mult 1
}
push $N4c0a8400
Shuffle2 {
 fromInput1 {{0} B}
 in1 zcam_J
 fromInput2 {{0} B}
 in2 zcam_M
 mappings "4 black -1 -1 rgba.red 0 0 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3 zcam_M.green 1 1 rgba.green 0 1"
 name Shuffle7
 xpos -30
 ypos 228
}
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 in2 zcam_h
 mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.alpha 0 3 rgba.alpha 0 3 zcam_h.blue 1 2 rgba.blue 0 2"
 name Shuffle8
 xpos -30
 ypos 252
}
push $N4c04b900
Shuffle2 {
 fromInput1 {{0} B}
 in1 zcam_M
 fromInput2 {{0} B}
 in2 zcam_h
 mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3 zcam_M.green 0 1 rgba.green 0 1"
 name Shuffle14
 xpos -34
 ypos 285
}
StickyNote {
 inputs 0
 name StickyNote1
 label "node = nuke.selectedNode()\n\nnodeToSample = nuke.selectedNode()\n\nvrange = range(0,1023)\n\nlutKnob = node.knob('lut')\n\nfor xPos in range(0,1024):\n    for yPos in reversed(range(0,1023)):\n        sample = nodeToSample.sample('rgba.green',xPos,yPos)\n        if sample > 0.00001:\n            print(sample)\n            node.knob('lut').setValueAt(sample,xPos,2)\n            break\n\n    print(xPos)\n    node.knob('lut').setValueAt(.5,xPos,2)"
 xpos -602
 ypos 318
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/aces-exr-1920/christophe-brejon/macbeth_spheres_001_lin_ap0.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 name Read2
 xpos 1359
 ypos -573
}
push $N2c878100
Dot {
 name Dot7
 xpos 398
 ypos 35
}
Saturation {
 saturation 0
 mode Average
 name Saturation1
 xpos 364
 ypos 146
}
Grade {
 channels rgba
 multiply 0.001
 name Grade5
 xpos 364
 ypos 175
}
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
 name Shuffle4
 xpos 364
 ypos 225
}
push $N4d569400
Expression {
 temp_name0 limit
 temp_expr0 clipped709_JMh.lut.green((g/360)+.5)*limitScale
 temp_name1 scaledVal
 temp_expr1 b/limit
 temp_name2 scale
 temp_expr2 1-thr
 expr2 "(scaledVal>thr? ( ((scaledVal-thr)/scale) / (((scaledVal-thr)/scale)+1) * scale + thr  )   : scaledVal ) * limit"
 channel3 alpha
 expr3 limit
 name clipToLimit
 xpos 858
 ypos 341
 addUserKnob {20 User}
 addUserKnob {7 limitScale R 0 100}
 limitScale 1.5
 addUserKnob {7 thr}
 thr 1
}
Shuffle2 {
 fromInput1 {{0} B}
 out1 zcam_M
 fromInput2 {{0} B}
 mappings "4 rgba.blue 0 2 zcam_M.red 0 0 rgba.blue 0 2 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.alpha 0 3"
 name Shuffle15
 xpos 858
 ypos 365
}
push $N4bc93c00
Copy {
 inputs 2
 from0 -rgba.alpha
 to0 -rgba.alpha
 channels zcam_M
 name Copy3
 xpos 706
 ypos 393
}
Grade {
 inputs 1+1
 channels zcam_M
 multiply 0
 name Grade4
 xpos 706
 ypos 451
}
Expression {
 temp_expr0 zcam_M.red
 temp_name1 max_at_h
 temp_expr1 Sampler1.lut.green(zcam_h.red)
 channel0 zcam_M
 expr0 Sampler1.lut.red(r)
 expr2 zcam_M.red>Sampler1.lut.green?r*1:zcam_M.red
 name Expression5
 xpos 706
 ypos 491
}
Group {
 name ZCAM1
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos 706
 ypos 515
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 direction inverse
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 inverseData1 M,h
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set N4d6c5000 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set N4db3b800 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $N4db3b800
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set N4db2b200 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $N4db2b200
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set N4db39c00 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set N4db39800 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $N4db39c00
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set N4db38c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set N4db38800 [stack 0]
push $N4db39c00
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set N4db38400 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set N4dacbc00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set N4dacb800 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set N4dacb400 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $N4db39800
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $N4db39c00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $N4db39c00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $N4db39c00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $N4d6c5000
push $N4db39800
push $N4db38c00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set N4dac9800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $N4dac9800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $N4db39800
push $N4db38800
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set N4dac8400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $N4dac8400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $N4db39800
push $N4db38400
push $N4db38c00
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set N4da62800 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set N4da62400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $N4da62400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $N4dacb800
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $N4da62800
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $N4dacb800
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $N4dacb400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $N4da62800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $N4db38800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $N4dacbc00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $N4db38c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $N4db38400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $N4db39800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $N4d6c5000
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set N5877d000 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set N5877c400 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $N5877c400
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $N5877d000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $N5877d000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $N5877d000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set N5870e800 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set N5870dc00 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $N5870dc00
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $N5870dc00
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set N5870cc00 [stack 0]
push $N5870cc00
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $N5877d000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $N5877d000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $N5870e800
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set N586bdc00 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $N586bdc00
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $N586bdc00
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set N586d7200 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set N586bcc00 [stack 0]
 Dot {
  name Dot44
  label C,h
  selected true
  xpos -1673
  ypos 2768
 }
push $N586d7200
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set N586bc400 [stack 0]
 Dot {
  name Dot20
  label M,h
  selected true
  xpos -1737
  ypos 2767
 }
push $N586d7200
push $N5877d000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set N5866f400 [stack 0]
push $N5877d000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set N5866e800 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set N586d6b00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $N586bcc00
push $N586bc400
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set N5866cc00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $N5866cc00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $N586d6b00
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set N4dc06800 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $N4dc06800
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set N586d5d00 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $N586d5d00
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $N5877d000
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $N5877d000
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $N5877d000
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $N586d6b00
push $N5877d000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $N5870e800
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $N5866f400
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $N5866e800
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $N586d7200
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
Multiply {
 value {{1/parent.Multiply3.value}}
 name Multiply2
 label "Div by 100 to go from nits"
 xpos 706
 ypos 567
}
Colorspace {
 colorspace_in CIE-XYZ
 name Colorspace6
 label "XYZ to sRGB Prims"
 xpos 706
 ypos 637
}
set N4db9c400 [stack 0]
Reformat {
 format "1024 1024 0 0 1024 1024 1 square_1K"
 resize height
 name Reformat7
 xpos 706
 ypos 769
}
set N5891fc00 [stack 0]
push $N5891fc00
Group {
 name PlotWaveform
 xpos 589
 ypos 825
 addUserKnob {20 Waveform_tab l Waveform}
 addUserKnob {41 useGPUIfAvailable l "Use GPU if available" T WaveForm.useGPUIfAvailable}
 addUserKnob {41 vectorize l "Vectorize on CPU" -STARTLINE T WaveForm.vectorize}
 addUserKnob {26 ""}
 addUserKnob {4 style M {fill add right bottom pip "" ""}}
 addUserKnob {6 guides t "draw guides at integer values (0, 1, 2 etc), and 0.18" -STARTLINE}
 guides true
 addUserKnob {6 split_rgb l "split rgb" t "separate rgb" -STARTLINE}
 addUserKnob {41 specifiedFormat l format t "specify the output format. Otherwise the input format will be used." -STARTLINE T WaveForm.specifiedFormat}
 addUserKnob {41 format l "" -STARTLINE T WaveForm.format}
 addUserKnob {6 log_transform l "log transform" t "display waveform in log (generic log2 shaper)" +STARTLINE}
 addUserKnob {6 antialias t "enable antialiasing" -STARTLINE}
 addUserKnob {7 max_value l "max value" t "The value to map to the top of frame. For example you may want to set this to the max pixel value in the image." R 1 25}
 max_value 1.5
 addUserKnob {7 min_value l "min value" R -1 0}
 addUserKnob {7 brightness t "multiply the brightness of the waveform"}
 brightness 0.2
 addUserKnob {22 set_max l "set max" t "Set's the max slider to the max pixel value on the current frame of the input image." T "n = nuke.thisNode()\nnuke.root().begin()\nn.begin()\nct = nuke.toNode('CT')\nnuke.execute(ct, nuke.frame(), nuke.frame())\nmaxpx = ct\['maxlumapixvalue'].getValue()\nave = (maxpx\[0] + maxpx\[1] + maxpx\[2])/3\nn\['max_value'].setValue(ave)" +STARTLINE}
 addUserKnob {41 box_size l pip_size t "set the picture in picture size" T Reformat3.box_size}
}
 Input {
  inputs 0
  name Input
  xpos 70
  ypos -226
 }
 AddChannels {
  name AddChannels1
  xpos 70
  ypos -184
 }
 Dot {
  name Dot1
  label " "
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 104
  ypos -102
 }
set N5891ec00 [stack 0]
 Reformat {
  format {{{parent.WaveForm.format}}}
  resize distort
  filter impulse
  name ReScale
  xpos 70
  ypos -58
  disable {{!parent.specifiedFormat}}
 }
set N5891e800 [stack 0]
 CurveTool {
  operation "Max Luma Pixel"
  ROI {0 0 {input.width} {input.height}}
  autocropdata {0 0 {input.width} {input.height}}
  maxlumapixdata {{curve x1 1047 x14 1800} {curve x1 2212 x14 436}}
  maxlumapixvalue {{curve x1 5.210135937 x14 3.869687557} {curve x1 10.19536495 x14 4.130000114} {curve x1 9.513872147 x14 3.160937548}}
  minlumapixdata {{curve x1 0 x14 380} {curve x1 26 x14 0}}
  minlumapixvalue {{curve x1 0.01240783278 x14 0} {curve x1 0.00967685692 x14 0} {curve x1 0.02308944985 x14 0}}
  name CT
  xpos -40
  ypos -58
 }
push $N5891e800
 BlinkScript {
  recompileCount 39
  KernelDescription "2 \"PlotWaveform\" iterate pixelWise 88b7f52352ee7ffcbd8d6465ec4ac2ee10c040557f69f3c5cce1cf1b8c43cde4 2 \"src\" Read Random \"dst\" Write Random 10 \"max_value\" Float 1 AAAAAA== \"min_value\" Float 1 AAAAAA== \"tolerance\" Float 1 AAAAAA== \"mult\" Float 1 AAAAAA== \"log_min\" Float 1 AAAAAA== \"log_max\" Float 1 AAAAAA== \"enable_log_transform\" Bool 1 AA== \"antialias\" Bool 1 AA== \"draw_lines\" Bool 1 AA== \"lines_color\" Float 4 AAAAAAAAAAAAAAAAAAAAAA== 10 \"max_value\" 1 1 \"min_value\" 1 1 \"tolerance\" 1 1 \"mult\" 1 1 \"log_min\" 1 1 \"log_max\" 1 1 \"enable_log_transform\" 1 1 \"antialias\" 1 1 \"draw_lines\" 1 1 \"lines_color\" 4 1 1 \"yscale\" Float 1 1 AAAAAA=="
  kernelSource "kernel PlotWaveform : public ImageComputationKernel<ePixelWise>\n\{\n  Image<eRead, eAccessRandom, eEdgeClamped> src;\n  Image<eWrite, eAccessRandom> dst;\n\n  param:\n    float max_value;\n    float min_value;\n    float tolerance;\n    float mult;\n    float log_min;\n    float log_max;\n    bool enable_log_transform;\n    bool antialias;\n    bool draw_lines;\n    float4 lines_color;\n\n  local:\n    float yscale;\n\n  void init() \{\n    yscale = dst.bounds.height() / max_value;\n  \}\n\n  float gaussian(float d, float a, float expv) \{\n    return max(0.0f, exp(-a*d*d)-expv);\n  \}\n\n  float gaussian_filter(float x, float y, float r) \{\n    // return gaussian weighted distance from origin (0, 0)\n    // given coordinate (x, y) and radius r\n    float a = 1.5f; // rate falloff\n    float expv = exp(-a*r*r);\n    return gaussian(x, a, expv) * gaussian(y, a, expv);\n  \}\n\n  void write(float x, float y, int k, float c) \{\n    // Write cubic antialiased pixel value c in channel k at continuous float position x, y\n    int n = 2;\n    int u0 = round(x);\n    int v0 = round(y);\n    // skip if center pixel weight is greater than tolerance\n    if ( dst.bounds.inside(u0, v0)) \{\n      if (dst(u0, v0, 3) >= tolerance) return;\n    \}\n    // loop over neighborhood\n    for (int j = -n; j <= n; j++) \{\n      int v = v0 + j;\n      for (int i = -n; i <= n; i++) \{\n        int u = u0 + i;\n        if ( dst.bounds.inside(u, v)) \{\n          // get filter weight for coord (u,v)\n          float w = gaussian_filter(u-x, v-y, float(n));\n          float c0 = dst(u, v, k); // existing color\n          // merge current color sample over existing color sample\n          dst(u, v, k) = c*w*mult+c0;\n          // merge current weight over existing weight\n          float w0 = dst(u, v, 3);\n          dst(u, v, 3) = w+w0*(1-w);\n        \}\n      \}\n    \}\n  \}\n\n  float log_transform(float x) \{\n    return x > 0.0f ? (log( x / 0.18f)/log(2.0f) - log_min) / (log_max - log_min) : x;\n  \}\n\n  void process(int2 pos) \{\n    float4 source = src(pos.x, pos.y);\n    if (enable_log_transform) \{\n      for (int k = 0; k < 3; k++)\{\n        source\[k] = log_transform(source\[k]);\n      \}\n    \}\n    float4 source_scaled = (source - min_value) * yscale;\n    if (antialias) \{\n      for (int k = 0; k < 3; k++)\{\n        write(pos.x, source_scaled\[k], k, source\[k]);\n      \}\n    \} else \{\n      for (int k = 0; k < 3; k++)\{\n        if ( dst.bounds.inside(pos.x, source_scaled\[k])) \{\n          dst(pos.x, source_scaled\[k], k) = source\[k]*mult + dst(pos.x, source_scaled\[k], k);\n          dst(pos.x, source_scaled\[k], 3) = 1.0f;\n        \}\n      \}\n    \}\n    if (draw_lines) \{\n      if (pos.x > 0 && pos.y > 0) return; // only draw the lines once\n      for (int i = 0; i < 50; i++) \{\n        float val = i;\n        if (enable_log_transform) val = log_transform(i);\n        for (int k = 0; k < 3; k++) \{\n          write(pos.x, (val - min_value)*yscale, k, lines_color\[k]);\n        \}\n      \}\n    \}\n  \}\n\};"
  rebuild ""
  PlotWaveform_max_value {{"parent.log_transform ? 1.01 : (parent.max_value+parent.min_value)"}}
  PlotWaveform_min_value {{parent.min_value}}
  PlotWaveform_tolerance 2
  PlotWaveform_mult {{parent.brightness}}
  PlotWaveform_log_min -6.5
  PlotWaveform_log_max 6.5
  PlotWaveform_enable_log_transform {{parent.log_transform}}
  PlotWaveform_antialias {{parent.antialias}}
  PlotWaveform_draw_lines {{parent.guides}}
  PlotWaveform_lines_color {0.6 0 0.02 1}
  format "2048 2048 0 0 2048 2048 1 square_2K"
  rebuild_finalise ""
  name WaveForm
  xpos 70
  ypos 32
 }
 Group {
  name RGB_Split
  selected true
  xpos 70
  ypos 110
  disable {{!parent.split_rgb}}
 }
  Input {
   inputs 0
   name Input
   xpos 45
   ypos -59
  }
  Reformat {
   type "to box"
   box_width {{rint(input.width/3)}}
   box_height {{input.height}}
   scale {1 1}
   resize none
   name Reformat4
   xpos 45
   ypos 1
  }
  Dot {
   name Dot18
   label " "
   note_font_size 24
   note_font_color 0xa5a5a501
   xpos 79
   ypos 53
  }
set N5891cc00 [stack 0]
  Dot {
   name Dot19
   label " "
   note_font_size 24
   note_font_color 0xa5a5a501
   xpos 189
   ypos 53
  }
  Expression {
   expr0 0
   expr1 0
   expr2 b
   expr3 a
   name Expression3
   xpos 155
   ypos 97
  }
push $N5891cc00
  Expression {
   expr0 0
   expr1 g
   expr2 0
   expr3 a
   name Expression2
   xpos 45
   ypos 97
  }
push $N5891cc00
  Dot {
   name Dot17
   label " "
   note_font_size 24
   note_font_color 0xa5a5a501
   xpos -31
   ypos 53
  }
  Expression {
   expr0 r
   expr1 0
   expr2 0
   expr3 a
   name Expression1
   xpos -65
   ypos 97
  }
  ContactSheet {
   inputs 3
   width {{parent.input.width}}
   height {{parent.input.height}}
   rows 1
   columns 3
   roworder TopBottom
   name ContactSheet1
   selected true
   xpos 45
   ypos 152
  }
  Output {
   name Output
   xpos 45
   ypos 241
  }
 end_group
 Keyer {
  operation "luminance key"
  name Keyer1
  xpos 70
  ypos 176
 }
 Dot {
  name Dot5
  label " "
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 104
  ypos 234
 }
set N588d2400 [stack 0]
 Dot {
  name Dot3
  label " Fill"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 104
  ypos 378
 }
 Dot {
  name Dot13
  label " "
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 104
  ypos 444
 }
set N588d1c00 [stack 0]
 Shuffle {
  alpha white
  name Shuffle1
  label "\[value in] -> \[value out]"
  xpos 747
  ypos 420
 }
 Reformat {
  type "to box"
  box_width {{"min(input.width, parent.Input.width*box_size)"}}
  scale 0.5
  filter notch
  black_outside true
  pbb true
  name Reformat3
  xpos 747
  ypos 465
  addUserKnob {20 User}
  addUserKnob {7 box_size R 0.05 0.6}
  box_size 0.3
 }
push $N5891ec00
 Dot {
  name Dot8
  label " "
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 324
  ypos -102
 }
set N588d0c00 [stack 0]
 Dot {
  name Dot2
  label " "
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 544
  ypos -102
 }
 BlackOutside {
  name BlackOutside2
  xpos 510
  ypos 14
 }
set N588d0400 [stack 0]
 Dot {
  name Dot7
  label " "
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 764
  ypos 18
 }
set N5888bc00 [stack 0]
 Dot {
  name Dot14
  label " "
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 874
  ypos 18
 }
 Merge2 {
  inputs 2
  bbox B
  name Merge4
  xpos 840
  ypos 518
 }
 Dot {
  name Dot11
  label PIP
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 874
  ypos 570
 }
push $N588d2400
 Dot {
  name Dot9
  label " "
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 214
  ypos 234
 }
set N5888ac00 [stack 0]
 Reformat {
  type "to box"
  box_width {{parent.Input.width}}
  box_height {{parent.Input.height}}
  box_fixed true
  resize none
  center false
  black_outside true
  name Reformat1
  xpos 400
  ypos 230
 }
 BlackOutside {
  name BlackOutside1
  xpos 400
  ypos 254
 }
set N5888a000 [stack 0]
 Position {
  translate {0 {-parent.input.height}}
  name MoveDown
  xpos 620
  ypos 254
  disable true
 }
push $N5888bc00
 Crop {
  box {0 {-parent.input.height} {input.width} {input.height}}
  reformat true
  crop false
  name Crop2
  xpos 730
  ypos 182
 }
 Merge2 {
  inputs 2
  name Merge2
  xpos 730
  ypos 326
 }
 Dot {
  name Dot6
  label " Bottom"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 764
  ypos 378
 }
push $N5888a000
 Position {
  translate {{parent.input.width} 0}
  name MoveRight
  xpos 400
  ypos 278
 }
push $N588d0400
 Crop {
  box {0 0 {parent.MoveRight.bbox.r} {input.height}}
  reformat true
  crop false
  name Crop1
  xpos 510
  ypos 278
 }
 Merge2 {
  inputs 2
  name Merge1
  xpos 510
  ypos 326
 }
 Dot {
  name Dot4
  label " Right"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 544
  ypos 378
 }
push $N5888ac00
 Reformat {
  type "to box"
  box_width {{parent.input.width}}
  box_height {{parent.input.height}}
  box_fixed true
  resize distort
  center false
  black_outside true
  name Reformat2
  xpos 180
  ypos 279
 }
push $N588d0c00
 Dot {
  name Dot12
  label " "
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 324
  ypos 190
 }
 Merge2 {
  inputs 2
  bbox B
  name Merge3
  xpos 290
  ypos 279
 }
 Dot {
  name Dot10
  label " Add"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 324
  ypos 378
 }
push $N588d1c00
 Switch {
  inputs 5
  which {{parent.style}}
  name SwitchStyle
  xpos 70
  ypos 566
 }
 Output {
  name Output
  xpos 70
  ypos 710
 }
end_group
ContactSheet {
 inputs 2
 width 2048
 height 1024
 rows 1
 columns 2
 name ContactSheet3
 xpos 706
 ypos 892
}
Colorspace {
 colorspace_out sRGB
 name Colorspace12
 xpos 706
 ypos 916
}
Write {
 file /Users/afry/GitHub/nukeZCAM/images/examples/ramp_Colour_histo_v001.png
 raw true
 file_type png
 checkHashOnRead false
 version 4
 in_colorspace scene_linear
 out_colorspace scene_linear
 name Write3
 xpos 706
 ypos 960
}
push $N2c83b400
Colorspace {
 colorspace_in CIE-XYZ
 name Colorspace7
 label "XYZ to sRGB Prims"
 xpos 880
 ypos -95
}
push $N2c878100
LayerContactSheet {
 width {{input.width*columns}}
 height {{input.height*rows}}
 rows 5
 autodims false
 showLayerNames true
 name LayerContactSheet1
 xpos 881
 ypos 13
}
Group {
 inputs 0
 name ZCAM4
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos 2872
 ypos 438
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set N58c38400 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set N58bd2c00 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $N58bd2c00
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set N58b9f200 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $N58b9f200
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set N58bd1000 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set N58bd0c00 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $N58bd1000
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set N58b57c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set N58b57800 [stack 0]
push $N58bd1000
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set N58b57400 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set N58b57000 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set N58b56c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set N58b56800 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $N58bd0c00
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $N58bd1000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $N58bd1000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $N58bd1000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $N58c38400
push $N58bd0c00
push $N58b57c00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set N58b54c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $N58b54c00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $N58bd0c00
push $N58b57800
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set N58af3400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $N58af3400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $N58bd0c00
push $N58b57400
push $N58b57c00
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set N58af1c00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set N58af1800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $N58af1800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $N58b56c00
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $N58af1c00
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $N58b56c00
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $N58b56800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $N58af1c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $N58b57800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $N58b57000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $N58b57c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $N58b57400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $N58bd0c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $N58c38400
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set N58a0c400 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set N58997400 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $N58997400
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $N58a0c400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $N58a0c400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $N58a0c400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set N58995c00 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set N58995000 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $N58995000
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $N58995000
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set N58fd3c00 [stack 0]
push $N58fd3c00
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $N58a0c400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $N58a0c400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $N58995c00
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set N58fd1000 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $N58fd1000
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $N58fd1000
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set N5895b200 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set N58f7fc00 [stack 0]
 Dot {
  name Dot44
  label C,h
  selected true
  xpos -1673
  ypos 2768
 }
push $N5895b200
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set N58f7f400 [stack 0]
 Dot {
  name Dot20
  label M,h
  selected true
  xpos -1737
  ypos 2767
 }
push $N5895b200
push $N58a0c400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set N58f7e800 [stack 0]
push $N58a0c400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set N58f7dc00 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set N5895ab00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $N58f7fc00
push $N58f7f400
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set N58f17c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $N58f17c00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $N5895ab00
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set N58f15c00 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $N58f15c00
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set N58959d00 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $N58959d00
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $N58a0c400
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $N58a0c400
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $N58a0c400
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $N5895ab00
push $N58a0c400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $N58995c00
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $N58f7e800
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $N58f7dc00
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $N5895b200
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
Group {
 inputs 0
 name ZCAM5
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos 2871
 ypos 543
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 direction inverse
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 inverseData1 M,h
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set N5924b000 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set N59249c00 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $N59249c00
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set N59240100 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $N59240100
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set N591c3c00 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set N591c3800 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $N591c3c00
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set N591c2c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set N591c2800 [stack 0]
push $N591c3c00
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set N591c2400 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set N591c2000 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set N591c1c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set N591c1800 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $N591c3800
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $N591c3c00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $N591c3c00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $N591c3c00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $N5924b000
push $N591c3800
push $N591c2c00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set N5915b800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $N5915b800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $N591c3800
push $N591c2800
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set N5915a400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $N5915a400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $N591c3800
push $N591c2400
push $N591c2c00
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set N59158c00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set N59158800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $N59158800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $N591c1c00
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $N59158c00
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $N591c1c00
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $N591c1800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $N59158c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $N591c2800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $N591c2000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $N591c2c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $N591c2400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $N591c3800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $N5924b000
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set N58fff000 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set N58ffe400 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $N58ffe400
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $N58fff000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $N58fff000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $N58fff000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set N58ffcc00 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set N593b3c00 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $N593b3c00
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $N593b3c00
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set N593b2c00 [stack 0]
push $N593b2c00
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $N58fff000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $N58fff000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $N58ffcc00
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set N5935fc00 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $N5935fc00
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $N5935fc00
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set N591d0100 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set N5935ec00 [stack 0]
 Dot {
  name Dot44
  label C,h
  xpos -1673
  ypos 2768
 }
push $N591d0100
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set N5935e400 [stack 0]
 Dot {
  name Dot20
  label M,h
  xpos -1737
  ypos 2767
 }
push $N591d0100
push $N58fff000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set N5935d800 [stack 0]
push $N58fff000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set N5935cc00 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set N59323900 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $N5935ec00
push $N5935e400
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set N59306c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $N59306c00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $N59323900
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set N59304c00 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $N59304c00
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set N59322b00 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $N59322b00
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $N58fff000
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $N58fff000
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $N58fff000
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $N59323900
push $N58fff000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $N58ffcc00
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $N5935d800
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $N5935cc00
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $N591d0100
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
Constant {
 inputs 0
 channels rgb
 color {1 1 1 0}
 name Constant4
 xpos 1407
 ypos 1021
}
Group {
 name ZCAM7
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos 1413
 ypos 1122
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set N59625c00 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set N59624800 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $N59624800
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set N59600800 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $N59600800
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set N595ae800 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set N595ae400 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $N595ae800
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set N595ad800 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set N595ad400 [stack 0]
push $N595ae800
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set N595ad000 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set N595acc00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set N595ac800 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set N595ac400 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $N595ae400
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $N595ae800
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $N595ae800
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $N595ae800
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $N59625c00
push $N595ae400
push $N595ad800
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set N59536400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $N59536400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $N595ae400
push $N595ad400
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set N59535000 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $N59535000
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $N595ae400
push $N595ad000
push $N595ad800
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set N594c7400 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set N594c7000 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $N594c7000
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $N595ac800
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $N594c7400
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $N595ac800
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $N595ac400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $N594c7400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $N595ad400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $N595acc00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $N595ad800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $N595ad000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $N595ae400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $N59625c00
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set N593f5c00 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set N593f5000 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $N593f5000
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $N593f5c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $N593f5c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $N593f5c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set N59787400 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set N59786800 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $N59786800
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $N59786800
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set N59785800 [stack 0]
push $N59785800
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $N593f5c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $N593f5c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $N59787400
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set N59742800 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $N59742800
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $N59742800
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set N59518800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set N59741800 [stack 0]
 Dot {
  name Dot44
  label C,h
  selected true
  xpos -1673
  ypos 2768
 }
push $N59518800
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set N59741000 [stack 0]
 Dot {
  name Dot20
  label M,h
  selected true
  xpos -1737
  ypos 2767
 }
push $N59518800
push $N593f5c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set N59740400 [stack 0]
push $N593f5c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set N596f3400 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set N59518100 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $N59741800
push $N59741000
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set N596f1800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $N596f1800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $N59518100
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set N59a67400 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $N59a67400
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set N59ac3200 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $N59ac3200
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $N593f5c00
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $N593f5c00
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $N593f5c00
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $N59518100
push $N593f5c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $N59787400
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $N59740400
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $N596f3400
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $N59518800
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
Shuffle2 {
 fromInput1 {{0} B}
 in1 zcam_M
 fromInput2 {{0} B}
 mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
 name Shuffle27
 xpos 1413
 ypos 1204
}
push $N4d56a400
ColorLookup {
 lut {master {}
   red {}
   green {curve 35.93902588 35.93735504 35.93753433 35.83887863 35.84093094 35.83343124 35.83169174 35.8393631 35.74020004 35.74031067 35.74192429 35.73725891 35.74119949 35.73592377 35.74422836 35.64019394 35.64123917 35.64620209 35.63986588 35.64028549 35.64251328 35.64444351 35.64264679 35.64365768 35.64627838 35.6400528 35.64422607 35.6402359 35.64598846 35.64023209 35.64229584 35.64193344 35.64261246 35.64746094 35.63682556 35.64370728 35.74347687 35.74534988 35.74236679 35.73675537 35.73838425 35.74174118 35.73894882 35.83584213 35.8412323 35.84160233 35.83996201 35.93353271 35.93379593 35.9345932 35.93690109 35.9334259 36.02864838 36.02735901 36.03026199 36.13125229 36.12955475 36.1228981 36.22369385 36.23100662 36.23028183 36.32764435 36.32866287 36.32495499 36.42479706 36.43197632 36.51892853 36.52161789 36.62269974 36.62142944 36.72122574 36.71898651 36.81211853 36.81745148 36.91525269 36.91080475 37.00736618 37.01118469 37.11250305 37.10976791 37.20728302 37.302845 37.30813217 37.40581512 37.49928665 37.49621201 37.59971619 37.69556808 37.69856644 37.7942009 37.89320374 37.8953743 37.9887886 38.0848999 38.18097687 38.28239059 38.27840424 38.37966919 38.47603607 38.57341003 38.67168808 38.76914978 38.86764526 38.96129608 39.06372833 39.0587883 39.16090012 39.25426865 39.35076523 39.54669952 39.65062332 39.74605942 39.84653854 39.94113922 40.04415131 40.13307953 40.23431778 40.33208847 40.53032684 40.62407303 40.72422791 40.81940079 41.0147171 41.11276627 41.205616 41.40884781 41.50452805 41.59882736 41.79209137 41.89821625 42.08958435 42.18856049 42.38302612 42.47993469 42.67907715 42.87290573 42.97105789 43.16693115 43.35734177 43.45572662 43.65342712 43.84939194 44.04508972 44.23981476 44.33708954 44.52936935 44.72503662 44.91989517 45.11779785 45.31217575 45.50875854 45.802948 45.9931488 46.19252777 46.38772964 46.6788559 46.87607193 47.06939697 47.36288071 47.56106949 47.85041046 48.04606628 48.33797073 48.63450241 48.8302803 49.12152863 49.41314697 49.70755768 50.00176239 50.29244232 50.58903885 50.88072586 51.26889801 51.55887222 51.85607529 52.24630737 52.53870773 52.92798233 53.32294083 53.70902634 54.10313034 54.4930191 54.8834877 55.27364731 55.76058578 56.14982986 56.63882065 57.02841568 57.52117157 58.00784683 58.59671783 59.08158493 59.66658783 60.15639496 60.74389267 61.42667007 62.0124588 62.69457626 63.37681198 64.06443024 64.74681854 65.52774048 66.31021881 67.18876648 68.06681061 69.04246521 70.01992035 71.0954361 72.26702881 73.5359726 75.00061798 76.46730042 78.22219849 80.27219391 82.81466675 86.32720947 92.77294159 92.47978973 92.18859863 91.79653168 91.50267029 91.20867157 90.91717529 90.62378693 90.33008575 90.03785706 89.74498749 89.45091248 89.16085052 88.86864471 88.67375946 88.37815094 88.085495 87.79483795 87.59604645 87.30580902 87.0121994 86.81477356 86.52365112 86.23173523 86.03422546 85.74343109 85.54766846 85.25550842 85.06121063 84.76651764 84.57078552 84.2778244 84.08197021 83.88652039 83.59406281 83.39922333 83.20137787 82.91230011 82.71536255 82.5194397 82.32489014 82.12976074 81.83760071 81.63871002 81.44684601 81.25106812 81.05558777 80.85884857 80.66533661 80.46903229 80.27294922 80.07853699 79.88320923 79.68422699 79.49024963 79.29807281 79.09967804 78.90900421 78.71144867 78.5160141 78.41762543 78.22486877 78.02793121 77.8327713 77.63743591 77.538414 77.34404755 77.14785004 76.95386505 76.85432434 76.66082001 76.46557617 76.36669922 76.17180634 75.97953033 75.87796783 75.68638611 75.58480835 75.39293671 75.19451904 75.09546661 74.90167236 74.80386353 74.60942078 74.51292419 74.31633759 74.22088623 74.02400208 73.9262619 73.82820129 73.63532257 73.5329361 73.34237671 73.24393463 73.14796448 72.94664001 72.85445404 72.75701141 72.55846405 72.46213531 72.36598969 72.16790009 72.06879425 71.97034454 71.87717438 71.68063354 71.58218384 71.48220062 71.38748932 71.18919373 71.09493256 70.99671173 70.89975739 70.80356598 70.70063019 70.50937653 70.41379547 70.31585693 70.21424103 70.11564636 70.02377319 69.92427826 69.82659912 69.72718811 69.52993011 69.43439484 69.33586884 69.23802185 69.14391327 69.04188538 68.94511414 68.85124969 68.75066376 68.65606689 68.55521393 68.45934296 68.36096954 68.25971222 68.16757965 68.16598511 68.0719986 67.96924591 67.87125397 67.77245331 67.67298126 67.58018494 67.48213196 67.38024139 67.28182983 67.28593445 67.18592072 67.08972931 66.98931122 66.89664459 66.79805756 66.79642487 66.70214081 66.59933472 66.50008392 66.41074371 66.40585327 66.3109436 66.20988464 66.1124649 66.11530304 66.0152359 65.91700745 65.8237381 65.81882477 65.72261047 65.63230896 65.52981567 65.52659607 65.43000031 65.33524323 65.33707428 65.23472595 65.13607788 65.1364212 65.04023743 64.94284821 64.9420929 64.84729767 64.7466507 64.74583435 64.65124512 64.64472961 64.55191803 64.45690918 64.45206451 64.35195923 64.35571289 64.25643158 64.16059113 64.16474915 64.06148529 64.06513977 63.97050858 63.9621048 63.86985397 63.8689003 63.77021408 63.77110672 63.67314148 63.67557907 63.57141876 63.57269287 63.47716904 63.47528076 63.37807083 63.38178635 63.28870773 63.28250885 63.18983078 63.17935944 63.08506393 63.08610153 63.08560181 62.98813629 62.98815918 62.89539337 62.89074326 62.89227676 62.79391861 62.80060577 62.69675446 62.69349289 62.6987114 62.59804153 62.60001373 62.59631348 62.50022888 62.49723434 62.50081253 62.40248871 62.40455627 62.40127182 62.30357361 62.30435562 62.30903625 62.20350266 62.20768356 62.20788956 62.21188354 62.11141586 62.10919189 62.10776138 62.10743332 62.01356506 62.01385498 62.01596069 62.00792313 62.00862503 61.91064835 61.9157753 61.91419601 61.91669464 61.91671753 61.82128525 61.82202148 61.8179512 61.81774902 61.82175064 61.81283188 61.8212204 61.72205734 61.71910858 61.71814346 61.71916962 61.71774292 61.7182312 61.71863937 61.72136688 61.71554947 61.71817398 61.62194443 61.62340546 61.62140274 61.62311172 61.62061691 61.61877823 61.62100601 61.62590027 61.623703 61.6206665 61.6184845 61.6190834 61.62500381 61.61876297 61.62221146 61.62573624 61.6214447 61.72372818 61.71715546 61.71935272 61.72673798 61.71169281 61.72066116 61.72264099 61.71887207 61.72253418 61.72341156 61.81517792 61.81740189 61.81483459 61.81319809 61.8238678 61.82185364 61.81326675 61.91387558 61.91043091 61.91744995 61.91103363 61.91780472 62.01591873 62.01387787 62.01602554 62.01297379 62.11548996 62.1067276 62.11439133 62.11171722 62.20619965 62.20685196 62.20759964 62.30322266 62.31111908 62.30070496 62.40403748 62.40358353 62.4039917 62.50132751 62.49913025 62.60264587 62.59640503 62.59876633 62.69623947 62.69539261 62.79282761 62.79143906 62.79136276 62.8872757 62.89276123 62.98524094 62.98807907 63.09153748 63.08860397 63.18286896 63.18919754 63.28068161 63.38180542 63.38282013 63.47850037 63.47373581 63.5747261 63.57614136 63.66799927 63.76377106 63.76695633 63.86920547 63.8690834 63.96191788 64.0622406 64.06108093 64.16133118 64.2569809 64.3600769 64.3585434 64.45617676 64.55487823 64.55782318 64.64794922 64.74227905 64.84680939 64.94369507 64.94055939 65.04627228 65.13388062 65.23962402 65.33287811 65.4275589 65.52989197 65.53150177 65.62509918 65.7230835 65.81693268 65.91795349 66.01490021 66.11055756 66.21057129 66.30930328 66.40958405 66.50550079 66.59815979 66.70316315 66.79588318 66.89571381 66.99430847 67.08624268 67.19080353 67.38208771 67.4837265 67.58010864 67.68003082 67.77623749 67.87133026 67.96807098 68.16547394 68.26278687 68.36183167 68.45191193 68.65579987 68.75180817 68.84950256 69.0428009 69.14099884 69.23834229 69.43442535 69.53222656 69.632164 69.82555389 69.92132568 70.11766052 70.11710358 69.63220978 69.24219513 68.75249481 68.36241913 67.87065887 67.47970581 67.09386444 66.60186768 66.20877838 65.81997681 65.42755127 65.03684998 64.65388489 64.35582733 63.96272278 63.57807922 63.18227768 62.88772202 62.50184631 62.20812607 61.81761932 61.52979279 61.13270569 60.8433075 60.54949188 60.24839401 59.86664963 59.57280731 59.27680588 58.98794174 58.69143295 58.395401 58.10408783 57.81227493 57.52017593 57.22842026 56.93185806 56.73752975 56.44951248 56.15695953 55.8586235 55.66687393 55.37416458 55.17963409 54.88437271 54.5905571 54.39528656 54.09878922 53.90460968 53.6129303 53.41859436 53.22289658 52.93015289 52.73370361 52.5394783 52.24549103 52.04938126 51.85460281 51.66251755 51.36879349 51.17526627 50.97798538 50.78419113 50.59011459 50.29180908 50.09874725 49.9030304 49.70691299 49.51330948 49.31416321 49.12406921 48.93008041 48.73166275 48.5334053 48.34260941 48.1462822 47.9478035 47.75603104 47.56013489 47.36261749 47.26512909 47.07024765 46.8780098 46.67582703 46.48662567 46.28880692 46.18995285 45.99759293 45.79856491 45.60540009 45.40980911 45.31474304 45.11869049 44.92122269 44.82301712 44.62847519 44.43479538 44.23583221 44.14387131 43.94570923 43.75009537 43.6511879 43.45724106 43.3602829 43.16654968 43.06821442 42.87141037 42.77432632 42.57572937 42.48049927 42.28443146 42.18509674 42.09146881 41.89381027 41.79674149 41.70076752 41.60007095 41.4064827 41.30747986 41.21148682 41.11444473 41.01685715 41.01596832 40.91708374 40.8192215 40.72195816 40.72220612 40.62486267 40.62443542 40.62629318 40.52801132 40.52706528 40.52642441 40.52826309 40.52755737 40.52542496 40.62447739 40.62583542 40.62650299 40.72006607 40.722332 40.82121658 40.91996765 40.9183197 41.01393509 41.11212921 41.20765305 41.30715561 41.40750504 41.50414658 41.60311508 41.69623566 41.79405594 41.89445114 41.99298477 42.08938599 42.28832626 42.38425064 42.48408127 42.57555771 42.67367172 42.87223816 42.96618271 43.06409073 43.25631714 43.35832977 43.45511246 43.65016556 43.75005341 43.85033035 44.04236984 44.14174652 44.23405457 44.43339539 44.53247452 44.72551727 44.82435226 45.01816177 45.1144371 45.21289062 45.40856552 45.5055809 45.70195007 45.79958725 45.99597549 46.09237671 46.28448486 46.3854866 46.58003998 46.68035126 46.87126541 46.97217941 47.16590118 47.36387634 47.45806503 47.65653992 47.75207901 47.9508667 48.14645004 48.23873138 48.43315125 48.63419724 48.7325592 48.92672729 49.12291336 49.21957779 49.41174698 49.60598373 49.80088806 49.90135193 50.09980774 50.29282761 50.49066162 50.68149948 50.88059235 50.97676849 51.16749191 51.3680687 51.56032944 51.75828552 51.95176697 52.14532471 52.34380341 52.54034042 52.73302078 52.9310379 53.12508392 53.32193756 53.51812363 53.80844879 54.00219727 54.19412994 54.39422607 54.68812943 54.8812294 55.07985687 55.27775192 55.56428146 55.75908279 56.05290985 56.2503891 56.44662857 56.74081802 56.93344116 57.22630692 57.51855469 57.71522141 58.00474548 58.29778671 58.4928894 58.10174942 57.51724243 57.02995682 56.54502487 56.05408478 55.66115189 55.17497635 54.78374481 54.29734039 53.89680481 53.51512146 53.12183762 52.73596191 52.34302139 51.95048523 51.6583519 51.26992416 50.97431564 50.58506012 50.29478836 50.00054169 49.70521164 49.41481781 49.12256622 48.82258987 48.528759 48.23807907 47.94736099 47.65626907 47.45898438 47.16497421 46.96705246 46.67845535 46.48375702 46.19107056 45.99602509 45.80202484 45.51155853 45.31067276 45.11905289 44.92168808 44.72563934 44.53132248 44.33517075 44.13421631 43.941185 43.75241852 43.55344391 43.35908508 43.15803528 43.06006241 42.87314987 42.67250443 42.57690048 42.37783051 42.18070602 42.09049988 41.89379883 41.79845428 41.60339737 41.50534439 41.31389618 41.20898438 41.11144638 40.91736603 40.82047653 40.72212219 40.52598953 40.42882156 40.33652496 40.23299789 40.03804779 39.9419899 39.84508514 39.74180603 39.64971542 39.5467186 39.44969177 39.35247803 39.25508881 39.0634079 38.96280289 38.86997223 38.8663559 38.77120209 38.67147827 38.56869125 38.48201752 38.37813187 38.28376007 38.18398285 38.07896805 38.08473587 37.98754883 37.89468384 37.79115295 37.79249573 37.692276 37.59499741 37.49941254 37.50154114 37.40305328 37.30319977 37.29952621 37.20677948 37.10554123 37.11078262 37.009758 37.01052094 36.90775299 36.91514587 36.81627274 36.80949402 36.71221542 36.71870422 36.62062454 36.6251297 36.5263443 36.52375793 36.42905426 36.42491913 36.32607269 36.32991409 36.32505417 36.22491074 36.2259407 36.22787094 36.13265228 36.13449478 36.1322937 36.03222275 36.02610779 36.03511047 35.93461227 x1125.702881 0}
   blue {}
   alpha {}}
 name clipped709_JMh
 xpos 160
 ypos 442
}
push $N4d56ac00
Multiply {
 value 0.01
 name Multiply8
 xpos 171
 ypos 320
}
push $N4d56a400
Sampler {
 sampler {0 1024}
 lut {red {curve 0.4999994338 x0.0009775171056 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.0175953079 0.4999994338 0.4999994338 x0.01955034211 0.4999994338 0.4999994338 x0.02150537632 0.4999994338 0.4999994338 x0.02346041054 0.4999994338 0.4999994338 x0.02541544475 0.4999994338 0.4999994338 x0.02737047896 0.4999994338 0.4999994338 x0.02932551317 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.03421309963 0.4999994338 x0.0351906158 0.4999994338 0.4999994338 x0.03714565188 0.4999994338 x0.03812316805 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.04203323647 0.4999994338 x0.04301075265 0.4999994338 0.4999994338 x0.04496578872 0.4999994338 x0.0459433049 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.04985337332 0.4999994338 x0.05083088949 0.4999994338 0.4999994338 x0.05278592557 0.4999994338 x0.05376344174 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.05767351016 0.4999994338 x0.05865102634 0.4999994338 0.4999994338 x0.06060606241 0.4999994338 x0.06158357859 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.06744868308 0.4999994338 x0.06842619926 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.07429130375 0.4999994338 x0.07526881993 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.08308895677 0.4999994338 x0.08406647295 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.08993157744 0.4999994338 x0.09090909362 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.09872923046 0.4999994338 x0.09970674664 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.1055718511 0.4999994338 x0.1065493673 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.1143695042 0.4999994338 x0.1153470203 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.1212121248 0.4999994338 x0.122189641 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.13391985 0.4999994338 x0.1348973662 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.1485826075 0.4999994338 x0.1495601237 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.1652003974 0.4999994338 x0.1661779135 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.1798631549 0.4999994338 x0.1808406711 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.1964809448 0.4999994338 x0.1974584609 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.2111437023 0.4999994338 x0.2121212184 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.2277614921 0.4999994338 x0.2287390083 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.2424242496 0.4999994338 x0.2434017658 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.2668621838 0.50000453 x0.2678397 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.297165215 0.4999994338 x0.2981427312 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.3294232786 0.4999994338 x0.3304007947 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.3597263098 0.4999994338 x0.360703826 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.3919843733 0.4999994338 x0.3929618895 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999943078 0.4999994338 0.4999994338 0.4999994338 x0.4222874045 0.50000453 x0.4232649207 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999943078 0.50000453 0.4999994338 x0.4545454681 0.4999994338 x0.4555229843 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 x0.4848484993 0.4999994338 x0.4858260155 0.4999994338 0.50000453 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.50000453 0.4999994338 0.4999994338 0.4999994338 x0.5327468514 0.4999994338 x0.5337243676 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999943078 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.50000453 0.50000453 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.50000453 0.50000453 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.59433043 0.50000453 x0.5953079462 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.50000453 0.50000453 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.50000453 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999943078 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.50000453 x0.657869041 0.50000453 x0.6588465571 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 x0.7194526196 0.4999994338 x0.7204301357 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.50000453 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.7829912305 0.4999994338 x0.7839687467 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.8445748091 0.4999994338 x0.8455523252 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.90811342 0.4999994338 x0.9090909362 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 x0.9696969986 0.4999994338 x0.9706745148 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338 0.4999994338}
   green {curve L 31.83551025 x0.2008529007 67.20974731 x0.4523992836 48.30766296 x0.7116855383 55.49045563 x1 32.42992401}
   blue {curve 176.3074646 x0.0009775171056 177.0280914 177.7571869 178.4942322 179.2392273 179.9922638 -179.2472992 -178.479187 -177.7039795 -176.9217072 -176.1325684 -175.3365326 -174.5341339 -173.7257385 -172.9119873 -172.0919952 -171.266983 -170.4371643 x0.0175953079 -169.602829 -168.7641754 x0.01955034211 -167.9215698 -167.0754852 x0.02150537632 -166.2264252 -165.3747406 x0.02346041054 -164.5200958 -163.6639252 x0.02541544475 -162.8060608 -161.9472046 x0.02737047896 -161.0873566 -160.2277985 x0.02932551317 -159.3677216 -158.5079498 -157.6496429 -156.7921448 -155.9369202 x0.03421309963 -155.0839233 x0.0351906158 -154.2322235 -153.3852234 x0.03714565188 -152.5402985 x0.03812316805 -151.6991882 -150.8624268 -150.0299683 -149.2024078 x0.04203323647 -148.3795776 x0.04301075265 -147.5618591 -146.750412 x0.04496578872 -145.9447327 x0.0459433049 -145.1459045 -144.3528137 -143.5679016 -142.7877045 x0.04985337332 -142.0164185 x0.05083088949 -141.2518311 -140.4963074 x0.05278592557 -139.7462158 x0.05376344174 -139.005249 -138.2719269 -137.548172 -136.8309937 x0.05767351016 -136.1222534 x0.05865102634 -135.4241028 -134.7341309 x0.06060606241 -134.05159 x0.06158357859 -133.3782196 -132.7133179 -132.0571442 -131.4104004 -130.7727966 -130.1426239 x0.06744868308 -129.522522 x0.06842619926 -128.9105835 -128.3085022 -127.7154312 -127.1300583 -126.5534363 -125.9847031 x0.07429130375 -125.425354 x0.07526881993 -124.8750687 -124.3319931 -123.7979813 -123.2726822 -122.7547607 -122.2436981 -121.7437973 -121.2499313 x0.08308895677 -120.7644043 x0.08406647295 -120.2854309 -119.8148041 -119.3534775 -118.8982086 -118.448616 -118.008667 x0.08993157744 -117.5756378 x0.09090909362 -117.1491013 -116.729454 -116.3167343 -115.9108429 -115.51091 -115.119072 -114.7330475 -114.3529434 x0.09872923046 -113.9781723 x0.09970674664 -113.6104889 -113.249382 -112.8935471 -112.5442276 -112.2000732 -111.8623428 x0.1055718511 -111.52845 x0.1065493673 -111.2017288 -110.8795624 -110.5628052 -110.2510147 -109.9444885 -109.6428528 -109.3468246 -109.055542 x0.1143695042 -108.7678223 x0.1153470203 -108.4855499 -108.2086868 -107.9344864 -107.6659698 -107.4015884 -107.1413269 x0.1212121248 -106.8857956 x0.122189641 -106.6342621 -106.3863449 -106.1434937 -105.9036942 -105.6673813 -105.4352646 -105.2072678 -104.981575 -104.7609863 -104.543251 -104.3295898 -104.1191254 x0.13391985 -103.9121552 x0.1348973662 -103.7073288 -103.5073776 -103.3097305 -103.1152573 -102.9236908 -102.7361832 -102.5513687 -102.3686981 -102.1893463 -102.0124664 -101.8391266 -101.6685944 -101.500885 -101.3352051 x0.1485826075 -101.1719742 x0.1495601237 -101.0114288 -100.8541794 -100.698967 -100.5457458 -100.3954391 -100.2480164 -100.1019135 -99.9582901 -99.81784821 -99.67919922 -99.54303741 -99.40869141 -99.27676392 -99.14633179 -99.0191803 -98.89281464 x0.1652003974 -98.76908875 x0.1661779135 -98.64769745 -98.52738953 -98.409935 -98.29354858 -98.17910767 -98.06780243 -97.95747375 -97.84875488 -97.74217224 -97.63750458 -97.53403473 -97.43332672 -97.3335495 -97.23551941 x0.1798631549 -97.13896942 x0.1808406711 -97.04425049 -96.95212555 -96.85972595 -96.77013397 -96.68202972 -96.59484863 -96.50952148 -96.42649841 -96.3445816 -96.26344299 -96.18431091 -96.10641479 -96.02996063 -95.95507812 -95.88117981 -95.80950928 x0.1964809448 -95.73854828 x0.1974584609 -95.66920471 -95.60133362 -95.53430176 -95.46897888 -95.40502167 -95.34222412 -95.28018951 -95.22046661 -95.16082001 -95.1035614 -95.04668427 -94.99155426 -94.93701935 -94.88400269 x0.2111437023 -94.83301544 x0.2121212184 -94.78235626 -94.73234558 -94.684021 -94.63742828 -94.59171295 -94.54663849 -94.503479 -94.46068573 -94.41899109 -94.37902069 -94.33952332 -94.3017807 -94.26459503 -94.22827148 -94.19332123 -94.15947723 x0.2277614921 -94.1269455 x0.2287390083 -94.09528351 -94.06499481 -94.03471375 -94.00635529 -93.97930908 -93.95225525 -93.92682648 -93.90250397 -93.87891388 -93.85614777 -93.83475494 -93.81443787 -93.51556396 -93.16397858 x0.2424242496 -92.81221008 x0.2434017658 -92.46097565 -92.10933685 -91.75797272 -91.40596771 -91.05480957 -90.703125 -90.35197449 -90.00005341 -89.64833069 -89.29642487 -88.94536591 -88.59345245 -88.24186707 -87.89083862 -87.53879547 -87.18766022 -86.83607483 -86.48445892 -86.13298798 -85.78100586 -85.42920685 -85.0778656 -84.72644806 -84.37506104 x0.2668621838 -84.02339172 x0.2678397 -83.67183685 -83.32027435 -82.96880341 -82.61690521 -82.26573944 -81.91412354 -81.56270599 -81.21089172 -80.85932922 -80.50782013 -80.15628815 -79.80454254 -79.45318604 -79.10142517 -78.74991608 -78.39840698 -78.04681396 -77.69528198 -77.34365082 -76.99221802 -76.64073944 -76.28916168 -75.93722534 -75.5863266 -75.23439026 -74.88256073 -74.53091431 -74.17945099 -73.82816315 -73.4765625 x0.297165215 -73.12471771 x0.2981427312 -72.77326965 -72.42196655 -72.07049561 -71.71871185 -71.36724091 -71.01579285 -70.66396332 -70.31231689 -69.96099091 -69.60956573 -69.2578125 -68.90632629 -68.55438995 -68.2033844 -67.85182953 -67.49979401 -67.14846039 -66.79668427 -66.44523621 -66.09378815 -65.74243164 -65.39041138 -65.03909302 -64.68755341 -64.33565521 -63.98432159 -63.63277817 -63.28139877 -62.92975235 -62.57808685 -62.22626495 -61.87521362 x0.3294232786 -61.52323914 x0.3304007947 -61.17179871 -60.8200798 -60.46903992 -60.11749649 -59.76571655 -59.41381073 -59.06235504 -58.71113586 -58.35943985 -58.00794601 -57.65601349 -57.30449677 -56.95283508 -56.60138321 -56.24978256 -55.89867401 -55.54664612 -55.19552231 -54.8441124 -54.49192429 -54.14077377 -53.78865814 -53.43777084 -53.08612442 -52.73423004 -52.38290405 -52.03130341 -51.67964554 -51.32822418 -50.97655487 x0.3597263098 -50.62523651 x0.360703826 -50.27373886 -49.92136383 -49.57020569 -49.21824646 -48.86746979 -48.51581192 -48.16392136 -47.81227493 -47.46107483 -47.10931015 -46.75773239 -46.40627289 -46.05514526 -45.70356369 -45.35123062 -45.00028229 -44.64833832 -44.29677582 -43.94533157 -43.59440231 -43.24197006 -42.89065933 -42.53913116 -42.18762589 -41.83597183 -41.4846077 -41.13315964 -40.78186035 -40.4301796 -40.07788467 -39.72669983 -39.37467957 x0.3919843733 -39.02323532 x0.3929618895 -38.67201614 -38.32023621 -37.96833801 -37.61686707 -37.26586151 -36.91412354 -36.56280899 -36.2108345 -35.85923767 -35.50828552 -35.15553665 -34.80471802 -34.45311737 -34.1014595 -33.74998856 -33.39873886 -33.0466423 -32.69543839 -32.34375381 -31.99185944 -31.64094925 -31.28888321 -30.93751526 -30.58550644 -30.23398399 -29.88276291 -29.53146172 -29.17924309 -28.82774162 -28.47654533 x0.4222874045 -28.12514305 x0.4232649207 -27.7735157 -27.42168236 -27.07026482 -26.7183342 -26.36751366 -26.01599503 -25.66420746 -25.31237411 -24.96137238 -24.60906029 -24.25840759 -23.90583611 -23.55424309 -23.20311356 -22.85111237 -22.50030518 -22.14834595 -21.79711342 -21.44508553 -21.09440613 -20.74219131 -20.39069748 -20.03963661 -19.68751907 -19.33540535 -18.98475838 -18.63292122 -18.28107452 -17.92967224 -17.57847595 -17.22660446 -16.87447739 x0.4545454681 -16.52266884 x0.4555229843 -16.17162704 -15.81982899 -15.46895218 -15.11732864 -14.76584053 -14.41400719 -14.06231976 -13.71068954 -13.35957909 -13.0074749 -12.65591812 -12.30516243 -11.95309639 -11.60125065 -11.25000668 -10.89822578 -10.54682636 -10.19559765 -9.843922615 -9.492348671 -9.140686989 -8.789406776 -8.437381744 -8.085835457 -7.734455585 -7.382839203 -7.031270504 -6.679451466 -6.32804966 -5.976819038 x0.4848484993 -5.625026703 x0.4858260155 -5.273333073 -4.921647549 -4.57044363 -4.218632698 -3.867095709 -3.515827417 -3.164312601 -2.812455177 -2.460875273 -2.109203339 -1.757820725 -1.406288385 -1.054721594 -0.703020215 -0.351698637 2.427518484e-05 0.351539582 0.7031132579 1.054671168 1.406401992 1.757814407 2.109508276 2.460862875 2.812501192 3.1641469 3.515648365 3.86716795 4.218748093 4.570329666 4.921858311 5.273546219 5.62499094 5.976554871 6.328083038 6.67969799 7.031258106 7.382876396 7.734297276 8.086149216 8.43764019 8.788971901 9.140665054 9.492019653 9.843785286 10.19538403 10.54692459 10.89831448 11.25000858 x0.5327468514 11.60141277 x0.5337243676 11.95334053 12.30476189 12.64957047 12.63229656 12.61542606 12.5992651 12.58302784 12.56738091 12.55178356 12.53700256 12.52237129 12.50777245 12.4943037 12.48087788 12.46780968 12.45454407 12.44208622 12.42996883 12.41788578 12.40637112 12.39531708 12.38438988 12.37391949 12.36345577 12.35368633 12.34412766 12.33449745 12.32584286 12.31720734 12.30891991 12.3007412 12.29322052 12.28550148 12.2786541 12.27191925 12.26561928 12.25934505 12.25370121 12.24818611 12.24267864 12.23802185 12.23327923 12.22885895 12.22486591 12.22131062 12.2177639 12.21453381 12.21204472 12.2092495 12.20731449 12.2048502 12.20345211 12.20226097 12.20119762 12.20044899 12.20011425 12.19968891 12.20000744 12.20022106 12.20108509 12.20226765 12.20367146 x0.59433043 12.20527172 x0.5953079462 12.20732117 12.20968151 12.2119503 12.21496582 12.21839619 12.22162724 12.22562885 12.2296114 12.2337122 12.23867226 12.24354076 12.2488451 12.25424194 12.2605257 12.26670361 12.27299595 12.27985001 12.28734684 12.29462528 12.30215836 12.31044292 12.31896591 12.32770443 12.33679199 12.34632301 12.35598278 12.36599064 12.37634373 12.38736057 12.39807892 12.4094696 12.42130947 12.43330669 12.44586086 12.45855331 12.47171211 12.48513126 12.49901295 12.51314831 12.52766514 12.54265022 12.55799675 12.57305431 12.58925819 12.60562992 12.62225533 12.63950729 12.65712166 12.67502117 12.69342995 12.71166039 12.73073769 12.75033092 12.77009106 12.79049015 12.81129742 12.83240032 12.85391617 12.87572002 12.89819336 12.92097759 12.94406319 12.96782017 12.99224949 x0.657869041 13.01676655 x0.6588465571 13.04185009 13.06726551 13.09335136 13.11979771 13.14682388 13.17429352 13.2022562 13.23055935 13.25972748 13.28924465 13.31914234 13.34964085 13.38064766 13.41217518 13.44444561 13.47763252 13.51070118 13.54442024 13.57921028 13.61415291 13.64988518 13.68620396 13.72333622 13.76036453 13.79904366 13.83752918 13.87725925 13.91745949 13.95826149 14.00037861 14.04242897 14.08552933 14.12913609 14.17437649 14.21944904 14.26519203 14.31247044 14.35972881 14.40854263 14.45823383 14.50835228 14.55995464 14.61200714 14.6652813 14.71902275 14.77446651 14.83057499 14.88763809 14.94602394 15.00507927 15.06549263 15.12709713 15.18992138 15.25429916 15.31963158 15.38607979 15.45447731 15.52437019 15.59562969 15.66778755 15.74201965 15.81735134 x0.7194526196 15.89535332 x0.7204301357 15.97485924 16.05641365 16.13975143 16.22486496 16.31268501 16.40259171 16.49495697 16.59004211 16.68808365 16.78915405 16.89317894 16.99999237 17.1102581 17.22484207 17.34291458 17.46552467 17.59222794 17.72416687 17.86110497 18.00336456 18.1518116 18.30620575 18.46718216 18.63565063 18.81143188 18.99529648 19.18823051 19.38946342 19.60097122 19.82253265 20.05530548 20.29905128 20.55480576 20.8236618 21.10634041 21.40266037 21.71334457 22.03974342 22.38178062 22.74096107 23.11727333 23.51199913 23.92589378 24.3593483 24.81386948 25.28886604 25.78739548 26.30896759 26.85493469 27.42675018 28.02640915 28.65293503 29.3106823 29.99875641 30.7193985 31.47564125 32.26753616 33.09830475 33.97034836 34.88492584 35.8452301 36.85400391 37.9134407 39.02717209 x0.7829912305 40.19839478 x0.7839687467 41.43107986 42.72550201 44.08901978 45.52266693 47.03256607 48.6194191 50.28736877 52.04463959 53.88686371 55.82282257 57.84971237 59.97327805 62.19246674 64.50495911 66.91353607 69.41324615 71.9929657 74.65518951 77.38815308 80.17959595 83.02291107 85.90283203 88.80589294 91.71356964 94.6157608 97.49390411 100.3399277 103.1342468 105.8708191 108.5346069 111.1200333 113.6238785 116.0333939 118.3508987 120.5743179 122.7002029 124.7342758 126.67099 128.5195923 130.2785187 131.9514618 133.5428467 135.0563812 136.495285 137.862381 139.1619568 140.3997955 141.5757141 142.6951904 143.7622528 144.7778625 145.746048 146.6695557 147.5508423 148.3922272 149.1962738 149.9644318 150.6999817 151.4039001 152.0779877 152.724472 153.3438416 x0.8445748091 153.9387512 x0.8455523252 154.5097961 155.05867 155.5861359 156.0935974 156.5820312 157.052475 157.5056305 157.9426727 158.3641357 158.7709961 159.1637573 159.5432434 159.9098511 160.2645111 160.6075745 160.9397125 161.2611542 161.572525 161.8743286 162.1669159 162.4507141 162.7260284 162.9932404 163.2527161 163.5046997 163.7496033 163.9876099 164.2190094 164.4440918 164.6630707 164.8761749 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 x0.90811342 164.9063263 x0.9090909362 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 x0.9696969986 164.9063263 x0.9706745148 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 164.9063263 165.3670959 165.9415283 166.5244751 167.1159363 167.716095 168.3247681 168.9422455 169.5683289 170.2032623 170.8468018 171.499115 172.1601105 172.8298187 173.5082855 174.195343 174.8907471 175.5949707}}
 name clipped709_JMh_01
 xpos 164
 ypos 382
}
Constant {
 inputs 0
 channels rgb
 color 0.05
 name Constant5
 xpos 2210
 ypos 1516
}
CMSTestPattern {
 inputs 0
 cube_size 16
 name CMSTestPattern1
 xpos 1789
 ypos 1020
}
Reformat {
 type scale
 scale 0.1428571429
 filter impulse
 name Reformat10
 xpos 1789
 ypos 1092
}
set N599a3800 [stack 0]
Colorspace {
 colorspace_out CIE-XYZ
 name Colorspace26
 xpos 1789
 ypos 1116
}
Multiply {
 value 100
 name Multiply14
 label "Mult by 100 to put in absolute nits"
 xpos 1789
 ypos 1140
}
Group {
 name ZCAM12
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos 1789
 ypos 1182
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 inverseData1 M,h
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set N599a2000 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set N599a0c00 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $N599a0c00
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set N59937200 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $N59937200
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set N5992ec00 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set N5992e800 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $N5992ec00
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set N5992dc00 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set N5992d800 [stack 0]
push $N5992ec00
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set N5992d400 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set N5992d000 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set N5992cc00 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set N5992c800 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $N5992e800
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $N5992ec00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $N5992ec00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $N5992ec00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  surrounds dark
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $N599a2000
push $N5992e800
push $N5992dc00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set N598ae800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $N598ae800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $N5992e800
push $N5992d800
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set N598ad400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $N598ad400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $N5992e800
push $N5992d400
push $N5992dc00
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set N5984f800 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set N5984f400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $N5984f400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $N5992cc00
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $N5984f800
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $N5992cc00
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $N5992c800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $N5984f800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $N5992d800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $N5992d000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $N5992dc00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $N5992d400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $N5992e800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $N599a2000
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set N59b8a000 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set N59b89400 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $N59b89400
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $N59b8a000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $N59b8a000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $N59b8a000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set N59b33800 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set N59b32c00 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $N59b32c00
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $N59b32c00
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set N59b31c00 [stack 0]
push $N59b31c00
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $N59b8a000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $N59b8a000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  selected true
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $N59b33800
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set N59edec00 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $N59edec00
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $N59edec00
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set N59b0f200 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set N59eddc00 [stack 0]
 Dot {
  name Dot44
  label C,h
  xpos -1673
  ypos 2768
 }
push $N59b0f200
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set N59edd400 [stack 0]
 Dot {
  name Dot20
  label M,h
  xpos -1737
  ypos 2767
 }
push $N59b0f200
push $N59b8a000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set N59edc800 [stack 0]
push $N59b8a000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set N59e8b800 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set N59b0eb00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $N59eddc00
push $N59edd400
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set N59e89c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $N59e89c00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $N59b0eb00
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set N59e17800 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $N59e17800
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set N59b0dd00 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $N59b0dd00
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $N59b8a000
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $N59b8a000
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $N59b8a000
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $N59b0eb00
push $N59b8a000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $N59b33800
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $N59edc800
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $N59e8b800
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $N59b0f200
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
Group {
 name ZCAM13
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos 1789
 ypos 1319
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 direction inverse
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 inverseData1 M,h
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set N59da1000 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set N59d37800 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $N59d37800
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set N59d74100 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $N59d74100
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set N59d35c00 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set N59d35800 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $N59d35c00
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set N59d34c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set N59d34800 [stack 0]
push $N59d35c00
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set N59d34400 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set N59cbfc00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set N59cbf800 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set N59cbf400 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $N59d35800
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $N59d35c00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $N59d35c00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $N59d35c00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  surrounds dark
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $N59da1000
push $N59d35800
push $N59d34c00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set N59cbd800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $N59cbd800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $N59d35800
push $N59d34800
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set N59cbc400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $N59cbc400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $N59d35800
push $N59d34400
push $N59d34c00
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set N59c4a800 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set N59c4a400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $N59c4a400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $N59cbf800
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $N59c4a800
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $N59cbf800
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $N59cbf400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $N59c4a800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $N59d34800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $N59cbfc00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $N59d34c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $N59d34400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $N59d35800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $N59da1000
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set N59f7d000 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set N59f7c400 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $N59f7c400
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $N59f7d000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $N59f7d000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $N59f7d000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set N59f0a800 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set N59f09c00 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $N59f09c00
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $N59f09c00
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set N59f08c00 [stack 0]
push $N59f08c00
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $N59f7d000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $N59f7d000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  selected true
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $N59f0a800
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set N5a2b1c00 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $N5a2b1c00
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $N5a2b1c00
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set N59d04100 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set N5a2b0c00 [stack 0]
 Dot {
  name Dot44
  label C,h
  xpos -1673
  ypos 2768
 }
push $N59d04100
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set N5a2b0400 [stack 0]
 Dot {
  name Dot20
  label M,h
  xpos -1737
  ypos 2767
 }
push $N59d04100
push $N59f7d000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set N5a263400 [stack 0]
push $N59f7d000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set N5a262800 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set N5a247900 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $N5a2b0c00
push $N5a2b0400
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set N5a260c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $N5a260c00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $N5a247900
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set N5a1fe800 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $N5a1fe800
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set N5a246b00 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $N5a246b00
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $N59f7d000
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $N59f7d000
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $N59f7d000
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $N5a247900
push $N59f7d000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $N59f0a800
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $N5a263400
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $N5a262800
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $N59d04100
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
Multiply {
 value 0.01
 name Multiply15
 label "Div by 100 to go from nits"
 xpos 1789
 ypos 1371
}
Colorspace {
 colorspace_in CIE-XYZ
 name Colorspace27
 xpos 1789
 ypos 1413
}
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.blue 0 2 white -1 -1 rgba.alpha 0 3"
 name Shuffle40
 xpos 1789
 ypos 1546
}
set N5a12fc00 [stack 0]
push $N599a3800
Difference {
 inputs 2
 name Difference2
 xpos 2074
 ypos 1326
}
push $N2c83bc00
Group {
 name ACES_OutputTransform_v1_2_1
 tile_color 0xa57aaaff
 xpos 1352
 ypos 10
 addUserKnob {20 ACES_OutputTransform_tab l "ACES OutputTransform"}
 addUserKnob {41 gamut l "input gamut" T GamutToXYZ_lite.gamut}
 addUserKnob {26 ""}
 addUserKnob {35 presets t "display output presets." M {display/sRGB "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 0 limiting_pri 0 eotf 0 stretch_black 0 d60_sim 0 force_d65_cat 0 dark_to_dim 1 legal_range 0 label \"sRGB\"\}" "display/sRGB D60 sim." "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 0 limiting_pri 0 eotf 0 stretch_black 0 d60_sim 1 force_d65_cat 0 dark_to_dim 1 legal_range 0 label \"sRGB D60 sim.\"\}" display/Rec.709 "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 0 limiting_pri 0 eotf 1 stretch_black 0 d60_sim 0 force_d65_cat 0 dark_to_dim 1 legal_range 0 label \"Rec.709\"\}" "display/Rec.709 D60 sim." "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 0 limiting_pri 0 eotf 1 stretch_black 0 d60_sim 1 force_d65_cat 0 dark_to_dim 1 legal_range 0 label \"Rec.709 D60 sim.\"\}" display/Rec.2020 "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 1 limiting_pri 1 eotf 1 stretch_black 0 d60_sim 0 force_d65_cat 0 dark_to_dim 1 legal_range 0 label \"Rec.2020\"\}" display/P3D60 "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 4 limiting_pri 4 eotf 4 stretch_black 0 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3D60\"\}" display/P3D65 "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 2 limiting_pri 2 eotf 4 stretch_black 0 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3D65\"\}" "display/P3D65 D60 sim." "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 2 limiting_pri 2 eotf 4 stretch_black 0 d60_sim 1 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3D65 D60 sim.\"\}" display/P3DCI "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 3 limiting_pri 3 eotf 4 stretch_black 0 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3DCI\"\}" "display/P3DCI D60 sim." "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 3 limiting_pri 3 eotf 4 stretch_black 0 d60_sim 1 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3DCI D60 sim.\"\}" "display/P3DCI D65 sim." "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 3 limiting_pri 3 eotf 4 stretch_black 0 d60_sim 0 force_d65_cat 1 dark_to_dim 0 legal_range 0 label \"P3DCI D65 sim.\"\}" display/DCDM "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 7 limiting_pri 7 eotf 5 stretch_black 0 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"DCDM\"\}" "display/P3D65 ST2084 108nits 7.2nits" "knobs this \{lum \{0.0001 7.2 108\} override_ssts_params 0 use_c9 0 display_pri 2 limiting_pri 2 eotf 6 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3D65 ST2084 108nits 7.2nits\"\}" "display/P3D65 ST2084 1000nits 15nits" "knobs this \{lum \{0.0001 15 1000\} override_ssts_params 0 use_c9 0 display_pri 2 limiting_pri 2 eotf 6 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3D65 ST2084 1000nits 15nits\"\}" "display/P3D65 ST2084 2000nits 15nits" "knobs this \{lum \{0.0001 15 2000\} override_ssts_params 0 use_c9 0 display_pri 2 limiting_pri 2 eotf 6 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3D65 ST2084 2000nits 15nits\"\}" "display/P3D65 ST2084 2000nits 15nits" "knobs this \{lum \{0.0001 15 2000\} override_ssts_params 0 use_c9 0 display_pri 2 limiting_pri 2 eotf 6 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3D65 ST2084 2000nits 15nits\"\}" "display/P3D65 ST2084 4000nits 15nits" "knobs this \{lum \{0.0001 15 4000\} override_ssts_params 0 use_c9 0 display_pri 2 limiting_pri 2 eotf 6 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3D65 ST2084 4000nits 15nits\"\}" display/Rec2020_HLG_1000nits_15nits "knobs this \{lum \{0.0001 15 1000\} override_ssts_params 0 use_c9 0 display_pri 1 limiting_pri 1 eotf 7 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"Rec2020_HLG_1000nits_15nits\"\}" display/Rec2020_ST2084_1000nits_15nits "knobs this \{lum \{0.0001 15 1000\} override_ssts_params 0 use_c9 0 display_pri 1 limiting_pri 1 eotf 6 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"Rec2020_ST2084_1000nits_15nits\"\}" display/Rec2020_ST2084_2000nits_15nits "knobs this \{lum \{0.0001 15 2000\} override_ssts_params 0 use_c9 0 display_pri 1 limiting_pri 1 eotf 6 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"Rec2020_ST2084_2000nits_15nits\"\}" display/Rec2020_ST2084_4000nits_15nits "knobs this \{lum \{0.0001 15 4000\} override_ssts_params 0 use_c9 0 display_pri 1 limiting_pri 1 eotf 6 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"Rec2020_ST2084_4000nits_15nits\"\}" display/OCES "knobs this \{lum \{0.0001 4.8 10000\} override_ssts_params 0 use_c9 0 display_pri 6 limiting_pri 6 eotf 9 stretch_black 0 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"OCES\"\}" "" ""}}
 addUserKnob {26 display_label l " " T "<b>Display Settings</b>"}
 addUserKnob {78 lum l luminance t "<b>SSTS Display Luminance</b>: \ny_min y_mid y_max\n\nAccording to Zach Lewis's ACES_OT\nhttps://gist.github.com/zachlewis/786c0be941868644c993fde1c3515c2c\n\n<b>Standard Cinema</b>: \n0.02 4.8 48\n<b>Dolby Cinema</b>: \n0.0001 7.2 108\n<b>Dolby Pulsar</b>: \n0.005 15 4000\n<b>Dolby PRR-4220</b>: \n0.005 10 600\n<b>Sony BVM-X300</b>: \n0.0001 10 1000\n<b>ACES OCES</b>: \n0.0001 4.8 10000\n\n" n 3}
 lum {0.02 4.8 48}
 addUserKnob {20 ssts_params_grp l "SSTS Parameters" n 1}
 ssts_params_grp 0
 addUserKnob {6 override_ssts_params l "override ssts params" t "Enable overrides of SSTS params.\n\nOtherwise the values will be calculated automatically by the algorithm." +STARTLINE}
 addUserKnob {35 presets_ssts_param l presets t "If you want to override the default SSTS parameters and play around, here are some useful starting points." M {contrast/default "knobs this \{override_ssts_params 0 pctLow 0.35 pctHigh 0.89 slope \{0 1.5 0.\} exposure 0.0 use_c9 0\}" contrast/sdr "knobs this \{override_ssts_params 1 pctLow 0.35 pctHigh 0.89 slope \{0.1 1.6 0.01\} exposure 0.0 use_c9 0\}" contrast/high "knobs this \{override_ssts_params 1 pctLow 0.2 pctHigh 0.89 slope \{0.28 1.75 0.01\} exposure 0.0 use_c9 0\}" contrast/med "knobs this \{override_ssts_params 1 pctLow 0.40 pctHigh 0.89 slope \{0.38 1.3 0.01\} exposure 0.0 use_c9 0\}" contrast/med-low "knobs this \{override_ssts_params 1 pctLow 0.40 pctHigh 0.80 slope \{0.38 1.42 0.01\} exposure 0.0 use_c9 0\}" contrast/low "knobs this \{override_ssts_params 1 pctLow 0.40 pctHigh 0.80 slope \{0.38 1.2 0.01\} exposure 0.0 use_c9 0\}" ""}}
 addUserKnob {7 exposure R -5 5}
 addUserKnob {7 pctLow l knee}
 pctLow 0.35
 addUserKnob {7 pctHigh l shoulder}
 pctHigh 0.89
 addUserKnob {78 slope n 3}
 slope {0.38 1.501 0.01}
 addUserKnob {20 endGroup n -1}
 addUserKnob {6 use_c9 l "use SegmentedSpline_c9" t "In ACES 1.1 the Output Transform was re-written for HDR tonescales. \n\nIn ACES 1.1, HDR transforms use the new SSTS (Single Stage Tone Scale), while SDR transforms continue to use the old SegmentedSpline_c5 -> OCES -> SegmentedSpline_c9 -> ODT transform.\n\nIf this is enabled, the SegmentedSpline_c9 transform is used to maintain compatibility with the ACES SDR output transforms and enable a 1:1 match with the AMPAS CTL.\n\nIf you are curious, turn use_c9 off and play around with the SSTS Parameters." +STARTLINE}
 use_c9 true
 addUserKnob {26 ""}
 addUserKnob {4 display_pri l "display pri" t "Display encoding primaries." M {Rec709 Rec2020 P3D65 P3DCI P3D60 ACEScg ACES XYZ}}
 addUserKnob {4 limiting_pri l "limiting pri" t "Limiting primaries for the output transform." -STARTLINE M {Rec709 Rec2020 P3D65 P3DCI P3D60 ACEScg ACES XYZ}}
 addUserKnob {4 eotf l EOTF t "Electrical to Optical Transfer Function of the monitor." M {sRGB BT.1886 "Gamma 2.2" "Gamma 2.4" "Gamma 2.6" DCDM "ST-2084 (PQ)" HLG Linear OCES ""}}
 eotf Linear
 addUserKnob {6 stretch_black l "stretch black" t "For hdr outputs: stretch black luminance to a PQ code value of 0" +STARTLINE}
 addUserKnob {6 d60_sim l "d60 sim" t "d60 whitepoint simulation." +STARTLINE}
 addUserKnob {6 force_d65_cat l "force d60 to d65 cat" -STARTLINE}
 addUserKnob {6 dark_to_dim l "dark to dim surround" t "Apply gamma adjustment to compensate for \"Dark to Dim\" surround. For SDR outputs only." +STARTLINE}
 addUserKnob {6 legal_range l "legal range" t "Output legal range." +STARTLINE}
}
 BackdropNode {
  inputs 0
  name Electrical_Optical_Transfer_Function
  tile_color 0x151515ff
  label "ACESlib.OutputTransforms.ctl : 185\n// EOTF"
  note_font_size 12
  xpos -2025
  ypos 2294
  bdwidth 3391
  bdheight 740
  z_order -10
 }
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x272727ff
  label "HDR EOTFs"
  note_font_size 42
  xpos 425
  ypos 2379
  bdwidth 910
  bdheight 617
  z_order -5
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x272727ff
  label "SDR EOTFs"
  note_font_size 42
  xpos -1158
  ypos 2384
  bdwidth 1436
  bdheight 608
  z_order -5
 }
 BackdropNode {
  inputs 0
  name AP1_to_XYZ
  tile_color 0x555b5cff
  label "ACESlib.OutputTransforms.ctl : 90\n// Rendering primaries to XYZ\n"
  note_font_size 12
  xpos -1400
  ypos 906
  bdwidth 380
  bdheight 156
 }
 BackdropNode {
  inputs 0
  name AP1_to_XYZ1
  tile_color 0x555a5cff
  label "// Apply desaturation to compensate for luminance difference\nlinearCV = mult_f3_f33( linearCV, ODT_SAT_MAT);\n( SDR only)"
  note_font_size 12
  xpos -1412
  ypos 669
  bdwidth 439
  bdheight 186
 }
 BackdropNode {
  inputs 0
  name D60_whitepoint_simulation
  tile_color 0x232323ff
  label "ACESlib.OutputTransforms.ctl : 150\n// Scale to avoid clipping when device calibration is different from D60. \n// To simulate D60, unequal code values are sent to the display.\n"
  note_font_size 12
  xpos -1399
  ypos 176
  bdwidth 818
  bdheight 463
 }
 BackdropNode {
  inputs 0
  name Luminance_to_Linear_Code_Values
  tile_color 0x272727ff
  label "ACESlib.OutputTransforms.ctl : 87\n/*  Scale absolute luminance to linear code value  */\n"
  note_font_size 12
  xpos -1367
  ypos -50
  bdwidth 315
  bdheight 148
 }
 BackdropNode {
  inputs 0
  name Output_Color_Encoding_Specification
  tile_color 0x1d1d1dff
  label "<font size=12>OCES\n<font size=0.1>\n- ACES Output Output Color Encoding Specification \n- An idealized reference display with 0.0001 / 4.8 / 10000 luma\n w/ ACES AP0 Primaries."
  note_font_size 27.4
  xpos -1833
  ypos 2379
  bdwidth 367
  bdheight 377
 }
 BackdropNode {
  inputs 0
  name Output_Legal_Range
  tile_color 0x272727ff
  label "ACESlib.OutputTransforms.ctl : 216\n"
  note_font_size 12
  xpos -1369
  ypos 3128
  bdwidth 318
  bdheight 176
 }
 BackdropNode {
  inputs 0
  name Single_Stage_Tone_Scale
  tile_color 0x272727ff
  label "<b>Single Stage Tone Scale : ACESlib.OutputTransforms.ctl : 82</b><pre>// Apply the tonescale independently in rendering-space RGB\nfloat rgbPost\[3] = ssts_f3( rgbPre, PARAMS);\n\nIf output is SDR, output OCES from SSTS and use SegmentedSpline_c9."
  note_font_size 12
  xpos -1502
  ypos -653
  bdwidth 609
  bdheight 533
 }
 BackdropNode {
  inputs 0
  name clamp_negatives
  tile_color 0x272727ff
  label "ACESlib.OutputTransforms.ctl : 174\n// Clip values < 0 (i.e. projecting outside the display primaries)\nNote: Also clamping values > 1 here."
  note_font_size 12
  xpos -1393
  ypos 2087
  bdwidth 386
  bdheight 120
 }
 BackdropNode {
  inputs 0
  name dim_surround_gamma_adjustment
  tile_color 0x272727ff
  label "ACESlib.OutputTransforms.ctl : 92\n// Apply gamma adjustment to compensate for dim surround\n"
  note_font_size 12
  xpos -1407
  ypos 1063
  bdwidth 395
  bdheight 258
 }
 BackdropNode {
  inputs 0
  name limit_primaries
  tile_color 0x555a5cff
  label "ACESlib.OutputTransforms.ctl : 130\n// Gamut limit to limiting primaries\n"
  note_font_size 12
  xpos -1408
  ypos 1655
  bdwidth 396
  bdheight 194
 }
 BackdropNode {
  inputs 0
  name limit_primaries1
  tile_color 0x555a5cff
  label "ACESlib.OutputTransforms.ctl : 144\n// CIE XYZ to display encoding primaries\n"
  note_font_size 12
  xpos -1402
  ypos 1892
  bdwidth 384
  bdheight 151
 }
 BackdropNode {
  inputs 0
  name limit_primaries2
  tile_color 0x555a5cff
  label "ACESlib.OutputTransforms.ctl : 130\n    // Apply CAT from ACES white point to assumed observer adapted white point\n    // TODO: Needs to expand from just supporting D60 sim to allow for any\n    // observer adapted white point.\n"
  note_font_size 12
  xpos -1407
  ypos 1337
  bdwidth 467
  bdheight 301
 }
 BackdropNode {
  inputs 0
  name rrt_sweeteners_
  tile_color 0x555a5cff
  label "<b>RRT Sweeteners : ACESlib.OutputTransforms.ctl : 79</b><pre>// RRT sweeteners\nfloat rgbPre\[3] = rrt_sweeteners( in);\n"
  note_font_size 18
  xpos -1469
  ypos -1234
  bdwidth 519
  bdheight 548
 }
 Input {
  inputs 0
  name Input
  xpos -1250
  ypos -1450
 }
 AddChannels {
  channels rgba
  name AddChannels
  xpos -1250
  ypos -1415
 }
 Group {
  name GamutToXYZ_lite
  xpos -1250
  ypos -1373
  addUserKnob {20 GamutToXYZ_lite_tab l GamutToXYZ_lite}
  addUserKnob {4 gamut t "Choose gamut" M {XYZ ACES ACEScg "Filmlight E-Gamut" "DaVinci WG" Rec709 Rec2020 P3D60 P3D65 P3DCI "Arri AlexaWideGamut" REDDRAGONcolor REDDRAGONcolor2 REDcolor REDcolor2 REDcolor3 REDcolor4 REDWideGamutRGB "GoPro Protune Native" CanonCinemaGamut SonySGamut SonySGamut3Cine PanasonicVGamut "DJI D-Gamut" "Fujifilm F-Gamut" BMDFilmV1 BMD4kFilmV1 BMD4kFilmV3 BMD46kFilmV1 BMD46kFilmV3 BMDWideGamutV4 "AdobeRGB\t" AdobeWideGamutRGB ROMM RIMM ERIMM ProPhotoRGB RusselRGB SharpRGB AppleRGB BestRGB}}
  gamut ACES
  addUserKnob {6 invert +STARTLINE}
  addUserKnob {26 ""}
  addUserKnob {26 chromaticity_coordinates_label l " " T "<b>Chromaticity Coordinates</b>"}
  addUserKnob {20 chromaticities_grp l "" +STARTLINE n 1}
  addUserKnob {41 rxy T ColorMatrix.rxy}
  addUserKnob {41 gxy T ColorMatrix.gxy}
  addUserKnob {41 bxy T ColorMatrix.bxy}
  addUserKnob {41 wxy T ColorMatrix.wxy}
  addUserKnob {41 matrix T ColorMatrix.matrix}
  addUserKnob {20 endGroup n -1}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -10
  }
  ColorMatrix {
   matrix {
       {{curve(which) 1 0.9525524378 0.6624541879 0.7053968906 0.4123907983 0.6369580626 0.5049495697 0.4865709841 0.4451698363 0.6380076408 0.5070186853 0.4462202489 0.4300414324 0.4581649601 0.4878340662 0.4517004192 0.7352752686 0.5022571683 0.7160496712 0.7064827085 0.5990839601 0.6796444654 0.6481720209 0.6369580626 0.6390493512 0.6141571999 0.3724023998 0.60689044 0.4017650783 0.6065810919 0.5766690373 0.7165006995 0.797760427 0.797760427 0.797760427 0.7976718545 0.7015837431 0.8156226277 0.4496616423 0.6318944097} {curve(which) 0 0 0.1340042055 0.1640413404 0.3575843275 0.1446169019 0.2646814585 0.2656676769 0.2771343887 0.2147038579 0.3587769568 0.3157556653 0.3700728714 0.3832037449 0.3432727158 0.3178463876 0.06860940903 0.2929667532 0.1296834797 0.1288010478 0.2489254922 0.1522114277 0.1940581352 0.1446169019 0.1578372866 0.2825684249 0.4324877858 0.2193847299 0.4560420811 0.2203479856 0.1855582297 0.1010205746 0.1351858526 0.1351858526 0.1351858526 0.1351878047 0.1554162204 0.04716260359 0.3162561059 0.2053879201} {curve(which) 0 9.367863095e-05 0.1561876982 0.08101774752 0.180480808 0.1688809693 0.1830150485 0.1982172877 0.1722826511 0.09774444997 0.0868505761 0.190669477 0.152531758 0.1112773567 0.1215386018 0.1830992699 0.1465712637 0.1552320272 0.1047228053 0.1151721701 0.1024464965 0.1186000481 0.108225815 0.1688809693 0.1516760886 0.05183707923 0.1436725408 0.124180764 0.09264881909 0.123526901 0.1882286519 0.1467743814 0.03134934977 0.03134934977 0.03134934977 0.03133957833 0.09979832917 0.1372147948 0.1845382005 0.1270133406}}
       {{curve(which) 0 0.3439664543 0.2722287476 0.2801307142 0.2126390189 0.2627002299 0.237623319 0.2289745659 0.209491685 0.2919537723 0.2207257152 0.1942579001 0.2022213936 0.1694435924 0.2289056629 0.2119505703 0.2866941094 0.1387997568 0.2612613738 0.2709796727 0.2150758505 0.2606855333 0.2830046713 0.2627002299 0.1743051857 0.2365771234 0.1383759677 0.1973138005 0.1721783578 0.2680045366 0.2973450124 0.258728236 0.2880711257 0.2880711257 0.2880711257 0.2880405784 0.3152042925 0.3790788651 0.2446159422 0.2276017666} {curve(which) 1 0.7281661034 0.6740817428 0.8202066422 0.7151686549 0.6779980659 0.6891706586 0.6917385459 0.7215952873 0.8238410354 0.839184761 0.7385566831 0.7585275769 0.8648257852 0.7808576822 0.7230190039 0.8429791331 0.910841465 0.8696421385 0.786606431 0.8850684762 0.7748944759 0.8131960034 0.6779980659 0.951146543 0.8896810412 0.911518693 0.943950057 0.8553914428 0.8326833844 0.6273635626 0.7246823311 0.7118432522 0.7118432522 0.7118432522 0.7118694782 0.6648360491 0.5769088268 0.6720442176 0.7383946776} {curve(which) 0 -0.07213255018 0.05368951708 -0.1003373638 0.07219231874 0.05930171534 0.07320601493 0.07928691059 0.06891305745 -0.1157948226 -0.05991046131 0.06718540192 0.03925102949 -0.03426937759 -0.009763340466 0.06503042579 -0.1296732277 -0.04964122549 -0.1309035122 -0.05758608505 -0.1001443192 -0.03558001295 -0.09620071948 0.05930171534 -0.1254517138 -0.1262581497 -0.04989464581 -0.1412638426 -0.02756982669 -0.1006879359 0.07529145479 0.01658944227 8.565396274e-05 8.565396274e-05 8.565396274e-05 8.991353388e-05 0.01995966583 0.04401229322 0.08333983272 0.0340035744}}
       {{curve(which) 0 -3.863927134e-08 -0.005574660841 -0.1037815213 0.01933082007 0 0 0 0 0.0027982709 -0.0544523783 -0.04792318866 -0.0176958181 -0.1061859056 -0.02100777067 -0.01945115253 -0.07968087494 0.07801423222 -0.009676366113 -0.009677864611 -0.03206583485 -0.009310216643 -0.01825834997 0 -0.11669112 -0.02325225808 -0.1602820009 -0.1427432895 -0.10720893 -0.02941203304 0.02703136392 -2.906408625e-08 -3.236030111e-08 -3.236030111e-08 -3.236030111e-08 0 0 -0.01229703799 0.02518104948 0} {curve(which) 0 0 0.004060741514 -0.07290724665 0.1191947311 0.0280726999 0.0449459292 0.04511339962 0.04706057906 -0.06703422964 -0.0003228379355 -0.0002844714036 0.08768811822 0.02554347552 0.01782695204 0.01650637016 -0.3473432064 -0.3148325086 -0.2364816219 0.004600019194 -0.02765839547 -0.004612449091 -0.08316776901 0.0280726999 -0.5518454909 -0.4897170365 -0.171635136 -0.4278847873 0.07809129357 -0.08659287542 0.07068887353 0.05121183768 1.2621717e-08 1.2621717e-08 1.2621717e-08 -1.262213711e-08 0.04317118227 0.01672476344 0.1411857158 0.01001892332} {curve(which) 1 1.008825183 1.010339141 1.265746474 0.950532198 1.060985088 0.9638792276 1.043944359 0.9073553085 1.153293729 1.063571215 1.057001948 0.9388025999 1.089437366 1.01197505 1.011739731 1.51608181 1.325875998 1.335215807 1.094135642 1.148782015 1.102980375 1.190483928 1.060985088 1.745692492 1.590125084 1.409072995 1.65968585 1.118175387 1.205062628 0.9913375378 0.7738927603 0.8251045942 0.8251045942 0.8251045942 0.8248898983 0.8782252669 0.9955722094 0.9226909876 0.8150856495}}
     }
   invert {{parent.invert}}
   name ColorMatrix
   label "RGB to XYZ"
   xpos -40
   ypos 32
   addUserKnob {20 Gamut}
   addUserKnob {3 which}
   which {{parent.gamut}}
   addUserKnob {12 rxy}
   rxy {{curve(which) 1 0.7347 0.713 0.8 0.8 0.64 0.708 0.68 0.68 0.68 0.684 0.7530442228 0.7530444911 0.6997470013 0.8786825105 0.7011810359 0.7011805919 0.780308 0.69848046 0.74 0.73 0.766 0.73 0.71 0.708 0.9173 0.7422 1.0625 0.9175 0.8608 0.7177 0.64 0.7347 0.7347 0.7347 0.7347 0.734699 0.69 0.6898 0.625 0.7351916376} {curve(which) 0 0.2653 0.293 0.3177 0.313 0.33 0.292 0.32 0.32 0.32 0.313 0.3278305767 0.3278310295 0.3290469303 0.3249640074 0.3290141556 0.3290136991 0.304253 0.19302645 0.27 0.28 0.275 0.28 0.31 0.292 0.2502 0.2859 0.3948 0.2983 0.3689 0.3171 0.33 0.2653 0.2653 0.2653 0.2653 0.265301 0.31 0.3206 0.34 0.2648083624}}
   addUserKnob {12 gxy}
   gxy {{curve(which) 0 0 0.165 0.18 0.1682 0.3 0.17 0.265 0.265 0.265 0.221 0.2995702285 0.2995704905 0.304264039 0.3008887144 0.3006003047 0.3006003955 0.121595 0.32955538 0.17 0.14 0.225 0.165 0.21 0.17 0.2833 0.414 0.3689 0.2983 0.3282 0.228 0.21 0.1152 0.1596 0.1596 0.1596 0.159597 0.18 0.0736 0.28 0.2153361345} {curve(which) 1 1 0.83 0.9 0.9877 0.6 0.797 0.69 0.69 0.69 0.848 0.700699322 0.7006994156 0.6236411451 0.6790547558 0.6837888343 0.6837888243 1.493994 1.02459662 1.14 0.855 0.8 0.84 0.88 0.797 1.7072 1.3035 0.7775 1.2835 0.6156 0.8616 0.71 0.8264 0.8404 0.8404 0.8404 0.840403 0.77 0.9003 0.595 0.7741596639}}
   addUserKnob {12 bxy}
   bxy {{curve(which) 0 0.0001 0.128 0.065 0.079 0.15 0.131 0.15 0.15 0.15 0.0861 0.07964206674 0.1450115843 0.1349139613 0.09539869461 0.1081544556 0.1453319462 0.095612 0.10844263 0.08 0.1 0.089 0.1 0.09 0.131 0.0856 0.0342 0.0956 0.0756 0.0783 0.1006 0.15 0.1566 0.0366 0.0366 0.0366 0.036598 0.1 0.1166 0.155 0.1301229508} {curve(which) 0 -0.077 0.044 -0.0805 -0.1155 0.06 0.046 0.06 0.06 0.06 -0.102 -0.05493795109 0.05109712509 0.03471744128 -0.02937932683 -0.008688175787 0.05161680362 -0.084589 -0.03467857 -0.1 -0.05 -0.087 -0.03 -0.08 0.046 -0.0708 -0.0833 -0.0332 -0.086 -0.0233 -0.082 0.06 0.0177 0.0001 0.0001 0.0001 0.000105 0.02 0.0374 0.07 0.03483606557}}
   addUserKnob {12 wxy}
   wxy {{curve(which) 0.33333333 0.32168 0.32168 0.3127 0.3127 0.3127 0.3127 0.32168 0.3127 0.314 0.3127 0.3216831877 0.3216832104 0.3216832894 0.3216832894 0.3216832104 0.3216832894 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3135 0.3135 0.3135 0.3127 0.3127 0.3127 0.3127 0.3457 0.3457 0.3457 0.3457 0.345704 0.33243 0.33333333 0.3127 0.3457} {curve(which) 0.33333333 0.33767 0.33767 0.329 0.329 0.329 0.329 0.33767 0.329 0.351 0.329 0.337673316 0.3376736101 0.3376734472 0.3376734472 0.3376736101 0.3376734472 0.329 0.329 0.329 0.329 0.329 0.329 0.329 0.329 0.3305 0.3305 0.3305 0.329 0.329 0.329 0.329 0.3585 0.3585 0.3585 0.3585 0.35854 0.34744 0.33333333 0.329 0.3585}}
  }
  Output {
   name Output
   xpos -40
   ypos 86
  }
 end_group
 ColorMatrix {
  matrix {
      {1.049811006 0 -9.748453158e-05}
      {-0.4959030151 1.373313069 0.09824004024}
      {4.020908051e-08 0 0.9912520051}
    }
  name ColorMatrix4
  label "XYZ to ACES"
  note_font Helvetica
  xpos -1250
  ypos -1338
 }
 Dot {
  name Dot7
  label " ACES 2065-1 IN"
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1216
  ypos -1268
 }
 Group {
  name glow_module1
  note_font Helvetica
  xpos -1250
  ypos -1089
  addUserKnob {20 Params_tab l Params}
  addUserKnob {7 RRT_GLOW_GAIN}
  RRT_GLOW_GAIN 0.05
  addUserKnob {7 RRT_GLOW_MID}
  RRT_GLOW_MID 0.08
  addUserKnob {6 invert +STARTLINE}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -562
  }
  Dot {
   name Dot2
   xpos -6
   ypos -510
  }
set N5a12d400 [stack 0]
  Dot {
   name Dot4
   xpos -116
   ypos -510
  }
set N5a12d000 [stack 0]
  Expression {
   temp_name0 chroma
   temp_expr0 sqrt(b*(b-g)+g*(g-r)+r*(r-b))
   temp_name1 ycRadiusWeight
   temp_expr1 1.75
   channel0 {-rgba.red rgba.green -rgba.blue none}
   expr0 "( b + g + r + ycRadiusWeight * chroma) / 3.0"
   channel1 {rgba.red -rgba.green -rgba.blue none}
   expr1 0
   expr2 0
   name rgb_2_yc1
   xpos -150
   ypos -466
  }
push 0
push $N5a12d000
  Dot {
   name Dot3
   xpos -226
   ypos -510
  }
  Expression {
   temp_name0 TINY
   temp_expr0 1e-10
   temp_name1 min_f3
   temp_expr1 min(r,min(g,b))
   temp_name2 max_f3
   temp_expr2 max(r,max(g,b))
   expr0 "(max( max_f3, TINY) - max( min_f3, TINY)) / max( max_f3, 1e-2)"
   expr1 0
   expr2 0
   name rgb_2_saturation1
   xpos -260
   ypos -466
  }
set N5a12c400 [stack 0]
  Expression {
   channel0 {rgba.red rgba.green rgba.blue none}
   expr0 "(r - 0.4) / 0.2"
   name Expression1
   xpos -370
   ypos -466
  }
  Expression {
   temp_name0 t
   temp_expr0 "max( 1.0 - fabs( r / 2.0), 0.0)"
   temp_name1 sign
   temp_expr1 r>0?1:r<0?-1:0
   temp_name2 valy
   temp_expr2 "1.0 + sign * (1.0 - t * t)"
   channel0 {-rgba.red -rgba.green rgba.blue none}
   expr0 "valy / 2"
   channel1 {rgba.red rgba.green -rgba.blue none}
   expr1 0
   channel2 {-rgba.red rgba.green rgba.blue none}
   expr2 0
   name sigmoid_shaper1
   xpos -370
   ypos -442
  }
push $N5a12c400
  Merge2 {
   inputs 3+1
   operation plus
   bbox B
   output rgb
   name Merge2
   note_font Helvetica
   xpos -260
   ypos -393
  }
set N5a07b400 [stack 0]
  Expression {
   temp_name0 ycOut
   temp_expr0 g
   temp_name1 glowGainIn
   temp_expr1 "RRT_GLOW_GAIN * b"
   temp_name2 glowMid
   temp_expr2 RRT_GLOW_MID
   channel0 rgb
   expr0 "1 + ((ycOut <= ((1 + glowGainIn) * 2./3. * glowMid)) ? -glowGainIn / (1 + glowGainIn) : ( ycOut >= (2. * glowMid)) ? 0 : glowGainIn * (glowMid / ycOut - 1./2.) / (glowGainIn / 2. - 1.))"
   channel1 none
   channel2 none
   name glow_inv
   xpos -150
   ypos -346
  }
push $N5a07b400
  Expression {
   temp_name0 ycIn
   temp_expr0 g
   temp_name1 glowGainIn
   temp_expr1 "RRT_GLOW_GAIN * b"
   temp_name2 glowMid
   temp_expr2 RRT_GLOW_MID
   channel0 rgb
   expr0 "1 + ( ycIn <= 2./3. * glowMid ? glowGainIn : ycIn >= 2. * glowMid ? 0 : glowGainIn * (glowMid / ycIn - 1./2.) )"
   channel1 none
   channel2 none
   name glow_fwd
   xpos -370
   ypos -346
  }
  Switch {
   inputs 2
   which {{parent.invert}}
   name Switch_direction
   note_font Helvetica
   xpos -260
   ypos -297
  }
  Dot {
   name Dot5
   xpos -226
   ypos -246
  }
push $N5a12d400
  Merge2 {
   inputs 2
   operation multiply
   bbox B
   output rgb
   name Merge3
   note_font Helvetica
   xpos -40
   ypos -249
  }
  Output {
   name Output
   xpos -40
   ypos -178
  }
 end_group
 Group {
  name red_modifier1
  note_font Helvetica
  xpos -1250
  ypos -1041
  addUserKnob {20 Params_tab l Params}
  addUserKnob {7 RRT_RED_SCALE}
  RRT_RED_SCALE 0.82
  addUserKnob {7 RRT_RED_PIVOT}
  RRT_RED_PIVOT 0.03
  addUserKnob {7 RRT_RED_HUE}
  addUserKnob {7 RRT_RED_WIDTH R 0 360}
  RRT_RED_WIDTH 135
  addUserKnob {6 invert +STARTLINE}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -10
  }
  Dot {
   name Dot1
   xpos -6
   ypos 42
  }
set N5a079800 [stack 0]
  Dot {
   name Dot2
   xpos -226
   ypos 42
  }
set N5a079400 [stack 0]
  Expression {
   temp_name0 TINY
   temp_expr0 1e-10
   temp_name1 min_f3
   temp_expr1 min(r,min(g,b))
   temp_name2 max_f3
   temp_expr2 max(r,max(g,b))
   channel0 rgb
   expr0 "(max( max_f3, TINY) - max( min_f3, TINY)) / max( max_f3, 1e-2)"
   channel1 none
   expr1 0
   channel2 none
   expr2 0
   name rgb_2_saturation
   xpos -260
   ypos 86
  }
push $N5a079400
  Dot {
   name Dot3
   xpos -336
   ypos 42
  }
  Expression {
   temp_name0 hue
   temp_expr0 "(r==g&&g==b)?0:(180/pi) * atan2( sqrt(3)*(g-b), 2*r-g-b)"
   channel0 {rgba.red -rgba.green -rgba.blue -rgba.alpha}
   expr0 "hue < 0 ? hue + 360 : hue"
   channel1 {-rgba.red rgba.green -rgba.blue none}
   expr1 0
   expr2 0
   name rgb_2_hue
   xpos -370
   ypos 86
  }
  Expression {
   temp_name0 hue
   temp_expr0 r
   temp_name1 centerH
   temp_expr1 RRT_RED_HUE
   temp_name2 hueCentered
   temp_expr2 hue-centerH
   channel0 {-rgba.red rgba.green -rgba.blue -rgba.alpha}
   expr0 "hueCentered < -180.0 ? hueCentered + 360.0 : (hueCentered > 180.0) ? hueCentered - 360.0 : hueCentered"
   name center_hue
   xpos -370
   ypos 134
  }
  Expression {
   temp_name0 centeredHue
   temp_expr0 g
   temp_name1 knot_coord
   temp_expr1 "(centeredHue - knots.0) * 4.0/w"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   channel0 {rgba.red -rgba.green -rgba.blue -rgba.alpha}
   expr0 "(min((centeredHue > knots.0?1:0) , (centeredHue < knots.4?1:0)) ? j == 3 ? t*t*t * -1./6 + t*t * 3./6 +  t * -3./6 + 1 * 1./6 : j == 2 ? t*t*t * 3./6 + t*t * -6./6 + t * 0./6 + 1. *4./6 : j == 1 ? t*t*t * -3./6 + t*t * 3./6 + t * 3./6 + 1. * 1./6 : j == 0 ? t*t*t * 1./6 + t*t * 0./6 + t * 0./6 + 1. * 0./6 : 0 : 0) * 3/2"
   channel1 none
   channel2 none
   name cubic_basis_shaper
   xpos -370
   ypos 182
   addUserKnob {20 param}
   addUserKnob {7 w R 0 360}
   w {{parent.RRT_RED_WIDTH}}
   addUserKnob {78 knots n 5}
   knots {{-w/2} {-w/4} 0 {w/4} {w/2}}
  }
  Dot {
   name Dot4
   xpos -336
   ypos 234
  }
  Copy {
   inputs 2
   from0 rgba.blue
   to0 rgba.blue
   name Copy4
   note_font Helvetica
   xpos -260
   ypos 226
  }
  Dot {
   name Dot6
   label " r : hueWeight\n g : centeredHue\n b : saturation"
   note_font "Helvetica \[pyrs]"
   note_font_size 12
   note_font_color 0xff
   xpos -226
   ypos 282
  }
  Dot {
   name Dot7
   xpos -226
   ypos 330
  }
set N5a012c00 [stack 0]
push $N5a079800
  Dot {
   name Dot8
   xpos -6
   ypos 258
  }
set N5a012800 [stack 0]
  MergeExpression {
   inputs 2
   temp_name0 minChan
   temp_expr0 "Ag < 0 ? Bg : Bb"
   temp_name1 a_
   temp_expr1 "Ar * (1. - RRT_RED_SCALE) - 1."
   temp_name2 b
   temp_expr2 "Br - Ar* (RRT_RED_PIVOT + minChan) * (1. - RRT_RED_SCALE)"
   temp_name3 c
   temp_expr3 "Ar * RRT_RED_PIVOT * minChan * (1. - RRT_RED_SCALE)"
   expr0 "( -b - sqrt( b * b - 4. * a_ * c)) / ( 2. * a_)"
   name red_modifier_rev
   note_font Helvetica
   xpos -150
   ypos 351
  }
push $N5a012c00
push $N5a012800
  MergeExpression {
   inputs 2
   expr0 "r + Ar * Ab * (RRT_RED_PIVOT - r) * (1. - RRT_RED_SCALE)"
   name red_modifier_fwd
   note_font Helvetica
   xpos -40
   ypos 327
  }
  Switch {
   inputs 2
   which {{parent.invert}}
   name Switch_direction
   note_font Helvetica
   xpos -40
   ypos 423
  }
  Output {
   name Output
   xpos -40
   ypos 494
  }
 end_group
 Clamp {
  channels rgb
  maximum_enable false
  name clamp_f3_min
  label "Clamp Negative Values"
  xpos -1250
  ypos -976
 }
 ColorMatrix {
  matrix {
      {1.451439381 -0.2365107685 -0.2149285674}
      {-0.07655383646 1.176229835 -0.09967593104}
      {0.008316127583 -0.0060324613 0.997716248}
    }
  name ColorMatrix15
  label "ACES to ACEScg"
  xpos -1250
  ypos -928
 }
 Clamp {
  channels rgb
  maximum 65535
  name clamp_f3_
  label "clamp to HALF_MAX"
  xpos -1250
  ypos -880
 }
 ColorMatrix {
  matrix {
      {{"(1.0 - sat) * rgb2Y.x + sat"} {"(1.0 - sat) * rgb2Y.y"} {"(1.0 - sat) * rgb2Y.z"}}
      {{"(1.0 - sat) * rgb2Y.x"} {"(1.0 - sat) * rgb2Y.y + sat"} {"(1.0 - sat) * rgb2Y.z"}}
      {{"(1.0 - sat) * rgb2Y.x"} {"(1.0 - sat) * rgb2Y.y"} {"(1.0 - sat) * rgb2Y.z + sat"}}
    }
  name ColorMatrix
  label "// --- Global desaturation --- //\nrgbPre = mult_f3_f33( rgbPre, RRT_SAT_MAT);"
  xpos -1250
  ypos -790
  addUserKnob {20 params}
  addUserKnob {13 rgb2Y}
  rgb2Y {0.27222875 0.67408174 0.05368952}
  addUserKnob {7 sat}
  sat 0.96
 }
 Dot {
  name Dot29
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xff
  xpos -1216
  ypos -558
 }
set N5a010800 [stack 0]
 Group {
  name ssts
  xpos -1250
  ypos -514
  addUserKnob {20 ssts_tab l ssts}
  addUserKnob {26 display_label l " " T "<b>Display Settings</b>"}
  addUserKnob {78 lum l luminance t "<b>SSTS Display Luminance</b>: \ny_min y_mid y_max\n\nAccording to Zach Lewis's ACES_OT\nhttps://gist.github.com/zachlewis/786c0be941868644c993fde1c3515c2c\n\n<b>Standard Cinema</b>: \n0.02 4.8 48\n<b>Dolby Cinema</b>: \n0.0001 7.2 108\n<b>Dolby Pulsar</b>: \n0.005 15 4000\n<b>Dolby PRR-4220</b>: \n0.005 10 600\n<b>Sony BVM-X300</b>: \n0.0001 10 1000\n<b>ACES OCES</b>: \n0.0001 4.8 10000\n\n" n 3}
  lum {{"use_c9 ? 0.0001 : parent.lum"} {parent.lum} {"use_c9 ? 10000 : parent.lum"}}
  addUserKnob {6 override_ssts_params l "override ssts params" t "Enable overrides of SSTS params.\n\nOtherwise the values will be calculated automatically by the algorithm." +STARTLINE}
  override_ssts_params {{parent.override_ssts_params}}
  addUserKnob {7 exposure R -5 5}
  exposure {{parent.exposure}}
  addUserKnob {7 knee}
  knee {{parent.pctLow}}
  addUserKnob {7 shoulder}
  shoulder {{parent.pctHigh}}
  addUserKnob {78 slope n 3}
  slope {{parent.slope} {parent.slope} {parent.slope}}
  addUserKnob {20 TsParams_tab l TsParams}
  addUserKnob {7 mid_lum l "mid lum" R 0 20}
  mid_lum {{parent.lum.1}}
  addUserKnob {7 expShift R -4 4}
  expShift {{"(parent.override_ssts_params ? exposure : 0) + (mid_lum<= 4.8 ? 0 : \[sample parent.expShift r 0 0] )"}}
  addUserKnob {13 minPoint t "x;        // ACES\ny;        // luminance\nz;        // slope"}
  minPoint {{"pow(2, log(0.18*pow(2, MIN_STOP_RRT+((MIN_STOP_SDR-MIN_STOP_RRT)/(log10(MIN_LUM_SDR)-log10(MIN_LUM_RRT)))*(log10(minPoint.y)-log10(MIN_LUM_RRT))))/log(2)-expShift)"} {lum.0} {override_ssts_params?slope.0:0}}
  addUserKnob {13 midPoint t "x;        // ACES\ny;        // luminance\nz;        // slope"}
  midPoint {{"pow(2, ((log(0.18)/log(2)-expShift)))"} 4.8 {override_ssts_params?slope.1:1.55}}
  addUserKnob {13 maxPoint t "x;        // ACES\ny;        // luminance\nz;        // slope"}
  maxPoint {{"pow(2, log(0.18*pow(2, (MAX_STOP_SDR + (MAX_STOP_RRT-MAX_STOP_SDR) / (log10(MAX_LUM_RRT)-log10(MAX_LUM_SDR)) * (log10(maxPoint.y)-log10(MAX_LUM_SDR)))))/log(2)-expShift)"} {lum.2} {override_ssts_params?slope.2:0}}
  addUserKnob {7 knotIncLow}
  knotIncLow {{"(log10(midPoint.x) - log10(minPoint.x)) / 3.0"}}
  addUserKnob {7 knotIncHigh}
  knotIncHigh {{"(log10(maxPoint.x) - log10(midPoint.x)) / 3.0"}}
  addUserKnob {7 pctLow}
  pctLow {{0.18+(0.35-0.18)/(MIN_STOP_SDR-MIN_STOP_RRT)*(log(minPoint.x/0.18)/log(2)-MIN_STOP_RRT)}}
  addUserKnob {7 pctHigh}
  pctHigh {{0.89+(0.90-0.89)/(MAX_STOP_SDR-MAX_STOP_RRT)*(log(maxPoint.x/0.89)/log(2)-MAX_STOP_RRT)}}
  addUserKnob {78 coefsLow n 5}
  coefsLow {{"(minPoint.z * (log10(minPoint.x)-0.5*knotIncLow)) + ( log10(minPoint.y) - minPoint.z * log10(minPoint.x))"} {"(minPoint.z * (log10(minPoint.x)+0.5*knotIncLow)) + ( log10(minPoint.y) - minPoint.z * log10(minPoint.x))"} {log10(minPoint.y)+pctLow*(log10(midPoint.y)-log10(minPoint.y))} {"(midPoint.z * (log10(midPoint.x)-0.5*knotIncLow)) + ( log10(midPoint.y) - midPoint.z * log10(midPoint.x))"} {"(midPoint.z * (log10(midPoint.x)+0.5*knotIncLow)) + ( log10(midPoint.y) - midPoint.z * log10(midPoint.x))"}}
  addUserKnob {78 coefsHigh n 5}
  coefsHigh {{"(midPoint.z * (log10(midPoint.x)-0.5*knotIncHigh)) + ( log10(midPoint.y) - midPoint.z * log10(midPoint.x))"} {"(midPoint.z * (log10(midPoint.x)+0.5*knotIncHigh)) + ( log10(midPoint.y) - midPoint.z * log10(midPoint.x))"} {log10(midPoint.y)+pctHigh*(log10(maxPoint.y)-log10(midPoint.y))} {"(maxPoint.z * (log10(maxPoint.x)-0.5*knotIncHigh)) + ( log10(maxPoint.y) - maxPoint.z * log10(maxPoint.x))"} {"(maxPoint.z * (log10(maxPoint.x)+0.5*knotIncHigh)) + ( log10(maxPoint.y) - maxPoint.z * log10(maxPoint.x))"}}
  addUserKnob {20 Constants_tab l const}
  addUserKnob {3 N_KNOTS_LOW}
  N_KNOTS_LOW 4
  addUserKnob {3 N_KNOTS_HIGH}
  N_KNOTS_HIGH 4
  addUserKnob {7 MIN_STOP_SDR R -20 20}
  MIN_STOP_SDR -6.5
  addUserKnob {7 MAX_STOP_SDR R -20 20}
  MAX_STOP_SDR 6.5
  addUserKnob {7 MIN_STOP_RRT R -20 20}
  MIN_STOP_RRT -15
  addUserKnob {7 MAX_STOP_RRT R -20 20}
  MAX_STOP_RRT 18
  addUserKnob {7 MIN_LUM_SDR R 0 0.1}
  MIN_LUM_SDR 0.02
  addUserKnob {7 MAX_LUM_SDR R 0 100}
  MAX_LUM_SDR 48
  addUserKnob {7 MIN_LUM_RRT R 0 0.1}
  MIN_LUM_RRT 0.0001
  addUserKnob {7 MAX_LUM_RRT R 0 10000}
  MAX_LUM_RRT 10000
 }
  Input {
   inputs 0
   name Input
   xpos -1030
   ypos -634
  }
  Dot {
   name Dot25
   label " "
   xpos -996
   ypos -318
  }
set N5a3a7c00 [stack 0]
  Dot {
   name Dot26
   label " "
   xpos -996
   ypos 1506
  }
push $N5a3a7c00
  Dot {
   name Dot4
   label " "
   xpos -886
   ypos -318
  }
set N5a3a7400 [stack 0]
  Dot {
   name Dot5
   label " "
   xpos -776
   ypos -318
  }
set N5a3a7000 [stack 0]
  Dot {
   name Dot2
   label " "
   xpos -666
   ypos -318
  }
set N5a3a6c00 [stack 0]
  Dot {
   name Dot3
   label " "
   xpos -556
   ypos -318
  }
set N5a3a6800 [stack 0]
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   expr0 "logr <= log10(minPoint.x)"
   expr1 "logg <= log10(minPoint.x)"
   expr2 "logb <= log10(minPoint.x)"
   name segment_bottom
   xpos -590
   ypos -178
  }
  Dot {
   name Dot1
   label " "
   xpos -556
   ypos 162
  }
push $N5a3a6800
  Dot {
   name Dot7
   label " "
   xpos -336
   ypos -318
  }
set N5a3a5c00 [stack 0]
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 "logr * minPoint.z + ( log10(minPoint.y) - minPoint.z * log10(minPoint.x) )"
   expr1 "logg * minPoint.z + ( log10(minPoint.y) - minPoint.z * log10(minPoint.x) )"
   expr2 "logb* minPoint.z + ( log10(minPoint.y) - minPoint.z * log10(minPoint.x) )"
   expr3 1
   name Expression
   xpos -370
   ypos -178
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply3
   xpos -370
   ypos 158
  }
  Dot {
   name Dot27
   label " "
   xpos -336
   ypos 786
  }
push $N5a3a6c00
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   expr0 "( logr > log10(minPoint.x) ) * ( logr < log10(midPoint.x) )"
   expr1 "( logg > log10(minPoint.x) ) * ( logg < log10(midPoint.x) )"
   expr2 "( logb > log10(minPoint.x) ) * ( logb < log10(midPoint.x) )"
   name segment_low
   xpos -700
   ypos -178
  }
  Dot {
   name Dot22
   label " "
   xpos -666
   ypos 354
  }
push $N5a3a5c00
  Dot {
   name Dot9
   label " "
   xpos -6
   ypos -318
  }
set N5a3a4400 [stack 0]
  Dot {
   name Dot6
   label " "
   xpos -6
   ypos -198
  }
set N5a373c00 [stack 0]
  Dot {
   name Dot8
   label " "
   xpos 214
   ypos -198
  }
set N5a373800 [stack 0]
  Dot {
   name Dot13
   label " "
   xpos 434
   ypos -198
  }
  Dot {
   name Dot12
   label " "
   xpos 434
   ypos -78
  }
set N5a373000 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsLow.0 : j == 1 ? coefsLow.1 : j == 2 ? coefsLow.2 :j == 3 ? coefsLow.3 : j == 4 ? coefsLow.4 : 0"
   expr1 "j == 0 ? coefsLow.1 : j == 1 ? coefsLow.2 : j == 2 ? coefsLow.3 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
   expr2 "j == 0 ? coefsLow.2 : j == 1 ? coefsLow.3 : j == 2 ? coefsLow.4 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
   name Expression5
   xpos 290
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix3
   label "mult_f3_f33( cf, M)"
   xpos 290
   ypos 8
  }
push $N5a373000
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression6
   xpos 400
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 0
   expr1 0
   expr2 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   name dot_f3_f2
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 400
   ypos 8
  }
push 0
push $N5a373800
  Dot {
   name Dot11
   label " "
   xpos 214
   ypos -78
  }
set N5a371c00 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsLow.0 : j == 1 ? coefsLow.1 : j == 2 ? coefsLow.2 :j == 3 ? coefsLow.3 : j == 4 ? coefsLow.4 : 0"
   expr1 "j == 0 ? coefsLow.1 : j == 1 ? coefsLow.2 : j == 2 ? coefsLow.3 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
   expr2 "j == 0 ? coefsLow.2 : j == 1 ? coefsLow.3 : j == 2 ? coefsLow.4 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
   name Expression3
   xpos 70
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix1
   label "mult_f3_f33( cf, M)"
   xpos 70
   ypos 8
  }
push $N5a371c00
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression4
   xpos 180
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 0
   expr1 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   expr2 0
   name dot_f3_f7
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 180
   ypos 8
  }
push $N5a373c00
  Dot {
   name Dot10
   label " "
   xpos -6
   ypos -78
  }
set N5a370800 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsLow.0 : j == 1 ? coefsLow.1 : j == 2 ? coefsLow.2 :j == 3 ? coefsLow.3 : j == 4 ? coefsLow.4 : 0"
   expr1 "j == 0 ? coefsLow.1 : j == 1 ? coefsLow.2 : j == 2 ? coefsLow.3 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
   expr2 "j == 0 ? coefsLow.2 : j == 1 ? coefsLow.3 : j == 2 ? coefsLow.4 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
   name Expression1
   xpos -150
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix2
   label "mult_f3_f33( cf, M)"
   xpos -150
   ypos 8
  }
push $N5a370800
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression2
   xpos -40
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   expr1 0
   expr2 0
   name dot_f3_f1
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos -40
   ypos 8
  }
  Merge2 {
   inputs 3+1
   operation plus
   bbox B
   output rgb
   name Merge1
   xpos 180
   ypos 158
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply1
   xpos 180
   ypos 350
  }
  Dot {
   name Dot28
   label " "
   xpos 214
   ypos 786
  }
push 0
push $N5a3a7000
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   expr0 "( logr >= log10(midPoint.x) ) * ( logr < log10(maxPoint.x) )"
   expr1 "( logg >= log10(midPoint.x) ) * ( logg < log10(maxPoint.x) )"
   expr2 "( logb >= log10(midPoint.x) ) * ( logb < log10(maxPoint.x) )"
   name segment_high
   xpos -810
   ypos -178
  }
  Dot {
   name Dot23
   label " "
   xpos -776
   ypos 474
  }
push $N5a3a4400
  Dot {
   name Dot14
   label " "
   xpos 764
   ypos -318
  }
set N5a311c00 [stack 0]
  Dot {
   name Dot15
   label " "
   xpos 764
   ypos -198
  }
set N5a311800 [stack 0]
  Dot {
   name Dot17
   label " "
   xpos 984
   ypos -198
  }
set N5a311400 [stack 0]
  Dot {
   name Dot20
   label " "
   xpos 1204
   ypos -198
  }
  Dot {
   name Dot19
   label " "
   xpos 1204
   ypos -78
  }
set N5a310c00 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsHigh.0 : j == 1 ? coefsHigh.1 : j == 2 ? coefsHigh.2 :j == 3 ? coefsHigh.3 : j == 4 ? coefsHigh.4 : 0"
   expr1 "j == 0 ? coefsHigh.1 : j == 1 ? coefsHigh.2 : j == 2 ? coefsHigh.3 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
   expr2 "j == 0 ? coefsHigh.2 : j == 1 ? coefsHigh.3 : j == 2 ? coefsHigh.4 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
   expr3 j
   name Expression11
   xpos 1060
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix6
   label "mult_f3_f33( cf, M)"
   xpos 1060
   ypos 8
  }
push $N5a310c00
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression12
   xpos 1170
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 0
   expr1 0
   expr2 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   name dot_f3_f6
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 1170
   ypos 8
  }
push 0
push $N5a311400
  Dot {
   name Dot18
   label " "
   xpos 984
   ypos -78
  }
set N5a6a7400 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsHigh.0 : j == 1 ? coefsHigh.1 : j == 2 ? coefsHigh.2 :j == 3 ? coefsHigh.3 : j == 4 ? coefsHigh.4 : 0"
   expr1 "j == 0 ? coefsHigh.1 : j == 1 ? coefsHigh.2 : j == 2 ? coefsHigh.3 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
   expr2 "j == 0 ? coefsHigh.2 : j == 1 ? coefsHigh.3 : j == 2 ? coefsHigh.4 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
   expr3 j
   name Expression9
   xpos 840
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix5
   label "mult_f3_f33( cf, M)"
   xpos 840
   ypos 8
  }
push $N5a6a7400
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression10
   xpos 950
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 0
   expr1 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   expr2 0
   name dot_f3_f5
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 950
   ypos 8
  }
push $N5a311800
  Dot {
   name Dot16
   label " "
   xpos 764
   ypos -78
  }
set N5a6a6000 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsHigh.0 : j == 1 ? coefsHigh.1 : j == 2 ? coefsHigh.2 :j == 3 ? coefsHigh.3 : j == 4 ? coefsHigh.4 : 0"
   expr1 "j == 0 ? coefsHigh.1 : j == 1 ? coefsHigh.2 : j == 2 ? coefsHigh.3 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
   expr2 "j == 0 ? coefsHigh.2 : j == 1 ? coefsHigh.3 : j == 2 ? coefsHigh.4 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
   expr3 j
   name Expression7
   xpos 620
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix4
   label "mult_f3_f33( cf, M)"
   xpos 620
   ypos 8
  }
push $N5a6a6000
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression8
   xpos 730
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   expr1 0
   expr2 0
   name dot_f3_f4
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 730
   ypos 8
  }
  Merge2 {
   inputs 3+1
   operation plus
   bbox B
   output rgb
   name Merge2
   xpos 950
   ypos 158
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply2
   xpos 950
   ypos 470
  }
  Dot {
   name Dot29
   label " "
   xpos 984
   ypos 786
  }
push $N5a3a7400
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   expr0 "logr >= log10(maxPoint.x) ? 1 : 0"
   expr1 "logg >= log10(maxPoint.x) ? 1 : 0"
   expr2 "logb >= log10(maxPoint.x) ? 1 : 0"
   name segment_peak
   xpos -920
   ypos -178
  }
  Dot {
   name Dot24
   label " "
   xpos -886
   ypos 618
  }
push $N5a311c00
  Dot {
   name Dot21
   label " "
   xpos 1534
   ypos -318
  }
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 "logr * maxPoint.z + ( log10(maxPoint.y) - maxPoint.z * log10(maxPoint.x) )"
   expr1 "logg * maxPoint.z + ( log10(maxPoint.y) - maxPoint.z * log10(maxPoint.x) )"
   expr2 "logb* maxPoint.z + ( log10(maxPoint.y) - maxPoint.z * log10(maxPoint.x) )"
   expr3 1
   name proc_low1
   label Expression
   xpos 1500
   ypos -160
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply4
   xpos 1500
   ypos 614
  }
  Dot {
   name Dot30
   xpos 1534
   ypos 810
  }
  Merge2 {
   inputs 4+1
   operation plus
   bbox B
   output rgb
   name Merge3
   xpos 510
   ypos 1118
  }
  Expression {
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 pow(10,r)
   expr1 pow(10,g)
   expr2 pow(10,b)
   name Expression13
   xpos 510
   ypos 1238
  }
  Copy {
   inputs 2
   from0 rgba.alpha
   to0 rgba.alpha
   name Copy1
   xpos 510
   ypos 1496
  }
  Output {
   name Output1
   xpos 510
   ypos 1814
  }
 end_group
 Dot {
  name Dot23
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1216
  ypos -462
 }
set N5a63d400 [stack 0]
 Dot {
  name Dot22
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1656
  ypos -462
 }
 ColorMatrix {
  matrix {
      {0.6954522133 0.1406786889 0.163869068}
      {0.04479461163 0.8596711159 0.09553432465}
      {-0.005525866989 0.004025223665 1.001500726}
    }
  name ColorMatrix7
  label "ACEScg to ACES"
  note_font Helvetica
  xpos -1690
  ypos -398
 }
 Dot {
  name Dot21
  label " OCES"
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1656
  ypos 2658
 }
push $N5a63d400
 Dot {
  name Dot28
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1216
  ypos -342
 }
set N5a63c400 [stack 0]
 Group {
  name segmented_spline_c9_fwd
  xpos -1140
  ypos -346
  addUserKnob {20 SegmentedSplineParams_c9_tab l SegmentedSplineParams_c9}
  addUserKnob {78 coefsLow n 10}
  coefsLow {-1.698970004 -1.698970004 -1.4779 -1.2291 -0.8648 -0.448 0.00518 0.4511080334 0.9113744414 0.9113744414}
  addUserKnob {78 coefsHigh n 10}
  coefsHigh {0.5154386965 0.8470437783 1.1358 1.3802 1.5197 1.5985 1.6467 1.674609136 1.687873339 1.687873339}
  addUserKnob {12 minPoint}
  minPoint {0.0028799 0.02}
  addUserKnob {12 midPoint}
  midPoint {4.79999924 4.8}
  addUserKnob {12 maxPoint}
  maxPoint {1005.719116 48}
  addUserKnob {7 slopeLow}
  addUserKnob {7 slopeHigh}
  slopeHigh 0.04
  addUserKnob {3 N_KNOTS_LOW}
  N_KNOTS_LOW 8
  addUserKnob {3 N_KNOTS_HIGH}
  N_KNOTS_HIGH 8
 }
  Input {
   inputs 0
   name Input
   xpos -1030
   ypos -634
  }
  Dot {
   name Dot25
   label " "
   xpos -996
   ypos -318
  }
set N5a5df800 [stack 0]
  Dot {
   name Dot26
   label " "
   xpos -996
   ypos 1506
  }
push $N5a5df800
  Dot {
   name Dot4
   label " "
   xpos -886
   ypos -318
  }
set N5a5df000 [stack 0]
  Dot {
   name Dot5
   label " "
   xpos -776
   ypos -318
  }
set N5a5dec00 [stack 0]
  Dot {
   name Dot2
   label " "
   xpos -666
   ypos -318
  }
set N5a5de800 [stack 0]
  Dot {
   name Dot3
   label " "
   xpos -556
   ypos -318
  }
set N5a5de400 [stack 0]
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   expr0 "logr <= log10(minPoint.x)"
   expr1 "logg <= log10(minPoint.x)"
   expr2 "logb <= log10(minPoint.x)"
   name segment_bottom
   xpos -590
   ypos -178
  }
  Dot {
   name Dot1
   label " "
   xpos -556
   ypos 162
  }
push $N5a5de400
  Dot {
   name Dot7
   label " "
   xpos -336
   ypos -318
  }
set N5a5dd800 [stack 0]
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 "logr * slopeLow + ( log10(minPoint.y) - slopeLow * log10(minPoint.x) )"
   expr1 "logg * slopeLow + ( log10(minPoint.y) - slopeLow * log10(minPoint.x) )"
   expr2 "logb* slopeLow + ( log10(minPoint.y) - slopeLow * log10(minPoint.x) )"
   expr3 1
   name Expression
   xpos -370
   ypos -178
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply3
   xpos -370
   ypos 158
  }
  Dot {
   name Dot27
   label " "
   xpos -336
   ypos 786
  }
push $N5a5de800
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   expr0 "( logr > log10(minPoint.x) ) * ( logr < log10(midPoint.x) )"
   expr1 "( logg > log10(minPoint.x) ) * ( logg < log10(midPoint.x) )"
   expr2 "( logb > log10(minPoint.x) ) * ( logb < log10(midPoint.x) )"
   name segment_low
   xpos -700
   ypos -178
  }
  Dot {
   name Dot22
   label " "
   xpos -666
   ypos 354
  }
push $N5a5dd800
  Dot {
   name Dot9
   label " "
   xpos -6
   ypos -318
  }
set N5a5a3c00 [stack 0]
  Dot {
   name Dot6
   label " "
   xpos -6
   ypos -198
  }
set N5a5a3800 [stack 0]
  Dot {
   name Dot8
   label " "
   xpos 214
   ypos -198
  }
set N5a5a3400 [stack 0]
  Dot {
   name Dot13
   label " "
   xpos 434
   ypos -198
  }
  Dot {
   name Dot12
   label " "
   xpos 434
   ypos -78
  }
set N5a5a2c00 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsLow.0 : j == 1 ? coefsLow.1 : j == 2 ? coefsLow.2 :j == 3 ? coefsLow.3 : j == 4 ? coefsLow.4 : j == 5 ? coefsLow.5 : j == 6 ? coefsLow.6 : j == 7 ? coefsLow.7 : j == 8 ? coefsLow.8 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr1 "j == 0 ? coefsLow.1 : j == 1 ? coefsLow.2 : j == 2 ? coefsLow.3 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.5 : j == 5 ? coefsLow.6 : j == 6 ? coefsLow.7 : j == 7 ? coefsLow.8 : j == 8 ? coefsLow.9 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr2 "j == 0 ? coefsLow.2 : j == 1 ? coefsLow.3 : j == 2 ? coefsLow.4 :j == 3 ? coefsLow.5 : j == 4 ? coefsLow.6 : j == 5 ? coefsLow.7 : j == 6 ? coefsLow.8 : j == 7 ? coefsLow.9 : j == 8 ? coefsLow.9 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr3 j
   name Expression15
   xpos 290
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix3
   label "mult_f3_f33( cf, M)"
   xpos 290
   ypos 8
  }
push $N5a5a2c00
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression6
   xpos 400
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 0
   expr1 0
   expr2 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   name dot_f3_f2
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 400
   ypos 8
  }
push 0
push $N5a5a3400
  Dot {
   name Dot11
   label " "
   xpos 214
   ypos -78
  }
set N5a5a1800 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsLow.0 : j == 1 ? coefsLow.1 : j == 2 ? coefsLow.2 :j == 3 ? coefsLow.3 : j == 4 ? coefsLow.4 : j == 5 ? coefsLow.5 : j == 6 ? coefsLow.6 : j == 7 ? coefsLow.7 : j == 8 ? coefsLow.8 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr1 "j == 0 ? coefsLow.1 : j == 1 ? coefsLow.2 : j == 2 ? coefsLow.3 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.5 : j == 5 ? coefsLow.6 : j == 6 ? coefsLow.7 : j == 7 ? coefsLow.8 : j == 8 ? coefsLow.9 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr2 "j == 0 ? coefsLow.2 : j == 1 ? coefsLow.3 : j == 2 ? coefsLow.4 :j == 3 ? coefsLow.5 : j == 4 ? coefsLow.6 : j == 5 ? coefsLow.7 : j == 6 ? coefsLow.8 : j == 7 ? coefsLow.9 : j == 8 ? coefsLow.9 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr3 j
   name Expression14
   xpos 70
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix1
   label "mult_f3_f33( cf, M)"
   xpos 70
   ypos 8
  }
push $N5a5a1800
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression4
   xpos 180
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 0
   expr1 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   expr2 0
   name dot_f3_f7
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 180
   ypos 8
  }
push $N5a5a3800
  Dot {
   name Dot10
   label " "
   xpos -6
   ypos -78
  }
set N5a5a0400 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsLow.0 : j == 1 ? coefsLow.1 : j == 2 ? coefsLow.2 :j == 3 ? coefsLow.3 : j == 4 ? coefsLow.4 : j == 5 ? coefsLow.5 : j == 6 ? coefsLow.6 : j == 7 ? coefsLow.7 : j == 8 ? coefsLow.8 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr1 "j == 0 ? coefsLow.1 : j == 1 ? coefsLow.2 : j == 2 ? coefsLow.3 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.5 : j == 5 ? coefsLow.6 : j == 6 ? coefsLow.7 : j == 7 ? coefsLow.8 : j == 8 ? coefsLow.9 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr2 "j == 0 ? coefsLow.2 : j == 1 ? coefsLow.3 : j == 2 ? coefsLow.4 :j == 3 ? coefsLow.5 : j == 4 ? coefsLow.6 : j == 5 ? coefsLow.7 : j == 6 ? coefsLow.8 : j == 7 ? coefsLow.9 : j == 8 ? coefsLow.9 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr3 j
   name Expression1
   xpos -150
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix2
   label "mult_f3_f33( cf, M)"
   xpos -150
   ypos 8
  }
push $N5a5a0400
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression2
   xpos -40
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   expr1 0
   expr2 0
   name dot_f3_f1
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos -40
   ypos 8
  }
  Merge2 {
   inputs 3+1
   operation plus
   bbox B
   output rgb
   name Merge1
   xpos 180
   ypos 158
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply1
   xpos 180
   ypos 350
  }
  Dot {
   name Dot28
   label " "
   xpos 214
   ypos 786
  }
push 0
push $N5a5dec00
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   expr0 "( logr >= log10(midPoint.x) ) * ( logr < log10(maxPoint.x) )"
   expr1 "( logg >= log10(midPoint.x) ) * ( logg < log10(maxPoint.x) )"
   expr2 "( logb >= log10(midPoint.x) ) * ( logb < log10(maxPoint.x) )"
   name segment_high
   xpos -810
   ypos -178
  }
  Dot {
   name Dot23
   label " "
   xpos -776
   ypos 474
  }
push $N5a5a3c00
  Dot {
   name Dot14
   label " "
   xpos 764
   ypos -318
  }
set N5a549800 [stack 0]
  Dot {
   name Dot15
   label " "
   xpos 764
   ypos -198
  }
set N5a549400 [stack 0]
  Dot {
   name Dot17
   label " "
   xpos 984
   ypos -198
  }
set N5a549000 [stack 0]
  Dot {
   name Dot20
   label " "
   xpos 1204
   ypos -198
  }
  Dot {
   name Dot19
   label " "
   xpos 1204
   ypos -78
  }
set N5a548800 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsHigh.0 : j == 1 ? coefsHigh.1 : j == 2 ? coefsHigh.2 :j == 3 ? coefsHigh.3 : j == 4 ? coefsHigh.4 : j == 5 ? coefsHigh.5 : j == 6 ? coefsHigh.6 : j == 7 ? coefsHigh.7 : j == 8 ? coefsHigh.8 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr1 "j == 0 ? coefsHigh.1 : j == 1 ? coefsHigh.2 : j == 2 ? coefsHigh.3 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.5 : j == 5 ? coefsHigh.6 : j == 6 ? coefsHigh.7 : j == 7 ? coefsHigh.8 : j == 8 ? coefsHigh.9 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr2 "j == 0 ? coefsHigh.2 : j == 1 ? coefsHigh.3 : j == 2 ? coefsHigh.4 :j == 3 ? coefsHigh.5 : j == 4 ? coefsHigh.6 : j == 5 ? coefsHigh.7 : j == 6 ? coefsHigh.8 : j == 7 ? coefsHigh.9 : j == 8 ? coefsHigh.9 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr3 j
   name Expression3
   xpos 1060
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix6
   label "mult_f3_f33( cf, M)"
   xpos 1060
   ypos 8
  }
push $N5a548800
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression12
   xpos 1170
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 0
   expr1 0
   expr2 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   name dot_f3_f6
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 1170
   ypos 8
  }
push 0
push $N5a549000
  Dot {
   name Dot18
   label " "
   xpos 984
   ypos -78
  }
set N5a4eb000 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsHigh.0 : j == 1 ? coefsHigh.1 : j == 2 ? coefsHigh.2 :j == 3 ? coefsHigh.3 : j == 4 ? coefsHigh.4 : j == 5 ? coefsHigh.5 : j == 6 ? coefsHigh.6 : j == 7 ? coefsHigh.7 : j == 8 ? coefsHigh.8 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr1 "j == 0 ? coefsHigh.1 : j == 1 ? coefsHigh.2 : j == 2 ? coefsHigh.3 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.5 : j == 5 ? coefsHigh.6 : j == 6 ? coefsHigh.7 : j == 7 ? coefsHigh.8 : j == 8 ? coefsHigh.9 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr2 "j == 0 ? coefsHigh.2 : j == 1 ? coefsHigh.3 : j == 2 ? coefsHigh.4 :j == 3 ? coefsHigh.5 : j == 4 ? coefsHigh.6 : j == 5 ? coefsHigh.7 : j == 6 ? coefsHigh.8 : j == 7 ? coefsHigh.9 : j == 8 ? coefsHigh.9 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr3 j
   name Expression5
   xpos 840
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix5
   label "mult_f3_f33( cf, M)"
   xpos 840
   ypos 8
  }
push $N5a4eb000
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression10
   xpos 950
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 0
   expr1 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   expr2 0
   name dot_f3_f5
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 950
   ypos 8
  }
push $N5a549400
  Dot {
   name Dot16
   label " "
   xpos 764
   ypos -78
  }
set N5a4e9c00 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsHigh.0 : j == 1 ? coefsHigh.1 : j == 2 ? coefsHigh.2 :j == 3 ? coefsHigh.3 : j == 4 ? coefsHigh.4 : j == 5 ? coefsHigh.5 : j == 6 ? coefsHigh.6 : j == 7 ? coefsHigh.7 : j == 8 ? coefsHigh.8 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr1 "j == 0 ? coefsHigh.1 : j == 1 ? coefsHigh.2 : j == 2 ? coefsHigh.3 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.5 : j == 5 ? coefsHigh.6 : j == 6 ? coefsHigh.7 : j == 7 ? coefsHigh.8 : j == 8 ? coefsHigh.9 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr2 "j == 0 ? coefsHigh.2 : j == 1 ? coefsHigh.3 : j == 2 ? coefsHigh.4 :j == 3 ? coefsHigh.5 : j == 4 ? coefsHigh.6 : j == 5 ? coefsHigh.7 : j == 6 ? coefsHigh.8 : j == 7 ? coefsHigh.9 : j == 8 ? coefsHigh.9 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr3 j
   name Expression16
   xpos 620
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix4
   label "mult_f3_f33( cf, M)"
   xpos 620
   ypos 8
  }
push $N5a4e9c00
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression8
   xpos 730
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   expr1 0
   expr2 0
   name dot_f3_f4
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 730
   ypos 8
  }
  Merge2 {
   inputs 3+1
   operation plus
   bbox B
   output rgb
   name Merge2
   xpos 950
   ypos 158
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply2
   xpos 950
   ypos 470
  }
  Dot {
   name Dot29
   label " "
   xpos 984
   ypos 786
  }
push $N5a5df000
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   expr0 "logr >= log10(maxPoint.x) ? 1 : 0"
   expr1 "logg >= log10(maxPoint.x) ? 1 : 0"
   expr2 "logb >= log10(maxPoint.x) ? 1 : 0"
   name segment_peak
   xpos -920
   ypos -178
  }
  Dot {
   name Dot24
   label " "
   xpos -886
   ypos 618
  }
push $N5a549800
  Dot {
   name Dot21
   label " "
   xpos 1534
   ypos -318
  }
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 "logr * slopeHigh + ( log10(maxPoint.y) - slopeHigh * log10(maxPoint.x) )"
   expr1 "logg * slopeHigh + ( log10(maxPoint.y) - slopeHigh * log10(maxPoint.x) )"
   expr2 "logb* slopeHigh + ( log10(maxPoint.y) - slopeHigh * log10(maxPoint.x) )"
   expr3 1
   name proc_low1
   label Expression
   xpos 1500
   ypos -202
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply4
   xpos 1500
   ypos 614
  }
  Merge2 {
   inputs 4+1
   operation plus
   bbox B
   output rgb
   name Merge3
   xpos 510
   ypos 1118
  }
  Expression {
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 pow(10,r)
   expr1 pow(10,g)
   expr2 pow(10,b)
   name Expression13
   xpos 510
   ypos 1238
  }
  Copy {
   inputs 2
   from0 rgba.alpha
   to0 rgba.alpha
   name Copy1
   xpos 510
   ypos 1496
  }
  Output {
   name Output1
   xpos 510
   ypos 1814
  }
 end_group
push $N5a63c400
 Switch {
  inputs 2
  which {{parent.use_c9}}
  name Switch_c9
  xpos -1250
  ypos -298
 }
 Expression {
  expr0 "(r - Ymin) / (Ymax - Ymin)"
  expr1 "(g - Ymin) / (Ymax - Ymin)"
  expr2 "(b - Ymin) / (Ymax - Ymin)"
  expr3 1
  name Y_2_linCV_f3_
  xpos -1250
  ypos 38
  addUserKnob {20 Luminance}
  addUserKnob {7 Ymin R 0.0001 0.02}
  Ymin {{parent.lum.0}}
  addUserKnob {7 Ymax R 48 10000}
  Ymax {{parent.lum.2}}
 }
 Dot {
  name Dot12
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1216
  ypos 282
 }
set N5a46d000 [stack 0]
 Dot {
  name Dot15
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1106
  ypos 282
 }
set N5a46cc00 [stack 0]
 Dot {
  name Dot13
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -886
  ypos 282
 }
 Dot {
  name Dot16
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -886
  ypos 354
 }
set N5a46c400 [stack 0]
 Expression {
  temp_name0 tr
  temp_expr0 "(-r - c_x_0) / (c_x_1 - c_x_0)"
  temp_name1 tg
  temp_expr1 "(-g - c_x_0) / (c_x_1 - c_x_0)"
  temp_name2 tb
  temp_expr2 "(-b - c_x_0) / (c_x_1 - c_x_0)"
  expr0 "tr < 0.0 ? -(tr * c_b + c_c) : tr > 1.0 ? r : -(( tr * c_a + c_b) * tr + c_c)"
  expr1 "tg < 0.0 ? -(tg * c_b + c_c) : tg > 1.0 ? g : -(( tg * c_a + c_b) * tg + c_c)"
  expr2 "tb < 0.0 ? -(tb * c_b + c_c) : tb > 1.0 ? b : -(( tb * c_a + c_b) * tb + c_c)"
  name roll_white_fwd_1
  xpos -920
  ypos 398
  addUserKnob {20 Params}
  addUserKnob {7 new_wht}
  new_wht 0.918
  addUserKnob {7 c_width}
  c_width 0.5
  addUserKnob {7 c_x_0 +DISABLED}
  c_x_0 -1
  addUserKnob {7 c_x_1 +DISABLED}
  c_x_1 {{"c_x_0 + c_width"}}
  addUserKnob {7 c_y0 +DISABLED}
  c_y0 {{-new_wht}}
  addUserKnob {7 c_y1 +DISABLED}
  c_y1 {{c_x_1}}
  addUserKnob {7 c_m1 +DISABLED}
  c_m1 {{"(c_x_1 - c_x_0)"}}
  addUserKnob {7 c_a +DISABLED}
  c_a {{"c_y0 - c_y1 + c_m1"}}
  addUserKnob {7 c_b +DISABLED}
  c_b {{"2 * (c_y1 - c_y0) - c_m1"}}
  addUserKnob {7 c_c +DISABLED}
  c_c {{c_y0}}
 }
 Expression {
  temp_name0 SCALE
  temp_expr0 0.96
  temp_name1 NEW_WHT
  temp_expr1 0.918
  expr0 "min( r, NEW_WHT) * SCALE"
  expr1 "min( g, NEW_WHT) * SCALE"
  expr2 "min( b, NEW_WHT) * SCALE"
  name Expression2
  label "// Scale and clamp white to avoid casted highlights due to D60 simulation"
  xpos -920
  ypos 440
 }
 Dot {
  name Dot11
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -886
  ypos 498
 }
push $N5a46c400
 Expression {
  temp_name0 SCALE
  temp_expr0 0.96362
  expr0 "r * SCALE"
  expr1 "g * SCALE"
  expr2 "b * SCALE"
  name mult_f_f3_
  label D65
  xpos -1030
  ypos 344
 }
push $N5a46cc00
 Switch {
  inputs 2
  which {{"parent.display_pri < 3"}}
  name switch_wp_is_d65_
  xpos -1140
  ypos 350
 }
 Dot {
  name Dot14
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1106
  ypos 426
 }
push $N5a46d000
 Switch {
  inputs 2
  which {{parent.d60_sim}}
  name d60_sim_switch1
  xpos -1250
  ypos 422
 }
 Switch {
  inputs 2
  which {{"parent.display_pri == 3"}}
  name switch_wp_is_dci_
  xpos -1250
  ypos 494
 }
 Dot {
  name Dot26
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1216
  ypos 762
 }
set N5a416800 [stack 0]
 ColorMatrix {
  matrix {
      {{"(1.0 - sat) * rgb2Y.x + sat"} {"(1.0 - sat) * rgb2Y.y"} {"(1.0 - sat) * rgb2Y.z"}}
      {{"(1.0 - sat) * rgb2Y.x"} {"(1.0 - sat) * rgb2Y.y + sat"} {"(1.0 - sat) * rgb2Y.z"}}
      {{"(1.0 - sat) * rgb2Y.x"} {"(1.0 - sat) * rgb2Y.y"} {"(1.0 - sat) * rgb2Y.z + sat"}}
    }
  name ColorMatrix3
  label "// Apply desaturation to compensate \nfor luminance difference"
  xpos -1140
  ypos 746
  addUserKnob {20 params}
  addUserKnob {13 rgb2Y}
  rgb2Y {0.27222875 0.67408174 0.05368952}
  addUserKnob {7 sat}
  sat 0.93
 }
push $N5a416800
 Switch {
  inputs 2
  which {{"parent.eotf < 5 && display_pri < 2"}}
  name Switch_eotf
  label "Use if output is SDR"
  xpos -1250
  ypos 800
 }
 ColorMatrix {
  matrix {
      {0.6624541879 0.1340042055 0.1561876982}
      {0.2722287476 0.6740817428 0.05368951708}
      {-0.005574660841 0.004060741514 1.010339141}
    }
  name ColorMatrix1
  label "ACES AP1 to XYZ"
  xpos -1250
  ypos 968
 }
 Dot {
  name Dot8
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1216
  ypos 1146
 }
set N5a415c00 [stack 0]
 Colorspace {
  colorspace_in CIE-XYZ
  colorspace_out CIE-Yxy
  name Colorspace2
  label "\[value colorspace_in] -> \[value colorspace_out]"
  xpos -1140
  ypos 1136
 }
 Clamp {
  channels {rgba.red -rgba.green -rgba.blue none}
  maximum_enable false
  name ClampMin4
  xpos -1140
  ypos 1190
 }
 Expression {
  expr0 "pow(r, DIM_SURROUND_GAMMA)"
  expr1 g
  expr2 b
  channel3 none
  name dark_to_dim3
  xpos -1140
  ypos 1214
  addUserKnob {20 Params}
  addUserKnob {7 DIM_SURROUND_GAMMA}
  DIM_SURROUND_GAMMA 0.9811
 }
 Colorspace {
  colorspace_in CIE-Yxy
  colorspace_out CIE-XYZ
  name Colorspace4
  label "\[value colorspace_in] -> \[value colorspace_out]"
  xpos -1140
  ypos 1256
 }
push $N5a415c00
 Switch {
  inputs 2
  which {{"(parent.eotf <= 4) ? parent.dark_to_dim : 0"}}
  name DarkToDim_Switch
  label "enable if sdr\nand dark_to_dim enabled"
  xpos -1250
  ypos 1250
 }
 Dot {
  name Dot19
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1216
  ypos 1434
 }
set N5a414800 [stack 0]
 Dot {
  name Dot9
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1106
  ypos 1434
 }
set N5a414400 [stack 0]
 ColorMatrix {
  matrix {
      {0.9872254133 -0.006114810705 0.01592640579}
      {-0.007603884675 1.001874804 0.005322027951}
      {0.003066040576 -0.005084238946 1.081519246}
    }
  name ColorMatrix2
  label "CAT: Bradford\n D60 to D65"
  xpos -1140
  ypos 1466
 }
set N5a797c00 [stack 0]
push $N5a414400
 Dot {
  name Dot10
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -996
  ypos 1434
 }
push $N5a797c00
 Switch {
  inputs 2
  which {{parent.d60_sim}}
  name d60_sim_switch
  xpos -1140
  ypos 1550
 }
push $N5a414800
 Switch {
  inputs 2
  which {{"parent.display_pri < 3"}}
  name switch_wp_is_d65_1
  xpos -1250
  ypos 1550
 }
 Switch {
  inputs 2
  which {{parent.force_d65_cat}}
  name switch_force_d65_cat
  xpos -1250
  ypos 1598
 }
 Group {
  name limit_to_primaries
  label "Only enabled when display_pri != limiting_pri"
  xpos -1250
  ypos 1760
  disable {{"!(parent.display_pri != parent.limiting_pri)"}}
  addUserKnob {20 limit_to_primaries}
  addUserKnob {4 limiting_pri l "limiting pri" M {Rec709 Rec2020 P3D65 P3DCI P3D60 ACEScg ACES XYZ}}
  limiting_pri {{parent.limiting_pri}}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -298
  }
  Dot {
   name Dot1
   label " XYZ to limiting primaries"
   note_font "Helvetica Bold"
   note_font_size 24
   note_font_color 0xa5a5a501
   xpos -6
   ypos -198
  }
set N5a797000 [stack 0]
push $N5a797000
  ColorMatrix {
   matrix {
       {1.049811006 0 -9.748453158e-05}
       {-0.4959030151 1.373313069 0.09824004024}
       {4.020908051e-08 0 0.9912520051}
     }
   name ColorMatrix5
   label "XYZ to ACES"
   xpos 730
   ypos -136
  }
push $N5a797000
  ColorMatrix {
   matrix {
       {1.641023397 -0.3248033226 -0.2364246994}
       {-0.6636629701 1.615331769 0.01675636508}
       {0.01172191743 -0.008284457959 0.9883947968}
     }
   name ColorMatrix21
   label "XYZ to ACEScg"
   xpos 620
   ypos -136
  }
push $N5a797000
  ColorMatrix {
   matrix {
       {2.402741432 -0.8974840641 -0.3880533576}
       {-0.8325796723 1.769231915 0.02371272631}
       {0.03882339597 -0.08249972761 1.036368608}
     }
   name ColorMatrix15
   label "XYZ to P3D60"
   xpos 510
   ypos -136
  }
push $N5a797000
  ColorMatrix {
   matrix {
       {2.725393534 -1.018002748 -0.4401631057}
       {-0.795167923 1.689731717 0.02264718339}
       {0.04124190658 -0.0876390487 1.100929499}
     }
   name ColorMatrix19
   label "XYZ to P3DCI"
   xpos 400
   ypos -136
  }
push $N5a797000
  ColorMatrix {
   matrix {
       {2.493496418 -0.9313833117 -0.4027107358}
       {-0.8294888139 1.762663841 0.02362467349}
       {0.03584583849 -0.07617240399 0.9568845034}
     }
   name ColorMatrix17
   label "XYZ to P3D65"
   xpos 290
   ypos -136
  }
push $N5a797000
  ColorMatrix {
   matrix {
       {0.6954522133 0.1406786889 0.163869068}
       {0.04479461163 0.8596711159 0.09553432465}
       {-0.005525866989 0.004025223665 1.001500726}
     }
   name ColorMatrix12
   label "XYZ to Rec2020"
   xpos 180
   ypos -136
  }
push $N5a797000
  ColorMatrix {
   matrix {
       {3.240970135 -1.537383318 -0.4986107945}
       {-0.9692437053 1.875967622 0.04155509174}
       {0.0556300357 -0.2039768547 1.056971431}
     }
   name ColorMatrix2
   label "XYZ to Rec709"
   xpos 70
   ypos -136
  }
  Switch {
   inputs 8
   which {{parent.limiting_pri}}
   name limiting_primary_switch
   xpos -40
   ypos -34
  }
  Clamp {
   channels rgb
   name clamp_f3
   label "Clip any values outside the limiting primaries"
   xpos -40
   ypos 56
  }
  Dot {
   name Dot2
   label " Convert limited RGB to XYZ"
   note_font "Helvetica Bold"
   note_font_size 24
   note_font_color 0xa5a5a501
   xpos -6
   ypos 162
  }
set N5a794c00 [stack 0]
push $N5a794c00
  ColorMatrix {
   matrix {
       {0.9525524378 0 9.367863095e-05}
       {0.3439664543 0.7281661034 -0.07213255018}
       {-3.863927134e-08 0 1.008825183}
     }
   name ColorMatrix4
   label "ACES to XYZ"
   xpos 730
   ypos 224
  }
push $N5a794c00
  ColorMatrix {
   matrix {
       {0.6624541879 0.1340042055 0.1561876982}
       {0.2722287476 0.6740817428 0.05368951708}
       {-0.005574660841 0.004060741514 1.010339141}
     }
   name ColorMatrix20
   label "ACEScg to XYZ"
   xpos 620
   ypos 224
  }
push $N5a794c00
  ColorMatrix {
   matrix {
       {0.5049495697 0.2646814585 0.1830150485}
       {0.237623319 0.6891706586 0.07320601493}
       {0 0.0449459292 0.9638792276}
     }
   name ColorMatrix13
   label "P3D60 to XYZ"
   xpos 510
   ypos 224
  }
push $N5a794c00
  ColorMatrix {
   matrix {
       {0.4451698363 0.2771343887 0.1722826511}
       {0.209491685 0.7215952873 0.06891305745}
       {0 0.04706057906 0.9073553085}
     }
   name ColorMatrix18
   label "P3DCI to XYZ"
   xpos 400
   ypos 224
  }
push $N5a794c00
  ColorMatrix {
   matrix {
       {0.4865709841 0.2656676769 0.1982172877}
       {0.2289745659 0.6917385459 0.07928691059}
       {0 0.04511339962 1.043944359}
     }
   name ColorMatrix16
   label "P3D65 to XYZ"
   xpos 290
   ypos 224
  }
push $N5a794c00
  ColorMatrix {
   matrix {
       {0.6369580626 0.1446169019 0.1688809693}
       {0.2627002299 0.6779980659 0.05930171534}
       {0 0.0280726999 1.060985088}
     }
   name ColorMatrix3
   label "Rec2020 to XYZ"
   xpos 180
   ypos 224
  }
push $N5a794c00
  ColorMatrix {
   matrix {
       {0.4123907983 0.3575843275 0.180480808}
       {0.2126390189 0.7151686549 0.07219231874}
       {0.01933082007 0.1191947311 0.950532198}
     }
   name ColorMatrix1
   label "Rec709 to XYZ"
   xpos 70
   ypos 224
  }
  Switch {
   inputs 8
   which {{parent.limiting_pri}}
   name limiting_primary_switch1
   xpos -40
   ypos 326
  }
  Output {
   name Output
   xpos -40
   ypos 446
  }
 end_group
 Group {
  name XYZ_2_DISPLAY_PRI
  label "CIE XYZ to display encoding primaries"
  xpos -1250
  ypos 1976
  addUserKnob {20 XYZ_2_DISPLAY_PRI_tab l XYZ_2_DISPLAY_PRI}
  addUserKnob {4 display_pri l "display pri" M {Rec709 Rec2020 P3D65 P3DCI P3D60 ACEScg ACES XYZ}}
  display_pri {{parent.display_pri}}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -298
  }
  Dot {
   name Dot1
   label " XYZ to display primaries"
   note_font "Helvetica Bold"
   note_font_size 24
   note_font_color 0xa5a5a501
   xpos -6
   ypos -198
  }
set N5a71e000 [stack 0]
push $N5a71e000
  ColorMatrix {
   matrix {
       {1.049811006 0 -9.748453158e-05}
       {-0.4959030151 1.373313069 0.09824004024}
       {4.020908051e-08 0 0.9912520051}
     }
   name ColorMatrix3
   label "XYZ to ACES"
   xpos 730
   ypos -136
  }
push $N5a71e000
  ColorMatrix {
   matrix {
       {1.641023397 -0.3248033226 -0.2364246994}
       {-0.6636629701 1.615331769 0.01675636508}
       {0.01172191743 -0.008284457959 0.9883947968}
     }
   name ColorMatrix21
   label "XYZ to ACEScg"
   xpos 620
   ypos -136
  }
push $N5a71e000
  ColorMatrix {
   matrix {
       {2.402741432 -0.8974840641 -0.3880533576}
       {-0.8325796723 1.769231915 0.02371272631}
       {0.03882339597 -0.08249972761 1.036368608}
     }
   name ColorMatrix15
   label "XYZ to P3D60"
   xpos 510
   ypos -136
  }
push $N5a71e000
  ColorMatrix {
   matrix {
       {2.725393534 -1.018002748 -0.4401631057}
       {-0.795167923 1.689731717 0.02264718339}
       {0.04124190658 -0.0876390487 1.100929499}
     }
   name ColorMatrix19
   label "XYZ to P3DCI"
   xpos 400
   ypos -136
  }
push $N5a71e000
  ColorMatrix {
   matrix {
       {2.493496418 -0.9313833117 -0.4027107358}
       {-0.8294888139 1.762663841 0.02362467349}
       {0.03584583849 -0.07617240399 0.9568845034}
     }
   name ColorMatrix17
   label "XYZ to P3D65"
   xpos 290
   ypos -136
  }
push $N5a71e000
  ColorMatrix {
   matrix {
       {1.71665132 -0.3556708097 -0.2533662617}
       {-0.6666844487 1.616481304 0.01576855592}
       {0.01763986237 -0.04277062416 0.9421030879}
     }
   name ColorMatrix12
   label "XYZ to Rec2020"
   xpos 180
   ypos -136
  }
push $N5a71e000
  ColorMatrix {
   matrix {
       {3.240970135 -1.537383318 -0.4986107945}
       {-0.9692437053 1.875967622 0.04155509174}
       {0.0556300357 -0.2039768547 1.056971431}
     }
   name ColorMatrix2
   label "XYZ to Rec709"
   xpos 70
   ypos -136
  }
  Switch {
   inputs 8
   which {{parent.display_pri}}
   name limiting_primary_switch
   xpos -40
   ypos -34
  }
  Output {
   name Output
   xpos -40
   ypos 86
  }
 end_group
 Clamp {
  channels rgb
  name clamp_f3_all
  xpos -1250
  ypos 2164
 }
 Dot {
  name Dot1
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1216
  ypos 2514
 }
set N5aa9f400 [stack 0]
push $N5aa9f400
 Dot {
  name Dot3
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -886
  ypos 2514
 }
set N5aa9f000 [stack 0]
 Dot {
  name Dot4
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -666
  ypos 2514
 }
set N5aa9ec00 [stack 0]
 Dot {
  name Dot6
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -446
  ypos 2514
 }
set N5aa9e800 [stack 0]
 Dot {
  name Dot18
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -226
  ypos 2514
 }
set N5aa9e400 [stack 0]
 Dot {
  name Dot20
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -6
  ypos 2514
 }
set N5aa9e000 [stack 0]
 Dot {
  name Dot25
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 214
  ypos 2514
 }
set N5aa9dc00 [stack 0]
 Dot {
  name Dot24
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 654
  ypos 2514
 }
 Dot {
  name Dot2
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 654
  ypos 2610
 }
set N5aa9d400 [stack 0]
 Expression {
  expr0 "r * (Ymax - Ymin) + Ymin"
  expr1 "g * (Ymax - Ymin) + Ymin"
  expr2 "b * (Ymax - Ymin) + Ymin"
  name linCV_2_Y_f3_hdr
  label "stretch_black = True"
  xpos 510
  ypos 2672
  addUserKnob {20 Luminance}
  addUserKnob {7 Ymin R 0.0001 0.02}
  addUserKnob {7 Ymax R 48 10000}
  Ymax {{parent.lum.2}}
 }
push $N5aa9d400
 Expression {
  expr0 "r * (Ymax - Ymin) + Ymin"
  expr1 "g * (Ymax - Ymin) + Ymin"
  expr2 "b * (Ymax - Ymin) + Ymin"
  name linCV_2_Y_f3_hdr2
  label "stretch_black = False"
  xpos 620
  ypos 2672
  addUserKnob {20 Luminance}
  addUserKnob {7 Ymin R 0.0001 0.02}
  Ymin {{parent.lum.0}}
  addUserKnob {7 Ymax R 48 10000}
  Ymax {{parent.lum.2}}
 }
 Switch {
  inputs 2
  which {{parent.stretch_black}}
  name StretchBlacks_Switch
  xpos 620
  ypos 2750
 }
 Clamp {
  channels rgb
  maximum 65535
  name clamp_f3__
  xpos 620
  ypos 2822
 }
 Expression {
  temp_name0 Lm_r
  temp_expr0 "pow((r / pq_C), pq_m1)"
  temp_name1 Lm_g
  temp_expr1 "pow((g / pq_C), pq_m1)"
  temp_name2 Lm_b
  temp_expr2 "pow((b / pq_C), pq_m1)"
  expr0 "pow(( pq_c1 + pq_c2 * Lm_r ) / ( 1.0 + pq_c3 * Lm_r ), pq_m2)"
  expr1 "pow(( pq_c1 + pq_c2 * Lm_g ) / ( 1.0 + pq_c3 * Lm_g ), pq_m2)"
  expr2 "pow(( pq_c1 + pq_c2 * Lm_b ) / ( 1.0 + pq_c3 * Lm_b ), pq_m2)"
  name Y_2_ST2084_
  label "ACESlib.OutputTransforms.ctl : 243 \nACESlib.Utilities_Color.ctl : 425"
  xpos 620
  ypos 2882
  addUserKnob {20 SMPTE_ST2084-2014_Constants_tab l "Constants from SMPTE ST 2084-2014"}
  addUserKnob {7 pq_m1 t " ( 2610.0 / 4096.0 ) / 4.0;" +DISABLED R 0 100}
  pq_m1 0.1593017578
  addUserKnob {7 pq_m2 t " ( 2523.0 / 4096.0 ) * 128.0;" +DISABLED R 0 100}
  pq_m2 78.84375
  addUserKnob {7 pq_c1 t " 3424.0 / 4096.0 or pq_c3 - pq_c2 + 1.0;" +DISABLED R 0 100}
  pq_c1 0.8359375
  addUserKnob {7 pq_c2 t " ( 2413.0 / 4096.0 ) * 32.0;" +DISABLED R 0 100}
  pq_c2 18.8515625
  addUserKnob {7 pq_c3 t " ( 2392.0 / 4096.0 ) * 32.0;" +DISABLED R 0 100}
  pq_c3 18.6875
  addUserKnob {7 pq_C +DISABLED R 0 100}
  pq_C 10000
 }
set N5aa9c400 [stack 0]
 Dot {
  name Dot5
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 984
  ypos 2514
 }
 Expression {
  temp_name0 Np_r
  temp_expr0 "pow( r, 1.0 / pq_m2 )"
  temp_name1 Np_g
  temp_expr1 "pow( g, 1.0 / pq_m2 )"
  temp_name2 Np_b
  temp_expr2 "pow( b, 1.0 / pq_m2 )"
  expr0 "r < 0 ? 0 : pow((Np_r - pq_c1) / ( pq_c2 - pq_c3 * Np_r ), 1.0/pq_m1) * pq_C"
  expr1 "g < 0 ? 0 : pow((Np_g - pq_c1) / ( pq_c2 - pq_c3 * Np_g ), 1.0/pq_m1) * pq_C"
  expr2 "b < 0 ? 0 : pow((Np_b - pq_c1) / ( pq_c2 - pq_c3 * Np_b ), 1.0/pq_m1) * pq_C"
  name ST2084_2_Y_f3_
  label "ACESlib.Utilities_Color.ctl : 408\n// Converts from the non-linear perceptually quantized space to linear cd/m^2"
  xpos 950
  ypos 2618
  addUserKnob {20 SMPTE_ST2084-2014_Constants_tab l "Constants from SMPTE ST 2084-2014"}
  addUserKnob {7 pq_m1 t " ( 2610.0 / 4096.0 ) / 4.0;" +DISABLED R 0 100}
  pq_m1 0.1593017578
  addUserKnob {7 pq_m2 t " ( 2523.0 / 4096.0 ) * 128.0;" +DISABLED R 0 100}
  pq_m2 78.84375
  addUserKnob {7 pq_c1 t " 3424.0 / 4096.0 or pq_c3 - pq_c2 + 1.0;" +DISABLED R 0 100}
  pq_c1 0.8359375
  addUserKnob {7 pq_c2 t " ( 2413.0 / 4096.0 ) * 32.0;" +DISABLED R 0 100}
  pq_c2 18.8515625
  addUserKnob {7 pq_c3 t " ( 2392.0 / 4096.0 ) * 32.0;" +DISABLED R 0 100}
  pq_c3 18.6875
  addUserKnob {7 pq_C +DISABLED R 0 100}
  pq_C 10000
 }
 Expression {
  temp_name0 Y_d
  temp_expr0 "0.2627*r + 0.6780*g + 0.0593*b"
  expr0 "Y_d == 0 ? 0 : pow( (Y_d-c_beta)/c_alpha, (1-c_gamma)/c_gamma) * ((r-c_beta)/c_alpha)"
  expr1 "Y_d == 0 ? 0 : pow( (Y_d-c_beta)/c_alpha, (1-c_gamma)/c_gamma) * ((g-c_beta)/c_alpha)"
  expr2 "Y_d == 0 ? 0 : pow( (Y_d-c_beta)/c_alpha, (1-c_gamma)/c_gamma) * ((b-c_beta)/c_alpha)"
  name ST2084_2_HLG_1000nits_f3_3
  label "ACESlib.Utilities_Color.ctl : 469\n// HLG Inverse EOTF (i.e. HLG inverse OOTF followed by the HLG OETF)\n// HLG Inverse OOTF (display linear to scene linear)"
  xpos 950
  ypos 2732
  addUserKnob {20 Constants_tab l Constants}
  addUserKnob {7 L_w +DISABLED}
  L_w 1000
  addUserKnob {7 L_b +DISABLED}
  addUserKnob {7 c_alpha +DISABLED}
  c_alpha {{L_w-L_b}}
  addUserKnob {7 c_beta +DISABLED}
  c_beta {{L_b}}
  addUserKnob {7 c_gamma +DISABLED}
  c_gamma 1.2
 }
 Expression {
  channel0 {rgba.red -rgba.green -rgba.blue none}
  expr0 "r <= 1.0/12 ? sqrt(3.0*r) : c_a * log(12.0 * r - c_b) + c_c"
  expr1 "g <= 1.0/12 ? sqrt(3.0*g) : c_a * log(12.0 * g- c_b) + c_c"
  expr2 "b <= 1.0/12 ? sqrt(3.0*b) : c_a * log(12.0 * b - c_b) + c_c"
  name ST2084_2_HLG_1000nits_f3_
  label "ACESlib.Utilities_Color.ctl : 493\n// HLG OETF (scene linear to non-linear signal value)"
  xpos 950
  ypos 2834
  addUserKnob {20 Constants_tab l Constants}
  addUserKnob {7 c_a +DISABLED}
  c_a 0.17883277
  addUserKnob {7 c_b t 1.-4.*a +DISABLED}
  c_b 0.28466892
  addUserKnob {7 c_c t 0.5-a*log(4.*a) +DISABLED}
  c_c 0.55991073
 }
 Dot {
  name Dot17
  label " HLG"
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 984
  ypos 2970
 }
push $N5aa9c400
 Dot {
  name Dot27
  label " PQ"
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 654
  ypos 2970
 }
push $N5aa9dc00
 Expression {
  expr0 "pow( (48./52.37) * r, 1./2.6)"
  expr1 "pow( (48./52.37) * g, 1./2.6)"
  expr2 "pow( (48./52.37) * b, 1./2.6)"
  expr3 1
  name dcdm_encode
  xpos 180
  ypos 2702
 }
push $N5aa9e000
 Expression {
  expr0 pow(r,1/gamma)
  expr1 pow(g,1/gamma)
  expr2 pow(b,1/gamma)
  name pow_f3_gamma_26_
  label "ACESlib.Utilities_Color.ctl : 260\n// Gamma 2.6"
  xpos -40
  ypos 2690
  addUserKnob {20 Gamma_tab l Gamma}
  addUserKnob {7 gamma R 0 4}
  gamma 2.6
 }
push $N5aa9e400
 Expression {
  expr0 pow(r,1/gamma)
  expr1 pow(g,1/gamma)
  expr2 pow(b,1/gamma)
  name pow_f3_gamma_24_
  label "ACESlib.Utilities_Color.ctl : 260\n// Gamma 2.4"
  xpos -260
  ypos 2690
  addUserKnob {20 Gamma_tab l Gamma}
  addUserKnob {7 gamma R 0 4}
  gamma 2.4
 }
push $N5aa9e800
 Expression {
  expr0 pow(r,1/gamma)
  expr1 pow(g,1/gamma)
  expr2 pow(b,1/gamma)
  name pow_f3_gamma_22_
  label "ACESlib.Utilities_Color.ctl : 260\n// Gamma 2.2"
  xpos -480
  ypos 2690
  addUserKnob {20 Gamma_tab l Gamma}
  addUserKnob {7 gamma R 0 4}
  gamma 2.2
 }
push $N5aa9ec00
 Expression {
  temp_name0 c_a
  temp_expr0 "pow( pow( Lw, 1./gamma) - pow( Lb, 1./gamma), gamma)"
  temp_name1 c_b
  temp_expr1 "pow( Lb, 1./gamma) / ( pow( Lw, 1./gamma) - pow( Lb, 1./gamma))"
  expr0 "pow( max( r / c_a, 0.), 1.0/gamma) - c_b"
  expr1 "pow( max( g / c_a, 0.), 1.0/gamma) - c_b"
  expr2 "pow( max( b / c_a, 0.), 1.0/gamma) - c_b"
  name bt1886_r_f3
  label "ACESlib.Utilities_Color.ctl : 301\n// The reference EOTF specified in Rec. ITU-R BT.1886\n// L = a(max\[(V+b),0])^g"
  xpos -700
  ypos 2684
  addUserKnob {20 Luminance}
  addUserKnob {7 Lw R 48 10000}
  Lw 1
  addUserKnob {7 Lb R 0.0001 0.02}
  addUserKnob {7 gamma R 1 4}
  gamma 2.4
 }
push $N5aa9f000
 Expression {
  temp_name0 yb
  temp_expr0 "pow( offs * gamma / ( ( gamma - 1.0) * ( 1.0 + offs)), gamma)"
  temp_name1 rs
  temp_expr1 "pow( ( gamma - 1.0) / offs, gamma - 1.0) * pow( ( 1.0 + offs) / gamma, gamma)"
  expr0 "r >= yb ? ( 1.0 + offs) * pow( r, 1.0 / gamma) - offs : r * rs"
  expr1 "g >= yb ? ( 1.0 + offs) * pow( g, 1.0 / gamma) - offs : g * rs"
  expr2 "b >= yb ? ( 1.0 + offs) * pow( b, 1.0 / gamma) - offs : b * rs"
  name moncurve_r_f3_
  label "ACESlib.Utilities_Color.ctl : 260\nmoncurve_r with gamma of 2.4 and offset of 0.055 matches the EOTF found in IEC 61966-2-1:1999 (sRGB)"
  xpos -920
  ypos 2690
  addUserKnob {20 Luminance}
  addUserKnob {7 gamma R 0 4}
  gamma 2.4
  addUserKnob {7 offs}
  offs 0.055
 }
 Switch {
  inputs 10
  which {{parent.eotf}}
  name EOTF_Switch
  xpos -1250
  ypos 2966
 }
 Expression {
  temp_name0 REFBLACK
  temp_expr0 "64 / 1023"
  temp_name1 REFWHITE
  temp_expr1 "940 / 1023"
  expr0 "r * ( REFWHITE - REFBLACK) + REFBLACK"
  expr1 "g * ( REFWHITE - REFBLACK) + REFBLACK"
  expr2 "b * ( REFWHITE - REFBLACK) + REFBLACK"
  name fullRange_to_smpteRange_f3_
  label "ACESlib.OutputTransforms.ctl : 216"
  xpos -1250
  ypos 3224
  disable {{!parent.legal_range}}
 }
 Output {
  name Output
  xpos -1250
  ypos 3446
 }
 StickyNote {
  inputs 0
  name StickyNote1
  tile_color 0x535a61ff
  label "\n<b>ACESlib.RRT_Common.ctl : 135</b>\n<pre>\nfloat\[3] rrt_sweeteners( float in\[3])\n\{\n    float aces\[3] = in;\n    \n    // --- Glow module --- //\n    float saturation = rgb_2_saturation( aces);\n    float ycIn = rgb_2_yc( aces);\n    float s = sigmoid_shaper( (saturation - 0.4) / 0.2);\n    float addedGlow = 1. + glow_fwd( ycIn, RRT_GLOW_GAIN * s, RRT_GLOW_MID);\n\n    aces = mult_f_f3( addedGlow, aces);\n\n    // --- Red modifier --- //\n    float hue = rgb_2_hue( aces);\n    float centeredHue = center_hue( hue, RRT_RED_HUE);\n    float hueWeight = cubic_basis_shaper( centeredHue, RRT_RED_WIDTH);\n\n    aces\[0] = aces\[0] + hueWeight * saturation * (RRT_RED_PIVOT - aces\[0]) * (1. - RRT_RED_SCALE);\n\n    // --- ACES to RGB rendering space --- //\n    aces = clamp_f3( aces, 0., HALF_POS_INF);\n    float rgbPre\[3] = mult_f3_f44( aces, AP0_2_AP1_MAT);\n    rgbPre = clamp_f3( rgbPre, 0., HALF_MAX);\n    \n    // --- Global desaturation --- //\n    rgbPre = mult_f3_f33( rgbPre, RRT_SAT_MAT);\n    return rgbPre;\n\}\n\n\n\n"
  note_font_size 10
  xpos -825
  ypos -1204
 }
 StickyNote {
  inputs 0
  name StickyNote2
  tile_color 0x535a61ff
  label "\n\n<b>ACESlib.SSTS.ctl : 163</b><pre>float ssts\n( \n    varying float x,\n    varying TsParams C\n)\n\{\n    const int N_KNOTS_LOW = 4;\n    const int N_KNOTS_HIGH = 4;\n\n    // Check for negatives or zero before taking the log. If negative or zero,\n    // set to HALF_MIN.\n    float logx = log10( max(x, HALF_MIN )); \n\n    float logy;\n\n    if ( logx <= log10(C.Min.x) ) \{ \n\n        logy = logx * C.Min.slope + ( log10(C.Min.y) - C.Min.slope * log10(C.Min.x) );\n\n    \} else if (( logx > log10(C.Min.x) ) && ( logx < log10(C.Mid.x) )) \{\n\n        float knot_coord = (N_KNOTS_LOW-1) * (logx-log10(C.Min.x))/(log10(C.Mid.x)-log10(C.Min.x));\n        int j = knot_coord;\n        float t = knot_coord - j;\n\n        float cf\[ 3] = \{ C.coefsLow\[ j], C.coefsLow\[ j + 1], C.coefsLow\[ j + 2]\};\n\n        float monomials\[ 3] = \{ t * t, t, 1. \};\n        logy = dot_f3_f3( monomials, mult_f3_f33( cf, M1));\n\n    \} else if (( logx >= log10(C.Mid.x) ) && ( logx < log10(C.Max.x) )) \{\n\n        float knot_coord = (N_KNOTS_HIGH-1) * (logx-log10(C.Mid.x))/(log10(C.Max.x)-log10(C.Mid.x));\n        int j = knot_coord;\n        float t = knot_coord - j;\n\n        float cf\[ 3] = \{ C.coefsHigh\[ j], C.coefsHigh\[ j + 1], C.coefsHigh\[ j + 2]\}; \n\n        float monomials\[ 3] = \{ t * t, t, 1. \};\n        logy = dot_f3_f3( monomials, mult_f3_f33( cf, M1));\n\n    \} else \{ //if ( logIn >= log10(C.Max.x) ) \{ \n\n        logy = logx * C.Max.slope + ( log10(C.Max.y) - C.Max.slope * log10(C.Max.x) );\n\n    \}\n\n    return pow10(logy);\n\n\}"
  note_font_size 10
  xpos -830
  ypos -664
 }
 StickyNote {
  inputs 0
  name StickyNote3
  tile_color 0x535a61ff
  label "\n\n<b>ACESlib.Tonescales.ctl : 271</b><pre>float segmented_spline_c9_fwd\n  ( \n    varying float x,\n    varying SegmentedSplineParams_c9 C = ODT_48nits\n  )\n\{    \n  const int N_KNOTS_LOW = 8;\n  const int N_KNOTS_HIGH = 8;\n\n  // Check for negatives or zero before taking the log. If negative or zero,\n  // set to HALF_MIN.\n  float logx = log10( max(x, HALF_MIN )); \n\n  float logy;\n\n  if ( logx <= log10(C.minPoint.x) ) \{ \n\n    logy = logx * C.slopeLow + ( log10(C.minPoint.y) - C.slopeLow * log10(C.minPoint.x) );\n\n  \} else if (( logx > log10(C.minPoint.x) ) && ( logx < log10(C.midPoint.x) )) \{\n\n    float knot_coord = (N_KNOTS_LOW-1) * (logx-log10(C.minPoint.x))/(log10(C.midPoint.x)-log10(C.minPoint.x));\n    int j = knot_coord;\n    float t = knot_coord - j;\n\n    float cf\[ 3] = \{ C.coefsLow\[ j], C.coefsLow\[ j + 1], C.coefsLow\[ j + 2]\};\n    \n    float monomials\[ 3] = \{ t * t, t, 1. \};\n    logy = dot_f3_f3( monomials, mult_f3_f33( cf, M));\n\n  \} else if (( logx >= log10(C.midPoint.x) ) && ( logx < log10(C.maxPoint.x) )) \{\n\n    float knot_coord = (N_KNOTS_HIGH-1) * (logx-log10(C.midPoint.x))/(log10(C.maxPoint.x)-log10(C.midPoint.x));\n    int j = knot_coord;\n    float t = knot_coord - j;\n\n    float cf\[ 3] = \{ C.coefsHigh\[ j], C.coefsHigh\[ j + 1], C.coefsHigh\[ j + 2]\}; \n\n    float monomials\[ 3] = \{ t * t, t, 1. \};\n    logy = dot_f3_f3( monomials, mult_f3_f33( cf, M));\n\n  \} else \{ //if ( logIn >= log10(C.maxPoint.x) ) \{ \n\n    logy = logx * C.slopeHigh + ( log10(C.maxPoint.y) - C.slopeHigh * log10(C.maxPoint.x) );\n\n  \}\n\n  return pow10(logy);\n  \n\}"
  note_font_size 10
  xpos -200
  ypos -660
 }
push $N5a010800
 Reformat {
  type "to box"
  box_width 4
  box_height 4
  box_fixed true
  name Reformat1
  note_font Helvetica
  xpos -1140
  ypos -561
 }
 Fill {
  output rgb
  color {{parent.ssts.mid_lum}}
  name Fill1
  note_font Helvetica
  xpos -1140
  ypos -537
 }
 Group {
  name inv_ssts
  xpos -1140
  ypos -514
  addUserKnob {20 ssts_tab l ssts}
  addUserKnob {78 lum l luminance t "<b>SSTS Display Luminance</b>: \ny_min y_mid y_max\n\nAccording to Zach Lewis's ACES_OT\nhttps://gist.github.com/zachlewis/786c0be941868644c993fde1c3515c2c\n\n<b>Standard Cinema</b>: \n0.02 4.8 48\n<b>Dolby Cinema</b>: \n0.0001 7.2 108\n<b>Dolby Pulsar</b>: \n0.005 15 4000\n<b>Dolby PRR-4220</b>: \n0.005 10 600\n<b>Sony BVM-X300</b>: \n0.0001 10 1000\n<b>ACES OCES</b>: \n0.0001 4.8 10000\n\n" n 3}
  lum {{"use_c9 ? 0.0001 : parent.lum"} 4.8 {"use_c9 ? 10000 : parent.lum"}}
  addUserKnob {6 override_ssts_params l "override ssts params" t "Enable overrides of SSTS params.\n\nOtherwise the values will be calculated automatically by the algorithm." +STARTLINE}
  override_ssts_params {{parent.ACES_SSTS.AcesSSTSKernel_override_curve_params}}
  addUserKnob {7 exposure R -5 5}
  exposure {{parent.exposure}}
  addUserKnob {7 knee}
  knee {{parent.pctLow}}
  addUserKnob {7 shoulder}
  shoulder {{parent.pctHigh}}
  addUserKnob {78 slope n 3}
  slope {{parent.slope} {parent.slope} {parent.slope}}
  addUserKnob {20 TsParams_tab l TsParams}
  addUserKnob {7 expShift R -4 4}
  expShift {{"override_ssts_params ? exposure : 0"}}
  addUserKnob {13 minPoint t "x;        // ACES\ny;        // luminance\nz;        // slope"}
  minPoint {{"pow(2, log(0.18*pow(2, MIN_STOP_RRT+((MIN_STOP_SDR-MIN_STOP_RRT)/(log10(MIN_LUM_SDR)-log10(MIN_LUM_RRT)))*(log10(minPoint.y)-log10(MIN_LUM_RRT))))/log(2)-expShift)"} {lum.0} {override_ssts_params?slope.0:0}}
  addUserKnob {13 midPoint t "x;        // ACES\ny;        // luminance\nz;        // slope"}
  midPoint {{"pow(2, ((log(0.18)/log(2)-expShift)))"} {lum.1} {override_ssts_params?slope.1:1.55}}
  addUserKnob {13 maxPoint t "x;        // ACES\ny;        // luminance\nz;        // slope"}
  maxPoint {{"pow(2, log(0.18*pow(2, (MAX_STOP_SDR+(MAX_STOP_RRT-MAX_STOP_SDR)/(log10(MAX_LUM_RRT)-log10(MAX_LUM_SDR))*(log10(maxPoint.y)-log10(MAX_LUM_SDR)))))/log(2)-expShift)"} {lum.2} {override_ssts_params?slope.2:0}}
  addUserKnob {7 knotIncLow}
  knotIncLow {{"(log10(midPoint.x) - log10(minPoint.x)) / 3.0"}}
  addUserKnob {7 knotIncHigh}
  knotIncHigh {{"(log10(maxPoint.x) - log10(midPoint.x)) / 3.0"}}
  addUserKnob {7 pctLow}
  pctLow {{0.18+(0.35-0.18)/(MIN_STOP_SDR-MIN_STOP_RRT)*(log(minPoint.x/0.18)/log(2)-MIN_STOP_RRT)}}
  addUserKnob {7 pctHigh}
  pctHigh {{0.89+(0.90-0.89)/(MAX_STOP_SDR-MAX_STOP_RRT)*(log(maxPoint.x/0.89)/log(2)-MAX_STOP_RRT)}}
  addUserKnob {78 coefsLow n 5}
  coefsLow {{"(minPoint.z * (log10(minPoint.x)-0.5*knotIncLow)) + ( log10(minPoint.y) - minPoint.z * log10(minPoint.x))"} {"(minPoint.z * (log10(minPoint.x)+0.5*knotIncLow)) + ( log10(minPoint.y) - minPoint.z * log10(minPoint.x))"} {log10(minPoint.y)+pctLow*(log10(midPoint.y)-log10(minPoint.y))} {"(midPoint.z * (log10(midPoint.x)-0.5*knotIncLow)) + ( log10(midPoint.y) - midPoint.z * log10(midPoint.x))"} {"(midPoint.z * (log10(midPoint.x)+0.5*knotIncLow)) + ( log10(midPoint.y) - midPoint.z * log10(midPoint.x))"}}
  addUserKnob {78 coefsHigh n 5}
  coefsHigh {{"(midPoint.z * (log10(midPoint.x)-0.5*knotIncHigh)) + ( log10(midPoint.y) - midPoint.z * log10(midPoint.x))"} {"(midPoint.z * (log10(midPoint.x)+0.5*knotIncHigh)) + ( log10(midPoint.y) - midPoint.z * log10(midPoint.x))"} {log10(midPoint.y)+pctHigh*(log10(maxPoint.y)-log10(midPoint.y))} {"(maxPoint.z * (log10(maxPoint.x)-0.5*knotIncHigh)) + ( log10(maxPoint.y) - maxPoint.z * log10(maxPoint.x))"} {"(maxPoint.z * (log10(maxPoint.x)+0.5*knotIncHigh)) + ( log10(maxPoint.y) - maxPoint.z * log10(maxPoint.x))"}}
  addUserKnob {7 KNOT_INC_LOW}
  KNOT_INC_LOW {{"(log10(midPoint.x) - log10(minPoint.x)) / (N_KNOTS_LOW - 1)"}}
  addUserKnob {7 KNOT_INC_HIGH}
  KNOT_INC_HIGH {{"(log10(maxPoint.x) - log10(midPoint.x)) / (N_KNOTS_HIGH - 1)"}}
  addUserKnob {78 KNOT_Y_LOW n 4}
  KNOT_Y_LOW {{"(coefsLow.0 + coefsLow.1) / 2"} {"(coefsLow.1 + coefsLow.2) / 2"} {"(coefsLow.2 + coefsLow.3) / 2"} {"(coefsLow.3 + coefsLow.4) / 2"}}
  addUserKnob {78 KNOT_Y_HIGH n 4}
  KNOT_Y_HIGH {{"(coefsHigh.0 + coefsHigh.1) / 2"} {"(coefsHigh.1 + coefsHigh.2) / 2"} {"(coefsHigh.2 + coefsHigh.3) / 2"} {"(coefsHigh.3 + coefsHigh.4) / 2"}}
  addUserKnob {20 Constants_tab l const}
  addUserKnob {3 N_KNOTS_LOW}
  N_KNOTS_LOW 4
  addUserKnob {3 N_KNOTS_HIGH}
  N_KNOTS_HIGH 4
  addUserKnob {7 MIN_STOP_SDR R -20 20}
  MIN_STOP_SDR -6.5
  addUserKnob {7 MAX_STOP_SDR R -20 20}
  MAX_STOP_SDR 6.5
  addUserKnob {7 MIN_STOP_RRT R -20 20}
  MIN_STOP_RRT -15
  addUserKnob {7 MAX_STOP_RRT R -20 20}
  MAX_STOP_RRT 18
  addUserKnob {7 MIN_LUM_SDR R 0 0.1}
  MIN_LUM_SDR 0.02
  addUserKnob {7 MAX_LUM_SDR R 0 100}
  MAX_LUM_SDR 48
  addUserKnob {7 MIN_LUM_RRT R 0 0.1}
  MIN_LUM_RRT 0.0001
  addUserKnob {7 MAX_LUM_RRT R 0 10000}
  MAX_LUM_RRT 10000
 }
  Input {
   inputs 0
   name Input
   xpos -1030
   ypos -634
  }
  Dot {
   name Dot25
   label " "
   xpos -996
   ypos -318
  }
set N5a9e2400 [stack 0]
  Dot {
   name Dot26
   label " "
   xpos -996
   ypos 1506
  }
push $N5a9e2400
  Dot {
   name Dot4
   label " "
   xpos -886
   ypos -318
  }
set N5a9e1c00 [stack 0]
  Dot {
   name Dot5
   label " "
   xpos -776
   ypos -318
  }
set N5a9e1800 [stack 0]
  Dot {
   name Dot2
   label " "
   xpos -666
   ypos -318
  }
set N5a9e1400 [stack 0]
  Dot {
   name Dot3
   label " "
   xpos -556
   ypos -318
  }
set N5a9e1000 [stack 0]
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 1e-10 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 1e-10 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 1e-10 ))"
   expr0 "logr <= log10(minPoint.y)"
   expr1 "logg <= log10(minPoint.y)"
   expr2 "logb <= log10(minPoint.y)"
   name segment_bottom
   xpos -590
   ypos -202
  }
  Dot {
   name Dot1
   label " "
   xpos -556
   ypos 162
  }
push $N5a9e1000
  Dot {
   name Dot7
   label " "
   xpos -336
   ypos -318
  }
set N5a9e0400 [stack 0]
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 1e-10 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 1e-10 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 1e-10 ))"
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 log10(minPoint.x)
   expr1 log10(minPoint.x)
   expr2 log10(minPoint.x)
   expr3 1
   name Expression
   xpos -370
   ypos -202
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply3
   xpos -370
   ypos 158
  }
  Dot {
   name Dot27
   label " "
   xpos -336
   ypos 786
  }
push $N5a9e1400
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 1e-10 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 1e-10 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 1e-10 ))"
   expr0 "( logr > log10(minPoint.y) ) && ( logr <= log10(midPoint.y) )"
   expr1 "( logg > log10(minPoint.y) ) && ( logg <= log10(midPoint.y) )"
   expr2 "( logb > log10(minPoint.y) ) && ( logb <= log10(midPoint.y) )"
   name segment_low
   xpos -700
   ypos -202
  }
  Dot {
   name Dot22
   label " "
   xpos -666
   ypos 354
  }
push $N5a9e0400
  Dot {
   name Dot9
   label " "
   xpos -6
   ypos -318
  }
set N5a9a2800 [stack 0]
  Dot {
   name Dot6
   label " "
   xpos -6
   ypos -174
  }
set N5a9a2400 [stack 0]
  Dot {
   name Dot8
   label " "
   xpos 214
   ypos -174
  }
set N5a9a2000 [stack 0]
  Dot {
   name Dot13
   label " "
   xpos 434
   ypos -174
  }
  Dot {
   name Dot19
   xpos 434
   ypos -78
  }
set N5a9a1800 [stack 0]
  Expression {
   temp_name0 logy
   temp_expr0 "log10( max(b, 1e-10 ))"
   temp_name1 low
   temp_expr1 "(logy > KNOT_Y_LOW.0) && (logy <= KNOT_Y_LOW.1)"
   temp_name2 mid
   temp_expr2 "(logy > KNOT_Y_LOW.1) && (logy <= KNOT_Y_LOW.2)"
   temp_name3 high
   temp_expr3 "(logy > KNOT_Y_LOW.2) && (logy <= KNOT_Y_LOW.3)"
   expr0 "low ? coefsLow.0 : mid ? coefsLow.1 : coefsLow.2"
   expr1 "low ? coefsLow.1 : mid ? coefsLow.2 : coefsLow.3"
   expr2 "low ? coefsLow.2 : mid ? coefsLow.3 : coefsLow.4"
   expr3 "low ? 0 : mid ? 1 : high ? 2 : 0"
   name inv_cfLow5
   xpos 290
   ypos -82
  }
  ColorMatrix {
   channels {rgba.red rgba.green rgba.blue -rgba.alpha}
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name inv_basis_low5
   xpos 290
   ypos -34
  }
push $N5a9a1800
  MergeExpression {
   inputs 2
   temp_name0 logy
   temp_expr0 "log10(max(Bb, 1e-10))"
   expr0 Ar
   expr1 Ag
   expr2 Ab-logy
   expr3 Aa
   name c_minus_logy5
   xpos 400
   ypos -34
  }
  Expression {
   temp_name0 j
   temp_expr0 a
   temp_name1 d
   temp_expr1 "sqrt(g*g - 4*r*b)"
   temp_name2 t
   temp_expr2 "(2.*b)/(-sqrt(g*g - 4*r*b)-g)"
   expr0 0
   channel1 {-rgba.red rgba.green -rgba.blue none}
   expr1 0
   channel2 {-rgba.red -rgba.green rgba.blue none}
   expr2 "log10(minPoint.x) + (t +j) * KNOT_INC_LOW"
   expr3 1
   maskChannelInput -rgba.alpha
   unpremult -rgba.alpha
   name inv_knot_vals4
   xpos 400
   ypos 14
   addUserKnob {20 User}
   addUserKnob {7 knotIncLow}
   knotIncLow {{parent.knotIncLow}}
   addUserKnob {13 min l Min}
   min {{parent.min.x} {parent.min.y} {parent.minSlope}}
  }
push 0
push $N5a9a2400
  Dot {
   name Dot10
   xpos -6
   ypos -78
  }
set N5a9a0400 [stack 0]
  Expression {
   temp_name0 logy
   temp_expr0 "log10( max(r, 1e-10 ))"
   temp_name1 low
   temp_expr1 "(logy > KNOT_Y_LOW.0) && (logy <= KNOT_Y_LOW.1)"
   temp_name2 mid
   temp_expr2 "(logy > KNOT_Y_LOW.1) && (logy <= KNOT_Y_LOW.2)"
   temp_name3 high
   temp_expr3 "(logy > KNOT_Y_LOW.2) && (logy <= KNOT_Y_LOW.3)"
   expr0 "low ? coefsLow.0 : mid ? coefsLow.1 : coefsLow.2"
   expr1 "low ? coefsLow.1 : mid ? coefsLow.2 : coefsLow.3"
   expr2 "low ? coefsLow.2 : mid ? coefsLow.3 : coefsLow.4"
   expr3 "low ? 0 : mid ? 1 : high ? 2 : 0"
   name inv_cfLow
   xpos -150
   ypos -82
  }
  ColorMatrix {
   channels {rgba.red rgba.green rgba.blue -rgba.alpha}
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name inv_basis_low
   xpos -150
   ypos -34
  }
push $N5a9a0400
  MergeExpression {
   inputs 2
   temp_name0 logy
   temp_expr0 "log10(max(Br, 1e-10))"
   expr0 Ar
   expr1 Ag
   expr2 Ab-logy
   expr3 Aa
   name c_minus_logy
   xpos -40
   ypos -34
  }
  Expression {
   temp_name0 j
   temp_expr0 a
   temp_name1 d
   temp_expr1 "sqrt(g*g - 4*r*b)"
   temp_name2 t
   temp_expr2 "(2.*b)/(-sqrt(g*g - 4*r*b)-g)"
   expr0 "log10(minPoint.x) + (t +j) * KNOT_INC_LOW"
   channel1 {-rgba.red rgba.green -rgba.blue none}
   expr1 0
   channel2 {-rgba.red -rgba.green rgba.blue none}
   expr2 0
   expr3 1
   maskChannelInput -rgba.alpha
   unpremult -rgba.alpha
   name inv_knot_vals
   xpos -40
   ypos 14
   addUserKnob {20 User}
   addUserKnob {7 knotIncLow}
   knotIncLow {{parent.knotIncLow}}
   addUserKnob {13 min l Min}
   min {{parent.min.x} {parent.min.y} {parent.minSlope}}
  }
push $N5a9a2000
  Dot {
   name Dot18
   xpos 214
   ypos -78
  }
set N5a94ac00 [stack 0]
  Expression {
   temp_name0 logy
   temp_expr0 "log10( max(g, 1e-10 ))"
   temp_name1 low
   temp_expr1 "(logy > KNOT_Y_LOW.0) && (logy <= KNOT_Y_LOW.1)"
   temp_name2 mid
   temp_expr2 "(logy > KNOT_Y_LOW.1) && (logy <= KNOT_Y_LOW.2)"
   temp_name3 high
   temp_expr3 "(logy > KNOT_Y_LOW.2) && (logy <= KNOT_Y_LOW.3)"
   expr0 "low ? coefsLow.0 : mid ? coefsLow.1 : coefsLow.2"
   expr1 "low ? coefsLow.1 : mid ? coefsLow.2 : coefsLow.3"
   expr2 "low ? coefsLow.2 : mid ? coefsLow.3 : coefsLow.4"
   expr3 "low ? 0 : mid ? 1 : high ? 2 : 0"
   name inv_cfLow4
   xpos 70
   ypos -82
  }
  ColorMatrix {
   channels {rgba.red rgba.green rgba.blue -rgba.alpha}
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name inv_basis_low4
   xpos 70
   ypos -34
  }
push $N5a94ac00
  MergeExpression {
   inputs 2
   temp_name0 logy
   temp_expr0 "log10(max(Bg, 1e-10))"
   expr0 Ar
   expr1 Ag
   expr2 Ab-logy
   expr3 Aa
   name c_minus_logy4
   xpos 180
   ypos -34
  }
  Expression {
   temp_name0 j
   temp_expr0 a
   temp_name1 d
   temp_expr1 "sqrt(g*g - 4*r*b)"
   temp_name2 t
   temp_expr2 "(2.*b)/(-sqrt(g*g - 4*r*b)-g)"
   expr0 0
   channel1 {-rgba.red rgba.green -rgba.blue none}
   expr1 "log10(minPoint.x) + (t +j) * KNOT_INC_LOW"
   channel2 {-rgba.red -rgba.green rgba.blue none}
   expr2 0
   expr3 1
   maskChannelInput -rgba.alpha
   unpremult -rgba.alpha
   name inv_knot_vals5
   xpos 180
   ypos 14
   addUserKnob {20 User}
   addUserKnob {7 knotIncLow}
   knotIncLow {{parent.knotIncLow}}
   addUserKnob {13 min l Min}
   min {{parent.min.x} {parent.min.y} {parent.minSlope}}
  }
  Merge2 {
   inputs 3+1
   operation plus
   bbox B
   name Merge2
   xpos 180
   ypos 134
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply1
   xpos 180
   ypos 350
  }
  Dot {
   name Dot28
   label " "
   xpos 214
   ypos 786
  }
push 0
push $N5a9e1800
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 1e-10 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 1e-10 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 1e-10 ))"
   expr0 "( logr >= log10(midPoint.y) ) && ( logr < log10(maxPoint.y) )"
   expr1 "( logg >= log10(midPoint.y) ) && ( logg < log10(maxPoint.y) )"
   expr2 "( logb >= log10(midPoint.y) ) && ( logb < log10(maxPoint.y) )"
   name segment_high
   xpos -810
   ypos -202
  }
  Dot {
   name Dot23
   label " "
   xpos -776
   ypos 474
  }
push $N5a9a2800
  Dot {
   name Dot14
   label " "
   xpos 764
   ypos -318
  }
set N5a948400 [stack 0]
  Dot {
   name Dot15
   label " "
   xpos 764
   ypos -174
  }
set N5a8d7c00 [stack 0]
  Dot {
   name Dot17
   label " "
   xpos 984
   ypos -174
  }
set N5a8d7800 [stack 0]
  Dot {
   name Dot20
   label " "
   xpos 1204
   ypos -174
  }
  Dot {
   name Dot16
   xpos 1204
   ypos -78
  }
set N5a8d7000 [stack 0]
  Expression {
   temp_name0 logy
   temp_expr0 "log10( max(b, 1e-10 ))"
   temp_name1 low
   temp_expr1 "(logy > KNOT_Y_HIGH.0) && (logy <= KNOT_Y_HIGH.1)"
   temp_name2 mid
   temp_expr2 "(logy > KNOT_Y_HIGH.1) && (logy <= KNOT_Y_HIGH.2)"
   temp_name3 high
   temp_expr3 "(logy > KNOT_Y_HIGH.2) && (logy <= KNOT_Y_HIGH.3)"
   expr0 "low ? coefsHigh.0 : mid ? coefsHigh.1 : coefsHigh.2"
   expr1 "low ? coefsHigh.1 : mid ? coefsHigh.2 : coefsHigh.3"
   expr2 "low ? coefsHigh.2 : mid ? coefsHigh.3 : coefsHigh.4"
   expr3 "low ? 0 : mid ? 1 : high ? 2 : 0"
   name inv_cfLow3
   xpos 1060
   ypos -82
  }
  ColorMatrix {
   channels {rgba.red rgba.green rgba.blue -rgba.alpha}
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name inv_basis_low3
   xpos 1060
   ypos -34
  }
push $N5a8d7000
  MergeExpression {
   inputs 2
   temp_name0 logy
   temp_expr0 "log10(max(Bb, 1e-10))"
   expr0 Ar
   expr1 Ag
   expr2 Ab-logy
   expr3 Aa
   name c_minus_logy3
   xpos 1170
   ypos -34
  }
  Expression {
   temp_name0 j
   temp_expr0 a
   temp_name1 d
   temp_expr1 "sqrt(g*g - 4*r*b)"
   temp_name2 t
   temp_expr2 "(2.*b) / (-sqrt(g*g - 4*r*b) - g)"
   expr0 0
   channel1 {-rgba.red rgba.green -rgba.blue none}
   expr1 0
   channel2 {-rgba.red -rgba.green rgba.blue none}
   expr2 "log10(midPoint.x) + (t +j) * KNOT_INC_HIGH"
   expr3 1
   maskChannelInput -rgba.alpha
   unpremult -rgba.alpha
   name inv_knot_vals3
   xpos 1170
   ypos 14
  }
push 0
push $N5a8d7c00
  Dot {
   name Dot11
   xpos 764
   ypos -78
  }
set N5a8d5c00 [stack 0]
  Expression {
   temp_name0 logy
   temp_expr0 "log10( max(r, 1e-10 ))"
   temp_name1 low
   temp_expr1 "(logy > KNOT_Y_HIGH.0) && (logy <= KNOT_Y_HIGH.1)"
   temp_name2 mid
   temp_expr2 "(logy > KNOT_Y_HIGH.1) && (logy <= KNOT_Y_HIGH.2)"
   temp_name3 high
   temp_expr3 "(logy > KNOT_Y_HIGH.2) && (logy <= KNOT_Y_HIGH.3)"
   expr0 "low ? coefsHigh.0 : mid ? coefsHigh.1 : coefsHigh.2"
   expr1 "low ? coefsHigh.1 : mid ? coefsHigh.2 : coefsHigh.3"
   expr2 "low ? coefsHigh.2 : mid ? coefsHigh.3 : coefsHigh.4"
   expr3 "low ? 0 : mid ? 1 : high ? 2 : 0"
   name inv_cfLow1
   xpos 620
   ypos -82
  }
  ColorMatrix {
   channels {rgba.red rgba.green rgba.blue -rgba.alpha}
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name inv_basis_low1
   xpos 620
   ypos -34
  }
push $N5a8d5c00
  MergeExpression {
   inputs 2
   temp_name0 logy
   temp_expr0 "log10(max(Br, 1e-10))"
   expr0 Ar
   expr1 Ag
   expr2 Ab-logy
   expr3 Aa
   name c_minus_logy1
   xpos 730
   ypos -34
  }
  Expression {
   temp_name0 j
   temp_expr0 a
   temp_name1 d
   temp_expr1 "sqrt(g*g - 4*r*b)"
   temp_name2 t
   temp_expr2 "(2.*b) / (-sqrt(g*g - 4*r*b) - g)"
   expr0 "log10(midPoint.x) + (t +j) * KNOT_INC_HIGH"
   channel1 {-rgba.red rgba.green -rgba.blue none}
   expr1 0
   channel2 {-rgba.red -rgba.green rgba.blue none}
   expr2 0
   expr3 1
   maskChannelInput -rgba.alpha
   unpremult -rgba.alpha
   name inv_knot_vals1
   xpos 730
   ypos 14
  }
push $N5a8d7800
  Dot {
   name Dot12
   xpos 984
   ypos -78
  }
set N5a8d4800 [stack 0]
  Expression {
   temp_name0 logy
   temp_expr0 "log10( max(g, 1e-10 ))"
   temp_name1 low
   temp_expr1 "(logy > KNOT_Y_HIGH.0) && (logy <= KNOT_Y_HIGH.1)"
   temp_name2 mid
   temp_expr2 "(logy > KNOT_Y_HIGH.1) && (logy <= KNOT_Y_HIGH.2)"
   temp_name3 high
   temp_expr3 "(logy > KNOT_Y_HIGH.2) && (logy <= KNOT_Y_HIGH.3)"
   expr0 "low ? coefsHigh.0 : mid ? coefsHigh.1 : coefsHigh.2"
   expr1 "low ? coefsHigh.1 : mid ? coefsHigh.2 : coefsHigh.3"
   expr2 "low ? coefsHigh.2 : mid ? coefsHigh.3 : coefsHigh.4"
   expr3 "low ? 0 : mid ? 1 : high ? 2 : 0"
   name inv_cfLow2
   xpos 840
   ypos -82
  }
  ColorMatrix {
   channels {rgba.red rgba.green rgba.blue -rgba.alpha}
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name inv_basis_low2
   xpos 840
   ypos -34
  }
push $N5a8d4800
  MergeExpression {
   inputs 2
   temp_name0 logy
   temp_expr0 "log10(max(Bg, 1e-10))"
   expr0 Ar
   expr1 Ag
   expr2 Ab-logy
   expr3 Aa
   name c_minus_logy2
   xpos 950
   ypos -34
  }
  Expression {
   temp_name0 j
   temp_expr0 a
   temp_name1 d
   temp_expr1 "sqrt(g*g - 4*r*b)"
   temp_name2 t
   temp_expr2 "(2.*b) / (-sqrt(g*g - 4*r*b) - g)"
   expr0 0
   channel1 {-rgba.red rgba.green -rgba.blue none}
   expr1 "log10(midPoint.x) + (t +j) * KNOT_INC_HIGH"
   channel2 {-rgba.red -rgba.green rgba.blue none}
   expr2 0
   expr3 1
   maskChannelInput -rgba.alpha
   unpremult -rgba.alpha
   name inv_knot_vals2
   xpos 950
   ypos 14
  }
  Merge2 {
   inputs 3+1
   operation plus
   bbox B
   output rgb
   name Merge1
   xpos 950
   ypos 134
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply2
   xpos 950
   ypos 470
  }
  Dot {
   name Dot29
   label " "
   xpos 984
   ypos 786
  }
push $N5a9e1c00
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 1e-10 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 1e-10 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 1e-10 ))"
   expr0 "logr >= log10(maxPoint.y) ? 1 : 0"
   expr1 "logg >= log10(maxPoint.y) ? 1 : 0"
   expr2 "logb >= log10(maxPoint.y) ? 1 : 0"
   name segment_peak
   xpos -920
   ypos -202
  }
  Dot {
   name Dot24
   label " "
   xpos -886
   ypos 618
  }
push $N5a948400
  Dot {
   name Dot21
   label " "
   xpos 1534
   ypos -318
  }
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 1e-10 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 1e-10 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 1e-10 ))"
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 log10(maxPoint.x)
   expr1 log10(maxPoint.x)
   expr2 log10(maxPoint.x)
   expr3 1
   name proc_low1
   label Expression
   xpos 1500
   ypos -208
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply4
   xpos 1500
   ypos 614
  }
  Merge2 {
   inputs 4+1
   operation plus
   bbox B
   output rgb
   name Merge3
   xpos 510
   ypos 1118
  }
  Expression {
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 pow(10,r)
   expr1 pow(10,g)
   expr2 pow(10,b)
   name Expression13
   xpos 510
   ypos 1238
  }
  Copy {
   inputs 2
   from0 rgba.alpha
   to0 rgba.alpha
   name Copy1
   xpos 510
   ypos 1496
  }
  Output {
   name Output1
   xpos 510
   ypos 1814
  }
 end_group
 Expression {
  channel0 rgb
  expr0 log(r)/log(2)-log(0.18)/log(2)
  name expShift
  note_font Helvetica
  xpos -1140
  ypos -489
 }
end_group
set N5a113900 [stack 0]
Dot {
 name Dot8
 xpos 1719
 ypos 51
}
set N5a80f800 [stack 0]
Colorspace {
 colorspace_out CIE-XYZ
 name Colorspace16
 label "sRGb Lin to XYZ"
 xpos 1791
 ypos 57
}
Multiply {
 value 100
 name Multiply10
 label "Mult by 100 to put in absolute nits"
 xpos 1791
 ypos 89
}
Group {
 name ZCAM8
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos 1791
 ypos 146
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set N5a80e400 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set N5a80d000 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $N5a80d000
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set N5abe6400 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $N5abe6400
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set N5aba7000 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set N5aba6c00 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $N5aba7000
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set N5aba6000 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set N5aba5c00 [stack 0]
push $N5aba7000
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set N5aba5800 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set N5aba5400 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set N5aba5000 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set N5aba4c00 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $N5aba6c00
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $N5aba7000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $N5aba7000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $N5aba7000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  surrounds dark
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $N5a80e400
push $N5aba6c00
push $N5aba6000
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set N5ab32c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $N5ab32c00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $N5aba6c00
push $N5aba5c00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set N5ab31800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $N5ab31800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $N5aba6c00
push $N5aba5800
push $N5aba6000
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set N5aecbc00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set N5aecb800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $N5aecb800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $N5aba5000
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $N5aecbc00
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $N5aba5000
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $N5aba4c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $N5aecbc00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $N5aba5c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $N5aba5400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $N5aba6000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $N5aba5800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $N5aba6c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $N5a80e400
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set N5adea400 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set N5ade9800 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $N5ade9800
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $N5adea400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $N5adea400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $N5adea400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set N5ad7fc00 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set N5ad7f000 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $N5ad7f000
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $N5ad7f000
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set N5ad7e000 [stack 0]
push $N5ad7e000
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $N5adea400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $N5adea400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $N5ad7fc00
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set N5ad3f000 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $N5ad3f000
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $N5ad3f000
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set N5adae400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set N5ad3e000 [stack 0]
 Dot {
  name Dot44
  label C,h
  selected true
  xpos -1673
  ypos 2768
 }
push $N5adae400
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set N5ad3d800 [stack 0]
 Dot {
  name Dot20
  label M,h
  selected true
  xpos -1737
  ypos 2767
 }
push $N5adae400
push $N5adea400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set N5ad3cc00 [stack 0]
push $N5adea400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set N5ace7c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set N5adadd00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $N5ad3e000
push $N5ad3d800
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set N5ace6000 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $N5ace6000
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $N5adadd00
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set N5ac73c00 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $N5ac73c00
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set N5adacf00 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $N5adacf00
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $N5adea400
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $N5adea400
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $N5adea400
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $N5adadd00
push $N5adea400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $N5ad7fc00
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $N5ad3cc00
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $N5ace7c00
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $N5adae400
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
Group {
 name ZCAM9
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos 1791
 ypos 198
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 direction inverse
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 inverseData1 M,h
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set N5b001400 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set N5af93c00 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $N5af93c00
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set N5af83200 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $N5af83200
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set N5af92000 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set N5af91c00 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $N5af92000
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set N5af91000 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set N5af90c00 [stack 0]
push $N5af92000
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set N5af90800 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set N5af90400 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set N5b307c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set N5b307800 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $N5af91c00
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $N5af92000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $N5af92000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $N5af92000
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  surrounds dim
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $N5b001400
push $N5af91c00
push $N5af91000
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set N5b305c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $N5b305c00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $N5af91c00
push $N5af90c00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set N5b304800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $N5b304800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $N5af91c00
push $N5af90800
push $N5af91000
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set N5b2aac00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set N5b2aa800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $N5b2aa800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $N5b307c00
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $N5b2aac00
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $N5b307c00
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $N5b307800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $N5b2aac00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $N5af90c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $N5af90400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $N5af91000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $N5af90800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $N5af91c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $N5b001400
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set N5b1cd400 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set N5b1cc800 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $N5b1cc800
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $N5b1cd400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $N5b1cd400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $N5b1cd400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set N5b166c00 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set N5b166000 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $N5b166000
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $N5b166000
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set N5b165000 [stack 0]
push $N5b165000
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $N5b1cd400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $N5b1cd400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $N5b166c00
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set N5b116000 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $N5b116000
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $N5b116000
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set N5b13b200 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set N5b115000 [stack 0]
 Dot {
  name Dot44
  label C,h
  selected true
  xpos -1673
  ypos 2768
 }
push $N5b13b200
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set N5b114800 [stack 0]
 Dot {
  name Dot20
  label M,h
  selected true
  xpos -1737
  ypos 2767
 }
push $N5b13b200
push $N5b1cd400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set N5b0c3800 [stack 0]
push $N5b1cd400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set N5b0c2c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set N5b13ab00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $N5b115000
push $N5b114800
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set N5b0c1000 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $N5b0c1000
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $N5b13ab00
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set N5b04ac00 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $N5b04ac00
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set N5b139d00 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $N5b139d00
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $N5b1cd400
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $N5b1cd400
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $N5b1cd400
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $N5b13ab00
push $N5b1cd400
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $N5b166c00
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $N5b0c3800
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $N5b0c2c00
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $N5b13b200
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
Multiply {
 value 0.01
 name Multiply11
 label "Mult by 100 to put in absolute nits"
 xpos 1791
 ypos 250
}
Colorspace {
 colorspace_in CIE-XYZ
 name Colorspace17
 label "XYZ to sRGB lin"
 xpos 1791
 ypos 301
}
Colorspace {
 colorspace_out sRGB
 name Colorspace15
 xpos 1791
 ypos 375
}
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.blue 0 2 white -1 -1 rgba.alpha 0 3"
 name Shuffle30
 xpos 1791
 ypos 399
}
Reformat {
 type scale
 scale 1.5
 resize none
 black_outside true
 name Reformat8
 xpos 1791
 ypos 420
}
set N5b383800 [stack 0]
push $N5b383800
Expression {
 channel0 rgba
 expr0 .1
 name Expression9
 xpos 1928
 ypos 420
}
Colorspace {
 colorspace_out sRGB
 name Colorspace19
 xpos 1928
 ypos 444
}
Merge2 {
 inputs 2
 name Merge1
 xpos 1825
 ypos 503
}
Crop {
 box {0 0 {width} {height}}
 name Crop2
 xpos 1825
 ypos 527
}
push $N5a80f800
Colorspace {
 colorspace_out sRGB
 name Colorspace18
 xpos 1692
 ypos 380
}
Reformat {
 type scale
 scale 1.5
 resize none
 black_outside true
 name Reformat9
 xpos 1692
 ypos 506
}
ContactSheet {
 inputs 2
 width {{input.width*columns}}
 height {{input.height*rows}}
 rows 2
 columns 1
 name ContactSheet4
 xpos 1819
 ypos 586
}
Constant {
 inputs 0
 channels rgb
 color {100 33 0 0}
 format "1024 1024 0 0 1024 1024 1 square_1K"
 name Constant3
 xpos 1252
 ypos 920
}
Expression {
 expr0 (y/(height-1))*r
 expr2 cx*180
 name Expression8
 xpos 1252
 ypos 1031
}
Shuffle2 {
 fromInput1 {{0} B}
 out1 zcam_J
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.red 0 0 zcam_J.blue 0 2 rgba.red 0 0 zcam_J.alpha 0 3"
 name Shuffle17
 xpos 1252
 ypos 1055
}
Shuffle2 {
 fromInput1 {{0} B}
 out1 zcam_Q
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.red 0 0 zcam_Q.blue 0 2 rgba.red 0 0 zcam_Q.alpha 0 3"
 name Shuffle29
 xpos 1252
 ypos 1079
}
Shuffle2 {
 fromInput1 {{0} B}
 out1 zcam_M
 fromInput2 {{0} B}
 mappings "4 rgba.green 0 1 zcam_M.green 0 1 rgba.green 0 1 zcam_M.red 0 0 rgba.green 0 1 zcam_M.blue 0 2 rgba.green 0 1 zcam_M.alpha 0 3"
 name Shuffle25
 xpos 1252
 ypos 1101
}
Shuffle2 {
 fromInput1 {{0} B}
 out1 zcam_h
 fromInput2 {{0} B}
 mappings "4 rgba.blue 0 2 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.red 0 0 rgba.blue 0 2 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.alpha 0 3"
 name Shuffle26
 xpos 1252
 ypos 1125
}
Group {
 name ZCAM6
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos 1252
 ypos 1154
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 direction inverse
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 inverseData1 M,h
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set N5b322c00 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set N5b321800 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $N5b321800
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set N5b6c3200 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $N5b6c3200
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set N5b69f800 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set N5b69f400 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $N5b69f800
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set N5b69e800 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set N5b69e400 [stack 0]
push $N5b69f800
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set N5b69e000 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set N5b69dc00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set N5b69d800 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set N5b69d400 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $N5b69f400
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $N5b69f800
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $N5b69f800
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $N5b69f800
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $N5b322c00
push $N5b69f400
push $N5b69e800
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set N5b62f400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $N5b62f400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $N5b69f400
push $N5b69e400
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set N5b62e000 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $N5b62e000
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $N5b69f400
push $N5b69e000
push $N5b69e800
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set N5b62c800 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set N5b62c400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $N5b62c400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $N5b69d800
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $N5b62c800
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $N5b69d800
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $N5b69d400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $N5b62c800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $N5b69e400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $N5b69dc00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $N5b69e800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $N5b69e000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $N5b69f400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $N5b322c00
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set N5b4e2c00 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set N5b4e2000 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $N5b4e2000
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $N5b4e2c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $N5b4e2c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $N5b4e2c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set N5b4e0800 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set N5b48b800 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $N5b48b800
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $N5b48b800
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set N5b48a800 [stack 0]
push $N5b48a800
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $N5b4e2c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $N5b4e2c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  selected true
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $N5b4e0800
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set N5b43b800 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $N5b43b800
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $N5b43b800
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set N5b46f200 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set N5b43a800 [stack 0]
 Dot {
  name Dot44
  label C,h
  xpos -1673
  ypos 2768
 }
push $N5b46f200
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set N5b43a000 [stack 0]
 Dot {
  name Dot20
  label M,h
  xpos -1737
  ypos 2767
 }
push $N5b46f200
push $N5b4e2c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set N5b439400 [stack 0]
push $N5b4e2c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set N5b438800 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set N5b46eb00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $N5b43a800
push $N5b43a000
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set N5b7e2800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $N5b7e2800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $N5b46eb00
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set N5b7e0800 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $N5b7e0800
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set N5b46dd00 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $N5b46dd00
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $N5b4e2c00
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $N5b4e2c00
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $N5b4e2c00
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $N5b46eb00
push $N5b4e2c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $N5b4e0800
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $N5b439400
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $N5b438800
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $N5b46f200
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
Multiply {
 value 0.01
 name Multiply9
 label "Div by 100 to go from nits"
 xpos 1252
 ypos 1213
}
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.blue 0 2 white -1 -1 rgba.alpha 0 3"
 name Shuffle28
 xpos 1252
 ypos 1255
}
Colorspace {
 colorspace_in CIE-XYZ
 name Colorspace13
 label "XYZ to sRGB Prims"
 xpos 1252
 ypos 1279
}
set N5bb01c00 [stack 0]
Shuffle2 {
 fromInput1 {{0} B}
 in1 zcam_M
 fromInput2 {{0} B}
 mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
 name Shuffle33
 xpos 1449
 ypos 1480
}
push $N5a12fc00
PositionToPoints2 {
 display textured
 render_mode textured
 P_channel rgb
 detail 1
 name PositionToPoints5
 xpos 1789
 ypos 1570
}
Constant {
 inputs 0
 channels rgb
 color {100 {frame/1023*100} 0 0}
 format "1024 1024 0 0 1024 1024 1 square_1K"
 name Constant6
 xpos 344
 ypos 985
}
Expression {
 expr0 (y/(height-1))*r
 expr2 cx*180
 name Expression13
 xpos 344
 ypos 1096
}
Shuffle2 {
 fromInput1 {{0} B}
 out1 zcam_J
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.red 0 0 zcam_J.blue 0 2 rgba.red 0 0 zcam_J.alpha 0 3"
 name Shuffle42
 xpos 344
 ypos 1120
}
Shuffle2 {
 fromInput1 {{0} B}
 out1 zcam_Q
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.red 0 0 zcam_Q.blue 0 2 rgba.red 0 0 zcam_Q.alpha 0 3"
 name Shuffle43
 xpos 344
 ypos 1144
}
Shuffle2 {
 fromInput1 {{0} B}
 out1 zcam_M
 fromInput2 {{0} B}
 mappings "4 rgba.green 0 1 zcam_M.green 0 1 rgba.green 0 1 zcam_M.red 0 0 rgba.green 0 1 zcam_M.blue 0 2 rgba.green 0 1 zcam_M.alpha 0 3"
 name Shuffle44
 xpos 344
 ypos 1166
}
Shuffle2 {
 fromInput1 {{0} B}
 out1 zcam_h
 fromInput2 {{0} B}
 mappings "4 rgba.blue 0 2 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.red 0 0 rgba.blue 0 2 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.alpha 0 3"
 name Shuffle45
 xpos 344
 ypos 1190
}
Group {
 name ZCAM14
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos 344
 ypos 1245
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 direction inverse
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 inverseData1 M,h
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set N5ba8ec00 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set N5ba8d800 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $N5ba8d800
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set N5ba43200 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $N5ba43200
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set N5ba23800 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set N5ba23400 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $N5ba23800
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set N5ba22800 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set N5ba22400 [stack 0]
push $N5ba23800
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set N5ba22000 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set N5ba21c00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set N5ba21800 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set N5ba21400 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $N5ba23400
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $N5ba23800
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $N5ba23800
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $N5ba23800
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $N5ba8ec00
push $N5ba23400
push $N5ba22800
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set N5b9a7400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $N5b9a7400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $N5ba23400
push $N5ba22400
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set N5b9a6000 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $N5b9a6000
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $N5ba23400
push $N5ba22000
push $N5ba22800
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set N5b9a4800 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set N5b9a4400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $N5b9a4400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $N5ba21800
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $N5b9a4800
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $N5ba21800
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $N5ba21400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $N5b9a4800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $N5ba22400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $N5ba21c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $N5ba22800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $N5ba22000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $N5ba23400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $N5ba8ec00
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set N5b862c00 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set N5b862000 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $N5b862000
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $N5b862c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $N5b862c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $N5b862c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set N5b860800 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set N5bc03800 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $N5bc03800
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $N5bc03800
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set N5bc02800 [stack 0]
push $N5bc02800
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $N5b862c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $N5b862c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  selected true
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $N5b860800
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set N5bbaf800 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $N5bbaf800
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $N5bbaf800
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set N5bbf3200 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set N5bbae800 [stack 0]
 Dot {
  name Dot44
  label C,h
  xpos -1673
  ypos 2768
 }
push $N5bbf3200
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set N5bbae000 [stack 0]
 Dot {
  name Dot20
  label M,h
  xpos -1737
  ypos 2767
 }
push $N5bbf3200
push $N5b862c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set N5bbad400 [stack 0]
push $N5b862c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set N5bbac800 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set N5bbf2b00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $N5bbae800
push $N5bbae000
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set N5bb62800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $N5bb62800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $N5bbf2b00
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set N5bb60800 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $N5bb60800
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set N5bbf1d00 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $N5bbf1d00
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $N5b862c00
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $N5b862c00
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $N5b862c00
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $N5bbf2b00
push $N5b862c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $N5b860800
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $N5bbad400
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $N5bbac800
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $N5bbf3200
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
Multiply {
 value 0.01
 name Multiply17
 label "Div by 100 to go from nits"
 xpos 344
 ypos 1324
}
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.blue 0 2 white -1 -1 rgba.alpha 0 3"
 name Shuffle46
 xpos 344
 ypos 1366
}
Colorspace {
 colorspace_in CIE-XYZ
 name Colorspace28
 label "XYZ to sRGB Prims"
 xpos 344
 ypos 1390
}
Dot {
 name Dot9
 xpos 378
 ypos 1439
}
set N5be75800 [stack 0]
Dot {
 name Dot11
 xpos 505
 ypos 1465
}
set N5be75400 [stack 0]
Expression {
 channel0 rgba
 expr0 min((r<0?0:1),(g<0?0:1),(b<0?0:1))
 name Expression10
 xpos 428
 ypos 1490
}
push $N5be75400
Expression {
 channel0 rgba
 expr0 min((r>1?0:1),(g>1?0:1),(b>1?0:1))
 name Expression12
 xpos 533
 ypos 1488
}
Merge2 {
 inputs 2
 operation multiply
 name Multiply16
 xpos 470
 ypos 1520
}
push $N5be75800
Copy {
 inputs 2
 from0 rgba.alpha
 to0 rgba.alpha
 name Copy8
 xpos 344
 ypos 1576
}
Premult {
 name Premult1
 xpos 344
 ypos 1608
}
Dot {
 name Dot10
 xpos 378
 ypos 1715
}
set N5be07800 [stack 0]
Group {
 name FrameBlendMerge
 help http://richardfrazer.com/tools-tutorials/frameblendmerge/
 knobChanged "\nn = nuke.thisNode()\nk = nuke.thisKnob()\n#print n\['customframerange'].getValue()\nif k.name()==\"customframerange\":\n    n\['framerangestart'].setEnabled((n\['customframerange'].getValue())!=0)\n    n\['framerangeend'].setEnabled(n\['customframerange'].getValue()!=0)\n    n\['numberframes'].setEnabled((1-n\['customframerange'].getValue())!=0)\nif k.name()==\"invertalpha\":\n    n\['defaultinvert'].setValue((n\['invertalpha'].getValue())!=0)\nif k.name()==\"method\":\n    n\['vectordetail'].setVisible((n\['method'].getValue())!=0)\n    n\['smooth'].setVisible(n\['method'].getValue()!=0)\n    if n\['method'].getValue()==0:\n        n\['invertalpha'].setValue(n\['defaultinvert'].getValue())\n    if n\['method'].getValue()==1:\n        n\['invertalpha'].setValue(0)\n"
 xpos 344
 ypos 2007
 disable true
 addUserKnob {20 User}
 addUserKnob {4 operation M {atop average color-burn color-dodge conjoint-over copy difference disjoint-over divide exclusion from geometric hard-light hypot in mask matte max min minus multiply out over overlay plus screen soft-light stencil under xor}}
 operation over
 addUserKnob {26 ""}
 addUserKnob {26 text2 l "" +STARTLINE T "Frame blend\n"}
 addUserKnob {3 framerangestart l "Frame Range"}
 addUserKnob {3 framerangeend l "" -STARTLINE}
 framerangeend 750
 addUserKnob {22 InputRange l "Input Range" -STARTLINE T "n = nuke.thisNode()\nf = n.firstFrame()\nl = n.lastFrame() \n\nn\['framerangestart'].setValue(f)\nn\['framerangeend'].setValue(l)"}
 addUserKnob {26 ""}
 addUserKnob {22 update l Update T "t = nuke.thisNode()\n\n\ntname = t.name()\n\n\n#print ('tname: ' + tname)\n\n\n\nnuke.thisNode().begin()\n\n\nframestart = int(t\['framerangestart'].value())\nframeend = int(t\['framerangeend'].value())\n\n\np = -1000\n\n\nfor d in nuke.allNodes():\n    if (d.Class() == 'FrameHold') or (d.Class() == 'Merge2'):\n         nuke.delete(d) \n    #else:\n    #     print (\"Ignore this\" + d.Class() )\n\n\n\nfor x in range(framestart, frameend):\n    nname = 'FrameHoldMerge' +str(x)\n    if(nuke.exists( nname )):\n        #print (nname + \" exists\")\n        k = nuke.toNode ( nname ) \n        nuke.delete ( k )\n    n = nuke.createNode( 'FrameHold' )              \n    n\['name'].setValue( nname )\n    n\['first_frame'].setValue( x )\n    n.setXYpos( p, 600 )\n    n.setInput(0, nuke.toNode( 'inputDot' ))\n    p = p + 100\n\n\nnewMerge = nuke.createNode('Merge2')\nnewMerge\['name'].setValue( 'MergeFrames' )\nnewMerge.setXYpos( -900, 700 )  \n\n\ni = 0\n\n\nfor x in range(framestart, frameend):\n    nname = 'FrameHoldMerge' +str(x)\n    n = nuke.toNode( nname )\n    if(i==2):\n        i=i+1\n    #print(\"connecting input \" + str(i))\n    newMerge.setInput(i, nuke.toNode( nname ))\n    i=i+1\n\n\nnewMerge.setInput(2, nuke.toNode( \"mask_dot\" ))\n\n\ntoperation = t\['operation'].value()\nnewMerge\['operation'].setValue( toperation )\n\n\no = nuke.toNode( 'OutputBlend' )\no.setInput(0, newMerge)\n\n\nnewMerge.hideControlPanel()\n\n\nnuke.thisNode().end()\n\n\nt = nuke.toNode( tname )\n\n\n#print ('t: ' +  t.name() )\n\n\nnuke.show(t)\n\n" +STARTLINE}
 addUserKnob {20 About}
 addUserKnob {26 textabout l "" +STARTLINE T "FrameBlendMerge v1.4 by Richard Frazer\nwww.richardfrazer.com/tools-tutorials/frameblendmerge/\n"}
}
 Input {
  inputs 0
  name Input
  xpos -905
  ypos 395
 }
 Dot {
  name inputDot
  xpos -871
  ypos 495
 }
set N5be07000 [stack 0]
 FrameHold {
  firstFrame 99
  name FrameHoldMerge99
  xpos 8800
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 98
  name FrameHoldMerge98
  xpos 8700
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 97
  name FrameHoldMerge97
  xpos 8600
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 96
  name FrameHoldMerge96
  xpos 8500
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 95
  name FrameHoldMerge95
  xpos 8400
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 94
  name FrameHoldMerge94
  xpos 8300
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 93
  name FrameHoldMerge93
  xpos 8200
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 92
  name FrameHoldMerge92
  xpos 8100
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 91
  name FrameHoldMerge91
  xpos 8000
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 90
  name FrameHoldMerge90
  xpos 7900
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 89
  name FrameHoldMerge89
  xpos 7800
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 88
  name FrameHoldMerge88
  xpos 7700
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 87
  name FrameHoldMerge87
  xpos 7600
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 86
  name FrameHoldMerge86
  xpos 7500
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 85
  name FrameHoldMerge85
  xpos 7400
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 84
  name FrameHoldMerge84
  xpos 7300
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 83
  name FrameHoldMerge83
  xpos 7200
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 82
  name FrameHoldMerge82
  xpos 7100
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 81
  name FrameHoldMerge81
  xpos 7000
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 80
  name FrameHoldMerge80
  xpos 6900
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 79
  name FrameHoldMerge79
  xpos 6800
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 78
  name FrameHoldMerge78
  xpos 6700
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 77
  name FrameHoldMerge77
  xpos 6600
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 76
  name FrameHoldMerge76
  xpos 6500
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 75
  name FrameHoldMerge75
  xpos 6400
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 74
  name FrameHoldMerge74
  xpos 6300
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 73
  name FrameHoldMerge73
  xpos 6200
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 72
  name FrameHoldMerge72
  xpos 6100
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 71
  name FrameHoldMerge71
  xpos 6000
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 70
  name FrameHoldMerge70
  xpos 5900
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 69
  name FrameHoldMerge69
  xpos 5800
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 68
  name FrameHoldMerge68
  xpos 5700
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 67
  name FrameHoldMerge67
  xpos 5600
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 66
  name FrameHoldMerge66
  xpos 5500
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 65
  name FrameHoldMerge65
  xpos 5400
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 64
  name FrameHoldMerge64
  xpos 5300
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 63
  name FrameHoldMerge63
  xpos 5200
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 62
  name FrameHoldMerge62
  xpos 5100
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 61
  name FrameHoldMerge61
  xpos 5000
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 60
  name FrameHoldMerge60
  xpos 4900
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 59
  name FrameHoldMerge59
  xpos 4800
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 58
  name FrameHoldMerge58
  xpos 4700
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 57
  name FrameHoldMerge57
  xpos 4600
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 56
  name FrameHoldMerge56
  xpos 4500
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 55
  name FrameHoldMerge55
  xpos 4400
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 54
  name FrameHoldMerge54
  xpos 4300
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 53
  name FrameHoldMerge53
  xpos 4200
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 52
  name FrameHoldMerge52
  xpos 4100
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 51
  name FrameHoldMerge51
  xpos 4000
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 50
  name FrameHoldMerge50
  xpos 3900
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 49
  name FrameHoldMerge49
  xpos 3800
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 48
  name FrameHoldMerge48
  xpos 3700
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 47
  name FrameHoldMerge47
  xpos 3600
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 46
  name FrameHoldMerge46
  xpos 3500
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 45
  name FrameHoldMerge45
  xpos 3400
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 44
  name FrameHoldMerge44
  xpos 3300
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 43
  name FrameHoldMerge43
  xpos 3200
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 42
  name FrameHoldMerge42
  xpos 3100
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 41
  name FrameHoldMerge41
  xpos 3000
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 40
  name FrameHoldMerge40
  xpos 2900
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 39
  name FrameHoldMerge39
  xpos 2800
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 38
  name FrameHoldMerge38
  xpos 2700
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 37
  name FrameHoldMerge37
  xpos 2600
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 36
  name FrameHoldMerge36
  xpos 2500
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 35
  name FrameHoldMerge35
  xpos 2400
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 34
  name FrameHoldMerge34
  xpos 2300
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 33
  name FrameHoldMerge33
  xpos 2200
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 32
  name FrameHoldMerge32
  xpos 2100
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 31
  name FrameHoldMerge31
  xpos 2000
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 30
  name FrameHoldMerge30
  xpos 1900
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 29
  name FrameHoldMerge29
  xpos 1800
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 28
  name FrameHoldMerge28
  xpos 1700
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 27
  name FrameHoldMerge27
  xpos 1600
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 26
  name FrameHoldMerge26
  xpos 1500
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 25
  name FrameHoldMerge25
  xpos 1400
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 24
  name FrameHoldMerge24
  xpos 1300
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 23
  name FrameHoldMerge23
  xpos 1200
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 22
  name FrameHoldMerge22
  xpos 1100
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 21
  name FrameHoldMerge21
  xpos 1000
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 20
  name FrameHoldMerge20
  xpos 900
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 19
  name FrameHoldMerge19
  xpos 800
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 18
  name FrameHoldMerge18
  xpos 700
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 17
  name FrameHoldMerge17
  xpos 600
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 16
  name FrameHoldMerge16
  xpos 500
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 15
  name FrameHoldMerge15
  xpos 400
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 14
  name FrameHoldMerge14
  xpos 300
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 13
  name FrameHoldMerge13
  xpos 200
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 12
  name FrameHoldMerge12
  xpos 100
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 11
  name FrameHoldMerge11
  xpos 0
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 10
  name FrameHoldMerge10
  xpos -100
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 9
  name FrameHoldMerge9
  xpos -200
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 8
  name FrameHoldMerge8
  xpos -300
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 7
  name FrameHoldMerge7
  xpos -400
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 6
  name FrameHoldMerge6
  xpos -500
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 5
  name FrameHoldMerge5
  xpos -600
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 4
  name FrameHoldMerge4
  xpos -700
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 3
  name FrameHoldMerge3
  xpos -800
  ypos 600
 }
 Input {
  inputs 0
  name Mask
  xpos -1349
  ypos 579
  number 1
 }
push $N5be07000
 Dot {
  name Dot2
  xpos -1202
  ypos 572
 }
 Remove {
  name Remove1
  xpos -1236
  ypos 604
 }
 Shuffle {
  red black
  green black
  blue black
  alpha white
  name Shuffle1
  xpos -1236
  ypos 638
 }
 Switch {
  inputs 2
  which {{"\[exists parent.input1]" i}}
  name Switch3
  xpos -1349
  ypos 647
 }
 Dot {
  name mask_dot
  xpos -1315
  ypos 703
 }
set N5be05c00 [stack 0]
push $N5be07000
 FrameHold {
  firstFrame 2
  name FrameHoldMerge2
  xpos -900
  ypos 600
 }
push $N5be07000
 FrameHold {
  firstFrame 1
  name FrameHoldMerge1
  xpos -1000
  ypos 600
 }
 Merge2 {
  inputs 99+1
  name MergeFrames
  selected true
  xpos -900
  ypos 700
 }
 Output {
  name OutputBlend
  xpos -900
  ypos 817
 }
push $N5be05c00
 Viewer {
  input_process false
  name Viewer1
  xpos -1341
  ypos 942
 }
end_group
push $N5a113900
Expression {
 expr0 "y==floor(r(x, pos.y)*height*mult)?1:0"
 expr1 "y==floor(g(x, pos.y)*height*mult)?1:0"
 expr2 "y==floor(b(x, pos.y)*height*mult)?1:0"
 channel3 alpha
 name PlotScanline2
 xpos 1274
 ypos 668
 addUserKnob {20 User}
 addUserKnob {12 pos}
 addUserKnob {7 mult R 0 5}
 mult 1
}
push $N4db9c400
Expression {
 expr0 "y==floor(r(x, pos.y)*height*mult)?1:0"
 expr1 "y==floor(g(x, pos.y)*height*mult)?1:0"
 expr2 "y==floor(b(x, pos.y)*height*mult)?1:0"
 channel3 alpha
 name PlotScanline3
 xpos 1134
 ypos 671
 addUserKnob {20 User}
 addUserKnob {12 pos}
 addUserKnob {7 mult R 0 5}
 mult 1
}
Copy {
 inputs 2
 from0 rgba.red
 to0 rgba.red
 name Copy2
 xpos 1206
 ypos 710
}
Rectangle {
 area {{width/2-1} 0 {width/2+1} {height}}
 color 0.05
 name Rectangle1
 xpos 1206
 ypos 742
}
push $N5a113900
Gamma {
 value 3.4
 name Gamma4
 xpos 1881
 ypos 2077
 disable true
}
Expression {
 expr0 "y==floor(r(x, pos.y)*height*mult)?1:0"
 expr1 "y==floor(g(x, pos.y)*height*mult)?1:0"
 expr2 "y==floor(b(x, pos.y)*height*mult)?1:0"
 channel3 alpha
 name PlotScanline4
 xpos 1894
 ypos 2175
 addUserKnob {20 User}
 addUserKnob {12 pos}
 addUserKnob {7 mult R 0 5}
 mult 1
}
push $N2c83bc00
EXPTool {
 mode Stops
 name Exposure2
 xpos 1061
 ypos 942
 disable true
}
Reformat {
 format "1024 1024 0 0 1024 1024 1 square_1K"
 black_outside true
 name Reformat11
 xpos 1061
 ypos 981
 disable true
}
Dot {
 name Dot20
 xpos 1088
 ypos 1639
}
Group {
 name ZCAMishDRT
 xpos 1054
 ypos 1841
 addUserKnob {20 User}
 addUserKnob {26 In}
 addUserKnob {41 illuminant_in l "" -STARTLINE T Colorspace30.illuminant_in}
 addUserKnob {41 primary_in l "" -STARTLINE T Colorspace30.primary_in}
 addUserKnob {26 "" +STARTLINE}
 addUserKnob {41 inverseData1 l "Inverse Data 1" T ZCAM11.inverseData1}
 addUserKnob {41 thr T clipToLimit1.thr}
 addUserKnob {26 "" +STARTLINE}
 addUserKnob {26 Out}
 addUserKnob {41 colorspace_out l out T Colorspace25.colorspace_out}
 addUserKnob {41 illuminant_out l "" -STARTLINE T Colorspace25.illuminant_out}
 addUserKnob {41 primary_out l "" -STARTLINE T Colorspace25.primary_out}
}
 Read {
  inputs 0
  file_type exr
  file /Users/afry/GitHub/nukeZCAM/images/gamutBounds/JCh_sRGBgamutBound_tempImg.exr
  format "1024 1024 0 0 1024 1024 1 square_1K"
  origset true
  version 2070
  name Read64
  xpos 553
  ypos 229
 }
set N248fac00 [stack 0]
 Colorspace {
  colorspace_out CIE-XYZ
  name Colorspace1
  xpos 553
  ypos 309
 }
 Multiply {
  value 100
  name Multiply3
  label "Mult by 100 to put in absolute nits"
  xpos 553
  ypos 333
 }
 Group {
  name ZCAM1
  label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
  xpos 553
  ypos 375
  addUserKnob {20 ZCAM}
  addUserKnob {4 direction M {forward inverse}}
  addUserKnob {26 ""}
  addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
  addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
  addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
  inverseData1 M,h
  addUserKnob {26 ""}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {41 surrounds T Constants.surrounds}
  addUserKnob {41 c T Constants.c}
  addUserKnob {41 Nc T Constants.Nc}
  addUserKnob {41 F T Constants.F}
  addUserKnob {41 FLL T Constants.FLL}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {41 La T Constants.La}
  addUserKnob {41 Yb T Constants.Yb}
  addUserKnob {41 surround T Constants.surround}
  addUserKnob {41 D T Constants.D}
  addUserKnob {41 Dtype T Constants.Dtype}
  addUserKnob {26 ""}
  addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
  addUserKnob {41 xyzw T Constants.xyzw}
  addUserKnob {26 ""}
  addUserKnob {41 Yw T Constants.Yw}
  addUserKnob {41 FL T Constants.FL}
  addUserKnob {41 n T Constants.n}
  addUserKnob {41 Fb T Constants.Fb}
  addUserKnob {41 Fs T Constants.Fs}
  addUserKnob {26 ""}
  addUserKnob {41 xyzwc T Constants.xyzwc}
  addUserKnob {41 iabzw T Constants.iabzw}
  addUserKnob {41 Qw T Constants.Qw}
 }
  BackdropNode {
   inputs 0
   name BackdropNode1
   tile_color 0x71c67100
   label xyz_to_jabz
   note_font_size 42
   xpos -1063
   ypos -50
   bdwidth 255
   bdheight 678
  }
  BackdropNode {
   inputs 0
   name BackdropNode2
   tile_color 0x388e8e00
   label Forward
   note_font_size 42
   xpos -1278
   ypos 673
   bdwidth 1634
   bdheight 582
  }
  BackdropNode {
   inputs 0
   name BackdropNode3
   tile_color 0x388e8e00
   label Inverse
   note_font_size 42
   xpos -2310
   ypos 2374
   bdwidth 1715
   bdheight 953
  }
  BackdropNode {
   inputs 0
   name BackdropNode4
   tile_color 0x388e8e00
   label "jabz to xyz"
   note_font_size 42
   xpos -2260
   ypos 3390
   bdwidth 300
   bdheight 667
  }
  BackdropNode {
   inputs 0
   name BackdropNode5
   label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
   xpos -1922
   ypos 791
   bdwidth 411
   bdheight 201
  }
  Input {
   inputs 0
   name Input1
   xpos -984
   ypos -137
  }
  Dot {
   name Dot4
   label xyzc
   xpos -950
   ypos -97
  }
  Dot {
   name Dot5
   xpos -950
   ypos -21
  }
set Ne1354c00 [stack 0]
  ColorMatrix {
   matrix {
       {{b} 0 {1-b}}
       {{1-g} {g} 0}
       {0 0 1}
     }
   name M_to_xyzp
   label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
   xpos -984
   ypos 30
   addUserKnob {20 User}
   addUserKnob {7 b}
   b 1.15
   addUserKnob {7 g}
   g 0.66
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   name _M_XYZP_TO_LMS
   label "# Define X',Y',Z' to L,M,S conversion matrix:"
   xpos -984
   ypos 102
  }
  Dot {
   name Dot1
   label LMS
   xpos -950
   ypos 154
  }
  Expression {
   expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
   expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
   expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
   name Expression1
   label "# response compression: lms to lms'"
   xpos -984
   ypos 199
   addUserKnob {20 _PQ_PARAMETERS}
   addUserKnob {7 c1}
   c1 {{3424/2**12}}
   addUserKnob {7 c2}
   c2 {{2413/2**7}}
   addUserKnob {7 c3}
   c3 {{2392/2**7}}
   addUserKnob {7 n}
   n {{2610/2**14}}
   addUserKnob {7 p}
   p {{1.7*2523/2**5}}
  }
  Dot {
   name Dot2
   label lmsp
   xpos -950
   ypos 260
  }
set N4c51f000 [stack 0]
  ColorMatrix {
   matrix {
       {0 1 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name _M_LMSP_TO_IAB_ZCAM
   xpos -912
   ypos 329
  }
  Add {
   value -3.703522621e-11
   name Add1
   label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
   xpos -912
   ypos 353
  }
  Dot {
   name Dot6
   label Iabz
   xpos -878
   ypos 411
  }
push $N4c51f000
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name _M_LMSP_TO_IAB_JABZ
   xpos -1053
   ypos 328
  }
  Dot {
   name Dot7
   label Iabz
   xpos -1019
   ypos 410
  }
  Switch {
   inputs 2
   which 1
   name use_zcam_parameters
   xpos -978
   ypos 441
  }
set N4cef0f00 [stack 0]
  Expression {
   expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
   name Expression2
   label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
   xpos -886
   ypos 492
  }
push $N4cef0f00
  Switch {
   inputs 2
   name use_zcam_parameters1
   label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
   xpos -978
   ypos 564
  }
  Dot {
   name Dot3
   label iabz
   xpos -944
   ypos 753
  }
set N4c51d400 [stack 0]
  Expression {
   temp_name0 r2d
   temp_expr0 180.0/pi
   temp_name1 h360
   temp_expr1 "360.0\n"
   temp_name2 h
   temp_expr2 atan2(b,g)*r2d
   channel0 rgba
   expr0 h
   name h
   xpos -1074
   ypos 904
  }
set N4c51d000 [stack 0]
  Expression {
   temp_name0 h
   temp_expr0 r
   channel0 rgba
   expr0 "1.015 + cos((h + 89.038)*pi/180)"
   name ez
   xpos -1074
   ypos 928
  }
push $N4c51d400
  Copy {
   inputs 2
   from0 rgba.red
   to0 rgba.red
   name Copy1
   xpos -894
   ypos 989
  }
  Expression {
   channel0 rgba
   expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
   name M_colorfulness
   label "# calculate colorfulness, M:"
   xpos -894
   ypos 1021
  }
set N4c51c400 [stack 0]
  Expression {
   channel0 rgba
   expr0 100*r/Constants.Qw
   name C
   label "# calculate chroma, C:"
   xpos -894
   ypos 1118
  }
set N4cc43c00 [stack 0]
push $N4c51d400
  Expression {
   channel0 rgba
   expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
   name Q
   label "# calculate brightness, Q:"
   xpos -1030
   ypos 1019
  }
set N4cc43800 [stack 0]
  Expression {
   channel0 rgba
   expr0 "100.0 * (r/Constants.Qw)"
   name J
   label "# calculate lightness, J:"
   xpos -1030
   ypos 1117
  }
set N4cc43400 [stack 0]
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy3
   xpos -1030
   ypos 1155
  }
set N4cc43000 [stack 0]
  Expression {
   channel0 rgba
   expr0 "100 - ((100-r)**2 + g**2)**0.5"
   name Wz
   label "# calculate whiteness, W:"
   xpos -1030
   ypos 1195
  }
set N4cc42c00 [stack 0]
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam
   fromInput2 {{0} B}
   mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
   name Shuffle2
   xpos -1202
   ypos 1199
  }
push $N4c51d000
  Dot {
   name Dot9
   label h
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1975
   ypos 2339
  }
push $N4c51d400
  Shuffle2 {
   fromInput1 {{0} B}
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
   name Iz
   xpos -1127
   ypos 835
  }
push $N4c51d400
  Shuffle2 {
   fromInput1 {{0} B}
   fromInput2 {{0} B}
   mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
   name az
   xpos -978
   ypos 837
  }
push $N4c51d400
  Shuffle2 {
   fromInput1 {{0} B}
   fromInput2 {{0} B}
   mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
   name bz
   xpos -825
   ypos 835
  }
  NoOp {
   inputs 0
   name Constants
   xpos -527
   ypos 180
   addUserKnob {20 User}
   addUserKnob {26 _1 l _SURROUND_PARAMETERS}
   addUserKnob {4 surrounds M {average dim dark}}
   addUserKnob {7 c}
   c {{curve(surrounds) 0.69 0.59 0.525}}
   addUserKnob {7 Nc}
   Nc {{curve(surrounds) 1 0.9 0.8}}
   addUserKnob {7 F}
   F {{curve(surrounds) 1 0.9 0.8}}
   addUserKnob {7 FLL}
   FLL {{curve(surrounds) 1 1 1}}
   addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
   addUserKnob {7 La}
   La 100
   addUserKnob {7 Yb}
   Yb 20
   addUserKnob {4 surround M {avg dim dark}}
   addUserKnob {7 D}
   D 1
   addUserKnob {7 Dtype}
   addUserKnob {26 ""}
   addUserKnob {18 xyzw_d65}
   xyzw_d65 {95.043 100 108.89}
   addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {18 xyzw}
   xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
   addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {26 ""}
   addUserKnob {7 Yw}
   Yw 100
   addUserKnob {7 FL}
   FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
   addUserKnob {7 n}
   n {{Yb/Yw}}
   addUserKnob {7 Fb}
   Fb {{n**0.5}}
   addUserKnob {7 Fs}
   Fs {{c}}
   addUserKnob {26 ""}
   addUserKnob {18 xyzwc}
   xyzwc {95.043 100 108.89}
   addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {18 iabzw}
   iabzw {0.31331 -0.00014318 -8.9369e-05}
   addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {7 Qw}
   Qw 185.85
  }
push $Ne1354c00
push $N4c51d000
push $N4c51c400
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy5
   xpos 67
   ypos 1136
  }
set N4cc41000 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180.0)
   name bM
   xpos 163
   ypos 1202
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_bM
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
   name Shuffle11
   xpos -752
   ypos 1400
  }
push $N4cc41000
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180.0)
   name aM
   xpos 67
   ypos 1203
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_aM
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
   name Shuffle10
   xpos -848
   ypos 1400
  }
push $N4c51d000
push $N4cc43c00
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy25
   xpos -164
   ypos 1149
  }
set N57a13800 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180.0)
   name bC
   xpos -76
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_bC
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
   name Shuffle25
   xpos -949
   ypos 1399
  }
push $N57a13800
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180.0)
   name aC
   xpos -164
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_aC
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
   name Shuffle24
   xpos -1048
   ypos 1397
  }
push $N4c51d000
push $N4cc43800
push $N4c51c400
  Copy {
   inputs 2
   from1 rgba.green
   to1 rgba.green
   name Copy2
   xpos -734
   ypos 1076
  }
  Expression {
   channel0 rgba
   expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
   name s
   label "# calculate saturation, s:"
   xpos -734
   ypos 1118
  }
set N57a12000 [stack 0]
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy24
   xpos -381
   ypos 1143
  }
set N57a11c00 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180.0)
   name bS
   xpos -287
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_bS
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
   name Shuffle23
   xpos -1150
   ypos 1398
  }
push $N57a11c00
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180.0)
   name aS
   xpos -381
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_aS
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
   name Shuffle22
   xpos -1254
   ypos 1395
  }
push $N4cc43000
  Expression {
   channel0 rgba
   expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
   name Vz
   label "# calculate vividness, V:"
   xpos -583
   ypos 1200
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Vz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
   name Shuffle9
   xpos -1345
   ypos 1396
  }
push $N57a12000
  Expression {
   channel0 rgba
   name Sz
   label "# calculate saturation, S:"
   xpos -734
   ypos 1196
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Sz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
   name Shuffle8
   xpos -1436
   ypos 1395
  }
push $N4cc43000
  Expression {
   channel0 rgba
   expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
   name Kz
   label "# calculate blackness, K:"
   xpos -895
   ypos 1195
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Kz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
   name Shuffle7
   xpos -1524
   ypos 1393
  }
push $N4cc42c00
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Wz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
   name Shuffle6
   xpos -1613
   ypos 1393
  }
push $N57a12000
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_s
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
   name Shuffle5
   xpos -1708
   ypos 1392
  }
push $N4cc43c00
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_C
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
   name Shuffle4
   xpos -1798
   ypos 1391
  }
push $N4cc43400
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_J
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
   name Shuffle1
   xpos -1900
   ypos 1390
  }
push $N4c51c400
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_M
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
   name Shuffle12
   xpos -1999
   ypos 1389
  }
push $N4cc43800
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Q
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
   name Shuffle3
   xpos -2089
   ypos 1391
  }
push $N4c51d000
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_h
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
   name Shuffle13
   xpos -2182
   ypos 1392
  }
push $Ne1354c00
  Dot {
   name Dot16
   xpos -2265
   ypos 1253
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_h
   name Copy21
   xpos -2299
   ypos 1416
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Q
   name Copy22
   xpos -2299
   ypos 1458
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_M
   name Copy20
   xpos -2298
   ypos 1505
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_J
   name Copy11
   xpos -2298
   ypos 1547
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_C
   name Copy12
   xpos -2298
   ypos 1589
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_s
   name Copy13
   xpos -2302
   ypos 1631
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Wz
   name Copy14
   xpos -2302
   ypos 1673
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Kz
   name Copy15
   xpos -2302
   ypos 1715
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Sz
   name Copy16
   xpos -2302
   ypos 1757
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Vz
   name Copy17
   xpos -2302
   ypos 1799
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_aS
   name Copy26
   xpos -2302
   ypos 1841
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_bS
   name Copy27
   xpos -2302
   ypos 1883
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_aC
   name Copy28
   xpos -2302
   ypos 1925
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_bC
   name Copy29
   xpos -2302
   ypos 1963
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_aM
   name Copy18
   xpos -2302
   ypos 2005
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_bM
   name Copy19
   xpos -2302
   ypos 2047
  }
  Switch {
   inputs 2
   which {{parent.direction}}
   name direction1
   xpos -2302
   ypos 2112
  }
  Dot {
   name Dot17
   xpos -2268
   ypos 2157
  }
set N574bc800 [stack 0]
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_h
   fromInput2 {{0} B}
   mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
   name Shuffle20
   xpos -1041
   ypos 2260
  }
  Dot {
   name Dot41
   label h
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1007
   ypos 2349
  }
  Dot {
   name Dot33
   label "h in outIn"
   xpos -1007
   ypos 2613
  }
set N55e83800 [stack 0]
  Dot {
   name Dot34
   xpos -1007
   ypos 2652
  }
push $N55e83800
  Dot {
   name Dot35
   xpos -1034
   ypos 2640
  }
push $N574bc800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_bS
   fromInput2 {{0} B}
   in2 zcam_aS
   mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
   name Shuffle16
   label "aS & bS"
   note_font_size 15
   xpos -1489
   ypos 2304
  }
push $N574bc800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_bC
   fromInput2 {{0} B}
   in2 zcam_aC
   mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
   name Shuffle17
   label "aC & bC"
   note_font_size 15
   xpos -1585
   ypos 2304
  }
push $N574bc800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_bM
   fromInput2 {{0} B}
   in2 zcam_aM
   mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
   name Shuffle26
   label "aM & bM"
   note_font_size 15
   xpos -1682
   ypos 2303
  }
  Switch {
   inputs 3
   which {{parent.inverseData1}}
   name inputdata_abX_mode
   xpos -1543
   ypos 2400
  }
  Dot {
   name Dot30
   xpos -1509
   ypos 2449
  }
set N55e82000 [stack 0]
  Dot {
   name Dot29
   xpos -1210
   ypos 2483
  }
  Expression {
   temp_name0 r2d
   temp_expr0 180.0/pi
   temp_name1 h360
   temp_expr1 "360.0\n"
   temp_name2 h
   temp_expr2 atan2(g,r)*r2d
   channel0 rgba
   expr0 h
   name inv_h
   label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
   xpos -1244
   ypos 2546
  }
  Dot {
   name Dot36
   label "a in outIn"
   xpos -1210
   ypos 2619
  }
set N55e81400 [stack 0]
  Dot {
   name Dot37
   xpos -1163
   ypos 2636
  }
push $N55e81400
  Dot {
   name Dot38
   xpos -1185
   ypos 2648
  }
push $N55e81400
  Dot {
   name Dot39
   xpos -1210
   ypos 2663
  }
  Switch {
   inputs 5
   which {{parent.inverseData1}}
   name inverseData1_Mode1
   label MCs
   xpos -1116
   ypos 2672
  }
  Dot {
   name Dot40
   xpos -1210
   ypos 2719
  }
set N55e80400 [stack 0]
push $N55e80400
  Expression {
   channel0 rgba
   expr0 "1.015 + cos((r + 89.038)*pi/180)"
   name inv_ez
   xpos -1244
   ypos 2756
  }
push $N574bc800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_C
   fromInput2 {{0} B}
   mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
   name Shuffle21
   xpos -1357
   ypos 2252
  }
  Dot {
   name Dot42
   label C
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1323
   ypos 2341
  }
  Expression {
   channel0 rgba
   expr0 r
   name MCs2
   label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
   xpos -1357
   ypos 2501
  }
  Dot {
   name Dot43
   label "h in outIn"
   xpos -1323
   ypos 2578
  }
push $N574bc800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_M
   fromInput2 {{0} B}
   mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
   name Shuffle19
   xpos -1442
   ypos 2252
  }
  Dot {
   name Dot31
   label M
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1408
   ypos 2341
  }
  Expression {
   channel0 rgba
   expr0 r
   name MCs1
   label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
   xpos -1442
   ypos 2501
  }
  Dot {
   name Dot25
   label "h in outIn"
   xpos -1408
   ypos 2575
  }
push $N55e82000
  Expression {
   channel0 rgba
   expr0 "(r**2.0 + g**2.0)**0.5"
   name MCs
   label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
   xpos -1645
   ypos 2460
  }
  Dot {
   name Dot24
   label "a in outIn"
   xpos -1611
   ypos 2581
  }
set N4c789400 [stack 0]
  Dot {
   name Dot28
   xpos -1564
   ypos 2598
  }
push $N4c789400
  Dot {
   name Dot27
   xpos -1586
   ypos 2610
  }
push $N4c789400
  Dot {
   name Dot26
   xpos -1611
   ypos 2625
  }
  Switch {
   inputs 5
   which {{parent.inverseData1}}
   name inverseData1_Mode
   label MCs
   xpos -1517
   ypos 2634
  }
set N66f30f00 [stack 0]
  Expression {
   channel0 rgba
   expr0 r
   name C_from_aC
   label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
   xpos -1926
   ypos 2714
  }
set N4c788400 [stack 0]
  Dot {
   name Dot44
   label C,h
   xpos -1673
   ypos 2768
  }
push $N66f30f00
  Expression {
   channel0 rgba
   expr0 100*r/Constants.Qw
   name C_from_aM
   label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
   xpos -2036
   ypos 2713
  }
set N548ab800 [stack 0]
  Dot {
   name Dot20
   label M,h
   xpos -1737
   ypos 2767
  }
push $N66f30f00
push $N574bc800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_Q
   fromInput2 {{0} B}
   mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
   name Shuffle18
   xpos -2182
   ypos 2257
  }
  Dot {
   name Dot21
   label Q
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1996
   ypos 2435
  }
set N548aac00 [stack 0]
push $N574bc800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_J
   fromInput2 {{0} B}
   mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
   name Shuffle14
   xpos -2302
   ypos 2259
  }
  Dot {
   name Dot8
   label J
   note_font_size 20
   note_font_color 0x677754ff
   xpos -2229
   ypos 2434
  }
  Dot {
   name Dot22
   xpos -2229
   ypos 2456
  }
set N548aa000 [stack 0]
  Expression {
   channel0 rgba
   expr0 Constants.Qw*(r/100)
   name Q_from_J
   label "# Get Lightness J and brightness Q from data:"
   xpos -2263
   ypos 2519
  }
  Switch {
   inputs 2
   which {{parent.inverseData0}}
   name InverseData0_Mode
   label Q
   xpos -2263
   ypos 2564
  }
set N66f30800 [stack 0]
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy30
   xpos -1818
   ypos 2676
  }
  Expression {
   temp_name0 M
   temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
   channel0 rgba
   expr0 100*M/Constants.Qw
   name C_from_aS
   label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
   xpos -1818
   ypos 2708
  }
push $N4c788400
push $N548ab800
  Switch {
   inputs 5
   which {{parent.inverseData1}}
   name inputdata_abX_mode1
   xpos -1926
   ypos 2799
  }
  Expression {
   channel0 rgba
   expr0 "Constants.Qw * r / 100"
   name inv_M
   label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
   xpos -1543
   ypos 2822
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy7
   xpos -1543
   ypos 2874
  }
  Expression {
   channel0 rgba
   expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
   name inv_t
   label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
   xpos -1543
   ypos 2906
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy8
   xpos -1543
   ypos 2986
  }
set N548a8400 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180)
   name inv_bz
   label t*np.sin(h*np.pi/180)
   xpos -1402
   ypos 3067
  }
push $N548a8400
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180)
   name inv_az
   label "az = t*np.cos(h*np.pi/180)"
   xpos -1543
   ypos 3064
  }
push $N66f30800
  Expression {
   channel0 rgba
   expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
   name inv_Iz
   label "# calculate achromatic signal, Iz:"
   xpos -2263
   ypos 2619
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy9
   xpos -2181
   ypos 3184
  }
  Copy {
   inputs 2
   from0 rgba.blue
   to0 rgba.blue
   name Copy10
   xpos -2181
   ypos 3216
  }
  Dot {
   name Dot15
   label iabz
   note_font_size 20
   xpos -2147
   ypos 3275
  }
  Dot {
   name Dot13
   xpos -2145
   ypos 3414
  }
  Dot {
   name Dot14
   xpos -2145
   ypos 3470
  }
set N57ab2000 [stack 0]
  Expression {
   expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
   name Expression3
   label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
   xpos -2050
   ypos 3532
  }
push $N57ab2000
  Switch {
   inputs 2
   name use_zcam_parameters2
   label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
   xpos -2179
   ypos 3608
  }
set N4b163900 [stack 0]
  Dot {
   name Dot19
   label Iabz
   xpos -2092
   ypos 3678
  }
  Add {
   value 3.703522621e-11
   name Add2
   label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
   xpos -2126
   ypos 3712
  }
  ColorMatrix {
   matrix {
       {0 1 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   invert true
   name _M_LMSP_TO_IAB_ZCAM1
   xpos -2126
   ypos 3750
  }
push $N4b163900
  Dot {
   name Dot18
   label Iabz
   xpos -2216
   ypos 3683
  }
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   invert true
   name _M_LMSP_TO_IAB_JABZ1
   xpos -2250
   ypos 3748
  }
  Switch {
   inputs 2
   which 1
   name use_zcam_parameters3
   xpos -2182
   ypos 3844
  }
  Expression {
   expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
   expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
   expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
   name Expression4
   label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
   xpos -2182
   ypos 3874
   addUserKnob {20 _PQ_PARAMETERS}
   addUserKnob {7 c1}
   c1 {{3424/2**12}}
   addUserKnob {7 c2}
   c2 {{2413/2**7}}
   addUserKnob {7 c3}
   c3 {{2392/2**7}}
   addUserKnob {7 n}
   n {{2610/2**14}}
   addUserKnob {7 p}
   p {{1.7*2523/2**5}}
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   invert true
   name _M_XYZP_TO_LMS1
   label "# Define X',Y',Z' to L,M,S conversion matrix:"
   xpos -2182
   ypos 3949
  }
  ColorMatrix {
   matrix {
       {{b} 0 {1-b}}
       {{1-g} {g} 0}
       {0 0 1}
     }
   invert true
   name M_to_xyzp1
   label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
   xpos -2182
   ypos 3981
   addUserKnob {20 User}
   addUserKnob {7 b}
   b 1.15
   addUserKnob {7 g}
   g 0.66
  }
push $N574bc800
  Switch {
   inputs 2
   which {{parent.direction}}
   name direction
   xpos -1519
   ypos 4172
  }
  Output {
   name Output1
   xpos -1519
   ypos 4272
  }
push $N574bc800
  Dot {
   name Dot11
   label aM
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1535
   ypos 2170
  }
push $N574bc800
  Dot {
   name Dot12
   label bM
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1439
   ypos 2173
  }
push $N66f30800
push $N574bc800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_Sz
   fromInput2 {{0} B}
   mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
   name Shuffle15
   xpos -1870
   ypos 2254
  }
  Dot {
   name Dot10
   label Sz
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1836
   ypos 2342
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy4
   xpos -1770
   ypos 2555
  }
  Expression {
   expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
   name inv_C
   label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
   xpos -1770
   ypos 2587
  }
push $N55e82000
  Dot {
   name Dot23
   label "H in outIn"
   xpos -1509
   ypos 2582
  }
  Dot {
   inputs 0
   name Dot32
   label "H in outIn"
   xpos -1108
   ypos 2620
  }
push $N548aac00
  Expression {
   channel0 rgba
   expr0 "100.0* (r/Constants.Qw)"
   name J_from_Q
   xpos -2030
   ypos 2479
  }
push $N548aa000
  Switch {
   inputs 2
   which {{parent.inverseData0}}
   name InverseData0_Mode1
   label J
   xpos -2030
   ypos 2527
  }
push $N66f30f00
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy23
   xpos -1596
   ypos 2681
  }
  Expression {
   channel0 rgba
   expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
   name inv3_C
   label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
   xpos -1596
   ypos 2713
  }
  Constant {
   inputs 0
   channels rgb
   color 0.034705
   name Constant1
   xpos -440
   ypos 2450
  }
 end_group
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name limitSampleNode1
  xpos 553
  ypos 428
 }
 Input {
  inputs 0
  name Input1
  xpos 1344
  ypos -442
 }
 Colorspace {
  primary_in ACES
  colorspace_out CIE-XYZ
  name Colorspace30
  label "ACES to XYZ"
  xpos 1344
  ypos -402
 }
 Multiply {
  value 100
  name Multiply19
  label "Mult by 100 to put in absolute nits"
  xpos 1344
  ypos -370
 }
 Group {
  name ZCAM10
  label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
  xpos 1344
  ypos -306
  addUserKnob {20 ZCAM}
  addUserKnob {4 direction M {forward inverse}}
  addUserKnob {26 ""}
  addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
  addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
  addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
  inverseData1 M,h
  addUserKnob {26 ""}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {41 surrounds T Constants.surrounds}
  addUserKnob {41 c T Constants.c}
  addUserKnob {41 Nc T Constants.Nc}
  addUserKnob {41 F T Constants.F}
  addUserKnob {41 FLL T Constants.FLL}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {41 La T Constants.La}
  addUserKnob {41 Yb T Constants.Yb}
  addUserKnob {41 surround T Constants.surround}
  addUserKnob {41 D T Constants.D}
  addUserKnob {41 Dtype T Constants.Dtype}
  addUserKnob {26 ""}
  addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
  addUserKnob {41 xyzw T Constants.xyzw}
  addUserKnob {26 ""}
  addUserKnob {41 Yw T Constants.Yw}
  addUserKnob {41 FL T Constants.FL}
  addUserKnob {41 n T Constants.n}
  addUserKnob {41 Fb T Constants.Fb}
  addUserKnob {41 Fs T Constants.Fs}
  addUserKnob {26 ""}
  addUserKnob {41 xyzwc T Constants.xyzwc}
  addUserKnob {41 iabzw T Constants.iabzw}
  addUserKnob {41 Qw T Constants.Qw}
 }
  BackdropNode {
   inputs 0
   name BackdropNode1
   tile_color 0x71c67100
   label xyz_to_jabz
   note_font_size 42
   xpos -1063
   ypos -50
   bdwidth 255
   bdheight 678
  }
  BackdropNode {
   inputs 0
   name BackdropNode2
   tile_color 0x388e8e00
   label Forward
   note_font_size 42
   xpos -1278
   ypos 673
   bdwidth 1634
   bdheight 582
  }
  BackdropNode {
   inputs 0
   name BackdropNode3
   tile_color 0x388e8e00
   label Inverse
   note_font_size 42
   xpos -2310
   ypos 2374
   bdwidth 1715
   bdheight 953
  }
  BackdropNode {
   inputs 0
   name BackdropNode4
   tile_color 0x388e8e00
   label "jabz to xyz"
   note_font_size 42
   xpos -2260
   ypos 3390
   bdwidth 300
   bdheight 667
  }
  BackdropNode {
   inputs 0
   name BackdropNode5
   label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
   xpos -1922
   ypos 791
   bdwidth 411
   bdheight 201
  }
  Input {
   inputs 0
   name Input1
   xpos -984
   ypos -137
  }
  Dot {
   name Dot4
   label xyzc
   xpos -950
   ypos -97
  }
  Dot {
   name Dot5
   xpos -950
   ypos -21
  }
set N878c1c00 [stack 0]
  ColorMatrix {
   matrix {
       {{b} 0 {1-b}}
       {{1-g} {g} 0}
       {0 0 1}
     }
   name M_to_xyzp
   label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
   xpos -984
   ypos 30
   addUserKnob {20 User}
   addUserKnob {7 b}
   b 1.15
   addUserKnob {7 g}
   g 0.66
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   name _M_XYZP_TO_LMS
   label "# Define X',Y',Z' to L,M,S conversion matrix:"
   xpos -984
   ypos 102
  }
  Dot {
   name Dot1
   label LMS
   xpos -950
   ypos 154
  }
  Expression {
   expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
   expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
   expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
   name Expression1
   label "# response compression: lms to lms'"
   xpos -984
   ypos 199
   addUserKnob {20 _PQ_PARAMETERS}
   addUserKnob {7 c1}
   c1 {{3424/2**12}}
   addUserKnob {7 c2}
   c2 {{2413/2**7}}
   addUserKnob {7 c3}
   c3 {{2392/2**7}}
   addUserKnob {7 n}
   n {{2610/2**14}}
   addUserKnob {7 p}
   p {{1.7*2523/2**5}}
  }
  Dot {
   name Dot2
   label lmsp
   xpos -950
   ypos 260
  }
set N878c0800 [stack 0]
  ColorMatrix {
   matrix {
       {0 1 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name _M_LMSP_TO_IAB_ZCAM
   xpos -912
   ypos 329
  }
  Add {
   value -3.703522621e-11
   name Add1
   label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
   xpos -912
   ypos 353
  }
  Dot {
   name Dot6
   label Iabz
   xpos -878
   ypos 411
  }
push $N878c0800
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name _M_LMSP_TO_IAB_JABZ
   xpos -1053
   ypos 328
  }
  Dot {
   name Dot7
   label Iabz
   xpos -1019
   ypos 410
  }
  Switch {
   inputs 2
   which 1
   name use_zcam_parameters
   xpos -978
   ypos 441
  }
set N87898100 [stack 0]
  Expression {
   expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
   name Expression2
   label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
   xpos -886
   ypos 492
  }
push $N87898100
  Switch {
   inputs 2
   name use_zcam_parameters1
   label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
   xpos -978
   ypos 564
  }
  Dot {
   name Dot3
   label iabz
   xpos -944
   ypos 753
  }
set N87856800 [stack 0]
  Expression {
   temp_name0 r2d
   temp_expr0 180.0/pi
   temp_name1 h360
   temp_expr1 "360.0\n"
   temp_name2 h
   temp_expr2 atan2(b,g)*r2d
   channel0 rgba
   expr0 h
   name h
   xpos -1074
   ypos 904
  }
set N87856400 [stack 0]
  Expression {
   temp_name0 h
   temp_expr0 r
   channel0 rgba
   expr0 "1.015 + cos((h + 89.038)*pi/180)"
   name ez
   xpos -1074
   ypos 928
  }
push $N87856800
  Copy {
   inputs 2
   from0 rgba.red
   to0 rgba.red
   name Copy1
   xpos -894
   ypos 989
  }
  Expression {
   channel0 rgba
   expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
   name M_colorfulness
   label "# calculate colorfulness, M:"
   xpos -894
   ypos 1021
  }
set N87855800 [stack 0]
  Expression {
   channel0 rgba
   expr0 100*r/Constants.Qw
   name C
   label "# calculate chroma, C:"
   xpos -894
   ypos 1118
  }
set N87855400 [stack 0]
push $N87856800
  Expression {
   channel0 rgba
   expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
   name Q
   label "# calculate brightness, Q:"
   xpos -1030
   ypos 1019
  }
set N87855000 [stack 0]
  Expression {
   channel0 rgba
   expr0 "100.0 * (r/Constants.Qw)"
   name J
   label "# calculate lightness, J:"
   xpos -1030
   ypos 1117
  }
set N87854c00 [stack 0]
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy3
   xpos -1030
   ypos 1155
  }
set N87854800 [stack 0]
  Expression {
   channel0 rgba
   expr0 "100 - ((100-r)**2 + g**2)**0.5"
   name Wz
   label "# calculate whiteness, W:"
   xpos -1030
   ypos 1195
  }
set N87854400 [stack 0]
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam
   fromInput2 {{0} B}
   mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
   name Shuffle2
   xpos -1202
   ypos 1199
  }
push $N87856400
  Dot {
   name Dot9
   label h
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1975
   ypos 2339
  }
push $N87856800
  Shuffle2 {
   fromInput1 {{0} B}
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
   name Iz
   xpos -1127
   ypos 835
  }
push $N87856800
  Shuffle2 {
   fromInput1 {{0} B}
   fromInput2 {{0} B}
   mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
   name az
   xpos -978
   ypos 837
  }
push $N87856800
  Shuffle2 {
   fromInput1 {{0} B}
   fromInput2 {{0} B}
   mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
   name bz
   xpos -825
   ypos 835
  }
  NoOp {
   inputs 0
   name Constants
   xpos -527
   ypos 180
   addUserKnob {20 User}
   addUserKnob {26 _1 l _SURROUND_PARAMETERS}
   addUserKnob {4 surrounds M {average dim dark}}
   addUserKnob {7 c}
   c {{curve(surrounds) 0.69 0.59 0.525}}
   addUserKnob {7 Nc}
   Nc {{curve(surrounds) 1 0.9 0.8}}
   addUserKnob {7 F}
   F {{curve(surrounds) 1 0.9 0.8}}
   addUserKnob {7 FLL}
   FLL {{curve(surrounds) 1 1 1}}
   addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
   addUserKnob {7 La}
   La 100
   addUserKnob {7 Yb}
   Yb 20
   addUserKnob {4 surround M {avg dim dark}}
   addUserKnob {7 D}
   D 1
   addUserKnob {7 Dtype}
   addUserKnob {26 ""}
   addUserKnob {18 xyzw_d65}
   xyzw_d65 {95.043 100 108.89}
   addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {18 xyzw}
   xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
   addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {26 ""}
   addUserKnob {7 Yw}
   Yw 100
   addUserKnob {7 FL}
   FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
   addUserKnob {7 n}
   n {{Yb/Yw}}
   addUserKnob {7 Fb}
   Fb {{n**0.5}}
   addUserKnob {7 Fs}
   Fs {{c}}
   addUserKnob {26 ""}
   addUserKnob {18 xyzwc}
   xyzwc {95.043 100 108.89}
   addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {18 iabzw}
   iabzw {0.31331 -0.00014318 -8.9369e-05}
   addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {7 Qw}
   Qw 185.85
  }
push $N878c1c00
push $N87856400
push $N87855800
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy5
   xpos 67
   ypos 1136
  }
set N877d2400 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180.0)
   name bM
   xpos 163
   ypos 1202
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_bM
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
   name Shuffle11
   xpos -752
   ypos 1400
  }
push $N877d2400
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180.0)
   name aM
   xpos 67
   ypos 1203
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_aM
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
   name Shuffle10
   xpos -848
   ypos 1400
  }
push $N87856400
push $N87855400
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy25
   xpos -164
   ypos 1149
  }
set N877d1000 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180.0)
   name bC
   xpos -76
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_bC
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
   name Shuffle25
   xpos -949
   ypos 1399
  }
push $N877d1000
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180.0)
   name aC
   xpos -164
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_aC
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
   name Shuffle24
   xpos -1048
   ypos 1397
  }
push $N87856400
push $N87855000
push $N87855800
  Copy {
   inputs 2
   from1 rgba.green
   to1 rgba.green
   name Copy2
   xpos -734
   ypos 1076
  }
  Expression {
   channel0 rgba
   expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
   name s
   label "# calculate saturation, s:"
   xpos -734
   ypos 1118
  }
set N87777400 [stack 0]
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy24
   xpos -381
   ypos 1143
  }
set N87777000 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180.0)
   name bS
   xpos -287
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_bS
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
   name Shuffle23
   xpos -1150
   ypos 1398
  }
push $N87777000
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180.0)
   name aS
   xpos -381
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_aS
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
   name Shuffle22
   xpos -1254
   ypos 1395
  }
push $N87854800
  Expression {
   channel0 rgba
   expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
   name Vz
   label "# calculate vividness, V:"
   xpos -583
   ypos 1200
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Vz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
   name Shuffle9
   xpos -1345
   ypos 1396
  }
push $N87777400
  Expression {
   channel0 rgba
   name Sz
   label "# calculate saturation, S:"
   xpos -734
   ypos 1196
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Sz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
   name Shuffle8
   xpos -1436
   ypos 1395
  }
push $N87854800
  Expression {
   channel0 rgba
   expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
   name Kz
   label "# calculate blackness, K:"
   xpos -895
   ypos 1195
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Kz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
   name Shuffle7
   xpos -1524
   ypos 1393
  }
push $N87854400
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Wz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
   name Shuffle6
   xpos -1613
   ypos 1393
  }
push $N87777400
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_s
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
   name Shuffle5
   xpos -1708
   ypos 1392
  }
push $N87855400
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_C
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
   name Shuffle4
   xpos -1798
   ypos 1391
  }
push $N87854c00
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_J
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
   name Shuffle1
   xpos -1900
   ypos 1390
  }
push $N87855800
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_M
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
   name Shuffle12
   xpos -1999
   ypos 1389
  }
push $N87855000
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Q
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
   name Shuffle3
   xpos -2089
   ypos 1391
  }
push $N87856400
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_h
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
   name Shuffle13
   xpos -2182
   ypos 1392
  }
push $N878c1c00
  Dot {
   name Dot16
   xpos -2265
   ypos 1253
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_h
   name Copy21
   xpos -2299
   ypos 1416
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Q
   name Copy22
   xpos -2299
   ypos 1458
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_M
   name Copy20
   xpos -2298
   ypos 1505
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_J
   name Copy11
   xpos -2298
   ypos 1547
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_C
   name Copy12
   xpos -2298
   ypos 1589
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_s
   name Copy13
   xpos -2302
   ypos 1631
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Wz
   name Copy14
   xpos -2302
   ypos 1673
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Kz
   name Copy15
   xpos -2302
   ypos 1715
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Sz
   name Copy16
   xpos -2302
   ypos 1757
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Vz
   name Copy17
   xpos -2302
   ypos 1799
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_aS
   name Copy26
   xpos -2302
   ypos 1841
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_bS
   name Copy27
   xpos -2302
   ypos 1883
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_aC
   name Copy28
   xpos -2302
   ypos 1925
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_bC
   name Copy29
   xpos -2302
   ypos 1963
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_aM
   name Copy18
   xpos -2302
   ypos 2005
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_bM
   name Copy19
   xpos -2302
   ypos 2047
  }
  Switch {
   inputs 2
   which {{parent.direction}}
   name direction1
   xpos -2302
   ypos 2112
  }
  Dot {
   name Dot17
   xpos -2268
   ypos 2157
  }
set N876a5c00 [stack 0]
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_h
   fromInput2 {{0} B}
   mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
   name Shuffle20
   xpos -1041
   ypos 2260
  }
  Dot {
   name Dot41
   label h
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1007
   ypos 2349
  }
  Dot {
   name Dot33
   label "h in outIn"
   xpos -1007
   ypos 2613
  }
set N876a5000 [stack 0]
  Dot {
   name Dot34
   xpos -1007
   ypos 2652
  }
push $N876a5000
  Dot {
   name Dot35
   xpos -1034
   ypos 2640
  }
push $N876a5c00
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_bS
   fromInput2 {{0} B}
   in2 zcam_aS
   mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
   name Shuffle16
   label "aS & bS"
   note_font_size 15
   xpos -1489
   ypos 2304
  }
push $N876a5c00
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_bC
   fromInput2 {{0} B}
   in2 zcam_aC
   mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
   name Shuffle17
   label "aC & bC"
   note_font_size 15
   xpos -1585
   ypos 2304
  }
push $N876a5c00
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_bM
   fromInput2 {{0} B}
   in2 zcam_aM
   mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
   name Shuffle26
   label "aM & bM"
   note_font_size 15
   xpos -1682
   ypos 2303
  }
  Switch {
   inputs 3
   which {{parent.inverseData1}}
   name inputdata_abX_mode
   xpos -1543
   ypos 2400
  }
  Dot {
   name Dot30
   xpos -1509
   ypos 2449
  }
set N8763b400 [stack 0]
  Dot {
   name Dot29
   xpos -1210
   ypos 2483
  }
  Expression {
   temp_name0 r2d
   temp_expr0 180.0/pi
   temp_name1 h360
   temp_expr1 "360.0\n"
   temp_name2 h
   temp_expr2 atan2(g,r)*r2d
   channel0 rgba
   expr0 h
   name inv_h
   label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
   xpos -1244
   ypos 2546
  }
  Dot {
   name Dot36
   label "a in outIn"
   xpos -1210
   ypos 2619
  }
set N8763a800 [stack 0]
  Dot {
   name Dot37
   xpos -1163
   ypos 2636
  }
push $N8763a800
  Dot {
   name Dot38
   xpos -1185
   ypos 2648
  }
push $N8763a800
  Dot {
   name Dot39
   xpos -1210
   ypos 2663
  }
  Switch {
   inputs 5
   which {{parent.inverseData1}}
   name inverseData1_Mode1
   label MCs
   xpos -1116
   ypos 2672
  }
  Dot {
   name Dot40
   xpos -1210
   ypos 2719
  }
set N87639800 [stack 0]
push $N87639800
  Expression {
   channel0 rgba
   expr0 "1.015 + cos((r + 89.038)*pi/180)"
   name inv_ez
   xpos -1244
   ypos 2756
  }
push $N876a5c00
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_C
   fromInput2 {{0} B}
   mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
   name Shuffle21
   xpos -1357
   ypos 2252
  }
  Dot {
   name Dot42
   label C
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1323
   ypos 2341
  }
  Expression {
   channel0 rgba
   expr0 r
   name MCs2
   label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
   xpos -1357
   ypos 2501
  }
  Dot {
   name Dot43
   label "h in outIn"
   xpos -1323
   ypos 2578
  }
push $N876a5c00
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_M
   fromInput2 {{0} B}
   mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
   name Shuffle19
   xpos -1442
   ypos 2252
  }
  Dot {
   name Dot31
   label M
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1408
   ypos 2341
  }
  Expression {
   channel0 rgba
   expr0 r
   name MCs1
   label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
   xpos -1442
   ypos 2501
  }
  Dot {
   name Dot25
   label "h in outIn"
   xpos -1408
   ypos 2575
  }
push $N8763b400
  Expression {
   channel0 rgba
   expr0 "(r**2.0 + g**2.0)**0.5"
   name MCs
   label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
   xpos -1645
   ypos 2460
  }
  Dot {
   name Dot24
   label "a in outIn"
   xpos -1611
   ypos 2581
  }
set N875ea800 [stack 0]
  Dot {
   name Dot28
   xpos -1564
   ypos 2598
  }
push $N875ea800
  Dot {
   name Dot27
   xpos -1586
   ypos 2610
  }
push $N875ea800
  Dot {
   name Dot26
   xpos -1611
   ypos 2625
  }
  Switch {
   inputs 5
   which {{parent.inverseData1}}
   name inverseData1_Mode
   label MCs
   xpos -1517
   ypos 2634
  }
set N87834100 [stack 0]
  Expression {
   channel0 rgba
   expr0 r
   name C_from_aC
   label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
   xpos -1926
   ypos 2714
  }
set N875e9800 [stack 0]
  Dot {
   name Dot44
   label C,h
   xpos -1673
   ypos 2768
  }
push $N87834100
  Expression {
   channel0 rgba
   expr0 100*r/Constants.Qw
   name C_from_aM
   label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
   xpos -2036
   ypos 2713
  }
set N875e9000 [stack 0]
  Dot {
   name Dot20
   label M,h
   xpos -1737
   ypos 2767
  }
push $N87834100
push $N876a5c00
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_Q
   fromInput2 {{0} B}
   mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
   name Shuffle18
   xpos -2182
   ypos 2257
  }
  Dot {
   name Dot21
   label Q
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1996
   ypos 2435
  }
set N875e8400 [stack 0]
push $N876a5c00
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_J
   fromInput2 {{0} B}
   mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
   name Shuffle14
   xpos -2302
   ypos 2259
  }
  Dot {
   name Dot8
   label J
   note_font_size 20
   note_font_color 0x677754ff
   xpos -2229
   ypos 2434
  }
  Dot {
   name Dot22
   xpos -2229
   ypos 2456
  }
set N875a7400 [stack 0]
  Expression {
   channel0 rgba
   expr0 Constants.Qw*(r/100)
   name Q_from_J
   label "# Get Lightness J and brightness Q from data:"
   xpos -2263
   ypos 2519
  }
  Switch {
   inputs 2
   which {{parent.inverseData0}}
   name InverseData0_Mode
   label Q
   xpos -2263
   ypos 2564
  }
set N87587900 [stack 0]
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy30
   xpos -1818
   ypos 2676
  }
  Expression {
   temp_name0 M
   temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
   channel0 rgba
   expr0 100*M/Constants.Qw
   name C_from_aS
   label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
   xpos -1818
   ypos 2708
  }
push $N875e9800
push $N875e9000
  Switch {
   inputs 5
   which {{parent.inverseData1}}
   name inputdata_abX_mode1
   xpos -1926
   ypos 2799
  }
  Expression {
   channel0 rgba
   expr0 "Constants.Qw * r / 100"
   name inv_M
   label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
   xpos -1543
   ypos 2822
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy7
   xpos -1543
   ypos 2874
  }
  Expression {
   channel0 rgba
   expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
   name inv_t
   label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
   xpos -1543
   ypos 2906
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy8
   xpos -1543
   ypos 2986
  }
set N875a5800 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180)
   name inv_bz
   label t*np.sin(h*np.pi/180)
   xpos -1402
   ypos 3067
  }
push $N875a5800
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180)
   name inv_az
   label "az = t*np.cos(h*np.pi/180)"
   xpos -1543
   ypos 3064
  }
push $N87587900
  Expression {
   channel0 rgba
   expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
   name inv_Iz
   label "# calculate achromatic signal, Iz:"
   xpos -2263
   ypos 2619
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy9
   xpos -2181
   ypos 3184
  }
  Copy {
   inputs 2
   from0 rgba.blue
   to0 rgba.blue
   name Copy10
   xpos -2181
   ypos 3216
  }
  Dot {
   name Dot15
   label iabz
   note_font_size 20
   xpos -2147
   ypos 3275
  }
  Dot {
   name Dot13
   xpos -2145
   ypos 3414
  }
  Dot {
   name Dot14
   xpos -2145
   ypos 3470
  }
set N87527400 [stack 0]
  Expression {
   expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
   name Expression3
   label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
   xpos -2050
   ypos 3532
  }
push $N87527400
  Switch {
   inputs 2
   name use_zcam_parameters2
   label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
   xpos -2179
   ypos 3608
  }
set N87586b00 [stack 0]
  Dot {
   name Dot19
   label Iabz
   xpos -2092
   ypos 3678
  }
  Add {
   value 3.703522621e-11
   name Add2
   label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
   xpos -2126
   ypos 3712
  }
  ColorMatrix {
   matrix {
       {0 1 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   invert true
   name _M_LMSP_TO_IAB_ZCAM1
   xpos -2126
   ypos 3750
  }
push $N87586b00
  Dot {
   name Dot18
   label Iabz
   xpos -2216
   ypos 3683
  }
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   invert true
   name _M_LMSP_TO_IAB_JABZ1
   xpos -2250
   ypos 3748
  }
  Switch {
   inputs 2
   which 1
   name use_zcam_parameters3
   xpos -2182
   ypos 3844
  }
  Expression {
   expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
   expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
   expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
   name Expression4
   label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
   xpos -2182
   ypos 3874
   addUserKnob {20 _PQ_PARAMETERS}
   addUserKnob {7 c1}
   c1 {{3424/2**12}}
   addUserKnob {7 c2}
   c2 {{2413/2**7}}
   addUserKnob {7 c3}
   c3 {{2392/2**7}}
   addUserKnob {7 n}
   n {{2610/2**14}}
   addUserKnob {7 p}
   p {{1.7*2523/2**5}}
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   invert true
   name _M_XYZP_TO_LMS1
   label "# Define X',Y',Z' to L,M,S conversion matrix:"
   xpos -2182
   ypos 3949
  }
  ColorMatrix {
   matrix {
       {{b} 0 {1-b}}
       {{1-g} {g} 0}
       {0 0 1}
     }
   invert true
   name M_to_xyzp1
   label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
   xpos -2182
   ypos 3981
   addUserKnob {20 User}
   addUserKnob {7 b}
   b 1.15
   addUserKnob {7 g}
   g 0.66
  }
push $N876a5c00
  Switch {
   inputs 2
   which {{parent.direction}}
   name direction
   xpos -1519
   ypos 4172
  }
  Output {
   name Output1
   xpos -1519
   ypos 4272
  }
push $N876a5c00
  Dot {
   name Dot11
   label aM
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1535
   ypos 2170
  }
push $N876a5c00
  Dot {
   name Dot12
   label bM
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1439
   ypos 2173
  }
push $N87587900
push $N876a5c00
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_Sz
   fromInput2 {{0} B}
   mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
   name Shuffle15
   xpos -1870
   ypos 2254
  }
  Dot {
   name Dot10
   label Sz
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1836
   ypos 2342
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy4
   xpos -1770
   ypos 2555
  }
  Expression {
   expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
   name inv_C
   label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
   xpos -1770
   ypos 2587
  }
push $N8763b400
  Dot {
   name Dot23
   label "H in outIn"
   xpos -1509
   ypos 2582
  }
  Dot {
   inputs 0
   name Dot32
   label "H in outIn"
   xpos -1108
   ypos 2620
  }
push $N875e8400
  Expression {
   channel0 rgba
   expr0 "100.0* (r/Constants.Qw)"
   name J_from_Q
   xpos -2030
   ypos 2479
  }
push $N875a7400
  Switch {
   inputs 2
   which {{parent.inverseData0}}
   name InverseData0_Mode1
   label J
   xpos -2030
   ypos 2527
  }
push $N87834100
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy23
   xpos -1596
   ypos 2681
  }
  Expression {
   channel0 rgba
   expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
   name inv3_C
   label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
   xpos -1596
   ypos 2713
  }
  Constant {
   inputs 0
   channels rgb
   color 0.034705
   name Constant1
   xpos -440
   ypos 2450
  }
 end_group
set N8789b200 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle1
  xpos 1501
  ypos -229
 }
 Multiply {
  value {{1/parent.Multiply19.value}}
  name Multiply1
  label "Div by 100 to go from nits"
  xpos 1501
  ypos -205
 }
 ColorLookup {
  channels all
  lut {master {curve x0.02407439426 0 x0.04948588461 5.620706361e-06 x0.0808724314 5.995634638e-05 x0.1089436561 0.0002520732232 x0.1538826674 0.0009655252215 x0.1705526412 0.001552375033 x0.1965807676 0.003411091166 x0.2212548852 0.005432802252 x0.2435974032 0.008078291081 x0.2744711637 0.01258628722 x0.335355252 0.02872310206 x0.3656598926 0.0391706787 x0.4067366123 0.05722413212 x0.451582104 0.08477441967 x0.5436673164 0.1626682729 x0.6915633678 0.3178558648 x0.7352961302 0.3736175299 x0.8164004087 0.4692641795 x0.8752408028 0.5275940299 x0.9309006333 0.5828329325 x0.9754681587 0.6187173724 x1.033632636 0.6637632847 x1.16960156 0.745464921 x1.235319972 0.7762671709 x1.356181145 0.8217196465 x1.508617401 0.8695153594 x1.637787938 0.8979744911 x1.822932601 0.9321763515 x1.905457973 0.9441890717 x2.068963289 0.9626951218 x2.316649675 0.9837986231 x2.455148697 0.9925647378 x2.621634722 1}
    red {}
    green {}
    blue {}
    alpha {}}
  name ColorLookup2
  xpos 1501
  ypos -163
 }
 Gamma {
  value 2.2
  name Gamma1
  xpos 1501
  ypos -131
 }
 Multiply {
  value {{parent.Multiply19.value}}
  name Multiply2
  label "Mult by 100 to put in absolute nits"
  xpos 1501
  ypos -99
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle2
  xpos 1501
  ypos -57
 }
push $N8789b200
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy10
  xpos 1350
  ypos -20
 }
 Dot {
  name Dot13
  xpos 1384
  ypos 90
 }
set N87453400 [stack 0]
 Dot {
  name Dot2
  xpos 739
  ypos 119
 }
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle3
  xpos 705
  ypos 186
 }
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  in2 zcam_C
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.blue 0 2 rgba.blue 0 2 rgba.alpha 0 3 rgba.alpha 0 3 zcam_C.green 1 1 rgba.green 0 1"
  name Shuffle4
  xpos 705
  ypos 210
 }
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  in2 zcam_h
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.alpha 0 3 rgba.alpha 0 3 zcam_h.blue 1 2 rgba.blue 0 2"
  name Shuffle5
  xpos 705
  ypos 234
 }
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.alpha
  name Copy1
  xpos 705
  ypos 424
 }
 Expression {
  temp_name0 limit
  temp_expr0 a(((b/360+.5)*1023),(r/100*1023))
  temp_name1 scaledVal
  temp_expr1 g/limit
  temp_name2 scale
  temp_expr2 1-thr
  expr2 "(scaledVal>thr? ( ((scaledVal-thr)/scale) / (((scaledVal-thr)/scale)+1) * scale + thr  )   : scaledVal ) * limit"
  channel3 alpha
  expr3 limit
  name clipToLimit1
  xpos 705
  ypos 456
  addUserKnob {20 User}
  addUserKnob {7 limitScale R 0 100}
  limitScale 100
  addUserKnob {7 thr}
  thr 0.9
 }
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.alpha 0 3"
  name Shuffle6
  xpos 705
  ypos 480
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.green 0 1 zcam_C.alpha 0 3"
  name Shuffle7
  xpos 705
  ypos 504
 }
 Read {
  inputs 0
  file_type exr
  file /Users/afry/GitHub/nukeZCAM/images/gamutBounds/JMh_sRGBgamutBound_tempImg.exr
  format "1024 1024 0 0 1024 1024 1 square_1K"
  origset true
  version 2072
  name Read68
  xpos 829
  ypos 237
 }
 Colorspace {
  colorspace_out CIE-XYZ
  name Colorspace29
  xpos 829
  ypos 317
 }
 Multiply {
  value 100
  name Multiply18
  label "Mult by 100 to put in absolute nits"
  xpos 829
  ypos 341
 }
 Group {
  name ZCAM15
  label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
  xpos 829
  ypos 383
  addUserKnob {20 ZCAM}
  addUserKnob {4 direction M {forward inverse}}
  addUserKnob {26 ""}
  addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
  addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
  addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
  inverseData1 M,h
  addUserKnob {26 ""}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {41 surrounds T Constants.surrounds}
  addUserKnob {41 c T Constants.c}
  addUserKnob {41 Nc T Constants.Nc}
  addUserKnob {41 F T Constants.F}
  addUserKnob {41 FLL T Constants.FLL}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {41 La T Constants.La}
  addUserKnob {41 Yb T Constants.Yb}
  addUserKnob {41 surround T Constants.surround}
  addUserKnob {41 D T Constants.D}
  addUserKnob {41 Dtype T Constants.Dtype}
  addUserKnob {26 ""}
  addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
  addUserKnob {41 xyzw T Constants.xyzw}
  addUserKnob {26 ""}
  addUserKnob {41 Yw T Constants.Yw}
  addUserKnob {41 FL T Constants.FL}
  addUserKnob {41 n T Constants.n}
  addUserKnob {41 Fb T Constants.Fb}
  addUserKnob {41 Fs T Constants.Fs}
  addUserKnob {26 ""}
  addUserKnob {41 xyzwc T Constants.xyzwc}
  addUserKnob {41 iabzw T Constants.iabzw}
  addUserKnob {41 Qw T Constants.Qw}
 }
  BackdropNode {
   inputs 0
   name BackdropNode1
   tile_color 0x71c67100
   label xyz_to_jabz
   note_font_size 42
   xpos -1063
   ypos -50
   bdwidth 255
   bdheight 678
  }
  BackdropNode {
   inputs 0
   name BackdropNode2
   tile_color 0x388e8e00
   label Forward
   note_font_size 42
   xpos -1278
   ypos 673
   bdwidth 1634
   bdheight 582
  }
  BackdropNode {
   inputs 0
   name BackdropNode3
   tile_color 0x388e8e00
   label Inverse
   note_font_size 42
   xpos -2310
   ypos 2374
   bdwidth 1715
   bdheight 953
  }
  BackdropNode {
   inputs 0
   name BackdropNode4
   tile_color 0x388e8e00
   label "jabz to xyz"
   note_font_size 42
   xpos -2260
   ypos 3390
   bdwidth 300
   bdheight 667
  }
  BackdropNode {
   inputs 0
   name BackdropNode5
   label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
   xpos -1922
   ypos 791
   bdwidth 411
   bdheight 201
  }
  Input {
   inputs 0
   name Input1
   xpos -984
   ypos -137
  }
  Dot {
   name Dot4
   label xyzc
   xpos -950
   ypos -97
  }
  Dot {
   name Dot5
   xpos -950
   ypos -21
  }
set N86cbf800 [stack 0]
  ColorMatrix {
   matrix {
       {{b} 0 {1-b}}
       {{1-g} {g} 0}
       {0 0 1}
     }
   name M_to_xyzp
   label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
   xpos -984
   ypos 30
   addUserKnob {20 User}
   addUserKnob {7 b}
   b 1.15
   addUserKnob {7 g}
   g 0.66
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   name _M_XYZP_TO_LMS
   label "# Define X',Y',Z' to L,M,S conversion matrix:"
   xpos -984
   ypos 102
  }
  Dot {
   name Dot1
   label LMS
   xpos -950
   ypos 154
  }
  Expression {
   expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
   expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
   expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
   name Expression1
   label "# response compression: lms to lms'"
   xpos -984
   ypos 199
   addUserKnob {20 _PQ_PARAMETERS}
   addUserKnob {7 c1}
   c1 {{3424/2**12}}
   addUserKnob {7 c2}
   c2 {{2413/2**7}}
   addUserKnob {7 c3}
   c3 {{2392/2**7}}
   addUserKnob {7 n}
   n {{2610/2**14}}
   addUserKnob {7 p}
   p {{1.7*2523/2**5}}
  }
  Dot {
   name Dot2
   label lmsp
   xpos -950
   ypos 260
  }
set N86cbe400 [stack 0]
  ColorMatrix {
   matrix {
       {0 1 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name _M_LMSP_TO_IAB_ZCAM
   xpos -912
   ypos 329
  }
  Add {
   value -3.703522621e-11
   name Add1
   label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
   xpos -912
   ypos 353
  }
  Dot {
   name Dot6
   label Iabz
   xpos -878
   ypos 411
  }
push $N86cbe400
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name _M_LMSP_TO_IAB_JABZ
   xpos -1053
   ypos 328
  }
  Dot {
   name Dot7
   label Iabz
   xpos -1019
   ypos 410
  }
  Switch {
   inputs 2
   which 1
   name use_zcam_parameters
   xpos -978
   ypos 441
  }
set N86c73900 [stack 0]
  Expression {
   expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
   name Expression2
   label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
   xpos -886
   ypos 492
  }
push $N86c73900
  Switch {
   inputs 2
   name use_zcam_parameters1
   label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
   xpos -978
   ypos 564
  }
  Dot {
   name Dot3
   label iabz
   xpos -944
   ypos 753
  }
set N86cbc800 [stack 0]
  Expression {
   temp_name0 r2d
   temp_expr0 180.0/pi
   temp_name1 h360
   temp_expr1 "360.0\n"
   temp_name2 h
   temp_expr2 atan2(b,g)*r2d
   channel0 rgba
   expr0 h
   name h
   xpos -1074
   ypos 904
  }
set N86cbc400 [stack 0]
  Expression {
   temp_name0 h
   temp_expr0 r
   channel0 rgba
   expr0 "1.015 + cos((h + 89.038)*pi/180)"
   name ez
   xpos -1074
   ypos 928
  }
push $N86cbc800
  Copy {
   inputs 2
   from0 rgba.red
   to0 rgba.red
   name Copy1
   xpos -894
   ypos 989
  }
  Expression {
   channel0 rgba
   expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
   name M_colorfulness
   label "# calculate colorfulness, M:"
   xpos -894
   ypos 1021
  }
set N86c5f400 [stack 0]
  Expression {
   channel0 rgba
   expr0 100*r/Constants.Qw
   name C
   label "# calculate chroma, C:"
   xpos -894
   ypos 1118
  }
set N86c5f000 [stack 0]
push $N86cbc800
  Expression {
   channel0 rgba
   expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
   name Q
   label "# calculate brightness, Q:"
   xpos -1030
   ypos 1019
  }
set N86c5ec00 [stack 0]
  Expression {
   channel0 rgba
   expr0 "100.0 * (r/Constants.Qw)"
   name J
   label "# calculate lightness, J:"
   xpos -1030
   ypos 1117
  }
set N86c5e800 [stack 0]
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy3
   xpos -1030
   ypos 1155
  }
set N86c5e400 [stack 0]
  Expression {
   channel0 rgba
   expr0 "100 - ((100-r)**2 + g**2)**0.5"
   name Wz
   label "# calculate whiteness, W:"
   xpos -1030
   ypos 1195
  }
set N86c5e000 [stack 0]
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam
   fromInput2 {{0} B}
   mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
   name Shuffle2
   xpos -1202
   ypos 1199
  }
push $N86cbc400
  Dot {
   name Dot9
   label h
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1975
   ypos 2339
  }
push $N86cbc800
  Shuffle2 {
   fromInput1 {{0} B}
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
   name Iz
   xpos -1127
   ypos 835
  }
push $N86cbc800
  Shuffle2 {
   fromInput1 {{0} B}
   fromInput2 {{0} B}
   mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
   name az
   xpos -978
   ypos 837
  }
push $N86cbc800
  Shuffle2 {
   fromInput1 {{0} B}
   fromInput2 {{0} B}
   mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
   name bz
   xpos -825
   ypos 835
  }
  NoOp {
   inputs 0
   name Constants
   xpos -527
   ypos 180
   addUserKnob {20 User}
   addUserKnob {26 _1 l _SURROUND_PARAMETERS}
   addUserKnob {4 surrounds M {average dim dark}}
   addUserKnob {7 c}
   c {{curve(surrounds) 0.69 0.59 0.525}}
   addUserKnob {7 Nc}
   Nc {{curve(surrounds) 1 0.9 0.8}}
   addUserKnob {7 F}
   F {{curve(surrounds) 1 0.9 0.8}}
   addUserKnob {7 FLL}
   FLL {{curve(surrounds) 1 1 1}}
   addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
   addUserKnob {7 La}
   La 100
   addUserKnob {7 Yb}
   Yb 20
   addUserKnob {4 surround M {avg dim dark}}
   addUserKnob {7 D}
   D 1
   addUserKnob {7 Dtype}
   addUserKnob {26 ""}
   addUserKnob {18 xyzw_d65}
   xyzw_d65 {95.043 100 108.89}
   addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {18 xyzw}
   xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
   addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {26 ""}
   addUserKnob {7 Yw}
   Yw 100
   addUserKnob {7 FL}
   FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
   addUserKnob {7 n}
   n {{Yb/Yw}}
   addUserKnob {7 Fb}
   Fb {{n**0.5}}
   addUserKnob {7 Fs}
   Fs {{c}}
   addUserKnob {26 ""}
   addUserKnob {18 xyzwc}
   xyzwc {95.043 100 108.89}
   addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {18 iabzw}
   iabzw {0.31331 -0.00014318 -8.9369e-05}
   addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {7 Qw}
   Qw 185.85
  }
push $N86cbf800
push $N86cbc400
push $N86c5f400
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy5
   xpos 67
   ypos 1136
  }
set N86c5c400 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180.0)
   name bM
   xpos 163
   ypos 1202
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_bM
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
   name Shuffle11
   xpos -752
   ypos 1400
  }
push $N86c5c400
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180.0)
   name aM
   xpos 67
   ypos 1203
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_aM
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
   name Shuffle10
   xpos -848
   ypos 1400
  }
push $N86cbc400
push $N86c5f000
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy25
   xpos -164
   ypos 1149
  }
set N86beec00 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180.0)
   name bC
   xpos -76
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_bC
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
   name Shuffle25
   xpos -949
   ypos 1399
  }
push $N86beec00
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180.0)
   name aC
   xpos -164
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_aC
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
   name Shuffle24
   xpos -1048
   ypos 1397
  }
push $N86cbc400
push $N86c5ec00
push $N86c5f400
  Copy {
   inputs 2
   from1 rgba.green
   to1 rgba.green
   name Copy2
   xpos -734
   ypos 1076
  }
  Expression {
   channel0 rgba
   expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
   name s
   label "# calculate saturation, s:"
   xpos -734
   ypos 1118
  }
set N86bed400 [stack 0]
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy24
   xpos -381
   ypos 1143
  }
set N86bed000 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180.0)
   name bS
   xpos -287
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_bS
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
   name Shuffle23
   xpos -1150
   ypos 1398
  }
push $N86bed000
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180.0)
   name aS
   xpos -381
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_aS
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
   name Shuffle22
   xpos -1254
   ypos 1395
  }
push $N86c5e400
  Expression {
   channel0 rgba
   expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
   name Vz
   label "# calculate vividness, V:"
   xpos -583
   ypos 1200
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Vz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
   name Shuffle9
   xpos -1345
   ypos 1396
  }
push $N86bed400
  Expression {
   channel0 rgba
   name Sz
   label "# calculate saturation, S:"
   xpos -734
   ypos 1196
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Sz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
   name Shuffle8
   xpos -1436
   ypos 1395
  }
push $N86c5e400
  Expression {
   channel0 rgba
   expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
   name Kz
   label "# calculate blackness, K:"
   xpos -895
   ypos 1195
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Kz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
   name Shuffle7
   xpos -1524
   ypos 1393
  }
push $N86c5e000
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Wz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
   name Shuffle6
   xpos -1613
   ypos 1393
  }
push $N86bed400
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_s
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
   name Shuffle5
   xpos -1708
   ypos 1392
  }
push $N86c5f000
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_C
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
   name Shuffle4
   xpos -1798
   ypos 1391
  }
push $N86c5e800
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_J
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
   name Shuffle1
   xpos -1900
   ypos 1390
  }
push $N86c5f400
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_M
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
   name Shuffle12
   xpos -1999
   ypos 1389
  }
push $N86c5ec00
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Q
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
   name Shuffle3
   xpos -2089
   ypos 1391
  }
push $N86cbc400
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_h
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
   name Shuffle13
   xpos -2182
   ypos 1392
  }
push $N86cbf800
  Dot {
   name Dot16
   xpos -2265
   ypos 1253
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_h
   name Copy21
   xpos -2299
   ypos 1416
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Q
   name Copy22
   xpos -2299
   ypos 1458
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_M
   name Copy20
   xpos -2298
   ypos 1505
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_J
   name Copy11
   xpos -2298
   ypos 1547
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_C
   name Copy12
   xpos -2298
   ypos 1589
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_s
   name Copy13
   xpos -2302
   ypos 1631
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Wz
   name Copy14
   xpos -2302
   ypos 1673
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Kz
   name Copy15
   xpos -2302
   ypos 1715
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Sz
   name Copy16
   xpos -2302
   ypos 1757
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Vz
   name Copy17
   xpos -2302
   ypos 1799
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_aS
   name Copy26
   xpos -2302
   ypos 1841
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_bS
   name Copy27
   xpos -2302
   ypos 1883
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_aC
   name Copy28
   xpos -2302
   ypos 1925
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_bC
   name Copy29
   xpos -2302
   ypos 1963
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_aM
   name Copy18
   xpos -2302
   ypos 2005
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_bM
   name Copy19
   xpos -2302
   ypos 2047
  }
  Switch {
   inputs 2
   which {{parent.direction}}
   name direction1
   xpos -2302
   ypos 2112
  }
  Dot {
   name Dot17
   xpos -2268
   ypos 2157
  }
set N872a7800 [stack 0]
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_h
   fromInput2 {{0} B}
   mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
   name Shuffle20
   xpos -1041
   ypos 2260
  }
  Dot {
   name Dot41
   label h
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1007
   ypos 2349
  }
  Dot {
   name Dot33
   label "h in outIn"
   xpos -1007
   ypos 2613
  }
set N872a6c00 [stack 0]
  Dot {
   name Dot34
   xpos -1007
   ypos 2652
  }
push $N872a6c00
  Dot {
   name Dot35
   xpos -1034
   ypos 2640
  }
push $N872a7800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_bS
   fromInput2 {{0} B}
   in2 zcam_aS
   mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
   name Shuffle16
   label "aS & bS"
   note_font_size 15
   xpos -1489
   ypos 2304
  }
push $N872a7800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_bC
   fromInput2 {{0} B}
   in2 zcam_aC
   mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
   name Shuffle17
   label "aC & bC"
   note_font_size 15
   xpos -1585
   ypos 2304
  }
push $N872a7800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_bM
   fromInput2 {{0} B}
   in2 zcam_aM
   mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
   name Shuffle26
   label "aM & bM"
   note_font_size 15
   xpos -1682
   ypos 2303
  }
  Switch {
   inputs 3
   which {{parent.inverseData1}}
   name inputdata_abX_mode
   xpos -1543
   ypos 2400
  }
  Dot {
   name Dot30
   xpos -1509
   ypos 2449
  }
set N872a5400 [stack 0]
  Dot {
   name Dot29
   xpos -1210
   ypos 2483
  }
  Expression {
   temp_name0 r2d
   temp_expr0 180.0/pi
   temp_name1 h360
   temp_expr1 "360.0\n"
   temp_name2 h
   temp_expr2 atan2(g,r)*r2d
   channel0 rgba
   expr0 h
   name inv_h
   label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
   xpos -1244
   ypos 2546
  }
  Dot {
   name Dot36
   label "a in outIn"
   xpos -1210
   ypos 2619
  }
set N872a4800 [stack 0]
  Dot {
   name Dot37
   xpos -1163
   ypos 2636
  }
push $N872a4800
  Dot {
   name Dot38
   xpos -1185
   ypos 2648
  }
push $N872a4800
  Dot {
   name Dot39
   xpos -1210
   ypos 2663
  }
  Switch {
   inputs 5
   which {{parent.inverseData1}}
   name inverseData1_Mode1
   label MCs
   xpos -1116
   ypos 2672
  }
  Dot {
   name Dot40
   xpos -1210
   ypos 2719
  }
set N87253400 [stack 0]
push $N87253400
  Expression {
   channel0 rgba
   expr0 "1.015 + cos((r + 89.038)*pi/180)"
   name inv_ez
   xpos -1244
   ypos 2756
  }
push $N872a7800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_C
   fromInput2 {{0} B}
   mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
   name Shuffle21
   xpos -1357
   ypos 2252
  }
  Dot {
   name Dot42
   label C
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1323
   ypos 2341
  }
  Expression {
   channel0 rgba
   expr0 r
   name MCs2
   label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
   xpos -1357
   ypos 2501
  }
  Dot {
   name Dot43
   label "h in outIn"
   xpos -1323
   ypos 2578
  }
push $N872a7800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_M
   fromInput2 {{0} B}
   mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
   name Shuffle19
   xpos -1442
   ypos 2252
  }
  Dot {
   name Dot31
   label M
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1408
   ypos 2341
  }
  Expression {
   channel0 rgba
   expr0 r
   name MCs1
   label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
   xpos -1442
   ypos 2501
  }
  Dot {
   name Dot25
   label "h in outIn"
   xpos -1408
   ypos 2575
  }
push $N872a5400
  Expression {
   channel0 rgba
   expr0 "(r**2.0 + g**2.0)**0.5"
   name MCs
   label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
   xpos -1645
   ypos 2460
  }
  Dot {
   name Dot24
   label "a in outIn"
   xpos -1611
   ypos 2581
  }
set N87250800 [stack 0]
  Dot {
   name Dot28
   xpos -1564
   ypos 2598
  }
push $N87250800
  Dot {
   name Dot27
   xpos -1586
   ypos 2610
  }
push $N87250800
  Dot {
   name Dot26
   xpos -1611
   ypos 2625
  }
  Switch {
   inputs 5
   which {{parent.inverseData1}}
   name inverseData1_Mode
   label MCs
   xpos -1517
   ypos 2634
  }
set N871fb900 [stack 0]
  Expression {
   channel0 rgba
   expr0 r
   name C_from_aC
   label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
   xpos -1926
   ypos 2714
  }
set N87203400 [stack 0]
  Dot {
   name Dot44
   label C,h
   xpos -1673
   ypos 2768
  }
push $N871fb900
  Expression {
   channel0 rgba
   expr0 100*r/Constants.Qw
   name C_from_aM
   label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
   xpos -2036
   ypos 2713
  }
set N87202c00 [stack 0]
  Dot {
   name Dot20
   label M,h
   xpos -1737
   ypos 2767
  }
push $N871fb900
push $N872a7800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_Q
   fromInput2 {{0} B}
   mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
   name Shuffle18
   xpos -2182
   ypos 2257
  }
  Dot {
   name Dot21
   label Q
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1996
   ypos 2435
  }
set N87202000 [stack 0]
push $N872a7800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_J
   fromInput2 {{0} B}
   mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
   name Shuffle14
   xpos -2302
   ypos 2259
  }
  Dot {
   name Dot8
   label J
   note_font_size 20
   note_font_color 0x677754ff
   xpos -2229
   ypos 2434
  }
  Dot {
   name Dot22
   xpos -2229
   ypos 2456
  }
set N87201400 [stack 0]
  Expression {
   channel0 rgba
   expr0 Constants.Qw*(r/100)
   name Q_from_J
   label "# Get Lightness J and brightness Q from data:"
   xpos -2263
   ypos 2519
  }
  Switch {
   inputs 2
   which {{parent.inverseData0}}
   name InverseData0_Mode
   label Q
   xpos -2263
   ypos 2564
  }
set N871fb200 [stack 0]
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy30
   xpos -1818
   ypos 2676
  }
  Expression {
   temp_name0 M
   temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
   channel0 rgba
   expr0 100*M/Constants.Qw
   name C_from_aS
   label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
   xpos -1818
   ypos 2708
  }
push $N87203400
push $N87202c00
  Switch {
   inputs 5
   which {{parent.inverseData1}}
   name inputdata_abX_mode1
   xpos -1926
   ypos 2799
  }
  Expression {
   channel0 rgba
   expr0 "Constants.Qw * r / 100"
   name inv_M
   label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
   xpos -1543
   ypos 2822
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy7
   xpos -1543
   ypos 2874
  }
  Expression {
   channel0 rgba
   expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
   name inv_t
   label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
   xpos -1543
   ypos 2906
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy8
   xpos -1543
   ypos 2986
  }
set N871a7400 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180)
   name inv_bz
   label t*np.sin(h*np.pi/180)
   xpos -1402
   ypos 3067
  }
push $N871a7400
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180)
   name inv_az
   label "az = t*np.cos(h*np.pi/180)"
   xpos -1543
   ypos 3064
  }
push $N871fb200
  Expression {
   channel0 rgba
   expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
   name inv_Iz
   label "# calculate achromatic signal, Iz:"
   xpos -2263
   ypos 2619
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy9
   xpos -2181
   ypos 3184
  }
  Copy {
   inputs 2
   from0 rgba.blue
   to0 rgba.blue
   name Copy10
   xpos -2181
   ypos 3216
  }
  Dot {
   name Dot15
   label iabz
   note_font_size 20
   xpos -2147
   ypos 3275
  }
  Dot {
   name Dot13
   xpos -2145
   ypos 3414
  }
  Dot {
   name Dot14
   xpos -2145
   ypos 3470
  }
set N871a5400 [stack 0]
  Expression {
   expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
   name Expression3
   label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
   xpos -2050
   ypos 3532
  }
push $N871a5400
  Switch {
   inputs 2
   name use_zcam_parameters2
   label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
   xpos -2179
   ypos 3608
  }
set N871fa400 [stack 0]
  Dot {
   name Dot19
   label Iabz
   xpos -2092
   ypos 3678
  }
  Add {
   value 3.703522621e-11
   name Add2
   label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
   xpos -2126
   ypos 3712
  }
  ColorMatrix {
   matrix {
       {0 1 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   invert true
   name _M_LMSP_TO_IAB_ZCAM1
   xpos -2126
   ypos 3750
  }
push $N871fa400
  Dot {
   name Dot18
   label Iabz
   xpos -2216
   ypos 3683
  }
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   invert true
   name _M_LMSP_TO_IAB_JABZ1
   xpos -2250
   ypos 3748
  }
  Switch {
   inputs 2
   which 1
   name use_zcam_parameters3
   xpos -2182
   ypos 3844
  }
  Expression {
   expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
   expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
   expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
   name Expression4
   label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
   xpos -2182
   ypos 3874
   addUserKnob {20 _PQ_PARAMETERS}
   addUserKnob {7 c1}
   c1 {{3424/2**12}}
   addUserKnob {7 c2}
   c2 {{2413/2**7}}
   addUserKnob {7 c3}
   c3 {{2392/2**7}}
   addUserKnob {7 n}
   n {{2610/2**14}}
   addUserKnob {7 p}
   p {{1.7*2523/2**5}}
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   invert true
   name _M_XYZP_TO_LMS1
   label "# Define X',Y',Z' to L,M,S conversion matrix:"
   xpos -2182
   ypos 3949
  }
  ColorMatrix {
   matrix {
       {{b} 0 {1-b}}
       {{1-g} {g} 0}
       {0 0 1}
     }
   invert true
   name M_to_xyzp1
   label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
   xpos -2182
   ypos 3981
   addUserKnob {20 User}
   addUserKnob {7 b}
   b 1.15
   addUserKnob {7 g}
   g 0.66
  }
push $N872a7800
  Switch {
   inputs 2
   which {{parent.direction}}
   name direction
   xpos -1519
   ypos 4172
  }
  Output {
   name Output1
   xpos -1519
   ypos 4272
  }
push $N872a7800
  Dot {
   name Dot11
   label aM
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1535
   ypos 2170
  }
push $N872a7800
  Dot {
   name Dot12
   label bM
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1439
   ypos 2173
  }
push $N871fb200
push $N872a7800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_Sz
   fromInput2 {{0} B}
   mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
   name Shuffle15
   xpos -1870
   ypos 2254
  }
  Dot {
   name Dot10
   label Sz
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1836
   ypos 2342
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy4
   xpos -1770
   ypos 2555
  }
  Expression {
   expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
   name inv_C
   label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
   xpos -1770
   ypos 2587
  }
push $N872a5400
  Dot {
   name Dot23
   label "H in outIn"
   xpos -1509
   ypos 2582
  }
  Dot {
   inputs 0
   name Dot32
   label "H in outIn"
   xpos -1108
   ypos 2620
  }
push $N87202000
  Expression {
   channel0 rgba
   expr0 "100.0* (r/Constants.Qw)"
   name J_from_Q
   xpos -2030
   ypos 2479
  }
push $N87201400
  Switch {
   inputs 2
   which {{parent.inverseData0}}
   name InverseData0_Mode1
   label J
   xpos -2030
   ypos 2527
  }
push $N871fb900
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy23
   xpos -1596
   ypos 2681
  }
  Expression {
   channel0 rgba
   expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
   name inv3_C
   label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
   xpos -1596
   ypos 2713
  }
  Constant {
   inputs 0
   channels rgb
   color 0.034705
   name Constant1
   xpos -440
   ypos 2450
  }
 end_group
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name limitSampleNode
  xpos 829
  ypos 442
 }
push $N87453400
 Dot {
  name Dot1
  xpos 1015
  ypos 127
 }
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle37
  xpos 981
  ypos 194
 }
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  in2 zcam_M
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.blue 0 2 rgba.blue 0 2 rgba.alpha 0 3 rgba.alpha 0 3 zcam_M.green 1 1 rgba.green 0 1"
  name Shuffle48
  xpos 981
  ypos 218
 }
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  in2 zcam_h
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.alpha 0 3 rgba.alpha 0 3 zcam_h.blue 1 2 rgba.blue 0 2"
  name Shuffle49
  xpos 981
  ypos 242
 }
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.alpha
  name Copy9
  xpos 981
  ypos 432
 }
 Expression {
  temp_name0 limit
  temp_expr0 a(((b/360+.5)*1023),(r/100*1023))
  temp_name1 scaledVal
  temp_expr1 g/limit
  temp_name2 scale
  temp_expr2 1-thr
  expr2 "(scaledVal>thr? ( ((scaledVal-thr)/scale) / (((scaledVal-thr)/scale)+1) * scale + thr  )   : scaledVal ) * limit"
  channel3 alpha
  expr3 limit
  name clipToLimit
  xpos 981
  ypos 464
  addUserKnob {20 User}
  addUserKnob {7 limitScale R 0 100}
  limitScale 100
  addUserKnob {7 thr}
  thr 0.765
 }
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.alpha 0 3"
  name Shuffle50
  xpos 981
  ypos 488
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.green 0 1 zcam_M.alpha 0 3"
  name Shuffle39
  xpos 981
  ypos 512
 }
push $N87453400
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy7
  xpos 1354
  ypos 569
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy2
  xpos 1354
  ypos 611
 }
set N554b5800 [stack 0]
 Group {
  name ZCAM11
  label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
  selected true
  xpos 1354
  ypos 663
  addUserKnob {20 ZCAM}
  addUserKnob {4 direction M {forward inverse}}
  direction inverse
  addUserKnob {26 ""}
  addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
  addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
  addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
  inverseData1 C,h
  addUserKnob {26 ""}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {41 surrounds T Constants.surrounds}
  addUserKnob {41 c T Constants.c}
  addUserKnob {41 Nc T Constants.Nc}
  addUserKnob {41 F T Constants.F}
  addUserKnob {41 FLL T Constants.FLL}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {41 La T Constants.La}
  addUserKnob {41 Yb T Constants.Yb}
  addUserKnob {41 surround T Constants.surround}
  addUserKnob {41 D T Constants.D}
  addUserKnob {41 Dtype T Constants.Dtype}
  addUserKnob {26 ""}
  addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
  addUserKnob {41 xyzw T Constants.xyzw}
  addUserKnob {26 ""}
  addUserKnob {41 Yw T Constants.Yw}
  addUserKnob {41 FL T Constants.FL}
  addUserKnob {41 n T Constants.n}
  addUserKnob {41 Fb T Constants.Fb}
  addUserKnob {41 Fs T Constants.Fs}
  addUserKnob {26 ""}
  addUserKnob {41 xyzwc T Constants.xyzwc}
  addUserKnob {41 iabzw T Constants.iabzw}
  addUserKnob {41 Qw T Constants.Qw}
 }
  BackdropNode {
   inputs 0
   name BackdropNode1
   tile_color 0x71c67100
   label xyz_to_jabz
   note_font_size 42
   xpos -1063
   ypos -50
   bdwidth 255
   bdheight 678
  }
  BackdropNode {
   inputs 0
   name BackdropNode2
   tile_color 0x388e8e00
   label Forward
   note_font_size 42
   xpos -1278
   ypos 673
   bdwidth 1634
   bdheight 582
  }
  BackdropNode {
   inputs 0
   name BackdropNode3
   tile_color 0x388e8e00
   label Inverse
   note_font_size 42
   xpos -2310
   ypos 2374
   bdwidth 1715
   bdheight 953
  }
  BackdropNode {
   inputs 0
   name BackdropNode4
   tile_color 0x388e8e00
   label "jabz to xyz"
   note_font_size 42
   xpos -2260
   ypos 3390
   bdwidth 300
   bdheight 667
  }
  BackdropNode {
   inputs 0
   name BackdropNode5
   label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
   xpos -1922
   ypos 791
   bdwidth 411
   bdheight 201
  }
  Input {
   inputs 0
   name Input1
   xpos -984
   ypos -137
  }
  Dot {
   name Dot4
   label xyzc
   xpos -950
   ypos -97
  }
  Dot {
   name Dot5
   xpos -950
   ypos -21
  }
set N87450400 [stack 0]
  ColorMatrix {
   matrix {
       {{b} 0 {1-b}}
       {{1-g} {g} 0}
       {0 0 1}
     }
   name M_to_xyzp
   label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
   xpos -984
   ypos 30
   addUserKnob {20 User}
   addUserKnob {7 b}
   b 1.15
   addUserKnob {7 g}
   g 0.66
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   name _M_XYZP_TO_LMS
   label "# Define X',Y',Z' to L,M,S conversion matrix:"
   xpos -984
   ypos 102
  }
  Dot {
   name Dot1
   label LMS
   xpos -950
   ypos 154
  }
  Expression {
   expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
   expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
   expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
   name Expression1
   label "# response compression: lms to lms'"
   xpos -984
   ypos 199
   addUserKnob {20 _PQ_PARAMETERS}
   addUserKnob {7 c1}
   c1 {{3424/2**12}}
   addUserKnob {7 c2}
   c2 {{2413/2**7}}
   addUserKnob {7 c3}
   c3 {{2392/2**7}}
   addUserKnob {7 n}
   n {{2610/2**14}}
   addUserKnob {7 p}
   p {{1.7*2523/2**5}}
  }
  Dot {
   name Dot2
   label lmsp
   xpos -950
   ypos 260
  }
set N873dec00 [stack 0]
  ColorMatrix {
   matrix {
       {0 1 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name _M_LMSP_TO_IAB_ZCAM
   xpos -912
   ypos 329
  }
  Add {
   value -3.703522621e-11
   name Add1
   label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
   xpos -912
   ypos 353
  }
  Dot {
   name Dot6
   label Iabz
   xpos -878
   ypos 411
  }
push $N873dec00
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name _M_LMSP_TO_IAB_JABZ
   xpos -1053
   ypos 328
  }
  Dot {
   name Dot7
   label Iabz
   xpos -1019
   ypos 410
  }
  Switch {
   inputs 2
   which 1
   name use_zcam_parameters
   xpos -978
   ypos 441
  }
set N873eeb00 [stack 0]
  Expression {
   expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
   name Expression2
   label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
   xpos -886
   ypos 492
  }
push $N873eeb00
  Switch {
   inputs 2
   name use_zcam_parameters1
   label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
   xpos -978
   ypos 564
  }
  Dot {
   name Dot3
   label iabz
   xpos -944
   ypos 753
  }
set N873dd000 [stack 0]
  Expression {
   temp_name0 r2d
   temp_expr0 180.0/pi
   temp_name1 h360
   temp_expr1 "360.0\n"
   temp_name2 h
   temp_expr2 atan2(b,g)*r2d
   channel0 rgba
   expr0 h
   name h
   xpos -1074
   ypos 904
  }
set N873dcc00 [stack 0]
  Expression {
   temp_name0 h
   temp_expr0 r
   channel0 rgba
   expr0 "1.015 + cos((h + 89.038)*pi/180)"
   name ez
   xpos -1074
   ypos 928
  }
push $N873dd000
  Copy {
   inputs 2
   from0 rgba.red
   to0 rgba.red
   name Copy1
   xpos -894
   ypos 989
  }
  Expression {
   channel0 rgba
   expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
   name M_colorfulness
   label "# calculate colorfulness, M:"
   xpos -894
   ypos 1021
  }
set N87377c00 [stack 0]
  Expression {
   channel0 rgba
   expr0 100*r/Constants.Qw
   name C
   label "# calculate chroma, C:"
   xpos -894
   ypos 1118
  }
set N87377800 [stack 0]
push $N873dd000
  Expression {
   channel0 rgba
   expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
   name Q
   label "# calculate brightness, Q:"
   xpos -1030
   ypos 1019
  }
set N87377400 [stack 0]
  Expression {
   channel0 rgba
   expr0 "100.0 * (r/Constants.Qw)"
   name J
   label "# calculate lightness, J:"
   xpos -1030
   ypos 1117
  }
set N87377000 [stack 0]
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy3
   xpos -1030
   ypos 1155
  }
set N87376c00 [stack 0]
  Expression {
   channel0 rgba
   expr0 "100 - ((100-r)**2 + g**2)**0.5"
   name Wz
   label "# calculate whiteness, W:"
   xpos -1030
   ypos 1195
  }
set N87376800 [stack 0]
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam
   fromInput2 {{0} B}
   mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
   name Shuffle2
   xpos -1202
   ypos 1199
  }
push $N873dcc00
  Dot {
   name Dot9
   label h
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1975
   ypos 2339
  }
push $N873dd000
  Shuffle2 {
   fromInput1 {{0} B}
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
   name Iz
   xpos -1127
   ypos 835
  }
push $N873dd000
  Shuffle2 {
   fromInput1 {{0} B}
   fromInput2 {{0} B}
   mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
   name az
   xpos -978
   ypos 837
  }
push $N873dd000
  Shuffle2 {
   fromInput1 {{0} B}
   fromInput2 {{0} B}
   mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
   name bz
   xpos -825
   ypos 835
  }
  NoOp {
   inputs 0
   name Constants
   xpos -527
   ypos 180
   addUserKnob {20 User}
   addUserKnob {26 _1 l _SURROUND_PARAMETERS}
   addUserKnob {4 surrounds M {average dim dark}}
   addUserKnob {7 c}
   c {{curve(surrounds) 0.69 0.59 0.525}}
   addUserKnob {7 Nc}
   Nc {{curve(surrounds) 1 0.9 0.8}}
   addUserKnob {7 F}
   F {{curve(surrounds) 1 0.9 0.8}}
   addUserKnob {7 FLL}
   FLL {{curve(surrounds) 1 1 1}}
   addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
   addUserKnob {7 La}
   La 100
   addUserKnob {7 Yb}
   Yb 20
   addUserKnob {4 surround M {avg dim dark}}
   addUserKnob {7 D}
   D 1
   addUserKnob {7 Dtype}
   addUserKnob {26 ""}
   addUserKnob {18 xyzw_d65}
   xyzw_d65 {95.043 100 108.89}
   addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {18 xyzw}
   xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
   addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {26 ""}
   addUserKnob {7 Yw}
   Yw 100
   addUserKnob {7 FL}
   FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
   addUserKnob {7 n}
   n {{Yb/Yw}}
   addUserKnob {7 Fb}
   Fb {{n**0.5}}
   addUserKnob {7 Fs}
   Fs {{c}}
   addUserKnob {26 ""}
   addUserKnob {18 xyzwc}
   xyzwc {95.043 100 108.89}
   addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {18 iabzw}
   iabzw {0.31331 -0.00014318 -8.9369e-05}
   addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {7 Qw}
   Qw 185.85
  }
push $N87450400
push $N873dcc00
push $N87377c00
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy5
   xpos 67
   ypos 1136
  }
set N87374c00 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180.0)
   name bM
   xpos 163
   ypos 1202
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_bM
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
   name Shuffle11
   xpos -752
   ypos 1400
  }
push $N87374c00
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180.0)
   name aM
   xpos 67
   ypos 1203
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_aM
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
   name Shuffle10
   xpos -848
   ypos 1400
  }
push $N873dcc00
push $N87377800
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy25
   xpos -164
   ypos 1149
  }
set N8730f400 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180.0)
   name bC
   xpos -76
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_bC
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
   name Shuffle25
   xpos -949
   ypos 1399
  }
push $N8730f400
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180.0)
   name aC
   xpos -164
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_aC
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
   name Shuffle24
   xpos -1048
   ypos 1397
  }
push $N873dcc00
push $N87377400
push $N87377c00
  Copy {
   inputs 2
   from1 rgba.green
   to1 rgba.green
   name Copy2
   xpos -734
   ypos 1076
  }
  Expression {
   channel0 rgba
   expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
   name s
   label "# calculate saturation, s:"
   xpos -734
   ypos 1118
  }
set N8730dc00 [stack 0]
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy24
   xpos -381
   ypos 1143
  }
set N8730d800 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180.0)
   name bS
   xpos -287
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_bS
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
   name Shuffle23
   xpos -1150
   ypos 1398
  }
push $N8730d800
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180.0)
   name aS
   xpos -381
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_aS
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
   name Shuffle22
   xpos -1254
   ypos 1395
  }
push $N87376c00
  Expression {
   channel0 rgba
   expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
   name Vz
   label "# calculate vividness, V:"
   xpos -583
   ypos 1200
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Vz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
   name Shuffle9
   xpos -1345
   ypos 1396
  }
push $N8730dc00
  Expression {
   channel0 rgba
   name Sz
   label "# calculate saturation, S:"
   xpos -734
   ypos 1196
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Sz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
   name Shuffle8
   xpos -1436
   ypos 1395
  }
push $N87376c00
  Expression {
   channel0 rgba
   expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
   name Kz
   label "# calculate blackness, K:"
   xpos -895
   ypos 1195
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Kz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
   name Shuffle7
   xpos -1524
   ypos 1393
  }
push $N87376800
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Wz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
   name Shuffle6
   xpos -1613
   ypos 1393
  }
push $N8730dc00
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_s
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
   name Shuffle5
   xpos -1708
   ypos 1392
  }
push $N87377800
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_C
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
   name Shuffle4
   xpos -1798
   ypos 1391
  }
push $N87377000
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_J
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
   name Shuffle1
   xpos -1900
   ypos 1390
  }
push $N87377c00
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_M
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
   name Shuffle12
   xpos -1999
   ypos 1389
  }
push $N87377400
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Q
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
   name Shuffle3
   xpos -2089
   ypos 1391
  }
push $N873dcc00
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_h
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
   name Shuffle13
   xpos -2182
   ypos 1392
  }
push $N87450400
  Dot {
   name Dot16
   xpos -2265
   ypos 1253
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_h
   name Copy21
   xpos -2299
   ypos 1416
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Q
   name Copy22
   xpos -2299
   ypos 1458
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_M
   name Copy20
   xpos -2298
   ypos 1505
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_J
   name Copy11
   xpos -2298
   ypos 1547
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_C
   name Copy12
   xpos -2298
   ypos 1589
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_s
   name Copy13
   xpos -2302
   ypos 1631
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Wz
   name Copy14
   xpos -2302
   ypos 1673
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Kz
   name Copy15
   xpos -2302
   ypos 1715
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Sz
   name Copy16
   xpos -2302
   ypos 1757
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Vz
   name Copy17
   xpos -2302
   ypos 1799
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_aS
   name Copy26
   xpos -2302
   ypos 1841
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_bS
   name Copy27
   xpos -2302
   ypos 1883
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_aC
   name Copy28
   xpos -2302
   ypos 1925
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_bC
   name Copy29
   xpos -2302
   ypos 1963
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_aM
   name Copy18
   xpos -2302
   ypos 2005
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_bM
   name Copy19
   xpos -2302
   ypos 2047
  }
  Switch {
   inputs 2
   which {{parent.direction}}
   name direction1
   xpos -2302
   ypos 2112
  }
  Dot {
   name Dot17
   xpos -2268
   ypos 2157
  }
set N89744400 [stack 0]
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_h
   fromInput2 {{0} B}
   mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
   name Shuffle20
   xpos -1041
   ypos 2260
  }
  Dot {
   name Dot41
   label h
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1007
   ypos 2349
  }
  Dot {
   name Dot33
   label "h in outIn"
   xpos -1007
   ypos 2613
  }
set N896c3400 [stack 0]
  Dot {
   name Dot34
   xpos -1007
   ypos 2652
  }
push $N896c3400
  Dot {
   name Dot35
   xpos -1034
   ypos 2640
  }
push $N89744400
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_bS
   fromInput2 {{0} B}
   in2 zcam_aS
   mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
   name Shuffle16
   label "aS & bS"
   note_font_size 15
   xpos -1489
   ypos 2304
  }
push $N89744400
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_bC
   fromInput2 {{0} B}
   in2 zcam_aC
   mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
   name Shuffle17
   label "aC & bC"
   note_font_size 15
   xpos -1585
   ypos 2304
  }
push $N89744400
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_bM
   fromInput2 {{0} B}
   in2 zcam_aM
   mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
   name Shuffle26
   label "aM & bM"
   note_font_size 15
   xpos -1682
   ypos 2303
  }
  Switch {
   inputs 3
   which {{parent.inverseData1}}
   name inputdata_abX_mode
   xpos -1543
   ypos 2400
  }
  Dot {
   name Dot30
   xpos -1509
   ypos 2449
  }
set N896c1c00 [stack 0]
  Dot {
   name Dot29
   xpos -1210
   ypos 2483
  }
  Expression {
   temp_name0 r2d
   temp_expr0 180.0/pi
   temp_name1 h360
   temp_expr1 "360.0\n"
   temp_name2 h
   temp_expr2 atan2(g,r)*r2d
   channel0 rgba
   expr0 h
   name inv_h
   label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
   xpos -1244
   ypos 2546
  }
  Dot {
   name Dot36
   label "a in outIn"
   xpos -1210
   ypos 2619
  }
set N896c1000 [stack 0]
  Dot {
   name Dot37
   xpos -1163
   ypos 2636
  }
push $N896c1000
  Dot {
   name Dot38
   xpos -1185
   ypos 2648
  }
push $N896c1000
  Dot {
   name Dot39
   xpos -1210
   ypos 2663
  }
  Switch {
   inputs 5
   which {{parent.inverseData1}}
   name inverseData1_Mode1
   label MCs
   xpos -1116
   ypos 2672
  }
  Dot {
   name Dot40
   xpos -1210
   ypos 2719
  }
set N8967fc00 [stack 0]
push $N8967fc00
  Expression {
   channel0 rgba
   expr0 "1.015 + cos((r + 89.038)*pi/180)"
   name inv_ez
   xpos -1244
   ypos 2756
  }
push $N89744400
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_C
   fromInput2 {{0} B}
   mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
   name Shuffle21
   xpos -1357
   ypos 2252
  }
  Dot {
   name Dot42
   label C
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1323
   ypos 2341
  }
  Expression {
   channel0 rgba
   expr0 r
   name MCs2
   label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
   xpos -1357
   ypos 2501
  }
  Dot {
   name Dot43
   label "h in outIn"
   xpos -1323
   ypos 2578
  }
push $N89744400
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_M
   fromInput2 {{0} B}
   mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
   name Shuffle19
   xpos -1442
   ypos 2252
  }
  Dot {
   name Dot31
   label M
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1408
   ypos 2341
  }
  Expression {
   channel0 rgba
   expr0 r
   name MCs1
   label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
   xpos -1442
   ypos 2501
  }
  Dot {
   name Dot25
   label "h in outIn"
   xpos -1408
   ypos 2575
  }
push $N896c1c00
  Expression {
   channel0 rgba
   expr0 "(r**2.0 + g**2.0)**0.5"
   name MCs
   label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
   xpos -1645
   ypos 2460
  }
  Dot {
   name Dot24
   label "a in outIn"
   xpos -1611
   ypos 2581
  }
set N8967d000 [stack 0]
  Dot {
   name Dot28
   xpos -1564
   ypos 2598
  }
push $N8967d000
  Dot {
   name Dot27
   xpos -1586
   ypos 2610
  }
push $N8967d000
  Dot {
   name Dot26
   xpos -1611
   ypos 2625
  }
  Switch {
   inputs 5
   which {{parent.inverseData1}}
   name inverseData1_Mode
   label MCs
   xpos -1517
   ypos 2634
  }
set N896a6b00 [stack 0]
  Expression {
   channel0 rgba
   expr0 r
   name C_from_aC
   label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
   xpos -1926
   ypos 2714
  }
set N89637c00 [stack 0]
  Dot {
   name Dot44
   label C,h
   xpos -1673
   ypos 2768
  }
push $N896a6b00
  Expression {
   channel0 rgba
   expr0 100*r/Constants.Qw
   name C_from_aM
   label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
   xpos -2036
   ypos 2713
  }
set N89637400 [stack 0]
  Dot {
   name Dot20
   label M,h
   xpos -1737
   ypos 2767
  }
push $N896a6b00
push $N89744400
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_Q
   fromInput2 {{0} B}
   mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
   name Shuffle18
   xpos -2182
   ypos 2257
  }
  Dot {
   name Dot21
   label Q
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1996
   ypos 2435
  }
set N89636800 [stack 0]
push $N89744400
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_J
   fromInput2 {{0} B}
   mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
   name Shuffle14
   xpos -2302
   ypos 2259
  }
  Dot {
   name Dot8
   label J
   note_font_size 20
   note_font_color 0x677754ff
   xpos -2229
   ypos 2434
  }
  Dot {
   name Dot22
   xpos -2229
   ypos 2456
  }
set N89635c00 [stack 0]
  Expression {
   channel0 rgba
   expr0 Constants.Qw*(r/100)
   name Q_from_J
   label "# Get Lightness J and brightness Q from data:"
   xpos -2263
   ypos 2519
  }
  Switch {
   inputs 2
   which {{parent.inverseData0}}
   name InverseData0_Mode
   label Q
   xpos -2263
   ypos 2564
  }
set N896a6400 [stack 0]
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy30
   xpos -1818
   ypos 2676
  }
  Expression {
   temp_name0 M
   temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
   channel0 rgba
   expr0 100*M/Constants.Qw
   name C_from_aS
   label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
   xpos -1818
   ypos 2708
  }
push $N89637c00
push $N89637400
  Switch {
   inputs 5
   which {{parent.inverseData1}}
   name inputdata_abX_mode1
   xpos -1926
   ypos 2799
  }
  Expression {
   channel0 rgba
   expr0 "Constants.Qw * r / 100"
   name inv_M
   label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
   xpos -1543
   ypos 2822
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy7
   xpos -1543
   ypos 2874
  }
  Expression {
   channel0 rgba
   expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
   name inv_t
   label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
   xpos -1543
   ypos 2906
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy8
   xpos -1543
   ypos 2986
  }
set N899c3c00 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180)
   name inv_bz
   label t*np.sin(h*np.pi/180)
   xpos -1402
   ypos 3067
  }
push $N899c3c00
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180)
   name inv_az
   label "az = t*np.cos(h*np.pi/180)"
   xpos -1543
   ypos 3064
  }
push $N896a6400
  Expression {
   channel0 rgba
   expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
   name inv_Iz
   label "# calculate achromatic signal, Iz:"
   xpos -2263
   ypos 2619
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy9
   xpos -2181
   ypos 3184
  }
  Copy {
   inputs 2
   from0 rgba.blue
   to0 rgba.blue
   name Copy10
   xpos -2181
   ypos 3216
  }
  Dot {
   name Dot15
   label iabz
   note_font_size 20
   xpos -2147
   ypos 3275
  }
  Dot {
   name Dot13
   xpos -2145
   ypos 3414
  }
  Dot {
   name Dot14
   xpos -2145
   ypos 3470
  }
set N899c1c00 [stack 0]
  Expression {
   expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
   name Expression3
   label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
   xpos -2050
   ypos 3532
  }
push $N899c1c00
  Switch {
   inputs 2
   name use_zcam_parameters2
   label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
   xpos -2179
   ypos 3608
  }
set N896a5600 [stack 0]
  Dot {
   name Dot19
   label Iabz
   xpos -2092
   ypos 3678
  }
  Add {
   value 3.703522621e-11
   name Add2
   label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
   xpos -2126
   ypos 3712
  }
  ColorMatrix {
   matrix {
       {0 1 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   invert true
   name _M_LMSP_TO_IAB_ZCAM1
   xpos -2126
   ypos 3750
  }
push $N896a5600
  Dot {
   name Dot18
   label Iabz
   xpos -2216
   ypos 3683
  }
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   invert true
   name _M_LMSP_TO_IAB_JABZ1
   xpos -2250
   ypos 3748
  }
  Switch {
   inputs 2
   which 1
   name use_zcam_parameters3
   xpos -2182
   ypos 3844
  }
  Expression {
   expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
   expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
   expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
   name Expression4
   label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
   xpos -2182
   ypos 3874
   addUserKnob {20 _PQ_PARAMETERS}
   addUserKnob {7 c1}
   c1 {{3424/2**12}}
   addUserKnob {7 c2}
   c2 {{2413/2**7}}
   addUserKnob {7 c3}
   c3 {{2392/2**7}}
   addUserKnob {7 n}
   n {{2610/2**14}}
   addUserKnob {7 p}
   p {{1.7*2523/2**5}}
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   invert true
   name _M_XYZP_TO_LMS1
   label "# Define X',Y',Z' to L,M,S conversion matrix:"
   xpos -2182
   ypos 3949
  }
  ColorMatrix {
   matrix {
       {{b} 0 {1-b}}
       {{1-g} {g} 0}
       {0 0 1}
     }
   invert true
   name M_to_xyzp1
   label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
   xpos -2182
   ypos 3981
   addUserKnob {20 User}
   addUserKnob {7 b}
   b 1.15
   addUserKnob {7 g}
   g 0.66
  }
push $N89744400
  Switch {
   inputs 2
   which {{parent.direction}}
   name direction
   xpos -1519
   ypos 4172
  }
  Output {
   name Output1
   xpos -1519
   ypos 4272
  }
push $N89744400
  Dot {
   name Dot11
   label aM
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1535
   ypos 2170
  }
push $N89744400
  Dot {
   name Dot12
   label bM
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1439
   ypos 2173
  }
push $N896a6400
push $N89744400
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_Sz
   fromInput2 {{0} B}
   mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
   name Shuffle15
   xpos -1870
   ypos 2254
  }
  Dot {
   name Dot10
   label Sz
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1836
   ypos 2342
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy4
   xpos -1770
   ypos 2555
  }
  Expression {
   expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
   name inv_C
   label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
   xpos -1770
   ypos 2587
  }
push $N896c1c00
  Dot {
   name Dot23
   label "H in outIn"
   xpos -1509
   ypos 2582
  }
  Dot {
   inputs 0
   name Dot32
   label "H in outIn"
   xpos -1108
   ypos 2620
  }
push $N89636800
  Expression {
   channel0 rgba
   expr0 "100.0* (r/Constants.Qw)"
   name J_from_Q
   xpos -2030
   ypos 2479
  }
push $N89635c00
  Switch {
   inputs 2
   which {{parent.inverseData0}}
   name InverseData0_Mode1
   label J
   xpos -2030
   ypos 2527
  }
push $N896a6b00
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy23
   xpos -1596
   ypos 2681
  }
  Expression {
   channel0 rgba
   expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
   name inv3_C
   label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
   xpos -1596
   ypos 2713
  }
  Constant {
   inputs 0
   channels rgb
   color 0.034705
   name Constant1
   xpos -440
   ypos 2450
  }
 end_group
 Multiply {
  value 0.01
  name Multiply13
  label "Div by 100 to go from nits"
  xpos 1354
  ypos 715
 }
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.blue 0 2 white -1 -1 rgba.alpha 0 3"
  name Shuffle36
  xpos 1354
  ypos 757
 }
 Colorspace {
  colorspace_in CIE-XYZ
  name Colorspace25
  label "XYZ to sRGB Prims"
  xpos 1354
  ypos 781
 }
 Output {
  name Output1
  xpos 1354
  ypos 888
 }
push $N248fac00
push $N554b5800
 Viewer {
  inputs 2
  frame 78
  frame_range 1-480
  channels zcam_C
  gain 0.015625
  name Viewer1
  xpos 409
  ypos 450
 }
end_group
set N86e00100 [stack 0]
Gamma {
 value 3.4
 name Gamma3
 xpos 1643
 ypos 2161
 disable true
}
Expression {
 expr0 "y==floor(r(x, pos.y)*height*mult)?1:0"
 expr1 "y==floor(g(x, pos.y)*height*mult)?1:0"
 expr2 "y==floor(b(x, pos.y)*height*mult)?1:0"
 channel3 alpha
 name PlotScanline5
 xpos 1747
 ypos 2186
 addUserKnob {20 User}
 addUserKnob {12 pos}
 pos {0 970}
 addUserKnob {7 mult R 0 5}
 mult 1
}
Copy {
 inputs 2
 from0 rgba.red
 to0 rgba.red
 name Copy4
 xpos 1830
 ypos 2219
}
Rectangle {
 area {{width/2-1} 0 {width/2+1} {height}}
 color 0.05
 name Rectangle2
 xpos 1825
 ypos 2250
}
TimeOffset {
 inputs 0
 time ""
 name TimeOffset1
 xpos -668
 ypos 1580
}
push $N5bb01c00
Colorspace {
 colorspace_out sRGB
 name Colorspace14
 xpos 998
 ypos 1393
 disable true
}
Clamp {
 name Clamp2
 xpos 998
 ypos 1434
 disable true
}
Write {
 file /Users/afry/GitHub/nukeZCAM/images/examples/ramp_J100_M25_v001.png
 colorspace texture_paint
 raw true
 file_type png
 checkHashOnRead false
 version 2
 in_colorspace scene_linear
 out_colorspace scene_linear
 name Write2
 xpos 998
 ypos 1503
}
push $N5bb01c00
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.blue 0 2 white -1 -1 rgba.alpha 0 3"
 name Shuffle35
 xpos 1525
 ypos 2004
}
Cube {
 inputs 0
 display wireframe
 rows 1
 columns 1
 cube {0 0 0 1 1 1}
 name Cube1
 xpos 1652
 ypos 1966
}
push $N86e00100
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.blue 0 2 white -1 -1 rgba.alpha 0 3"
 name Shuffle34
 xpos 1224
 ypos 2258
}
PositionToPoints2 {
 display textured
 render_mode textured
 P_channel rgb
 detail 1
 name PositionToPoints4
 xpos 1516
 ypos 2139
}
Scene {
 inputs 2
 name Scene1
 xpos 1600
 ypos 2084
}
push $N86e00100
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.blue 0 2 white -1 -1 rgba.alpha 0 3"
 name Shuffle41
 xpos 530
 ypos 2032
}
PositionToPoints2 {
 display textured
 render_mode textured
 P_channel rgb
 detail 1
 name PositionToPoints6
 xpos 530
 ypos 2086
}
push $N86e00100
Expression {
 expr0 r(x+100,y)
 name Expression11
 xpos 734
 ypos 2215
}
Read {
 inputs 0
 file_type exr
 file "\[value Write4.file]"
 origset true
 version 2072
 name Read68
 xpos 492
 ypos 1685
}
set N5d174800 [stack 0]
Write {
 file /Users/afry/GitHub/nukeZCAM/images/gamutBounds/sRGBgamutBound_tempImg.png
 file_type png
 checkHashOnRead false
 version 1047
 in_colorspace scene_linear
 out_colorspace scene_linear
 name Write6
 xpos 606
 ypos 1836
}
push $N86e00100
EXPTool {
 mode Stops
 red -6.3
 green -6.3
 blue -6.3
 name Exposure5
 xpos 615
 ypos 2207
}
Write {
 file /Users/afry/GitHub/nukeZCAM/images/gamutBounds/sRGBgamutBound_MLimitExample.png
 file_type png
 checkHashOnRead false
 version 1048
 in_colorspace scene_linear
 out_colorspace scene_linear
 name Write7
 xpos 615
 ypos 2231
}
push $N5bb01c00
Colorspace {
 colorspace_out CIE-XYZ
 name Colorspace24
 label "XYZ to sRGB Prims"
 xpos 1276
 ypos 1386
}
Multiply {
 value 100
 name Multiply12
 label "Div by 100 to go from nits"
 xpos 1276
 ypos 1418
}
push $N86e00100
Dot {
 name Dot15
 xpos 1422
 ypos 2313
}
Crop {
 box {0 -74 {width} {height}}
 reformat true
 crop false
 name Crop3
 xpos 1388
 ypos 2331
 disable true
}
Rectangle {
 opacity 0.955
 area {782.4000244 6 1137.599976 67.80000305}
 color 0
 name Rectangle3
 xpos 1388
 ypos 2355
}
Text2 {
 font_size_toolbar 30
 font_width_toolbar 100
 font_height_toolbar 100
 message "ZCAMishDRT 0.3"
 old_message {{90 67 65 77 105 115 104 68 82 84 32 48 46 51}
   }
 box {0 16 1920 55}
 xjustify center
 yjustify center
 transforms {{0 2}
   }
 font_size_values {{0 30 1 30 2 30 3 30 4 30 5 30 6 30 7 30 8 30 9 30 10 30 11 30 12 30 13 30 0 99 1 99 2 99 3 99 4 99 5 99 6 99 7 99 8 99 9 99}
   }
 cursor_position 14
 font {{ Helvetica : Regular : Helvetica.ttc : 0 }}
 font_size 30
 center {960 540}
 cursor_initialised true
 autofit_bbox false
 initial_cursor_position {{717.6001587 112.7998962}
   }
 group_animations {{0} imported: 0 selected: items: "root transform/"}
 animation_layers {{1 11 960 540 0 0 1 1 0 0 0 0}
   }
 name Text1
 xpos 1397
 ypos 2383
}
set N5dcfcc00 [stack 0]
Colorspace {
 colorspace_out sRGB
 name Colorspace31
 xpos 1397
 ypos 2481
}
Write {
 file /Users/afry/GitHub/nukeZCAM/images/comparisons/ZCAMishDRTv03_solo_v001/ZCAMishDRTv03_solo_v001.####.jpg
 colorspace texture_paint
 raw true
 file_type jpeg
 create_directories true
 checkHashOnRead false
 version 8
 name Write8
 xpos 1397
 ypos 2505
}
PositionToPoints2 {
 inputs 0
 display textured
 render_mode textured
 P_channel rgb
 name PositionToPoints8
 xpos 3397
 ypos 2203
}
Cube {
 inputs 0
 display wireframe
 rows 1
 columns 1
 cube {0 0 0 1 1 1}
 name Cube2
 xpos 2587
 ypos 2073
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/jed-smith/jedsmith_colorchecker24_streaks_flat.aces.exr"
 format "1152 576 0 0 1152 576 1 "
 origset true
 name Read61
 xpos 2327
 ypos 1949
}
Group {
 name ZCAMishDRT1
 xpos 2327
 ypos 2074
 addUserKnob {20 User}
 addUserKnob {26 In}
 addUserKnob {41 illuminant_in l "" -STARTLINE T Colorspace30.illuminant_in}
 addUserKnob {41 primary_in l "" -STARTLINE T Colorspace30.primary_in}
 addUserKnob {26 Out}
 addUserKnob {41 colorspace_out l out T Colorspace25.colorspace_out}
 addUserKnob {41 illuminant_out l "" -STARTLINE T Colorspace25.illuminant_out}
 addUserKnob {41 primary_out l "" -STARTLINE T Colorspace25.primary_out}
}
 Read {
  inputs 0
  file_type exr
  file /Users/afry/GitHub/nukeZCAM/images/gamutBounds/JMh_sRGBgamutBound_tempImg.exr
  format "1024 1024 0 0 1024 1024 1 square_1K"
  origset true
  version 2072
  name Read1
  xpos 829
  ypos 237
 }
 Colorspace {
  colorspace_out CIE-XYZ
  name Colorspace29
  xpos 829
  ypos 317
 }
 Multiply {
  value 100
  name Multiply18
  label "Mult by 100 to put in absolute nits"
  xpos 829
  ypos 341
 }
 Group {
  name ZCAM15
  label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
  xpos 829
  ypos 383
  addUserKnob {20 ZCAM}
  addUserKnob {4 direction M {forward inverse}}
  addUserKnob {26 ""}
  addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
  addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
  addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
  inverseData1 M,h
  addUserKnob {26 ""}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {41 surrounds T Constants.surrounds}
  addUserKnob {41 c T Constants.c}
  addUserKnob {41 Nc T Constants.Nc}
  addUserKnob {41 F T Constants.F}
  addUserKnob {41 FLL T Constants.FLL}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {41 La T Constants.La}
  addUserKnob {41 Yb T Constants.Yb}
  addUserKnob {41 surround T Constants.surround}
  addUserKnob {41 D T Constants.D}
  addUserKnob {41 Dtype T Constants.Dtype}
  addUserKnob {26 ""}
  addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
  addUserKnob {41 xyzw T Constants.xyzw}
  addUserKnob {26 ""}
  addUserKnob {41 Yw T Constants.Yw}
  addUserKnob {41 FL T Constants.FL}
  addUserKnob {41 n T Constants.n}
  addUserKnob {41 Fb T Constants.Fb}
  addUserKnob {41 Fs T Constants.Fs}
  addUserKnob {26 ""}
  addUserKnob {41 xyzwc T Constants.xyzwc}
  addUserKnob {41 iabzw T Constants.iabzw}
  addUserKnob {41 Qw T Constants.Qw}
 }
  BackdropNode {
   inputs 0
   name BackdropNode1
   tile_color 0x71c67100
   label xyz_to_jabz
   note_font_size 42
   xpos -1063
   ypos -50
   bdwidth 255
   bdheight 678
  }
  BackdropNode {
   inputs 0
   name BackdropNode2
   tile_color 0x388e8e00
   label Forward
   note_font_size 42
   xpos -1278
   ypos 673
   bdwidth 1634
   bdheight 582
  }
  BackdropNode {
   inputs 0
   name BackdropNode3
   tile_color 0x388e8e00
   label Inverse
   note_font_size 42
   xpos -2310
   ypos 2374
   bdwidth 1715
   bdheight 953
  }
  BackdropNode {
   inputs 0
   name BackdropNode4
   tile_color 0x388e8e00
   label "jabz to xyz"
   note_font_size 42
   xpos -2260
   ypos 3390
   bdwidth 300
   bdheight 667
  }
  BackdropNode {
   inputs 0
   name BackdropNode5
   label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
   xpos -1922
   ypos 791
   bdwidth 411
   bdheight 201
  }
  Input {
   inputs 0
   name Input1
   xpos -984
   ypos -137
  }
  Dot {
   name Dot4
   label xyzc
   xpos -950
   ypos -97
  }
  Dot {
   name Dot5
   xpos -950
   ypos -21
  }
set N898ed000 [stack 0]
  ColorMatrix {
   matrix {
       {{b} 0 {1-b}}
       {{1-g} {g} 0}
       {0 0 1}
     }
   name M_to_xyzp
   label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
   xpos -984
   ypos 30
   addUserKnob {20 User}
   addUserKnob {7 b}
   b 1.15
   addUserKnob {7 g}
   g 0.66
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   name _M_XYZP_TO_LMS
   label "# Define X',Y',Z' to L,M,S conversion matrix:"
   xpos -984
   ypos 102
  }
  Dot {
   name Dot1
   label LMS
   xpos -950
   ypos 154
  }
  Expression {
   expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
   expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
   expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
   name Expression1
   label "# response compression: lms to lms'"
   xpos -984
   ypos 199
   addUserKnob {20 _PQ_PARAMETERS}
   addUserKnob {7 c1}
   c1 {{3424/2**12}}
   addUserKnob {7 c2}
   c2 {{2413/2**7}}
   addUserKnob {7 c3}
   c3 {{2392/2**7}}
   addUserKnob {7 n}
   n {{2610/2**14}}
   addUserKnob {7 p}
   p {{1.7*2523/2**5}}
  }
  Dot {
   name Dot2
   label lmsp
   xpos -950
   ypos 260
  }
set N2a7f1000 [stack 0]
  ColorMatrix {
   matrix {
       {0 1 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name _M_LMSP_TO_IAB_ZCAM
   xpos -912
   ypos 329
  }
  Add {
   value -3.703522621e-11
   name Add1
   label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
   xpos -912
   ypos 353
  }
  Dot {
   name Dot6
   label Iabz
   xpos -878
   ypos 411
  }
push $N2a7f1000
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name _M_LMSP_TO_IAB_JABZ
   xpos -1053
   ypos 328
  }
  Dot {
   name Dot7
   label Iabz
   xpos -1019
   ypos 410
  }
  Switch {
   inputs 2
   which 1
   name use_zcam_parameters
   xpos -978
   ypos 441
  }
set N7d0db900 [stack 0]
  Expression {
   expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
   name Expression2
   label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
   xpos -886
   ypos 492
  }
push $N7d0db900
  Switch {
   inputs 2
   name use_zcam_parameters1
   label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
   xpos -978
   ypos 564
  }
  Dot {
   name Dot3
   label iabz
   xpos -944
   ypos 753
  }
set N4e7b9400 [stack 0]
  Expression {
   temp_name0 r2d
   temp_expr0 180.0/pi
   temp_name1 h360
   temp_expr1 "360.0\n"
   temp_name2 h
   temp_expr2 atan2(b,g)*r2d
   channel0 rgba
   expr0 h
   name h
   xpos -1074
   ypos 904
  }
set N4e7b9000 [stack 0]
  Expression {
   temp_name0 h
   temp_expr0 r
   channel0 rgba
   expr0 "1.015 + cos((h + 89.038)*pi/180)"
   name ez
   xpos -1074
   ypos 928
  }
push $N4e7b9400
  Copy {
   inputs 2
   from0 rgba.red
   to0 rgba.red
   name Copy1
   xpos -894
   ypos 989
  }
  Expression {
   channel0 rgba
   expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
   name M_colorfulness
   label "# calculate colorfulness, M:"
   xpos -894
   ypos 1021
  }
set N4e7b8400 [stack 0]
  Expression {
   channel0 rgba
   expr0 100*r/Constants.Qw
   name C
   label "# calculate chroma, C:"
   xpos -894
   ypos 1118
  }
set N7d2a2000 [stack 0]
push $N4e7b9400
  Expression {
   channel0 rgba
   expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
   name Q
   label "# calculate brightness, Q:"
   xpos -1030
   ypos 1019
  }
set N7d2a1c00 [stack 0]
  Expression {
   channel0 rgba
   expr0 "100.0 * (r/Constants.Qw)"
   name J
   label "# calculate lightness, J:"
   xpos -1030
   ypos 1117
  }
set N7d2a1800 [stack 0]
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy3
   xpos -1030
   ypos 1155
  }
set N7d2a1400 [stack 0]
  Expression {
   channel0 rgba
   expr0 "100 - ((100-r)**2 + g**2)**0.5"
   name Wz
   label "# calculate whiteness, W:"
   xpos -1030
   ypos 1195
  }
set N7d2a1000 [stack 0]
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam
   fromInput2 {{0} B}
   mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
   name Shuffle2
   xpos -1202
   ypos 1199
  }
push $N4e7b9000
  Dot {
   name Dot9
   label h
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1975
   ypos 2339
  }
push $N4e7b9400
  Shuffle2 {
   fromInput1 {{0} B}
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
   name Iz
   xpos -1127
   ypos 835
  }
push $N4e7b9400
  Shuffle2 {
   fromInput1 {{0} B}
   fromInput2 {{0} B}
   mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
   name az
   xpos -978
   ypos 837
  }
push $N4e7b9400
  Shuffle2 {
   fromInput1 {{0} B}
   fromInput2 {{0} B}
   mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
   name bz
   xpos -825
   ypos 835
  }
  NoOp {
   inputs 0
   name Constants
   xpos -527
   ypos 180
   addUserKnob {20 User}
   addUserKnob {26 _1 l _SURROUND_PARAMETERS}
   addUserKnob {4 surrounds M {average dim dark}}
   addUserKnob {7 c}
   c {{curve(surrounds) 0.69 0.59 0.525}}
   addUserKnob {7 Nc}
   Nc {{curve(surrounds) 1 0.9 0.8}}
   addUserKnob {7 F}
   F {{curve(surrounds) 1 0.9 0.8}}
   addUserKnob {7 FLL}
   FLL {{curve(surrounds) 1 1 1}}
   addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
   addUserKnob {7 La}
   La 100
   addUserKnob {7 Yb}
   Yb 20
   addUserKnob {4 surround M {avg dim dark}}
   addUserKnob {7 D}
   D 1
   addUserKnob {7 Dtype}
   addUserKnob {26 ""}
   addUserKnob {18 xyzw_d65}
   xyzw_d65 {95.043 100 108.89}
   addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {18 xyzw}
   xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
   addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {26 ""}
   addUserKnob {7 Yw}
   Yw 100
   addUserKnob {7 FL}
   FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
   addUserKnob {7 n}
   n {{Yb/Yw}}
   addUserKnob {7 Fb}
   Fb {{n**0.5}}
   addUserKnob {7 Fs}
   Fs {{c}}
   addUserKnob {26 ""}
   addUserKnob {18 xyzwc}
   xyzwc {95.043 100 108.89}
   addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {18 iabzw}
   iabzw {0.31331 -0.00014318 -8.9369e-05}
   addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {7 Qw}
   Qw 185.85
  }
push $N898ed000
push $N4e7b9000
push $N4e7b8400
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy5
   xpos 67
   ypos 1136
  }
set N8a3ef000 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180.0)
   name bM
   xpos 163
   ypos 1202
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_bM
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
   name Shuffle11
   xpos -752
   ypos 1400
  }
push $N8a3ef000
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180.0)
   name aM
   xpos 67
   ypos 1203
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_aM
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
   name Shuffle10
   xpos -848
   ypos 1400
  }
push $N4e7b9000
push $N7d2a2000
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy25
   xpos -164
   ypos 1149
  }
set N8a3edc00 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180.0)
   name bC
   xpos -76
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_bC
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
   name Shuffle25
   xpos -949
   ypos 1399
  }
push $N8a3edc00
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180.0)
   name aC
   xpos -164
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_aC
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
   name Shuffle24
   xpos -1048
   ypos 1397
  }
push $N4e7b9000
push $N7d2a1c00
push $N4e7b8400
  Copy {
   inputs 2
   from1 rgba.green
   to1 rgba.green
   name Copy2
   xpos -734
   ypos 1076
  }
  Expression {
   channel0 rgba
   expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
   name s
   label "# calculate saturation, s:"
   xpos -734
   ypos 1118
  }
set N8a3ec400 [stack 0]
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy24
   xpos -381
   ypos 1143
  }
set N8a37fc00 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180.0)
   name bS
   xpos -287
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_bS
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
   name Shuffle23
   xpos -1150
   ypos 1398
  }
push $N8a37fc00
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180.0)
   name aS
   xpos -381
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_aS
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
   name Shuffle22
   xpos -1254
   ypos 1395
  }
push $N7d2a1400
  Expression {
   channel0 rgba
   expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
   name Vz
   label "# calculate vividness, V:"
   xpos -583
   ypos 1200
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Vz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
   name Shuffle9
   xpos -1345
   ypos 1396
  }
push $N8a3ec400
  Expression {
   channel0 rgba
   name Sz
   label "# calculate saturation, S:"
   xpos -734
   ypos 1196
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Sz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
   name Shuffle8
   xpos -1436
   ypos 1395
  }
push $N7d2a1400
  Expression {
   channel0 rgba
   expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
   name Kz
   label "# calculate blackness, K:"
   xpos -895
   ypos 1195
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Kz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
   name Shuffle7
   xpos -1524
   ypos 1393
  }
push $N7d2a1000
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Wz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
   name Shuffle6
   xpos -1613
   ypos 1393
  }
push $N8a3ec400
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_s
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
   name Shuffle5
   xpos -1708
   ypos 1392
  }
push $N7d2a2000
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_C
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
   name Shuffle4
   xpos -1798
   ypos 1391
  }
push $N7d2a1800
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_J
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
   name Shuffle1
   xpos -1900
   ypos 1390
  }
push $N4e7b8400
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_M
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
   name Shuffle12
   xpos -1999
   ypos 1389
  }
push $N7d2a1c00
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Q
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
   name Shuffle3
   xpos -2089
   ypos 1391
  }
push $N4e7b9000
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_h
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
   name Shuffle13
   xpos -2182
   ypos 1392
  }
push $N898ed000
  Dot {
   name Dot16
   xpos -2265
   ypos 1253
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_h
   name Copy21
   xpos -2299
   ypos 1416
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Q
   name Copy22
   xpos -2299
   ypos 1458
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_M
   name Copy20
   xpos -2298
   ypos 1505
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_J
   name Copy11
   xpos -2298
   ypos 1547
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_C
   name Copy12
   xpos -2298
   ypos 1589
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_s
   name Copy13
   xpos -2302
   ypos 1631
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Wz
   name Copy14
   xpos -2302
   ypos 1673
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Kz
   name Copy15
   xpos -2302
   ypos 1715
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Sz
   name Copy16
   xpos -2302
   ypos 1757
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Vz
   name Copy17
   xpos -2302
   ypos 1799
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_aS
   name Copy26
   xpos -2302
   ypos 1841
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_bS
   name Copy27
   xpos -2302
   ypos 1883
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_aC
   name Copy28
   xpos -2302
   ypos 1925
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_bC
   name Copy29
   xpos -2302
   ypos 1963
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_aM
   name Copy18
   xpos -2302
   ypos 2005
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_bM
   name Copy19
   xpos -2302
   ypos 2047
  }
  Switch {
   inputs 2
   which {{parent.direction}}
   name direction1
   xpos -2302
   ypos 2112
  }
  Dot {
   name Dot17
   xpos -2268
   ypos 2157
  }
set N8a2a2800 [stack 0]
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_h
   fromInput2 {{0} B}
   mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
   name Shuffle20
   xpos -1041
   ypos 2260
  }
  Dot {
   name Dot41
   label h
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1007
   ypos 2349
  }
  Dot {
   name Dot33
   label "h in outIn"
   xpos -1007
   ypos 2613
  }
set N8a2a1c00 [stack 0]
  Dot {
   name Dot34
   xpos -1007
   ypos 2652
  }
push $N8a2a1c00
  Dot {
   name Dot35
   xpos -1034
   ypos 2640
  }
push $N8a2a2800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_bS
   fromInput2 {{0} B}
   in2 zcam_aS
   mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
   name Shuffle16
   label "aS & bS"
   note_font_size 15
   xpos -1489
   ypos 2304
  }
push $N8a2a2800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_bC
   fromInput2 {{0} B}
   in2 zcam_aC
   mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
   name Shuffle17
   label "aC & bC"
   note_font_size 15
   xpos -1585
   ypos 2304
  }
push $N8a2a2800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_bM
   fromInput2 {{0} B}
   in2 zcam_aM
   mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
   name Shuffle26
   label "aM & bM"
   note_font_size 15
   xpos -1682
   ypos 2303
  }
  Switch {
   inputs 3
   which {{parent.inverseData1}}
   name inputdata_abX_mode
   xpos -1543
   ypos 2400
  }
  Dot {
   name Dot30
   xpos -1509
   ypos 2449
  }
set N8a2a0400 [stack 0]
  Dot {
   name Dot29
   xpos -1210
   ypos 2483
  }
  Expression {
   temp_name0 r2d
   temp_expr0 180.0/pi
   temp_name1 h360
   temp_expr1 "360.0\n"
   temp_name2 h
   temp_expr2 atan2(g,r)*r2d
   channel0 rgba
   expr0 h
   name inv_h
   label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
   xpos -1244
   ypos 2546
  }
  Dot {
   name Dot36
   label "a in outIn"
   xpos -1210
   ypos 2619
  }
set N8a243400 [stack 0]
  Dot {
   name Dot37
   xpos -1163
   ypos 2636
  }
push $N8a243400
  Dot {
   name Dot38
   xpos -1185
   ypos 2648
  }
push $N8a243400
  Dot {
   name Dot39
   xpos -1210
   ypos 2663
  }
  Switch {
   inputs 5
   which {{parent.inverseData1}}
   name inverseData1_Mode1
   label MCs
   xpos -1116
   ypos 2672
  }
  Dot {
   name Dot40
   xpos -1210
   ypos 2719
  }
set N8a242400 [stack 0]
push $N8a242400
  Expression {
   channel0 rgba
   expr0 "1.015 + cos((r + 89.038)*pi/180)"
   name inv_ez
   xpos -1244
   ypos 2756
  }
push $N8a2a2800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_C
   fromInput2 {{0} B}
   mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
   name Shuffle21
   xpos -1357
   ypos 2252
  }
  Dot {
   name Dot42
   label C
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1323
   ypos 2341
  }
  Expression {
   channel0 rgba
   expr0 r
   name MCs2
   label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
   xpos -1357
   ypos 2501
  }
  Dot {
   name Dot43
   label "h in outIn"
   xpos -1323
   ypos 2578
  }
push $N8a2a2800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_M
   fromInput2 {{0} B}
   mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
   name Shuffle19
   xpos -1442
   ypos 2252
  }
  Dot {
   name Dot31
   label M
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1408
   ypos 2341
  }
  Expression {
   channel0 rgba
   expr0 r
   name MCs1
   label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
   xpos -1442
   ypos 2501
  }
  Dot {
   name Dot25
   label "h in outIn"
   xpos -1408
   ypos 2575
  }
push $N8a2a0400
  Expression {
   channel0 rgba
   expr0 "(r**2.0 + g**2.0)**0.5"
   name MCs
   label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
   xpos -1645
   ypos 2460
  }
  Dot {
   name Dot24
   label "a in outIn"
   xpos -1611
   ypos 2581
  }
set N8a1f7400 [stack 0]
  Dot {
   name Dot28
   xpos -1564
   ypos 2598
  }
push $N8a1f7400
  Dot {
   name Dot27
   xpos -1586
   ypos 2610
  }
push $N8a1f7400
  Dot {
   name Dot26
   xpos -1611
   ypos 2625
  }
  Switch {
   inputs 5
   which {{parent.inverseData1}}
   name inverseData1_Mode
   label MCs
   xpos -1517
   ypos 2634
  }
set N8a27e400 [stack 0]
  Expression {
   channel0 rgba
   expr0 r
   name C_from_aC
   label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
   xpos -1926
   ypos 2714
  }
set N8a1f6400 [stack 0]
  Dot {
   name Dot44
   label C,h
   xpos -1673
   ypos 2768
  }
push $N8a27e400
  Expression {
   channel0 rgba
   expr0 100*r/Constants.Qw
   name C_from_aM
   label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
   xpos -2036
   ypos 2713
  }
set N8a1f5c00 [stack 0]
  Dot {
   name Dot20
   label M,h
   xpos -1737
   ypos 2767
  }
push $N8a27e400
push $N8a2a2800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_Q
   fromInput2 {{0} B}
   mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
   name Shuffle18
   xpos -2182
   ypos 2257
  }
  Dot {
   name Dot21
   label Q
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1996
   ypos 2435
  }
set N8a1f5000 [stack 0]
push $N8a2a2800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_J
   fromInput2 {{0} B}
   mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
   name Shuffle14
   xpos -2302
   ypos 2259
  }
  Dot {
   name Dot8
   label J
   note_font_size 20
   note_font_color 0x677754ff
   xpos -2229
   ypos 2434
  }
  Dot {
   name Dot22
   xpos -2229
   ypos 2456
  }
set N8a1f4400 [stack 0]
  Expression {
   channel0 rgba
   expr0 Constants.Qw*(r/100)
   name Q_from_J
   label "# Get Lightness J and brightness Q from data:"
   xpos -2263
   ypos 2519
  }
  Switch {
   inputs 2
   which {{parent.inverseData0}}
   name InverseData0_Mode
   label Q
   xpos -2263
   ypos 2564
  }
set N8a27dd00 [stack 0]
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy30
   xpos -1818
   ypos 2676
  }
  Expression {
   temp_name0 M
   temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
   channel0 rgba
   expr0 100*M/Constants.Qw
   name C_from_aS
   label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
   xpos -1818
   ypos 2708
  }
push $N8a1f6400
push $N8a1f5c00
  Switch {
   inputs 5
   which {{parent.inverseData1}}
   name inputdata_abX_mode1
   xpos -1926
   ypos 2799
  }
  Expression {
   channel0 rgba
   expr0 "Constants.Qw * r / 100"
   name inv_M
   label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
   xpos -1543
   ypos 2822
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy7
   xpos -1543
   ypos 2874
  }
  Expression {
   channel0 rgba
   expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
   name inv_t
   label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
   xpos -1543
   ypos 2906
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy8
   xpos -1543
   ypos 2986
  }
set N8a1aa400 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180)
   name inv_bz
   label t*np.sin(h*np.pi/180)
   xpos -1402
   ypos 3067
  }
push $N8a1aa400
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180)
   name inv_az
   label "az = t*np.cos(h*np.pi/180)"
   xpos -1543
   ypos 3064
  }
push $N8a27dd00
  Expression {
   channel0 rgba
   expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
   name inv_Iz
   label "# calculate achromatic signal, Iz:"
   xpos -2263
   ypos 2619
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy9
   xpos -2181
   ypos 3184
  }
  Copy {
   inputs 2
   from0 rgba.blue
   to0 rgba.blue
   name Copy10
   xpos -2181
   ypos 3216
  }
  Dot {
   name Dot15
   label iabz
   note_font_size 20
   xpos -2147
   ypos 3275
  }
  Dot {
   name Dot13
   xpos -2145
   ypos 3414
  }
  Dot {
   name Dot14
   xpos -2145
   ypos 3470
  }
set N8a1a8400 [stack 0]
  Expression {
   expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
   name Expression3
   label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
   xpos -2050
   ypos 3532
  }
push $N8a1a8400
  Switch {
   inputs 2
   name use_zcam_parameters2
   label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
   xpos -2179
   ypos 3608
  }
set N8a27cf00 [stack 0]
  Dot {
   name Dot19
   label Iabz
   xpos -2092
   ypos 3678
  }
  Add {
   value 3.703522621e-11
   name Add2
   label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
   xpos -2126
   ypos 3712
  }
  ColorMatrix {
   matrix {
       {0 1 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   invert true
   name _M_LMSP_TO_IAB_ZCAM1
   xpos -2126
   ypos 3750
  }
push $N8a27cf00
  Dot {
   name Dot18
   label Iabz
   xpos -2216
   ypos 3683
  }
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   invert true
   name _M_LMSP_TO_IAB_JABZ1
   xpos -2250
   ypos 3748
  }
  Switch {
   inputs 2
   which 1
   name use_zcam_parameters3
   xpos -2182
   ypos 3844
  }
  Expression {
   expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
   expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
   expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
   name Expression4
   label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
   xpos -2182
   ypos 3874
   addUserKnob {20 _PQ_PARAMETERS}
   addUserKnob {7 c1}
   c1 {{3424/2**12}}
   addUserKnob {7 c2}
   c2 {{2413/2**7}}
   addUserKnob {7 c3}
   c3 {{2392/2**7}}
   addUserKnob {7 n}
   n {{2610/2**14}}
   addUserKnob {7 p}
   p {{1.7*2523/2**5}}
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   invert true
   name _M_XYZP_TO_LMS1
   label "# Define X',Y',Z' to L,M,S conversion matrix:"
   xpos -2182
   ypos 3949
  }
  ColorMatrix {
   matrix {
       {{b} 0 {1-b}}
       {{1-g} {g} 0}
       {0 0 1}
     }
   invert true
   name M_to_xyzp1
   label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
   xpos -2182
   ypos 3981
   addUserKnob {20 User}
   addUserKnob {7 b}
   b 1.15
   addUserKnob {7 g}
   g 0.66
  }
push $N8a2a2800
  Switch {
   inputs 2
   which {{parent.direction}}
   name direction
   xpos -1519
   ypos 4172
  }
  Output {
   name Output1
   xpos -1519
   ypos 4272
  }
push $N8a2a2800
  Dot {
   name Dot11
   label aM
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1535
   ypos 2170
  }
push $N8a2a2800
  Dot {
   name Dot12
   label bM
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1439
   ypos 2173
  }
push $N8a27dd00
push $N8a2a2800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_Sz
   fromInput2 {{0} B}
   mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
   name Shuffle15
   xpos -1870
   ypos 2254
  }
  Dot {
   name Dot10
   label Sz
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1836
   ypos 2342
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy4
   xpos -1770
   ypos 2555
  }
  Expression {
   expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
   name inv_C
   label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
   xpos -1770
   ypos 2587
  }
push $N8a2a0400
  Dot {
   name Dot23
   label "H in outIn"
   xpos -1509
   ypos 2582
  }
  Dot {
   inputs 0
   name Dot32
   label "H in outIn"
   xpos -1108
   ypos 2620
  }
push $N8a1f5000
  Expression {
   channel0 rgba
   expr0 "100.0* (r/Constants.Qw)"
   name J_from_Q
   xpos -2030
   ypos 2479
  }
push $N8a1f4400
  Switch {
   inputs 2
   which {{parent.inverseData0}}
   name InverseData0_Mode1
   label J
   xpos -2030
   ypos 2527
  }
push $N8a27e400
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy23
   xpos -1596
   ypos 2681
  }
  Expression {
   channel0 rgba
   expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
   name inv3_C
   label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
   xpos -1596
   ypos 2713
  }
  Constant {
   inputs 0
   channels rgb
   color 0.034705
   name Constant1
   xpos -440
   ypos 2450
  }
 end_group
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name limitSampleNode
  xpos 829
  ypos 442
 }
 Input {
  inputs 0
  name Input1
  xpos 1344
  ypos -41
 }
 Colorspace {
  primary_in ACES
  colorspace_out CIE-XYZ
  name Colorspace30
  label "ACES to XYZ"
  xpos 1344
  ypos -1
 }
 Multiply {
  value 100
  name Multiply19
  label "Mult by 100 to put in absolute nits"
  xpos 1344
  ypos 31
 }
 Group {
  name ZCAM10
  label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
  xpos 1344
  ypos 107
  addUserKnob {20 ZCAM}
  addUserKnob {4 direction M {forward inverse}}
  addUserKnob {26 ""}
  addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
  addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
  addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
  inverseData1 M,h
  addUserKnob {26 ""}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {41 surrounds T Constants.surrounds}
  addUserKnob {41 c T Constants.c}
  addUserKnob {41 Nc T Constants.Nc}
  addUserKnob {41 F T Constants.F}
  addUserKnob {41 FLL T Constants.FLL}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {41 La T Constants.La}
  addUserKnob {41 Yb T Constants.Yb}
  addUserKnob {41 surround T Constants.surround}
  addUserKnob {41 D T Constants.D}
  addUserKnob {41 Dtype T Constants.Dtype}
  addUserKnob {26 ""}
  addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
  addUserKnob {41 xyzw T Constants.xyzw}
  addUserKnob {26 ""}
  addUserKnob {41 Yw T Constants.Yw}
  addUserKnob {41 FL T Constants.FL}
  addUserKnob {41 n T Constants.n}
  addUserKnob {41 Fb T Constants.Fb}
  addUserKnob {41 Fs T Constants.Fs}
  addUserKnob {26 ""}
  addUserKnob {41 xyzwc T Constants.xyzwc}
  addUserKnob {41 iabzw T Constants.iabzw}
  addUserKnob {41 Qw T Constants.Qw}
 }
  BackdropNode {
   inputs 0
   name BackdropNode1
   tile_color 0x71c67100
   label xyz_to_jabz
   note_font_size 42
   xpos -1063
   ypos -50
   bdwidth 255
   bdheight 678
  }
  BackdropNode {
   inputs 0
   name BackdropNode2
   tile_color 0x388e8e00
   label Forward
   note_font_size 42
   xpos -1278
   ypos 673
   bdwidth 1634
   bdheight 582
  }
  BackdropNode {
   inputs 0
   name BackdropNode3
   tile_color 0x388e8e00
   label Inverse
   note_font_size 42
   xpos -2310
   ypos 2374
   bdwidth 1715
   bdheight 953
  }
  BackdropNode {
   inputs 0
   name BackdropNode4
   tile_color 0x388e8e00
   label "jabz to xyz"
   note_font_size 42
   xpos -2260
   ypos 3390
   bdwidth 300
   bdheight 667
  }
  BackdropNode {
   inputs 0
   name BackdropNode5
   label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
   xpos -1922
   ypos 791
   bdwidth 411
   bdheight 201
  }
  Input {
   inputs 0
   name Input1
   xpos -984
   ypos -137
  }
  Dot {
   name Dot4
   label xyzc
   xpos -950
   ypos -97
  }
  Dot {
   name Dot5
   xpos -950
   ypos -21
  }
set N8a0c0800 [stack 0]
  ColorMatrix {
   matrix {
       {{b} 0 {1-b}}
       {{1-g} {g} 0}
       {0 0 1}
     }
   name M_to_xyzp
   label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
   xpos -984
   ypos 30
   addUserKnob {20 User}
   addUserKnob {7 b}
   b 1.15
   addUserKnob {7 g}
   g 0.66
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   name _M_XYZP_TO_LMS
   label "# Define X',Y',Z' to L,M,S conversion matrix:"
   xpos -984
   ypos 102
  }
  Dot {
   name Dot1
   label LMS
   xpos -950
   ypos 154
  }
  Expression {
   expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
   expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
   expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
   name Expression1
   label "# response compression: lms to lms'"
   xpos -984
   ypos 199
   addUserKnob {20 _PQ_PARAMETERS}
   addUserKnob {7 c1}
   c1 {{3424/2**12}}
   addUserKnob {7 c2}
   c2 {{2413/2**7}}
   addUserKnob {7 c3}
   c3 {{2392/2**7}}
   addUserKnob {7 n}
   n {{2610/2**14}}
   addUserKnob {7 p}
   p {{1.7*2523/2**5}}
  }
  Dot {
   name Dot2
   label lmsp
   xpos -950
   ypos 260
  }
set N8a04b000 [stack 0]
  ColorMatrix {
   matrix {
       {0 1 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name _M_LMSP_TO_IAB_ZCAM
   xpos -912
   ypos 329
  }
  Add {
   value -3.703522621e-11
   name Add1
   label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
   xpos -912
   ypos 353
  }
  Dot {
   name Dot6
   label Iabz
   xpos -878
   ypos 411
  }
push $N8a04b000
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name _M_LMSP_TO_IAB_JABZ
   xpos -1053
   ypos 328
  }
  Dot {
   name Dot7
   label Iabz
   xpos -1019
   ypos 410
  }
  Switch {
   inputs 2
   which 1
   name use_zcam_parameters
   xpos -978
   ypos 441
  }
set N8a06eb00 [stack 0]
  Expression {
   expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
   name Expression2
   label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
   xpos -886
   ypos 492
  }
push $N8a06eb00
  Switch {
   inputs 2
   name use_zcam_parameters1
   label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
   xpos -978
   ypos 564
  }
  Dot {
   name Dot3
   label iabz
   xpos -944
   ypos 753
  }
set N8a049400 [stack 0]
  Expression {
   temp_name0 r2d
   temp_expr0 180.0/pi
   temp_name1 h360
   temp_expr1 "360.0\n"
   temp_name2 h
   temp_expr2 atan2(b,g)*r2d
   channel0 rgba
   expr0 h
   name h
   xpos -1074
   ypos 904
  }
set N8a049000 [stack 0]
  Expression {
   temp_name0 h
   temp_expr0 r
   channel0 rgba
   expr0 "1.015 + cos((h + 89.038)*pi/180)"
   name ez
   xpos -1074
   ypos 928
  }
push $N8a049400
  Copy {
   inputs 2
   from0 rgba.red
   to0 rgba.red
   name Copy1
   xpos -894
   ypos 989
  }
  Expression {
   channel0 rgba
   expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
   name M_colorfulness
   label "# calculate colorfulness, M:"
   xpos -894
   ypos 1021
  }
set N8a048400 [stack 0]
  Expression {
   channel0 rgba
   expr0 100*r/Constants.Qw
   name C
   label "# calculate chroma, C:"
   xpos -894
   ypos 1118
  }
set N89fe3c00 [stack 0]
push $N8a049400
  Expression {
   channel0 rgba
   expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
   name Q
   label "# calculate brightness, Q:"
   xpos -1030
   ypos 1019
  }
set N89fe3800 [stack 0]
  Expression {
   channel0 rgba
   expr0 "100.0 * (r/Constants.Qw)"
   name J
   label "# calculate lightness, J:"
   xpos -1030
   ypos 1117
  }
set N89fe3400 [stack 0]
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy3
   xpos -1030
   ypos 1155
  }
set N89fe3000 [stack 0]
  Expression {
   channel0 rgba
   expr0 "100 - ((100-r)**2 + g**2)**0.5"
   name Wz
   label "# calculate whiteness, W:"
   xpos -1030
   ypos 1195
  }
set N89fe2c00 [stack 0]
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam
   fromInput2 {{0} B}
   mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
   name Shuffle2
   xpos -1202
   ypos 1199
  }
push $N8a049000
  Dot {
   name Dot9
   label h
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1975
   ypos 2339
  }
push $N8a049400
  Shuffle2 {
   fromInput1 {{0} B}
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
   name Iz
   xpos -1127
   ypos 835
  }
push $N8a049400
  Shuffle2 {
   fromInput1 {{0} B}
   fromInput2 {{0} B}
   mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
   name az
   xpos -978
   ypos 837
  }
push $N8a049400
  Shuffle2 {
   fromInput1 {{0} B}
   fromInput2 {{0} B}
   mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
   name bz
   xpos -825
   ypos 835
  }
  NoOp {
   inputs 0
   name Constants
   xpos -527
   ypos 180
   addUserKnob {20 User}
   addUserKnob {26 _1 l _SURROUND_PARAMETERS}
   addUserKnob {4 surrounds M {average dim dark}}
   addUserKnob {7 c}
   c {{curve(surrounds) 0.69 0.59 0.525}}
   addUserKnob {7 Nc}
   Nc {{curve(surrounds) 1 0.9 0.8}}
   addUserKnob {7 F}
   F {{curve(surrounds) 1 0.9 0.8}}
   addUserKnob {7 FLL}
   FLL {{curve(surrounds) 1 1 1}}
   addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
   addUserKnob {7 La}
   La 100
   addUserKnob {7 Yb}
   Yb 20
   addUserKnob {4 surround M {avg dim dark}}
   addUserKnob {7 D}
   D 1
   addUserKnob {7 Dtype}
   addUserKnob {26 ""}
   addUserKnob {18 xyzw_d65}
   xyzw_d65 {95.043 100 108.89}
   addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {18 xyzw}
   xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
   addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {26 ""}
   addUserKnob {7 Yw}
   Yw 100
   addUserKnob {7 FL}
   FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
   addUserKnob {7 n}
   n {{Yb/Yw}}
   addUserKnob {7 Fb}
   Fb {{n**0.5}}
   addUserKnob {7 Fs}
   Fs {{c}}
   addUserKnob {26 ""}
   addUserKnob {18 xyzwc}
   xyzwc {95.043 100 108.89}
   addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {18 iabzw}
   iabzw {0.31331 -0.00014318 -8.9369e-05}
   addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {7 Qw}
   Qw 185.85
  }
push $N8a0c0800
push $N8a049000
push $N8a048400
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy5
   xpos 67
   ypos 1136
  }
set N89fe1000 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180.0)
   name bM
   xpos 163
   ypos 1202
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_bM
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
   name Shuffle11
   xpos -752
   ypos 1400
  }
push $N89fe1000
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180.0)
   name aM
   xpos 67
   ypos 1203
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_aM
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
   name Shuffle10
   xpos -848
   ypos 1400
  }
push $N8a049000
push $N89fe3c00
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy25
   xpos -164
   ypos 1149
  }
set N89f73800 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180.0)
   name bC
   xpos -76
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_bC
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
   name Shuffle25
   xpos -949
   ypos 1399
  }
push $N89f73800
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180.0)
   name aC
   xpos -164
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_aC
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
   name Shuffle24
   xpos -1048
   ypos 1397
  }
push $N8a049000
push $N89fe3800
push $N8a048400
  Copy {
   inputs 2
   from1 rgba.green
   to1 rgba.green
   name Copy2
   xpos -734
   ypos 1076
  }
  Expression {
   channel0 rgba
   expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
   name s
   label "# calculate saturation, s:"
   xpos -734
   ypos 1118
  }
set N89f72000 [stack 0]
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy24
   xpos -381
   ypos 1143
  }
set N89f71c00 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180.0)
   name bS
   xpos -287
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_bS
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
   name Shuffle23
   xpos -1150
   ypos 1398
  }
push $N89f71c00
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180.0)
   name aS
   xpos -381
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_aS
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
   name Shuffle22
   xpos -1254
   ypos 1395
  }
push $N89fe3000
  Expression {
   channel0 rgba
   expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
   name Vz
   label "# calculate vividness, V:"
   xpos -583
   ypos 1200
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Vz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
   name Shuffle9
   xpos -1345
   ypos 1396
  }
push $N89f72000
  Expression {
   channel0 rgba
   name Sz
   label "# calculate saturation, S:"
   xpos -734
   ypos 1196
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Sz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
   name Shuffle8
   xpos -1436
   ypos 1395
  }
push $N89fe3000
  Expression {
   channel0 rgba
   expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
   name Kz
   label "# calculate blackness, K:"
   xpos -895
   ypos 1195
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Kz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
   name Shuffle7
   xpos -1524
   ypos 1393
  }
push $N89fe2c00
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Wz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
   name Shuffle6
   xpos -1613
   ypos 1393
  }
push $N89f72000
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_s
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
   name Shuffle5
   xpos -1708
   ypos 1392
  }
push $N89fe3c00
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_C
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
   name Shuffle4
   xpos -1798
   ypos 1391
  }
push $N89fe3400
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_J
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
   name Shuffle1
   xpos -1900
   ypos 1390
  }
push $N8a048400
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_M
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
   name Shuffle12
   xpos -1999
   ypos 1389
  }
push $N89fe3800
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Q
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
   name Shuffle3
   xpos -2089
   ypos 1391
  }
push $N8a049000
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_h
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
   name Shuffle13
   xpos -2182
   ypos 1392
  }
push $N8a0c0800
  Dot {
   name Dot16
   xpos -2265
   ypos 1253
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_h
   name Copy21
   xpos -2299
   ypos 1416
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Q
   name Copy22
   xpos -2299
   ypos 1458
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_M
   name Copy20
   xpos -2298
   ypos 1505
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_J
   name Copy11
   xpos -2298
   ypos 1547
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_C
   name Copy12
   xpos -2298
   ypos 1589
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_s
   name Copy13
   xpos -2302
   ypos 1631
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Wz
   name Copy14
   xpos -2302
   ypos 1673
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Kz
   name Copy15
   xpos -2302
   ypos 1715
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Sz
   name Copy16
   xpos -2302
   ypos 1757
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Vz
   name Copy17
   xpos -2302
   ypos 1799
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_aS
   name Copy26
   xpos -2302
   ypos 1841
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_bS
   name Copy27
   xpos -2302
   ypos 1883
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_aC
   name Copy28
   xpos -2302
   ypos 1925
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_bC
   name Copy29
   xpos -2302
   ypos 1963
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_aM
   name Copy18
   xpos -2302
   ypos 2005
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_bM
   name Copy19
   xpos -2302
   ypos 2047
  }
  Switch {
   inputs 2
   which {{parent.direction}}
   name direction1
   xpos -2302
   ypos 2112
  }
  Dot {
   name Dot17
   xpos -2268
   ypos 2157
  }
set N89ea0800 [stack 0]
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_h
   fromInput2 {{0} B}
   mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
   name Shuffle20
   xpos -1041
   ypos 2260
  }
  Dot {
   name Dot41
   label h
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1007
   ypos 2349
  }
  Dot {
   name Dot33
   label "h in outIn"
   xpos -1007
   ypos 2613
  }
set N89e37800 [stack 0]
  Dot {
   name Dot34
   xpos -1007
   ypos 2652
  }
push $N89e37800
  Dot {
   name Dot35
   xpos -1034
   ypos 2640
  }
push $N89ea0800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_bS
   fromInput2 {{0} B}
   in2 zcam_aS
   mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
   name Shuffle16
   label "aS & bS"
   note_font_size 15
   xpos -1489
   ypos 2304
  }
push $N89ea0800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_bC
   fromInput2 {{0} B}
   in2 zcam_aC
   mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
   name Shuffle17
   label "aC & bC"
   note_font_size 15
   xpos -1585
   ypos 2304
  }
push $N89ea0800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_bM
   fromInput2 {{0} B}
   in2 zcam_aM
   mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
   name Shuffle26
   label "aM & bM"
   note_font_size 15
   xpos -1682
   ypos 2303
  }
  Switch {
   inputs 3
   which {{parent.inverseData1}}
   name inputdata_abX_mode
   xpos -1543
   ypos 2400
  }
  Dot {
   name Dot30
   xpos -1509
   ypos 2449
  }
set N89e36000 [stack 0]
  Dot {
   name Dot29
   xpos -1210
   ypos 2483
  }
  Expression {
   temp_name0 r2d
   temp_expr0 180.0/pi
   temp_name1 h360
   temp_expr1 "360.0\n"
   temp_name2 h
   temp_expr2 atan2(g,r)*r2d
   channel0 rgba
   expr0 h
   name inv_h
   label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
   xpos -1244
   ypos 2546
  }
  Dot {
   name Dot36
   label "a in outIn"
   xpos -1210
   ypos 2619
  }
set N89e35400 [stack 0]
  Dot {
   name Dot37
   xpos -1163
   ypos 2636
  }
push $N89e35400
  Dot {
   name Dot38
   xpos -1185
   ypos 2648
  }
push $N89e35400
  Dot {
   name Dot39
   xpos -1210
   ypos 2663
  }
  Switch {
   inputs 5
   which {{parent.inverseData1}}
   name inverseData1_Mode1
   label MCs
   xpos -1116
   ypos 2672
  }
  Dot {
   name Dot40
   xpos -1210
   ypos 2719
  }
set N89e34400 [stack 0]
push $N89e34400
  Expression {
   channel0 rgba
   expr0 "1.015 + cos((r + 89.038)*pi/180)"
   name inv_ez
   xpos -1244
   ypos 2756
  }
push $N89ea0800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_C
   fromInput2 {{0} B}
   mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
   name Shuffle21
   xpos -1357
   ypos 2252
  }
  Dot {
   name Dot42
   label C
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1323
   ypos 2341
  }
  Expression {
   channel0 rgba
   expr0 r
   name MCs2
   label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
   xpos -1357
   ypos 2501
  }
  Dot {
   name Dot43
   label "h in outIn"
   xpos -1323
   ypos 2578
  }
push $N89ea0800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_M
   fromInput2 {{0} B}
   mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
   name Shuffle19
   xpos -1442
   ypos 2252
  }
  Dot {
   name Dot31
   label M
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1408
   ypos 2341
  }
  Expression {
   channel0 rgba
   expr0 r
   name MCs1
   label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
   xpos -1442
   ypos 2501
  }
  Dot {
   name Dot25
   label "h in outIn"
   xpos -1408
   ypos 2575
  }
push $N89e36000
  Expression {
   channel0 rgba
   expr0 "(r**2.0 + g**2.0)**0.5"
   name MCs
   label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
   xpos -1645
   ypos 2460
  }
  Dot {
   name Dot24
   label "a in outIn"
   xpos -1611
   ypos 2581
  }
set N91b49400 [stack 0]
  Dot {
   name Dot28
   xpos -1564
   ypos 2598
  }
push $N91b49400
  Dot {
   name Dot27
   xpos -1586
   ypos 2610
  }
push $N91b49400
  Dot {
   name Dot26
   xpos -1611
   ypos 2625
  }
  Switch {
   inputs 5
   which {{parent.inverseData1}}
   name inverseData1_Mode
   label MCs
   xpos -1517
   ypos 2634
  }
set N91b66b00 [stack 0]
  Expression {
   channel0 rgba
   expr0 r
   name C_from_aC
   label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
   xpos -1926
   ypos 2714
  }
set N91b48400 [stack 0]
  Dot {
   name Dot44
   label C,h
   xpos -1673
   ypos 2768
  }
push $N91b66b00
  Expression {
   channel0 rgba
   expr0 100*r/Constants.Qw
   name C_from_aM
   label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
   xpos -2036
   ypos 2713
  }
set N91afb800 [stack 0]
  Dot {
   name Dot20
   label M,h
   xpos -1737
   ypos 2767
  }
push $N91b66b00
push $N89ea0800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_Q
   fromInput2 {{0} B}
   mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
   name Shuffle18
   xpos -2182
   ypos 2257
  }
  Dot {
   name Dot21
   label Q
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1996
   ypos 2435
  }
set N91afac00 [stack 0]
push $N89ea0800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_J
   fromInput2 {{0} B}
   mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
   name Shuffle14
   xpos -2302
   ypos 2259
  }
  Dot {
   name Dot8
   label J
   note_font_size 20
   note_font_color 0x677754ff
   xpos -2229
   ypos 2434
  }
  Dot {
   name Dot22
   xpos -2229
   ypos 2456
  }
set N91afa000 [stack 0]
  Expression {
   channel0 rgba
   expr0 Constants.Qw*(r/100)
   name Q_from_J
   label "# Get Lightness J and brightness Q from data:"
   xpos -2263
   ypos 2519
  }
  Switch {
   inputs 2
   which {{parent.inverseData0}}
   name InverseData0_Mode
   label Q
   xpos -2263
   ypos 2564
  }
set N91b66400 [stack 0]
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy30
   xpos -1818
   ypos 2676
  }
  Expression {
   temp_name0 M
   temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
   channel0 rgba
   expr0 100*M/Constants.Qw
   name C_from_aS
   label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
   xpos -1818
   ypos 2708
  }
push $N91b48400
push $N91afb800
  Switch {
   inputs 5
   which {{parent.inverseData1}}
   name inputdata_abX_mode1
   xpos -1926
   ypos 2799
  }
  Expression {
   channel0 rgba
   expr0 "Constants.Qw * r / 100"
   name inv_M
   label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
   xpos -1543
   ypos 2822
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy7
   xpos -1543
   ypos 2874
  }
  Expression {
   channel0 rgba
   expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
   name inv_t
   label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
   xpos -1543
   ypos 2906
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy8
   xpos -1543
   ypos 2986
  }
set N91af8400 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180)
   name inv_bz
   label t*np.sin(h*np.pi/180)
   xpos -1402
   ypos 3067
  }
push $N91af8400
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180)
   name inv_az
   label "az = t*np.cos(h*np.pi/180)"
   xpos -1543
   ypos 3064
  }
push $N91b66400
  Expression {
   channel0 rgba
   expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
   name inv_Iz
   label "# calculate achromatic signal, Iz:"
   xpos -2263
   ypos 2619
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy9
   xpos -2181
   ypos 3184
  }
  Copy {
   inputs 2
   from0 rgba.blue
   to0 rgba.blue
   name Copy10
   xpos -2181
   ypos 3216
  }
  Dot {
   name Dot15
   label iabz
   note_font_size 20
   xpos -2147
   ypos 3275
  }
  Dot {
   name Dot13
   xpos -2145
   ypos 3414
  }
  Dot {
   name Dot14
   xpos -2145
   ypos 3470
  }
set N91a8a000 [stack 0]
  Expression {
   expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
   name Expression3
   label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
   xpos -2050
   ypos 3532
  }
push $N91a8a000
  Switch {
   inputs 2
   name use_zcam_parameters2
   label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
   xpos -2179
   ypos 3608
  }
set N91b65600 [stack 0]
  Dot {
   name Dot19
   label Iabz
   xpos -2092
   ypos 3678
  }
  Add {
   value 3.703522621e-11
   name Add2
   label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
   xpos -2126
   ypos 3712
  }
  ColorMatrix {
   matrix {
       {0 1 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   invert true
   name _M_LMSP_TO_IAB_ZCAM1
   xpos -2126
   ypos 3750
  }
push $N91b65600
  Dot {
   name Dot18
   label Iabz
   xpos -2216
   ypos 3683
  }
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   invert true
   name _M_LMSP_TO_IAB_JABZ1
   xpos -2250
   ypos 3748
  }
  Switch {
   inputs 2
   which 1
   name use_zcam_parameters3
   xpos -2182
   ypos 3844
  }
  Expression {
   expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
   expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
   expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
   name Expression4
   label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
   xpos -2182
   ypos 3874
   addUserKnob {20 _PQ_PARAMETERS}
   addUserKnob {7 c1}
   c1 {{3424/2**12}}
   addUserKnob {7 c2}
   c2 {{2413/2**7}}
   addUserKnob {7 c3}
   c3 {{2392/2**7}}
   addUserKnob {7 n}
   n {{2610/2**14}}
   addUserKnob {7 p}
   p {{1.7*2523/2**5}}
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   invert true
   name _M_XYZP_TO_LMS1
   label "# Define X',Y',Z' to L,M,S conversion matrix:"
   xpos -2182
   ypos 3949
  }
  ColorMatrix {
   matrix {
       {{b} 0 {1-b}}
       {{1-g} {g} 0}
       {0 0 1}
     }
   invert true
   name M_to_xyzp1
   label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
   xpos -2182
   ypos 3981
   addUserKnob {20 User}
   addUserKnob {7 b}
   b 1.15
   addUserKnob {7 g}
   g 0.66
  }
push $N89ea0800
  Switch {
   inputs 2
   which {{parent.direction}}
   name direction
   xpos -1519
   ypos 4172
  }
  Output {
   name Output1
   xpos -1519
   ypos 4272
  }
push $N89ea0800
  Dot {
   name Dot11
   label aM
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1535
   ypos 2170
  }
push $N89ea0800
  Dot {
   name Dot12
   label bM
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1439
   ypos 2173
  }
push $N91b66400
push $N89ea0800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_Sz
   fromInput2 {{0} B}
   mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
   name Shuffle15
   xpos -1870
   ypos 2254
  }
  Dot {
   name Dot10
   label Sz
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1836
   ypos 2342
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy4
   xpos -1770
   ypos 2555
  }
  Expression {
   expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
   name inv_C
   label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
   xpos -1770
   ypos 2587
  }
push $N89e36000
  Dot {
   name Dot23
   label "H in outIn"
   xpos -1509
   ypos 2582
  }
  Dot {
   inputs 0
   name Dot32
   label "H in outIn"
   xpos -1108
   ypos 2620
  }
push $N91afac00
  Expression {
   channel0 rgba
   expr0 "100.0* (r/Constants.Qw)"
   name J_from_Q
   xpos -2030
   ypos 2479
  }
push $N91afa000
  Switch {
   inputs 2
   which {{parent.inverseData0}}
   name InverseData0_Mode1
   label J
   xpos -2030
   ypos 2527
  }
push $N91b66b00
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy23
   xpos -1596
   ypos 2681
  }
  Expression {
   channel0 rgba
   expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
   name inv3_C
   label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
   xpos -1596
   ypos 2713
  }
  Constant {
   inputs 0
   channels rgb
   color 0.034705
   name Constant1
   xpos -440
   ypos 2450
  }
 end_group
set N8a0e9d00 [stack 0]
 Ramp {
  replace true
  p0 {0 0}
  p1 {{width} 0}
  color 5
  name Ramp1
  xpos 1208
  ypos 168
 }
set N4d215400 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle1
  xpos 1208
  ypos 220
 }
set N4d214800 [stack 0]
push $N4d215400
push $N8a0e9d00
 Multiply {
  inputs 1+1
  channels zcam_M
  value 0
  name Multiply1
  xpos 1344
  ypos 215
  disable true
 }
 Merge2 {
  inputs 2
  operation multiply
  Achannels none
  Bchannels none
  output none
  also_merge zcam_M
  name Multiply
  xpos 1344
  ypos 276
 }
 Clamp {
  channels zcam_M
  maximum 100
  name Clamp1
  xpos 1344
  ypos 308
 }
set N4d214400 [stack 0]
 Dot {
  name Dot13
  xpos 1376
  ypos 487
 }
set N919c2000 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle37
  xpos 981
  ypos 194
 }
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  in2 zcam_M
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.blue 0 2 rgba.blue 0 2 rgba.alpha 0 3 rgba.alpha 0 3 zcam_M.green 1 1 rgba.green 0 1"
  name Shuffle48
  xpos 981
  ypos 218
 }
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  in2 zcam_h
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.alpha 0 3 rgba.alpha 0 3 zcam_h.blue 1 2 rgba.blue 0 2"
  name Shuffle49
  xpos 981
  ypos 242
 }
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.alpha
  name Copy9
  xpos 981
  ypos 409
 }
set N919c1000 [stack 0]
 Expression {
  temp_name0 limit
  temp_expr0 a(((b/360+.5)*1023),(r/100*1023))
  temp_name1 scaledVal
  temp_expr1 g/limit
  temp_name2 scale
  temp_expr2 1-thr
  expr2 "(scaledVal>thr? ( ((scaledVal-thr)/scale) / (((scaledVal-thr)/scale)+1) * scale + thr  )   : scaledVal ) * limit"
  channel3 alpha
  expr3 limit
  name clipToLimit2
  xpos 1064
  ypos 470
  addUserKnob {20 User}
  addUserKnob {7 limitScale R 0 100}
  limitScale 100
  addUserKnob {7 thr}
  thr 0.765
 }
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.alpha 0 3"
  name Shuffle50
  xpos 1064
  ypos 499
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.green 0 1 zcam_M.alpha 0 3"
  name Shuffle39
  xpos 1193
  ypos 550
 }
push $N919c2000
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy7
  xpos 1354
  ypos 595
  disable true
 }
 Group {
  name ZCAM11
  label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
  xpos 1354
  ypos 663
  addUserKnob {20 ZCAM}
  addUserKnob {4 direction M {forward inverse}}
  direction inverse
  addUserKnob {26 ""}
  addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
  addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
  addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
  inverseData1 M,h
  addUserKnob {26 ""}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {41 surrounds T Constants.surrounds}
  addUserKnob {41 c T Constants.c}
  addUserKnob {41 Nc T Constants.Nc}
  addUserKnob {41 F T Constants.F}
  addUserKnob {41 FLL T Constants.FLL}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {41 La T Constants.La}
  addUserKnob {41 Yb T Constants.Yb}
  addUserKnob {41 surround T Constants.surround}
  addUserKnob {41 D T Constants.D}
  addUserKnob {41 Dtype T Constants.Dtype}
  addUserKnob {26 ""}
  addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
  addUserKnob {41 xyzw T Constants.xyzw}
  addUserKnob {26 ""}
  addUserKnob {41 Yw T Constants.Yw}
  addUserKnob {41 FL T Constants.FL}
  addUserKnob {41 n T Constants.n}
  addUserKnob {41 Fb T Constants.Fb}
  addUserKnob {41 Fs T Constants.Fs}
  addUserKnob {26 ""}
  addUserKnob {41 xyzwc T Constants.xyzwc}
  addUserKnob {41 iabzw T Constants.iabzw}
  addUserKnob {41 Qw T Constants.Qw}
 }
  BackdropNode {
   inputs 0
   name BackdropNode1
   tile_color 0x71c67100
   label xyz_to_jabz
   note_font_size 42
   xpos -1063
   ypos -50
   bdwidth 255
   bdheight 678
  }
  BackdropNode {
   inputs 0
   name BackdropNode2
   tile_color 0x388e8e00
   label Forward
   note_font_size 42
   xpos -1278
   ypos 673
   bdwidth 1634
   bdheight 582
  }
  BackdropNode {
   inputs 0
   name BackdropNode3
   tile_color 0x388e8e00
   label Inverse
   note_font_size 42
   xpos -2310
   ypos 2374
   bdwidth 1715
   bdheight 953
  }
  BackdropNode {
   inputs 0
   name BackdropNode4
   tile_color 0x388e8e00
   label "jabz to xyz"
   note_font_size 42
   xpos -2260
   ypos 3390
   bdwidth 300
   bdheight 667
  }
  BackdropNode {
   inputs 0
   name BackdropNode5
   label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
   xpos -1922
   ypos 791
   bdwidth 411
   bdheight 201
  }
  Input {
   inputs 0
   name Input1
   xpos -984
   ypos -137
  }
  Dot {
   name Dot4
   label xyzc
   xpos -950
   ypos -97
  }
  Dot {
   name Dot5
   xpos -950
   ypos -21
  }
set N9214ec00 [stack 0]
  ColorMatrix {
   matrix {
       {{b} 0 {1-b}}
       {{1-g} {g} 0}
       {0 0 1}
     }
   name M_to_xyzp
   label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
   xpos -984
   ypos 30
   addUserKnob {20 User}
   addUserKnob {7 b}
   b 1.15
   addUserKnob {7 g}
   g 0.66
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   name _M_XYZP_TO_LMS
   label "# Define X',Y',Z' to L,M,S conversion matrix:"
   xpos -984
   ypos 102
  }
  Dot {
   name Dot1
   label LMS
   xpos -950
   ypos 154
  }
  Expression {
   expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
   expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
   expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
   name Expression1
   label "# response compression: lms to lms'"
   xpos -984
   ypos 199
   addUserKnob {20 _PQ_PARAMETERS}
   addUserKnob {7 c1}
   c1 {{3424/2**12}}
   addUserKnob {7 c2}
   c2 {{2413/2**7}}
   addUserKnob {7 c3}
   c3 {{2392/2**7}}
   addUserKnob {7 n}
   n {{2610/2**14}}
   addUserKnob {7 p}
   p {{1.7*2523/2**5}}
  }
  Dot {
   name Dot2
   label lmsp
   xpos -950
   ypos 260
  }
set N9214d800 [stack 0]
  ColorMatrix {
   matrix {
       {0 1 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name _M_LMSP_TO_IAB_ZCAM
   xpos -912
   ypos 329
  }
  Add {
   value -3.703522621e-11
   name Add1
   label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
   xpos -912
   ypos 353
  }
  Dot {
   name Dot6
   label Iabz
   xpos -878
   ypos 411
  }
push $N9214d800
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name _M_LMSP_TO_IAB_JABZ
   xpos -1053
   ypos 328
  }
  Dot {
   name Dot7
   label Iabz
   xpos -1019
   ypos 410
  }
  Switch {
   inputs 2
   which 1
   name use_zcam_parameters
   xpos -978
   ypos 441
  }
set N9212d600 [stack 0]
  Expression {
   expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
   name Expression2
   label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
   xpos -886
   ypos 492
  }
push $N9212d600
  Switch {
   inputs 2
   name use_zcam_parameters1
   label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
   xpos -978
   ypos 564
  }
  Dot {
   name Dot3
   label iabz
   xpos -944
   ypos 753
  }
set N920e3800 [stack 0]
  Expression {
   temp_name0 r2d
   temp_expr0 180.0/pi
   temp_name1 h360
   temp_expr1 "360.0\n"
   temp_name2 h
   temp_expr2 atan2(b,g)*r2d
   channel0 rgba
   expr0 h
   name h
   xpos -1074
   ypos 904
  }
set N920e3400 [stack 0]
  Expression {
   temp_name0 h
   temp_expr0 r
   channel0 rgba
   expr0 "1.015 + cos((h + 89.038)*pi/180)"
   name ez
   xpos -1074
   ypos 928
  }
push $N920e3800
  Copy {
   inputs 2
   from0 rgba.red
   to0 rgba.red
   name Copy1
   xpos -894
   ypos 989
  }
  Expression {
   channel0 rgba
   expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
   name M_colorfulness
   label "# calculate colorfulness, M:"
   xpos -894
   ypos 1021
  }
set N920e2800 [stack 0]
  Expression {
   channel0 rgba
   expr0 100*r/Constants.Qw
   name C
   label "# calculate chroma, C:"
   xpos -894
   ypos 1118
  }
set N920e2400 [stack 0]
push $N920e3800
  Expression {
   channel0 rgba
   expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
   name Q
   label "# calculate brightness, Q:"
   xpos -1030
   ypos 1019
  }
set N920e2000 [stack 0]
  Expression {
   channel0 rgba
   expr0 "100.0 * (r/Constants.Qw)"
   name J
   label "# calculate lightness, J:"
   xpos -1030
   ypos 1117
  }
set N920e1c00 [stack 0]
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy3
   xpos -1030
   ypos 1155
  }
set N920e1800 [stack 0]
  Expression {
   channel0 rgba
   expr0 "100 - ((100-r)**2 + g**2)**0.5"
   name Wz
   label "# calculate whiteness, W:"
   xpos -1030
   ypos 1195
  }
set N920e1400 [stack 0]
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam
   fromInput2 {{0} B}
   mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
   name Shuffle2
   xpos -1202
   ypos 1199
  }
push $N920e3400
  Dot {
   name Dot9
   label h
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1975
   ypos 2339
  }
push $N920e3800
  Shuffle2 {
   fromInput1 {{0} B}
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
   name Iz
   xpos -1127
   ypos 835
  }
push $N920e3800
  Shuffle2 {
   fromInput1 {{0} B}
   fromInput2 {{0} B}
   mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
   name az
   xpos -978
   ypos 837
  }
push $N920e3800
  Shuffle2 {
   fromInput1 {{0} B}
   fromInput2 {{0} B}
   mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
   name bz
   xpos -825
   ypos 835
  }
  NoOp {
   inputs 0
   name Constants
   xpos -527
   ypos 180
   addUserKnob {20 User}
   addUserKnob {26 _1 l _SURROUND_PARAMETERS}
   addUserKnob {4 surrounds M {average dim dark}}
   addUserKnob {7 c}
   c {{curve(surrounds) 0.69 0.59 0.525}}
   addUserKnob {7 Nc}
   Nc {{curve(surrounds) 1 0.9 0.8}}
   addUserKnob {7 F}
   F {{curve(surrounds) 1 0.9 0.8}}
   addUserKnob {7 FLL}
   FLL {{curve(surrounds) 1 1 1}}
   addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
   addUserKnob {7 La}
   La 100
   addUserKnob {7 Yb}
   Yb 20
   addUserKnob {4 surround M {avg dim dark}}
   addUserKnob {7 D}
   D 1
   addUserKnob {7 Dtype}
   addUserKnob {26 ""}
   addUserKnob {18 xyzw_d65}
   xyzw_d65 {95.043 100 108.89}
   addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {18 xyzw}
   xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
   addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {26 ""}
   addUserKnob {7 Yw}
   Yw 100
   addUserKnob {7 FL}
   FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
   addUserKnob {7 n}
   n {{Yb/Yw}}
   addUserKnob {7 Fb}
   Fb {{n**0.5}}
   addUserKnob {7 Fs}
   Fs {{c}}
   addUserKnob {26 ""}
   addUserKnob {18 xyzwc}
   xyzwc {95.043 100 108.89}
   addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {18 iabzw}
   iabzw {0.31331 -0.00014318 -8.9369e-05}
   addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {7 Qw}
   Qw 185.85
  }
push $N9214ec00
push $N920e3400
push $N920e2800
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy5
   xpos 67
   ypos 1136
  }
set N92073400 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180.0)
   name bM
   xpos 163
   ypos 1202
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_bM
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
   name Shuffle11
   xpos -752
   ypos 1400
  }
push $N92073400
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180.0)
   name aM
   xpos 67
   ypos 1203
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_aM
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
   name Shuffle10
   xpos -848
   ypos 1400
  }
push $N920e3400
push $N920e2400
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy25
   xpos -164
   ypos 1149
  }
set N92072000 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180.0)
   name bC
   xpos -76
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_bC
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
   name Shuffle25
   xpos -949
   ypos 1399
  }
push $N92072000
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180.0)
   name aC
   xpos -164
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_aC
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
   name Shuffle24
   xpos -1048
   ypos 1397
  }
push $N920e3400
push $N920e2000
push $N920e2800
  Copy {
   inputs 2
   from1 rgba.green
   to1 rgba.green
   name Copy2
   xpos -734
   ypos 1076
  }
  Expression {
   channel0 rgba
   expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
   name s
   label "# calculate saturation, s:"
   xpos -734
   ypos 1118
  }
set N92070800 [stack 0]
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy24
   xpos -381
   ypos 1143
  }
set N92070400 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180.0)
   name bS
   xpos -287
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_bS
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
   name Shuffle23
   xpos -1150
   ypos 1398
  }
push $N92070400
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180.0)
   name aS
   xpos -381
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_aS
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
   name Shuffle22
   xpos -1254
   ypos 1395
  }
push $N920e1800
  Expression {
   channel0 rgba
   expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
   name Vz
   label "# calculate vividness, V:"
   xpos -583
   ypos 1200
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Vz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
   name Shuffle9
   xpos -1345
   ypos 1396
  }
push $N92070800
  Expression {
   channel0 rgba
   name Sz
   label "# calculate saturation, S:"
   xpos -734
   ypos 1196
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Sz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
   name Shuffle8
   xpos -1436
   ypos 1395
  }
push $N920e1800
  Expression {
   channel0 rgba
   expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
   name Kz
   label "# calculate blackness, K:"
   xpos -895
   ypos 1195
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Kz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
   name Shuffle7
   xpos -1524
   ypos 1393
  }
push $N920e1400
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Wz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
   name Shuffle6
   xpos -1613
   ypos 1393
  }
push $N92070800
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_s
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
   name Shuffle5
   xpos -1708
   ypos 1392
  }
push $N920e2400
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_C
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
   name Shuffle4
   xpos -1798
   ypos 1391
  }
push $N920e1c00
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_J
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
   name Shuffle1
   xpos -1900
   ypos 1390
  }
push $N920e2800
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_M
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
   name Shuffle12
   xpos -1999
   ypos 1389
  }
push $N920e2000
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Q
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
   name Shuffle3
   xpos -2089
   ypos 1391
  }
push $N920e3400
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_h
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
   name Shuffle13
   xpos -2182
   ypos 1392
  }
push $N9214ec00
  Dot {
   name Dot16
   xpos -2265
   ypos 1253
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_h
   name Copy21
   xpos -2299
   ypos 1416
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Q
   name Copy22
   xpos -2299
   ypos 1458
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_M
   name Copy20
   xpos -2298
   ypos 1505
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_J
   name Copy11
   xpos -2298
   ypos 1547
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_C
   name Copy12
   xpos -2298
   ypos 1589
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_s
   name Copy13
   xpos -2302
   ypos 1631
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Wz
   name Copy14
   xpos -2302
   ypos 1673
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Kz
   name Copy15
   xpos -2302
   ypos 1715
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Sz
   name Copy16
   xpos -2302
   ypos 1757
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Vz
   name Copy17
   xpos -2302
   ypos 1799
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_aS
   name Copy26
   xpos -2302
   ypos 1841
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_bS
   name Copy27
   xpos -2302
   ypos 1883
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_aC
   name Copy28
   xpos -2302
   ypos 1925
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_bC
   name Copy29
   xpos -2302
   ypos 1963
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_aM
   name Copy18
   xpos -2302
   ypos 2005
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_bM
   name Copy19
   xpos -2302
   ypos 2047
  }
  Switch {
   inputs 2
   which {{parent.direction}}
   name direction1
   xpos -2302
   ypos 2112
  }
  Dot {
   name Dot17
   xpos -2268
   ypos 2157
  }
set N91f22c00 [stack 0]
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_h
   fromInput2 {{0} B}
   mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
   name Shuffle20
   xpos -1041
   ypos 2260
  }
  Dot {
   name Dot41
   label h
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1007
   ypos 2349
  }
  Dot {
   name Dot33
   label "h in outIn"
   xpos -1007
   ypos 2613
  }
set N91f22000 [stack 0]
  Dot {
   name Dot34
   xpos -1007
   ypos 2652
  }
push $N91f22000
  Dot {
   name Dot35
   xpos -1034
   ypos 2640
  }
push $N91f22c00
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_bS
   fromInput2 {{0} B}
   in2 zcam_aS
   mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
   name Shuffle16
   label "aS & bS"
   note_font_size 15
   xpos -1489
   ypos 2304
  }
push $N91f22c00
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_bC
   fromInput2 {{0} B}
   in2 zcam_aC
   mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
   name Shuffle17
   label "aC & bC"
   note_font_size 15
   xpos -1585
   ypos 2304
  }
push $N91f22c00
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_bM
   fromInput2 {{0} B}
   in2 zcam_aM
   mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
   name Shuffle26
   label "aM & bM"
   note_font_size 15
   xpos -1682
   ypos 2303
  }
  Switch {
   inputs 3
   which {{parent.inverseData1}}
   name inputdata_abX_mode
   xpos -1543
   ypos 2400
  }
  Dot {
   name Dot30
   xpos -1509
   ypos 2449
  }
set N91f20800 [stack 0]
  Dot {
   name Dot29
   xpos -1210
   ypos 2483
  }
  Expression {
   temp_name0 r2d
   temp_expr0 180.0/pi
   temp_name1 h360
   temp_expr1 "360.0\n"
   temp_name2 h
   temp_expr2 atan2(g,r)*r2d
   channel0 rgba
   expr0 h
   name inv_h
   label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
   xpos -1244
   ypos 2546
  }
  Dot {
   name Dot36
   label "a in outIn"
   xpos -1210
   ypos 2619
  }
set N91ecb800 [stack 0]
  Dot {
   name Dot37
   xpos -1163
   ypos 2636
  }
push $N91ecb800
  Dot {
   name Dot38
   xpos -1185
   ypos 2648
  }
push $N91ecb800
  Dot {
   name Dot39
   xpos -1210
   ypos 2663
  }
  Switch {
   inputs 5
   which {{parent.inverseData1}}
   name inverseData1_Mode1
   label MCs
   xpos -1116
   ypos 2672
  }
  Dot {
   name Dot40
   xpos -1210
   ypos 2719
  }
set N91eca800 [stack 0]
push $N91eca800
  Expression {
   channel0 rgba
   expr0 "1.015 + cos((r + 89.038)*pi/180)"
   name inv_ez
   xpos -1244
   ypos 2756
  }
push $N91f22c00
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_C
   fromInput2 {{0} B}
   mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
   name Shuffle21
   xpos -1357
   ypos 2252
  }
  Dot {
   name Dot42
   label C
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1323
   ypos 2341
  }
  Expression {
   channel0 rgba
   expr0 r
   name MCs2
   label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
   xpos -1357
   ypos 2501
  }
  Dot {
   name Dot43
   label "h in outIn"
   xpos -1323
   ypos 2578
  }
push $N91f22c00
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_M
   fromInput2 {{0} B}
   mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
   name Shuffle19
   xpos -1442
   ypos 2252
  }
  Dot {
   name Dot31
   label M
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1408
   ypos 2341
  }
  Expression {
   channel0 rgba
   expr0 r
   name MCs1
   label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
   xpos -1442
   ypos 2501
  }
  Dot {
   name Dot25
   label "h in outIn"
   xpos -1408
   ypos 2575
  }
push $N91f20800
  Expression {
   channel0 rgba
   expr0 "(r**2.0 + g**2.0)**0.5"
   name MCs
   label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
   xpos -1645
   ypos 2460
  }
  Dot {
   name Dot24
   label "a in outIn"
   xpos -1611
   ypos 2581
  }
set N91e77800 [stack 0]
  Dot {
   name Dot28
   xpos -1564
   ypos 2598
  }
push $N91e77800
  Dot {
   name Dot27
   xpos -1586
   ypos 2610
  }
push $N91e77800
  Dot {
   name Dot26
   xpos -1611
   ypos 2625
  }
  Switch {
   inputs 5
   which {{parent.inverseData1}}
   name inverseData1_Mode
   label MCs
   xpos -1517
   ypos 2634
  }
set N92061600 [stack 0]
  Expression {
   channel0 rgba
   expr0 r
   name C_from_aC
   label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
   xpos -1926
   ypos 2714
  }
set N91e76800 [stack 0]
  Dot {
   name Dot44
   label C,h
   xpos -1673
   ypos 2768
  }
push $N92061600
  Expression {
   channel0 rgba
   expr0 100*r/Constants.Qw
   name C_from_aM
   label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
   xpos -2036
   ypos 2713
  }
set N91e76000 [stack 0]
  Dot {
   name Dot20
   label M,h
   xpos -1737
   ypos 2767
  }
push $N92061600
push $N91f22c00
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_Q
   fromInput2 {{0} B}
   mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
   name Shuffle18
   xpos -2182
   ypos 2257
  }
  Dot {
   name Dot21
   label Q
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1996
   ypos 2435
  }
set N91e75400 [stack 0]
push $N91f22c00
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_J
   fromInput2 {{0} B}
   mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
   name Shuffle14
   xpos -2302
   ypos 2259
  }
  Dot {
   name Dot8
   label J
   note_font_size 20
   note_font_color 0x677754ff
   xpos -2229
   ypos 2434
  }
  Dot {
   name Dot22
   xpos -2229
   ypos 2456
  }
set N91e74800 [stack 0]
  Expression {
   channel0 rgba
   expr0 Constants.Qw*(r/100)
   name Q_from_J
   label "# Get Lightness J and brightness Q from data:"
   xpos -2263
   ypos 2519
  }
  Switch {
   inputs 2
   which {{parent.inverseData0}}
   name InverseData0_Mode
   label Q
   xpos -2263
   ypos 2564
  }
set N92060f00 [stack 0]
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy30
   xpos -1818
   ypos 2676
  }
  Expression {
   temp_name0 M
   temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
   channel0 rgba
   expr0 100*M/Constants.Qw
   name C_from_aS
   label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
   xpos -1818
   ypos 2708
  }
push $N91e76800
push $N91e76000
  Switch {
   inputs 5
   which {{parent.inverseData1}}
   name inputdata_abX_mode1
   xpos -1926
   ypos 2799
  }
  Expression {
   channel0 rgba
   expr0 "Constants.Qw * r / 100"
   name inv_M
   label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
   xpos -1543
   ypos 2822
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy7
   xpos -1543
   ypos 2874
  }
  Expression {
   channel0 rgba
   expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
   name inv_t
   label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
   xpos -1543
   ypos 2906
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy8
   xpos -1543
   ypos 2986
  }
set N91e32800 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180)
   name inv_bz
   label t*np.sin(h*np.pi/180)
   xpos -1402
   ypos 3067
  }
push $N91e32800
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180)
   name inv_az
   label "az = t*np.cos(h*np.pi/180)"
   xpos -1543
   ypos 3064
  }
push $N92060f00
  Expression {
   channel0 rgba
   expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
   name inv_Iz
   label "# calculate achromatic signal, Iz:"
   xpos -2263
   ypos 2619
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy9
   xpos -2181
   ypos 3184
  }
  Copy {
   inputs 2
   from0 rgba.blue
   to0 rgba.blue
   name Copy10
   xpos -2181
   ypos 3216
  }
  Dot {
   name Dot15
   label iabz
   note_font_size 20
   xpos -2147
   ypos 3275
  }
  Dot {
   name Dot13
   xpos -2145
   ypos 3414
  }
  Dot {
   name Dot14
   xpos -2145
   ypos 3470
  }
set N91e30800 [stack 0]
  Expression {
   expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
   name Expression3
   label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
   xpos -2050
   ypos 3532
  }
push $N91e30800
  Switch {
   inputs 2
   name use_zcam_parameters2
   label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
   xpos -2179
   ypos 3608
  }
set N92060100 [stack 0]
  Dot {
   name Dot19
   label Iabz
   xpos -2092
   ypos 3678
  }
  Add {
   value 3.703522621e-11
   name Add2
   label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
   xpos -2126
   ypos 3712
  }
  ColorMatrix {
   matrix {
       {0 1 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   invert true
   name _M_LMSP_TO_IAB_ZCAM1
   xpos -2126
   ypos 3750
  }
push $N92060100
  Dot {
   name Dot18
   label Iabz
   xpos -2216
   ypos 3683
  }
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   invert true
   name _M_LMSP_TO_IAB_JABZ1
   xpos -2250
   ypos 3748
  }
  Switch {
   inputs 2
   which 1
   name use_zcam_parameters3
   xpos -2182
   ypos 3844
  }
  Expression {
   expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
   expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
   expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
   name Expression4
   label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
   xpos -2182
   ypos 3874
   addUserKnob {20 _PQ_PARAMETERS}
   addUserKnob {7 c1}
   c1 {{3424/2**12}}
   addUserKnob {7 c2}
   c2 {{2413/2**7}}
   addUserKnob {7 c3}
   c3 {{2392/2**7}}
   addUserKnob {7 n}
   n {{2610/2**14}}
   addUserKnob {7 p}
   p {{1.7*2523/2**5}}
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   invert true
   name _M_XYZP_TO_LMS1
   label "# Define X',Y',Z' to L,M,S conversion matrix:"
   xpos -2182
   ypos 3949
  }
  ColorMatrix {
   matrix {
       {{b} 0 {1-b}}
       {{1-g} {g} 0}
       {0 0 1}
     }
   invert true
   name M_to_xyzp1
   label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
   xpos -2182
   ypos 3981
   addUserKnob {20 User}
   addUserKnob {7 b}
   b 1.15
   addUserKnob {7 g}
   g 0.66
  }
push $N91f22c00
  Switch {
   inputs 2
   which {{parent.direction}}
   name direction
   xpos -1519
   ypos 4172
  }
  Output {
   name Output1
   xpos -1519
   ypos 4272
  }
push $N91f22c00
  Dot {
   name Dot11
   label aM
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1535
   ypos 2170
  }
push $N91f22c00
  Dot {
   name Dot12
   label bM
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1439
   ypos 2173
  }
push $N92060f00
push $N91f22c00
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_Sz
   fromInput2 {{0} B}
   mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
   name Shuffle15
   xpos -1870
   ypos 2254
  }
  Dot {
   name Dot10
   label Sz
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1836
   ypos 2342
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy4
   xpos -1770
   ypos 2555
  }
  Expression {
   expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
   name inv_C
   label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
   xpos -1770
   ypos 2587
  }
push $N91f20800
  Dot {
   name Dot23
   label "H in outIn"
   xpos -1509
   ypos 2582
  }
  Dot {
   inputs 0
   name Dot32
   label "H in outIn"
   xpos -1108
   ypos 2620
  }
push $N91e75400
  Expression {
   channel0 rgba
   expr0 "100.0* (r/Constants.Qw)"
   name J_from_Q
   xpos -2030
   ypos 2479
  }
push $N91e74800
  Switch {
   inputs 2
   which {{parent.inverseData0}}
   name InverseData0_Mode1
   label J
   xpos -2030
   ypos 2527
  }
push $N92061600
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy23
   xpos -1596
   ypos 2681
  }
  Expression {
   channel0 rgba
   expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
   name inv3_C
   label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
   xpos -1596
   ypos 2713
  }
  Constant {
   inputs 0
   channels rgb
   color 0.034705
   name Constant1
   xpos -440
   ypos 2450
  }
 end_group
 Multiply {
  value 0.01
  name Multiply13
  label "Div by 100 to go from nits"
  xpos 1354
  ypos 715
 }
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.blue 0 2 white -1 -1 rgba.alpha 0 3"
  name Shuffle36
  xpos 1354
  ypos 757
 }
 Colorspace {
  colorspace_in CIE-XYZ
  name Colorspace25
  label "XYZ to sRGB Prims"
  xpos 1354
  ypos 781
 }
 Output {
  name Output1
  xpos 1354
  ypos 888
 }
push $N919c1000
 Expression {
  temp_name0 limit
  temp_expr0 a(((b/360+.5)*width),(r/100*height))
  temp_name1 scaledVal
  temp_expr1 g/limit
  temp_name2 scale
  temp_expr2 1-thr
  expr2 "(scaledVal>thr? ( ((scaledVal-thr)/scale) / (((scaledVal-thr)/scale)+1) * scale + thr  )   : scaledVal ) * limit"
  channel3 alpha
  expr3 limit
  name clipToLimit3
  xpos 981
  ypos 546
  addUserKnob {20 User}
  addUserKnob {7 limitScale R 0 100}
  limitScale 100
  addUserKnob {7 thr}
  thr 0.9
 }
push $N4d214800
push $N4d214400
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy1
  xpos 1344
  ypos 348
  disable true
 }
set N94cb7c00 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle51
  xpos 1588
  ypos 227
 }
 Multiply {
  value {{1/parent.Multiply19.value}}
  name Multiply20
  label "Div by 100 to go from nits"
  xpos 1588
  ypos 251
 }
 ColorLookup {
  channels all
  lut {master {curve x0.02407439426 0 x0.04948588461 5.620706361e-06 x0.0808724314 5.995634638e-05 x0.1089436561 0.0002520732232 x0.1538826674 0.0009655252215 x0.1705526412 0.001552375033 x0.1965807676 0.003411091166 x0.2212548852 0.005432802252 x0.2435974032 0.008078291081 x0.2744711637 0.01258628722 x0.335355252 0.02872310206 x0.3656598926 0.0391706787 x0.4067366123 0.05722413212 x0.451582104 0.08477441967 x0.5436673164 0.1626682729 x0.6915633678 0.3178558648 x0.7352961302 0.3736175299 x0.8164004087 0.4692641795 x0.8752408028 0.5275940299 x0.9309006333 0.5828329325 x0.9754681587 0.6187173724 x1.033632636 0.6637632847 x1.16960156 0.745464921 x1.235319972 0.7762671709 x1.356181145 0.8217196465 x1.508617401 0.8695153594 x1.637787938 0.8979744911 x1.822932601 0.9321763515 x1.905457973 0.9441890717 x2.068963289 0.9626951218 x2.316649675 0.9837986231 x2.455148697 0.9925647378 x2.621634722 1}
    red {}
    green {}
    blue {}
    alpha {}}
  name ColorLookup1
  xpos 1588
  ypos 293
 }
 Gamma {
  value 2.2
  name Gamma2
  xpos 1588
  ypos 325
 }
 Multiply {
  value {{parent.Multiply19.value}}
  name Multiply21
  label "Mult by 100 to put in absolute nits"
  xpos 1588
  ypos 357
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle52
  xpos 1588
  ypos 399
 }
push $N94cb7c00
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy10
  xpos 1344
  ypos 390
 }
end_group
set N8990e400 [stack 0]
PositionToPoints2 {
 display textured
 render_mode textured
 P_channel rgb
 name PositionToPoints7
 xpos 2462
 ypos 2096
}
Scene {
 inputs 2
 name Scene2
 xpos 2538
 ypos 2141
}
Read {
 inputs 0
 file_type exr
 file "/Volumes/GoogleDrive/My Drive/Output Transform Image Submissions/original/jed-smith/jedsmith_colorchecker24_streaks_flat.aces.exr"
 format "1152 576 0 0 1152 576 1 "
 origset true
 name Read62
 xpos 2797
 ypos 1939
}
Reformat {
 inputs 0
 type "to box"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 box_width 1920
 box_height 154
 box_fixed true
 name Reformat13
 xpos 2934
 ypos 1667
}
Ramp {
 p0 {0 0}
 p1 {{width} 0}
 name Ramp3
 xpos 2934
 ypos 1709
}
set N76bcd800 [stack 0]
Grade {
 multiply {0 0 1 1}
 multiply_panelDropped true
 name Grade3
 xpos 3450
 ypos 1817
}
set N76d1b000 [stack 0]
OCIOColorSpace {
 in_colorspace "ACES - ACEScg"
 out_colorspace "ACES - ACES2065-1"
 name OCIOColorSpace3
 xpos 3557
 ypos 1839
}
Colorspace {
 illuminant_in ACES
 primary_in ACES
 primary_out ACES
 name Colorspace33
 xpos 3557
 ypos 1863
}
Text {
 message "AP1\n0:0:1"
 font "/Library/Fonts/Arial Unicode.ttf"
 size 40
 xjustify center
 yjustify center
 box {56 466 216 610}
 center {1024 778}
 color 0
 name Text11
 xpos 3557
 ypos 1891
 disable true
}
push $N76d1b000
Colorspace {
 primary_out ACES
 name Colorspace25
 xpos 3450
 ypos 1841
}
Text {
 message "709\n0:0:1"
 font "/Library/Fonts/Arial Unicode.ttf"
 size 40
 xjustify center
 yjustify center
 box {56 466 216 610}
 center {1024 778}
 color 0
 name Text12
 xpos 3450
 ypos 1893
 disable true
}
push $N76bcd800
Grade {
 multiply {0 1 0 1}
 multiply_panelDropped true
 name Grade8
 xpos 3240
 ypos 1821
}
set N76d19400 [stack 0]
OCIOColorSpace {
 in_colorspace "ACES - ACEScg"
 out_colorspace "ACES - ACES2065-1"
 name OCIOColorSpace5
 xpos 3344
 ypos 1837
}
Colorspace {
 illuminant_in ACES
 primary_in ACES
 primary_out ACES
 name Colorspace34
 xpos 3344
 ypos 1861
}
Text {
 message "AP1\n0:1:0"
 font "/Library/Fonts/Arial Unicode.ttf"
 size 40
 xjustify center
 yjustify center
 box {56 466 216 610}
 center {1024 778}
 color 0
 name Text13
 xpos 3344
 ypos 1897
 disable true
}
push $N76d19400
Colorspace {
 primary_out ACES
 name Colorspace29
 xpos 3240
 ypos 1845
}
Text {
 message "709\n0:1:0"
 font "/Library/Fonts/Arial Unicode.ttf"
 size 40
 xjustify center
 yjustify center
 box {56 466 216 610}
 center {1024 778}
 color 0
 name Text14
 xpos 3240
 ypos 1897
 disable true
}
push $N76bcd800
Grade {
 multiply {1 0 0 1}
 multiply_panelDropped true
 name Grade10
 xpos 3023
 ypos 1823
}
set N76cab400 [stack 0]
OCIOColorSpace {
 in_colorspace "ACES - ACEScg"
 out_colorspace "ACES - ACES2065-1"
 name OCIOColorSpace6
 xpos 3131
 ypos 1845
}
Colorspace {
 illuminant_in ACES
 primary_in ACES
 primary_out ACES
 name Colorspace32
 xpos 3131
 ypos 1869
}
Text {
 message "AP1\n1:0:0"
 font "/Library/Fonts/Arial Unicode.ttf"
 size 40
 xjustify center
 yjustify center
 box {56 466 216 610}
 center {1024 778}
 color 0
 name Text15
 xpos 3131
 ypos 1897
 disable true
}
push $N76cab400
Colorspace {
 primary_out ACES
 name Colorspace30
 xpos 3023
 ypos 1847
}
Text {
 message "709\n1:0:0"
 font "/Library/Fonts/Arial Unicode.ttf"
 size 40
 xjustify center
 yjustify center
 box {56 466 216 610}
 center {1024 778}
 color 0
 name Text16
 xpos 3023
 ypos 1899
 disable true
}
push $N76bcd800
Text {
 message 1:1:1
 font "/Library/Fonts/Arial Unicode.ttf"
 size 40
 xjustify center
 yjustify center
 box {56 466 216 610}
 center {1024 778}
 color 0
 name Text17
 xpos 2934
 ypos 1873
}
ContactSheet {
 inputs 7
 width {{input.width*columns}}
 height {{input.height*rows}}
 rows 7
 columns 1
 roworder TopBottom
 name ContactSheet7
 xpos 2934
 ypos 1969
}
FrameHold {
 firstFrame 5
 name FrameHold2
 xpos 2938
 ypos 2065
}
set N76c84f00 [stack 0]
Group {
 name ZCAMishDRT2
 xpos 2797
 ypos 2088
 addUserKnob {20 User}
 addUserKnob {26 In}
 addUserKnob {41 illuminant_in l "" -STARTLINE T Colorspace30.illuminant_in}
 addUserKnob {41 primary_in l "" -STARTLINE T Colorspace30.primary_in}
 addUserKnob {26 Out}
 addUserKnob {41 colorspace_out l out T Colorspace25.colorspace_out}
 addUserKnob {41 illuminant_out l "" -STARTLINE T Colorspace25.illuminant_out}
 addUserKnob {41 primary_out l "" -STARTLINE T Colorspace25.primary_out}
}
 Read {
  inputs 0
  file_type exr
  file /Users/afry/GitHub/nukeZCAM/images/gamutBounds/JMh_sRGBgamutBound_tempImg.exr
  format "1024 1024 0 0 1024 1024 1 square_1K"
  origset true
  version 2072
  name Read1
  xpos 829
  ypos 237
 }
 Colorspace {
  colorspace_out CIE-XYZ
  name Colorspace29
  xpos 829
  ypos 317
 }
 Multiply {
  value 100
  name Multiply18
  label "Mult by 100 to put in absolute nits"
  xpos 829
  ypos 341
 }
 Group {
  name ZCAM15
  label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
  xpos 829
  ypos 383
  addUserKnob {20 ZCAM}
  addUserKnob {4 direction M {forward inverse}}
  addUserKnob {26 ""}
  addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
  addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
  addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
  inverseData1 M,h
  addUserKnob {26 ""}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {41 surrounds T Constants.surrounds}
  addUserKnob {41 c T Constants.c}
  addUserKnob {41 Nc T Constants.Nc}
  addUserKnob {41 F T Constants.F}
  addUserKnob {41 FLL T Constants.FLL}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {41 La T Constants.La}
  addUserKnob {41 Yb T Constants.Yb}
  addUserKnob {41 surround T Constants.surround}
  addUserKnob {41 D T Constants.D}
  addUserKnob {41 Dtype T Constants.Dtype}
  addUserKnob {26 ""}
  addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
  addUserKnob {41 xyzw T Constants.xyzw}
  addUserKnob {26 ""}
  addUserKnob {41 Yw T Constants.Yw}
  addUserKnob {41 FL T Constants.FL}
  addUserKnob {41 n T Constants.n}
  addUserKnob {41 Fb T Constants.Fb}
  addUserKnob {41 Fs T Constants.Fs}
  addUserKnob {26 ""}
  addUserKnob {41 xyzwc T Constants.xyzwc}
  addUserKnob {41 iabzw T Constants.iabzw}
  addUserKnob {41 Qw T Constants.Qw}
 }
  BackdropNode {
   inputs 0
   name BackdropNode1
   tile_color 0x71c67100
   label xyz_to_jabz
   note_font_size 42
   xpos -1063
   ypos -50
   bdwidth 255
   bdheight 678
  }
  BackdropNode {
   inputs 0
   name BackdropNode2
   tile_color 0x388e8e00
   label Forward
   note_font_size 42
   xpos -1278
   ypos 673
   bdwidth 1634
   bdheight 582
  }
  BackdropNode {
   inputs 0
   name BackdropNode3
   tile_color 0x388e8e00
   label Inverse
   note_font_size 42
   xpos -2310
   ypos 2374
   bdwidth 1715
   bdheight 953
  }
  BackdropNode {
   inputs 0
   name BackdropNode4
   tile_color 0x388e8e00
   label "jabz to xyz"
   note_font_size 42
   xpos -2260
   ypos 3390
   bdwidth 300
   bdheight 667
  }
  BackdropNode {
   inputs 0
   name BackdropNode5
   label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
   xpos -1922
   ypos 791
   bdwidth 411
   bdheight 201
  }
  Input {
   inputs 0
   name Input1
   xpos -984
   ypos -137
  }
  Dot {
   name Dot4
   label xyzc
   xpos -950
   ypos -97
  }
  Dot {
   name Dot5
   xpos -950
   ypos -21
  }
set N94cb4800 [stack 0]
  ColorMatrix {
   matrix {
       {{b} 0 {1-b}}
       {{1-g} {g} 0}
       {0 0 1}
     }
   name M_to_xyzp
   label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
   xpos -984
   ypos 30
   addUserKnob {20 User}
   addUserKnob {7 b}
   b 1.15
   addUserKnob {7 g}
   g 0.66
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   name _M_XYZP_TO_LMS
   label "# Define X',Y',Z' to L,M,S conversion matrix:"
   xpos -984
   ypos 102
  }
  Dot {
   name Dot1
   label LMS
   xpos -950
   ypos 154
  }
  Expression {
   expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
   expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
   expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
   name Expression1
   label "# response compression: lms to lms'"
   xpos -984
   ypos 199
   addUserKnob {20 _PQ_PARAMETERS}
   addUserKnob {7 c1}
   c1 {{3424/2**12}}
   addUserKnob {7 c2}
   c2 {{2413/2**7}}
   addUserKnob {7 c3}
   c3 {{2392/2**7}}
   addUserKnob {7 n}
   n {{2610/2**14}}
   addUserKnob {7 p}
   p {{1.7*2523/2**5}}
  }
  Dot {
   name Dot2
   label lmsp
   xpos -950
   ypos 260
  }
set N68267000 [stack 0]
  ColorMatrix {
   matrix {
       {0 1 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name _M_LMSP_TO_IAB_ZCAM
   xpos -912
   ypos 329
  }
  Add {
   value -3.703522621e-11
   name Add1
   label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
   xpos -912
   ypos 353
  }
  Dot {
   name Dot6
   label Iabz
   xpos -878
   ypos 411
  }
push $N68267000
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name _M_LMSP_TO_IAB_JABZ
   xpos -1053
   ypos 328
  }
  Dot {
   name Dot7
   label Iabz
   xpos -1019
   ypos 410
  }
  Switch {
   inputs 2
   which 1
   name use_zcam_parameters
   xpos -978
   ypos 441
  }
set N68294800 [stack 0]
  Expression {
   expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
   name Expression2
   label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
   xpos -886
   ypos 492
  }
push $N68294800
  Switch {
   inputs 2
   name use_zcam_parameters1
   label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
   xpos -978
   ypos 564
  }
  Dot {
   name Dot3
   label iabz
   xpos -944
   ypos 753
  }
set N68265400 [stack 0]
  Expression {
   temp_name0 r2d
   temp_expr0 180.0/pi
   temp_name1 h360
   temp_expr1 "360.0\n"
   temp_name2 h
   temp_expr2 atan2(b,g)*r2d
   channel0 rgba
   expr0 h
   name h
   xpos -1074
   ypos 904
  }
set N68265000 [stack 0]
  Expression {
   temp_name0 h
   temp_expr0 r
   channel0 rgba
   expr0 "1.015 + cos((h + 89.038)*pi/180)"
   name ez
   xpos -1074
   ypos 928
  }
push $N68265400
  Copy {
   inputs 2
   from0 rgba.red
   to0 rgba.red
   name Copy1
   xpos -894
   ypos 989
  }
  Expression {
   channel0 rgba
   expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
   name M_colorfulness
   label "# calculate colorfulness, M:"
   xpos -894
   ypos 1021
  }
set N68264400 [stack 0]
  Expression {
   channel0 rgba
   expr0 100*r/Constants.Qw
   name C
   label "# calculate chroma, C:"
   xpos -894
   ypos 1118
  }
set N68203c00 [stack 0]
push $N68265400
  Expression {
   channel0 rgba
   expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
   name Q
   label "# calculate brightness, Q:"
   xpos -1030
   ypos 1019
  }
set N68203800 [stack 0]
  Expression {
   channel0 rgba
   expr0 "100.0 * (r/Constants.Qw)"
   name J
   label "# calculate lightness, J:"
   xpos -1030
   ypos 1117
  }
set N68203400 [stack 0]
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy3
   xpos -1030
   ypos 1155
  }
set N68203000 [stack 0]
  Expression {
   channel0 rgba
   expr0 "100 - ((100-r)**2 + g**2)**0.5"
   name Wz
   label "# calculate whiteness, W:"
   xpos -1030
   ypos 1195
  }
set N68202c00 [stack 0]
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam
   fromInput2 {{0} B}
   mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
   name Shuffle2
   xpos -1202
   ypos 1199
  }
push $N68265000
  Dot {
   name Dot9
   label h
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1975
   ypos 2339
  }
push $N68265400
  Shuffle2 {
   fromInput1 {{0} B}
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
   name Iz
   xpos -1127
   ypos 835
  }
push $N68265400
  Shuffle2 {
   fromInput1 {{0} B}
   fromInput2 {{0} B}
   mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
   name az
   xpos -978
   ypos 837
  }
push $N68265400
  Shuffle2 {
   fromInput1 {{0} B}
   fromInput2 {{0} B}
   mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
   name bz
   xpos -825
   ypos 835
  }
  NoOp {
   inputs 0
   name Constants
   xpos -527
   ypos 180
   addUserKnob {20 User}
   addUserKnob {26 _1 l _SURROUND_PARAMETERS}
   addUserKnob {4 surrounds M {average dim dark}}
   addUserKnob {7 c}
   c {{curve(surrounds) 0.69 0.59 0.525}}
   addUserKnob {7 Nc}
   Nc {{curve(surrounds) 1 0.9 0.8}}
   addUserKnob {7 F}
   F {{curve(surrounds) 1 0.9 0.8}}
   addUserKnob {7 FLL}
   FLL {{curve(surrounds) 1 1 1}}
   addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
   addUserKnob {7 La}
   La 100
   addUserKnob {7 Yb}
   Yb 20
   addUserKnob {4 surround M {avg dim dark}}
   addUserKnob {7 D}
   D 1
   addUserKnob {7 Dtype}
   addUserKnob {26 ""}
   addUserKnob {18 xyzw_d65}
   xyzw_d65 {95.043 100 108.89}
   addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {18 xyzw}
   xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
   addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {26 ""}
   addUserKnob {7 Yw}
   Yw 100
   addUserKnob {7 FL}
   FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
   addUserKnob {7 n}
   n {{Yb/Yw}}
   addUserKnob {7 Fb}
   Fb {{n**0.5}}
   addUserKnob {7 Fs}
   Fs {{c}}
   addUserKnob {26 ""}
   addUserKnob {18 xyzwc}
   xyzwc {95.043 100 108.89}
   addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {18 iabzw}
   iabzw {0.31331 -0.00014318 -8.9369e-05}
   addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {7 Qw}
   Qw 185.85
  }
push $N94cb4800
push $N68265000
push $N68264400
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy5
   xpos 67
   ypos 1136
  }
set N68201000 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180.0)
   name bM
   xpos 163
   ypos 1202
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_bM
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
   name Shuffle11
   xpos -752
   ypos 1400
  }
push $N68201000
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180.0)
   name aM
   xpos 67
   ypos 1203
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_aM
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
   name Shuffle10
   xpos -848
   ypos 1400
  }
push $N68265000
push $N68203c00
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy25
   xpos -164
   ypos 1149
  }
set N6818f800 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180.0)
   name bC
   xpos -76
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_bC
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
   name Shuffle25
   xpos -949
   ypos 1399
  }
push $N6818f800
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180.0)
   name aC
   xpos -164
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_aC
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
   name Shuffle24
   xpos -1048
   ypos 1397
  }
push $N68265000
push $N68203800
push $N68264400
  Copy {
   inputs 2
   from1 rgba.green
   to1 rgba.green
   name Copy2
   xpos -734
   ypos 1076
  }
  Expression {
   channel0 rgba
   expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
   name s
   label "# calculate saturation, s:"
   xpos -734
   ypos 1118
  }
set N6818e000 [stack 0]
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy24
   xpos -381
   ypos 1143
  }
set N6818dc00 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180.0)
   name bS
   xpos -287
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_bS
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
   name Shuffle23
   xpos -1150
   ypos 1398
  }
push $N6818dc00
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180.0)
   name aS
   xpos -381
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_aS
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
   name Shuffle22
   xpos -1254
   ypos 1395
  }
push $N68203000
  Expression {
   channel0 rgba
   expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
   name Vz
   label "# calculate vividness, V:"
   xpos -583
   ypos 1200
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Vz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
   name Shuffle9
   xpos -1345
   ypos 1396
  }
push $N6818e000
  Expression {
   channel0 rgba
   name Sz
   label "# calculate saturation, S:"
   xpos -734
   ypos 1196
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Sz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
   name Shuffle8
   xpos -1436
   ypos 1395
  }
push $N68203000
  Expression {
   channel0 rgba
   expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
   name Kz
   label "# calculate blackness, K:"
   xpos -895
   ypos 1195
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Kz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
   name Shuffle7
   xpos -1524
   ypos 1393
  }
push $N68202c00
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Wz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
   name Shuffle6
   xpos -1613
   ypos 1393
  }
push $N6818e000
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_s
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
   name Shuffle5
   xpos -1708
   ypos 1392
  }
push $N68203c00
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_C
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
   name Shuffle4
   xpos -1798
   ypos 1391
  }
push $N68203400
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_J
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
   name Shuffle1
   xpos -1900
   ypos 1390
  }
push $N68264400
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_M
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
   name Shuffle12
   xpos -1999
   ypos 1389
  }
push $N68203800
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Q
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
   name Shuffle3
   xpos -2089
   ypos 1391
  }
push $N68265000
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_h
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
   name Shuffle13
   xpos -2182
   ypos 1392
  }
push $N94cb4800
  Dot {
   name Dot16
   xpos -2265
   ypos 1253
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_h
   name Copy21
   xpos -2299
   ypos 1416
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Q
   name Copy22
   xpos -2299
   ypos 1458
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_M
   name Copy20
   xpos -2298
   ypos 1505
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_J
   name Copy11
   xpos -2298
   ypos 1547
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_C
   name Copy12
   xpos -2298
   ypos 1589
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_s
   name Copy13
   xpos -2302
   ypos 1631
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Wz
   name Copy14
   xpos -2302
   ypos 1673
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Kz
   name Copy15
   xpos -2302
   ypos 1715
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Sz
   name Copy16
   xpos -2302
   ypos 1757
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Vz
   name Copy17
   xpos -2302
   ypos 1799
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_aS
   name Copy26
   xpos -2302
   ypos 1841
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_bS
   name Copy27
   xpos -2302
   ypos 1883
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_aC
   name Copy28
   xpos -2302
   ypos 1925
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_bC
   name Copy29
   xpos -2302
   ypos 1963
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_aM
   name Copy18
   xpos -2302
   ypos 2005
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_bM
   name Copy19
   xpos -2302
   ypos 2047
  }
  Switch {
   inputs 2
   which {{parent.direction}}
   name direction1
   xpos -2302
   ypos 2112
  }
  Dot {
   name Dot17
   xpos -2268
   ypos 2157
  }
set N680bc800 [stack 0]
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_h
   fromInput2 {{0} B}
   mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
   name Shuffle20
   xpos -1041
   ypos 2260
  }
  Dot {
   name Dot41
   label h
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1007
   ypos 2349
  }
  Dot {
   name Dot33
   label "h in outIn"
   xpos -1007
   ypos 2613
  }
set N6803f800 [stack 0]
  Dot {
   name Dot34
   xpos -1007
   ypos 2652
  }
push $N6803f800
  Dot {
   name Dot35
   xpos -1034
   ypos 2640
  }
push $N680bc800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_bS
   fromInput2 {{0} B}
   in2 zcam_aS
   mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
   name Shuffle16
   label "aS & bS"
   note_font_size 15
   xpos -1489
   ypos 2304
  }
push $N680bc800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_bC
   fromInput2 {{0} B}
   in2 zcam_aC
   mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
   name Shuffle17
   label "aC & bC"
   note_font_size 15
   xpos -1585
   ypos 2304
  }
push $N680bc800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_bM
   fromInput2 {{0} B}
   in2 zcam_aM
   mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
   name Shuffle26
   label "aM & bM"
   note_font_size 15
   xpos -1682
   ypos 2303
  }
  Switch {
   inputs 3
   which {{parent.inverseData1}}
   name inputdata_abX_mode
   xpos -1543
   ypos 2400
  }
  Dot {
   name Dot30
   xpos -1509
   ypos 2449
  }
set N6803e000 [stack 0]
  Dot {
   name Dot29
   xpos -1210
   ypos 2483
  }
  Expression {
   temp_name0 r2d
   temp_expr0 180.0/pi
   temp_name1 h360
   temp_expr1 "360.0\n"
   temp_name2 h
   temp_expr2 atan2(g,r)*r2d
   channel0 rgba
   expr0 h
   name inv_h
   label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
   xpos -1244
   ypos 2546
  }
  Dot {
   name Dot36
   label "a in outIn"
   xpos -1210
   ypos 2619
  }
set N6803d400 [stack 0]
  Dot {
   name Dot37
   xpos -1163
   ypos 2636
  }
push $N6803d400
  Dot {
   name Dot38
   xpos -1185
   ypos 2648
  }
push $N6803d400
  Dot {
   name Dot39
   xpos -1210
   ypos 2663
  }
  Switch {
   inputs 5
   which {{parent.inverseData1}}
   name inverseData1_Mode1
   label MCs
   xpos -1116
   ypos 2672
  }
  Dot {
   name Dot40
   xpos -1210
   ypos 2719
  }
set N6803c400 [stack 0]
push $N6803c400
  Expression {
   channel0 rgba
   expr0 "1.015 + cos((r + 89.038)*pi/180)"
   name inv_ez
   xpos -1244
   ypos 2756
  }
push $N680bc800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_C
   fromInput2 {{0} B}
   mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
   name Shuffle21
   xpos -1357
   ypos 2252
  }
  Dot {
   name Dot42
   label C
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1323
   ypos 2341
  }
  Expression {
   channel0 rgba
   expr0 r
   name MCs2
   label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
   xpos -1357
   ypos 2501
  }
  Dot {
   name Dot43
   label "h in outIn"
   xpos -1323
   ypos 2578
  }
push $N680bc800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_M
   fromInput2 {{0} B}
   mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
   name Shuffle19
   xpos -1442
   ypos 2252
  }
  Dot {
   name Dot31
   label M
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1408
   ypos 2341
  }
  Expression {
   channel0 rgba
   expr0 r
   name MCs1
   label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
   xpos -1442
   ypos 2501
  }
  Dot {
   name Dot25
   label "h in outIn"
   xpos -1408
   ypos 2575
  }
push $N6803e000
  Expression {
   channel0 rgba
   expr0 "(r**2.0 + g**2.0)**0.5"
   name MCs
   label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
   xpos -1645
   ypos 2460
  }
  Dot {
   name Dot24
   label "a in outIn"
   xpos -1611
   ypos 2581
  }
set N67ffd400 [stack 0]
  Dot {
   name Dot28
   xpos -1564
   ypos 2598
  }
push $N67ffd400
  Dot {
   name Dot27
   xpos -1586
   ypos 2610
  }
push $N67ffd400
  Dot {
   name Dot26
   xpos -1611
   ypos 2625
  }
  Switch {
   inputs 5
   which {{parent.inverseData1}}
   name inverseData1_Mode
   label MCs
   xpos -1517
   ypos 2634
  }
set N681b8800 [stack 0]
  Expression {
   channel0 rgba
   expr0 r
   name C_from_aC
   label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
   xpos -1926
   ypos 2714
  }
set N67ffc400 [stack 0]
  Dot {
   name Dot44
   label C,h
   xpos -1673
   ypos 2768
  }
push $N681b8800
  Expression {
   channel0 rgba
   expr0 100*r/Constants.Qw
   name C_from_aM
   label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
   xpos -2036
   ypos 2713
  }
set N67fb3800 [stack 0]
  Dot {
   name Dot20
   label M,h
   xpos -1737
   ypos 2767
  }
push $N681b8800
push $N680bc800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_Q
   fromInput2 {{0} B}
   mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
   name Shuffle18
   xpos -2182
   ypos 2257
  }
  Dot {
   name Dot21
   label Q
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1996
   ypos 2435
  }
set N67fb2c00 [stack 0]
push $N680bc800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_J
   fromInput2 {{0} B}
   mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
   name Shuffle14
   xpos -2302
   ypos 2259
  }
  Dot {
   name Dot8
   label J
   note_font_size 20
   note_font_color 0x677754ff
   xpos -2229
   ypos 2434
  }
  Dot {
   name Dot22
   xpos -2229
   ypos 2456
  }
set N67fb2000 [stack 0]
  Expression {
   channel0 rgba
   expr0 Constants.Qw*(r/100)
   name Q_from_J
   label "# Get Lightness J and brightness Q from data:"
   xpos -2263
   ypos 2519
  }
  Switch {
   inputs 2
   which {{parent.inverseData0}}
   name InverseData0_Mode
   label Q
   xpos -2263
   ypos 2564
  }
set N681b8100 [stack 0]
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy30
   xpos -1818
   ypos 2676
  }
  Expression {
   temp_name0 M
   temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
   channel0 rgba
   expr0 100*M/Constants.Qw
   name C_from_aS
   label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
   xpos -1818
   ypos 2708
  }
push $N67ffc400
push $N67fb3800
  Switch {
   inputs 5
   which {{parent.inverseData1}}
   name inputdata_abX_mode1
   xpos -1926
   ypos 2799
  }
  Expression {
   channel0 rgba
   expr0 "Constants.Qw * r / 100"
   name inv_M
   label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
   xpos -1543
   ypos 2822
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy7
   xpos -1543
   ypos 2874
  }
  Expression {
   channel0 rgba
   expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
   name inv_t
   label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
   xpos -1543
   ypos 2906
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy8
   xpos -1543
   ypos 2986
  }
set N67fb0400 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180)
   name inv_bz
   label t*np.sin(h*np.pi/180)
   xpos -1402
   ypos 3067
  }
push $N67fb0400
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180)
   name inv_az
   label "az = t*np.cos(h*np.pi/180)"
   xpos -1543
   ypos 3064
  }
push $N681b8100
  Expression {
   channel0 rgba
   expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
   name inv_Iz
   label "# calculate achromatic signal, Iz:"
   xpos -2263
   ypos 2619
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy9
   xpos -2181
   ypos 3184
  }
  Copy {
   inputs 2
   from0 rgba.blue
   to0 rgba.blue
   name Copy10
   xpos -2181
   ypos 3216
  }
  Dot {
   name Dot15
   label iabz
   note_font_size 20
   xpos -2147
   ypos 3275
  }
  Dot {
   name Dot13
   xpos -2145
   ypos 3414
  }
  Dot {
   name Dot14
   xpos -2145
   ypos 3470
  }
set N67f42000 [stack 0]
  Expression {
   expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
   name Expression3
   label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
   xpos -2050
   ypos 3532
  }
push $N67f42000
  Switch {
   inputs 2
   name use_zcam_parameters2
   label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
   xpos -2179
   ypos 3608
  }
set N67f73200 [stack 0]
  Dot {
   name Dot19
   label Iabz
   xpos -2092
   ypos 3678
  }
  Add {
   value 3.703522621e-11
   name Add2
   label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
   xpos -2126
   ypos 3712
  }
  ColorMatrix {
   matrix {
       {0 1 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   invert true
   name _M_LMSP_TO_IAB_ZCAM1
   xpos -2126
   ypos 3750
  }
push $N67f73200
  Dot {
   name Dot18
   label Iabz
   xpos -2216
   ypos 3683
  }
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   invert true
   name _M_LMSP_TO_IAB_JABZ1
   xpos -2250
   ypos 3748
  }
  Switch {
   inputs 2
   which 1
   name use_zcam_parameters3
   xpos -2182
   ypos 3844
  }
  Expression {
   expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
   expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
   expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
   name Expression4
   label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
   xpos -2182
   ypos 3874
   addUserKnob {20 _PQ_PARAMETERS}
   addUserKnob {7 c1}
   c1 {{3424/2**12}}
   addUserKnob {7 c2}
   c2 {{2413/2**7}}
   addUserKnob {7 c3}
   c3 {{2392/2**7}}
   addUserKnob {7 n}
   n {{2610/2**14}}
   addUserKnob {7 p}
   p {{1.7*2523/2**5}}
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   invert true
   name _M_XYZP_TO_LMS1
   label "# Define X',Y',Z' to L,M,S conversion matrix:"
   xpos -2182
   ypos 3949
  }
  ColorMatrix {
   matrix {
       {{b} 0 {1-b}}
       {{1-g} {g} 0}
       {0 0 1}
     }
   invert true
   name M_to_xyzp1
   label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
   xpos -2182
   ypos 3981
   addUserKnob {20 User}
   addUserKnob {7 b}
   b 1.15
   addUserKnob {7 g}
   g 0.66
  }
push $N680bc800
  Switch {
   inputs 2
   which {{parent.direction}}
   name direction
   xpos -1519
   ypos 4172
  }
  Output {
   name Output1
   xpos -1519
   ypos 4272
  }
push $N680bc800
  Dot {
   name Dot11
   label aM
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1535
   ypos 2170
  }
push $N680bc800
  Dot {
   name Dot12
   label bM
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1439
   ypos 2173
  }
push $N681b8100
push $N680bc800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_Sz
   fromInput2 {{0} B}
   mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
   name Shuffle15
   xpos -1870
   ypos 2254
  }
  Dot {
   name Dot10
   label Sz
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1836
   ypos 2342
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy4
   xpos -1770
   ypos 2555
  }
  Expression {
   expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
   name inv_C
   label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
   xpos -1770
   ypos 2587
  }
push $N6803e000
  Dot {
   name Dot23
   label "H in outIn"
   xpos -1509
   ypos 2582
  }
  Dot {
   inputs 0
   name Dot32
   label "H in outIn"
   xpos -1108
   ypos 2620
  }
push $N67fb2c00
  Expression {
   channel0 rgba
   expr0 "100.0* (r/Constants.Qw)"
   name J_from_Q
   xpos -2030
   ypos 2479
  }
push $N67fb2000
  Switch {
   inputs 2
   which {{parent.inverseData0}}
   name InverseData0_Mode1
   label J
   xpos -2030
   ypos 2527
  }
push $N681b8800
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy23
   xpos -1596
   ypos 2681
  }
  Expression {
   channel0 rgba
   expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
   name inv3_C
   label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
   xpos -1596
   ypos 2713
  }
  Constant {
   inputs 0
   channels rgb
   color 0.034705
   name Constant1
   xpos -440
   ypos 2450
  }
 end_group
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name limitSampleNode
  xpos 829
  ypos 442
 }
 Input {
  inputs 0
  name Input1
  xpos 1344
  ypos -41
 }
 Colorspace {
  primary_in ACES
  colorspace_out CIE-XYZ
  name Colorspace30
  label "ACES to XYZ"
  xpos 1344
  ypos -1
 }
 Multiply {
  value 100
  name Multiply19
  label "Mult by 100 to put in absolute nits"
  xpos 1344
  ypos 31
 }
 Group {
  name ZCAM10
  label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
  xpos 1344
  ypos 107
  addUserKnob {20 ZCAM}
  addUserKnob {4 direction M {forward inverse}}
  addUserKnob {26 ""}
  addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
  addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
  addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
  inverseData1 M,h
  addUserKnob {26 ""}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {41 surrounds T Constants.surrounds}
  addUserKnob {41 c T Constants.c}
  addUserKnob {41 Nc T Constants.Nc}
  addUserKnob {41 F T Constants.F}
  addUserKnob {41 FLL T Constants.FLL}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {41 La T Constants.La}
  addUserKnob {41 Yb T Constants.Yb}
  addUserKnob {41 surround T Constants.surround}
  addUserKnob {41 D T Constants.D}
  addUserKnob {41 Dtype T Constants.Dtype}
  addUserKnob {26 ""}
  addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
  addUserKnob {41 xyzw T Constants.xyzw}
  addUserKnob {26 ""}
  addUserKnob {41 Yw T Constants.Yw}
  addUserKnob {41 FL T Constants.FL}
  addUserKnob {41 n T Constants.n}
  addUserKnob {41 Fb T Constants.Fb}
  addUserKnob {41 Fs T Constants.Fs}
  addUserKnob {26 ""}
  addUserKnob {41 xyzwc T Constants.xyzwc}
  addUserKnob {41 iabzw T Constants.iabzw}
  addUserKnob {41 Qw T Constants.Qw}
 }
  BackdropNode {
   inputs 0
   name BackdropNode1
   tile_color 0x71c67100
   label xyz_to_jabz
   note_font_size 42
   xpos -1063
   ypos -50
   bdwidth 255
   bdheight 678
  }
  BackdropNode {
   inputs 0
   name BackdropNode2
   tile_color 0x388e8e00
   label Forward
   note_font_size 42
   xpos -1278
   ypos 673
   bdwidth 1634
   bdheight 582
  }
  BackdropNode {
   inputs 0
   name BackdropNode3
   tile_color 0x388e8e00
   label Inverse
   note_font_size 42
   xpos -2310
   ypos 2374
   bdwidth 1715
   bdheight 953
  }
  BackdropNode {
   inputs 0
   name BackdropNode4
   tile_color 0x388e8e00
   label "jabz to xyz"
   note_font_size 42
   xpos -2260
   ypos 3390
   bdwidth 300
   bdheight 667
  }
  BackdropNode {
   inputs 0
   name BackdropNode5
   label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
   xpos -1922
   ypos 791
   bdwidth 411
   bdheight 201
  }
  Input {
   inputs 0
   name Input1
   xpos -984
   ypos -137
  }
  Dot {
   name Dot4
   label xyzc
   xpos -950
   ypos -97
  }
  Dot {
   name Dot5
   xpos -950
   ypos -21
  }
set N67e7a400 [stack 0]
  ColorMatrix {
   matrix {
       {{b} 0 {1-b}}
       {{1-g} {g} 0}
       {0 0 1}
     }
   name M_to_xyzp
   label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
   xpos -984
   ypos 30
   addUserKnob {20 User}
   addUserKnob {7 b}
   b 1.15
   addUserKnob {7 g}
   g 0.66
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   name _M_XYZP_TO_LMS
   label "# Define X',Y',Z' to L,M,S conversion matrix:"
   xpos -984
   ypos 102
  }
  Dot {
   name Dot1
   label LMS
   xpos -950
   ypos 154
  }
  Expression {
   expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
   expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
   expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
   name Expression1
   label "# response compression: lms to lms'"
   xpos -984
   ypos 199
   addUserKnob {20 _PQ_PARAMETERS}
   addUserKnob {7 c1}
   c1 {{3424/2**12}}
   addUserKnob {7 c2}
   c2 {{2413/2**7}}
   addUserKnob {7 c3}
   c3 {{2392/2**7}}
   addUserKnob {7 n}
   n {{2610/2**14}}
   addUserKnob {7 p}
   p {{1.7*2523/2**5}}
  }
  Dot {
   name Dot2
   label lmsp
   xpos -950
   ypos 260
  }
set N67e79000 [stack 0]
  ColorMatrix {
   matrix {
       {0 1 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name _M_LMSP_TO_IAB_ZCAM
   xpos -912
   ypos 329
  }
  Add {
   value -3.703522621e-11
   name Add1
   label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
   xpos -912
   ypos 353
  }
  Dot {
   name Dot6
   label Iabz
   xpos -878
   ypos 411
  }
push $N67e79000
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name _M_LMSP_TO_IAB_JABZ
   xpos -1053
   ypos 328
  }
  Dot {
   name Dot7
   label Iabz
   xpos -1019
   ypos 410
  }
  Switch {
   inputs 2
   which 1
   name use_zcam_parameters
   xpos -978
   ypos 441
  }
set N67e48f00 [stack 0]
  Expression {
   expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
   name Expression2
   label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
   xpos -886
   ypos 492
  }
push $N67e48f00
  Switch {
   inputs 2
   name use_zcam_parameters1
   label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
   xpos -978
   ypos 564
  }
  Dot {
   name Dot3
   label iabz
   xpos -944
   ypos 753
  }
set N67e03000 [stack 0]
  Expression {
   temp_name0 r2d
   temp_expr0 180.0/pi
   temp_name1 h360
   temp_expr1 "360.0\n"
   temp_name2 h
   temp_expr2 atan2(b,g)*r2d
   channel0 rgba
   expr0 h
   name h
   xpos -1074
   ypos 904
  }
set N67e02c00 [stack 0]
  Expression {
   temp_name0 h
   temp_expr0 r
   channel0 rgba
   expr0 "1.015 + cos((h + 89.038)*pi/180)"
   name ez
   xpos -1074
   ypos 928
  }
push $N67e03000
  Copy {
   inputs 2
   from0 rgba.red
   to0 rgba.red
   name Copy1
   xpos -894
   ypos 989
  }
  Expression {
   channel0 rgba
   expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
   name M_colorfulness
   label "# calculate colorfulness, M:"
   xpos -894
   ypos 1021
  }
set N67e02000 [stack 0]
  Expression {
   channel0 rgba
   expr0 100*r/Constants.Qw
   name C
   label "# calculate chroma, C:"
   xpos -894
   ypos 1118
  }
set N67e01c00 [stack 0]
push $N67e03000
  Expression {
   channel0 rgba
   expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
   name Q
   label "# calculate brightness, Q:"
   xpos -1030
   ypos 1019
  }
set N67e01800 [stack 0]
  Expression {
   channel0 rgba
   expr0 "100.0 * (r/Constants.Qw)"
   name J
   label "# calculate lightness, J:"
   xpos -1030
   ypos 1117
  }
set N67e01400 [stack 0]
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy3
   xpos -1030
   ypos 1155
  }
set N67e01000 [stack 0]
  Expression {
   channel0 rgba
   expr0 "100 - ((100-r)**2 + g**2)**0.5"
   name Wz
   label "# calculate whiteness, W:"
   xpos -1030
   ypos 1195
  }
set N67e00c00 [stack 0]
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam
   fromInput2 {{0} B}
   mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
   name Shuffle2
   xpos -1202
   ypos 1199
  }
push $N67e02c00
  Dot {
   name Dot9
   label h
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1975
   ypos 2339
  }
push $N67e03000
  Shuffle2 {
   fromInput1 {{0} B}
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
   name Iz
   xpos -1127
   ypos 835
  }
push $N67e03000
  Shuffle2 {
   fromInput1 {{0} B}
   fromInput2 {{0} B}
   mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
   name az
   xpos -978
   ypos 837
  }
push $N67e03000
  Shuffle2 {
   fromInput1 {{0} B}
   fromInput2 {{0} B}
   mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
   name bz
   xpos -825
   ypos 835
  }
  NoOp {
   inputs 0
   name Constants
   xpos -527
   ypos 180
   addUserKnob {20 User}
   addUserKnob {26 _1 l _SURROUND_PARAMETERS}
   addUserKnob {4 surrounds M {average dim dark}}
   addUserKnob {7 c}
   c {{curve(surrounds) 0.69 0.59 0.525}}
   addUserKnob {7 Nc}
   Nc {{curve(surrounds) 1 0.9 0.8}}
   addUserKnob {7 F}
   F {{curve(surrounds) 1 0.9 0.8}}
   addUserKnob {7 FLL}
   FLL {{curve(surrounds) 1 1 1}}
   addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
   addUserKnob {7 La}
   La 100
   addUserKnob {7 Yb}
   Yb 20
   addUserKnob {4 surround M {avg dim dark}}
   addUserKnob {7 D}
   D 1
   addUserKnob {7 Dtype}
   addUserKnob {26 ""}
   addUserKnob {18 xyzw_d65}
   xyzw_d65 {95.043 100 108.89}
   addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {18 xyzw}
   xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
   addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {26 ""}
   addUserKnob {7 Yw}
   Yw 100
   addUserKnob {7 FL}
   FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
   addUserKnob {7 n}
   n {{Yb/Yw}}
   addUserKnob {7 Fb}
   Fb {{n**0.5}}
   addUserKnob {7 Fs}
   Fs {{c}}
   addUserKnob {26 ""}
   addUserKnob {18 xyzwc}
   xyzwc {95.043 100 108.89}
   addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {18 iabzw}
   iabzw {0.31331 -0.00014318 -8.9369e-05}
   addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {7 Qw}
   Qw 185.85
  }
push $N67e7a400
push $N67e02c00
push $N67e02000
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy5
   xpos 67
   ypos 1136
  }
set N67d7ec00 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180.0)
   name bM
   xpos 163
   ypos 1202
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_bM
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
   name Shuffle11
   xpos -752
   ypos 1400
  }
push $N67d7ec00
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180.0)
   name aM
   xpos 67
   ypos 1203
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_aM
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
   name Shuffle10
   xpos -848
   ypos 1400
  }
push $N67e02c00
push $N67e01c00
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy25
   xpos -164
   ypos 1149
  }
set N67d7d800 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180.0)
   name bC
   xpos -76
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_bC
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
   name Shuffle25
   xpos -949
   ypos 1399
  }
push $N67d7d800
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180.0)
   name aC
   xpos -164
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_aC
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
   name Shuffle24
   xpos -1048
   ypos 1397
  }
push $N67e02c00
push $N67e01800
push $N67e02000
  Copy {
   inputs 2
   from1 rgba.green
   to1 rgba.green
   name Copy2
   xpos -734
   ypos 1076
  }
  Expression {
   channel0 rgba
   expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
   name s
   label "# calculate saturation, s:"
   xpos -734
   ypos 1118
  }
set N67d17c00 [stack 0]
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy24
   xpos -381
   ypos 1143
  }
set N67d17800 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180.0)
   name bS
   xpos -287
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_bS
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
   name Shuffle23
   xpos -1150
   ypos 1398
  }
push $N67d17800
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180.0)
   name aS
   xpos -381
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_aS
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
   name Shuffle22
   xpos -1254
   ypos 1395
  }
push $N67e01000
  Expression {
   channel0 rgba
   expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
   name Vz
   label "# calculate vividness, V:"
   xpos -583
   ypos 1200
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Vz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
   name Shuffle9
   xpos -1345
   ypos 1396
  }
push $N67d17c00
  Expression {
   channel0 rgba
   name Sz
   label "# calculate saturation, S:"
   xpos -734
   ypos 1196
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Sz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
   name Shuffle8
   xpos -1436
   ypos 1395
  }
push $N67e01000
  Expression {
   channel0 rgba
   expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
   name Kz
   label "# calculate blackness, K:"
   xpos -895
   ypos 1195
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Kz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
   name Shuffle7
   xpos -1524
   ypos 1393
  }
push $N67e00c00
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Wz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
   name Shuffle6
   xpos -1613
   ypos 1393
  }
push $N67d17c00
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_s
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
   name Shuffle5
   xpos -1708
   ypos 1392
  }
push $N67e01c00
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_C
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
   name Shuffle4
   xpos -1798
   ypos 1391
  }
push $N67e01400
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_J
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
   name Shuffle1
   xpos -1900
   ypos 1390
  }
push $N67e02000
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_M
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
   name Shuffle12
   xpos -1999
   ypos 1389
  }
push $N67e01800
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Q
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
   name Shuffle3
   xpos -2089
   ypos 1391
  }
push $N67e02c00
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_h
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
   name Shuffle13
   xpos -2182
   ypos 1392
  }
push $N67e7a400
  Dot {
   name Dot16
   xpos -2265
   ypos 1253
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_h
   name Copy21
   xpos -2299
   ypos 1416
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Q
   name Copy22
   xpos -2299
   ypos 1458
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_M
   name Copy20
   xpos -2298
   ypos 1505
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_J
   name Copy11
   xpos -2298
   ypos 1547
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_C
   name Copy12
   xpos -2298
   ypos 1589
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_s
   name Copy13
   xpos -2302
   ypos 1631
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Wz
   name Copy14
   xpos -2302
   ypos 1673
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Kz
   name Copy15
   xpos -2302
   ypos 1715
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Sz
   name Copy16
   xpos -2302
   ypos 1757
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Vz
   name Copy17
   xpos -2302
   ypos 1799
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_aS
   name Copy26
   xpos -2302
   ypos 1841
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_bS
   name Copy27
   xpos -2302
   ypos 1883
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_aC
   name Copy28
   xpos -2302
   ypos 1925
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_bC
   name Copy29
   xpos -2302
   ypos 1963
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_aM
   name Copy18
   xpos -2302
   ypos 2005
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_bM
   name Copy19
   xpos -2302
   ypos 2047
  }
  Switch {
   inputs 2
   which {{parent.direction}}
   name direction1
   xpos -2302
   ypos 2112
  }
  Dot {
   name Dot17
   xpos -2268
   ypos 2157
  }
set N67c3e400 [stack 0]
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_h
   fromInput2 {{0} B}
   mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
   name Shuffle20
   xpos -1041
   ypos 2260
  }
  Dot {
   name Dot41
   label h
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1007
   ypos 2349
  }
  Dot {
   name Dot33
   label "h in outIn"
   xpos -1007
   ypos 2613
  }
set N67c3d800 [stack 0]
  Dot {
   name Dot34
   xpos -1007
   ypos 2652
  }
push $N67c3d800
  Dot {
   name Dot35
   xpos -1034
   ypos 2640
  }
push $N67c3e400
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_bS
   fromInput2 {{0} B}
   in2 zcam_aS
   mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
   name Shuffle16
   label "aS & bS"
   note_font_size 15
   xpos -1489
   ypos 2304
  }
push $N67c3e400
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_bC
   fromInput2 {{0} B}
   in2 zcam_aC
   mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
   name Shuffle17
   label "aC & bC"
   note_font_size 15
   xpos -1585
   ypos 2304
  }
push $N67c3e400
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_bM
   fromInput2 {{0} B}
   in2 zcam_aM
   mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
   name Shuffle26
   label "aM & bM"
   note_font_size 15
   xpos -1682
   ypos 2303
  }
  Switch {
   inputs 3
   which {{parent.inverseData1}}
   name inputdata_abX_mode
   xpos -1543
   ypos 2400
  }
  Dot {
   name Dot30
   xpos -1509
   ypos 2449
  }
set N67bdfc00 [stack 0]
  Dot {
   name Dot29
   xpos -1210
   ypos 2483
  }
  Expression {
   temp_name0 r2d
   temp_expr0 180.0/pi
   temp_name1 h360
   temp_expr1 "360.0\n"
   temp_name2 h
   temp_expr2 atan2(g,r)*r2d
   channel0 rgba
   expr0 h
   name inv_h
   label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
   xpos -1244
   ypos 2546
  }
  Dot {
   name Dot36
   label "a in outIn"
   xpos -1210
   ypos 2619
  }
set N67bdf000 [stack 0]
  Dot {
   name Dot37
   xpos -1163
   ypos 2636
  }
push $N67bdf000
  Dot {
   name Dot38
   xpos -1185
   ypos 2648
  }
push $N67bdf000
  Dot {
   name Dot39
   xpos -1210
   ypos 2663
  }
  Switch {
   inputs 5
   which {{parent.inverseData1}}
   name inverseData1_Mode1
   label MCs
   xpos -1116
   ypos 2672
  }
  Dot {
   name Dot40
   xpos -1210
   ypos 2719
  }
set N67bde000 [stack 0]
push $N67bde000
  Expression {
   channel0 rgba
   expr0 "1.015 + cos((r + 89.038)*pi/180)"
   name inv_ez
   xpos -1244
   ypos 2756
  }
push $N67c3e400
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_C
   fromInput2 {{0} B}
   mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
   name Shuffle21
   xpos -1357
   ypos 2252
  }
  Dot {
   name Dot42
   label C
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1323
   ypos 2341
  }
  Expression {
   channel0 rgba
   expr0 r
   name MCs2
   label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
   xpos -1357
   ypos 2501
  }
  Dot {
   name Dot43
   label "h in outIn"
   xpos -1323
   ypos 2578
  }
push $N67c3e400
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_M
   fromInput2 {{0} B}
   mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
   name Shuffle19
   xpos -1442
   ypos 2252
  }
  Dot {
   name Dot31
   label M
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1408
   ypos 2341
  }
  Expression {
   channel0 rgba
   expr0 r
   name MCs1
   label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
   xpos -1442
   ypos 2501
  }
  Dot {
   name Dot25
   label "h in outIn"
   xpos -1408
   ypos 2575
  }
push $N67bdfc00
  Expression {
   channel0 rgba
   expr0 "(r**2.0 + g**2.0)**0.5"
   name MCs
   label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
   xpos -1645
   ypos 2460
  }
  Dot {
   name Dot24
   label "a in outIn"
   xpos -1611
   ypos 2581
  }
set N67b97000 [stack 0]
  Dot {
   name Dot28
   xpos -1564
   ypos 2598
  }
push $N67b97000
  Dot {
   name Dot27
   xpos -1586
   ypos 2610
  }
push $N67b97000
  Dot {
   name Dot26
   xpos -1611
   ypos 2625
  }
  Switch {
   inputs 5
   which {{parent.inverseData1}}
   name inverseData1_Mode
   label MCs
   xpos -1517
   ypos 2634
  }
set N67d6cf00 [stack 0]
  Expression {
   channel0 rgba
   expr0 r
   name C_from_aC
   label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
   xpos -1926
   ypos 2714
  }
set N67b96000 [stack 0]
  Dot {
   name Dot44
   label C,h
   xpos -1673
   ypos 2768
  }
push $N67d6cf00
  Expression {
   channel0 rgba
   expr0 100*r/Constants.Qw
   name C_from_aM
   label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
   xpos -2036
   ypos 2713
  }
set N67b95800 [stack 0]
  Dot {
   name Dot20
   label M,h
   xpos -1737
   ypos 2767
  }
push $N67d6cf00
push $N67c3e400
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_Q
   fromInput2 {{0} B}
   mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
   name Shuffle18
   xpos -2182
   ypos 2257
  }
  Dot {
   name Dot21
   label Q
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1996
   ypos 2435
  }
set N67b94c00 [stack 0]
push $N67c3e400
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_J
   fromInput2 {{0} B}
   mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
   name Shuffle14
   xpos -2302
   ypos 2259
  }
  Dot {
   name Dot8
   label J
   note_font_size 20
   note_font_color 0x677754ff
   xpos -2229
   ypos 2434
  }
  Dot {
   name Dot22
   xpos -2229
   ypos 2456
  }
set N67b47c00 [stack 0]
  Expression {
   channel0 rgba
   expr0 Constants.Qw*(r/100)
   name Q_from_J
   label "# Get Lightness J and brightness Q from data:"
   xpos -2263
   ypos 2519
  }
  Switch {
   inputs 2
   which {{parent.inverseData0}}
   name InverseData0_Mode
   label Q
   xpos -2263
   ypos 2564
  }
set N67d6c800 [stack 0]
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy30
   xpos -1818
   ypos 2676
  }
  Expression {
   temp_name0 M
   temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
   channel0 rgba
   expr0 100*M/Constants.Qw
   name C_from_aS
   label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
   xpos -1818
   ypos 2708
  }
push $N67b96000
push $N67b95800
  Switch {
   inputs 5
   which {{parent.inverseData1}}
   name inputdata_abX_mode1
   xpos -1926
   ypos 2799
  }
  Expression {
   channel0 rgba
   expr0 "Constants.Qw * r / 100"
   name inv_M
   label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
   xpos -1543
   ypos 2822
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy7
   xpos -1543
   ypos 2874
  }
  Expression {
   channel0 rgba
   expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
   name inv_t
   label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
   xpos -1543
   ypos 2906
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy8
   xpos -1543
   ypos 2986
  }
set N67b46000 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180)
   name inv_bz
   label t*np.sin(h*np.pi/180)
   xpos -1402
   ypos 3067
  }
push $N67b46000
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180)
   name inv_az
   label "az = t*np.cos(h*np.pi/180)"
   xpos -1543
   ypos 3064
  }
push $N67d6c800
  Expression {
   channel0 rgba
   expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
   name inv_Iz
   label "# calculate achromatic signal, Iz:"
   xpos -2263
   ypos 2619
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy9
   xpos -2181
   ypos 3184
  }
  Copy {
   inputs 2
   from0 rgba.blue
   to0 rgba.blue
   name Copy10
   xpos -2181
   ypos 3216
  }
  Dot {
   name Dot15
   label iabz
   note_font_size 20
   xpos -2147
   ypos 3275
  }
  Dot {
   name Dot13
   xpos -2145
   ypos 3414
  }
  Dot {
   name Dot14
   xpos -2145
   ypos 3470
  }
set N67acfc00 [stack 0]
  Expression {
   expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
   name Expression3
   label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
   xpos -2050
   ypos 3532
  }
push $N67acfc00
  Switch {
   inputs 2
   name use_zcam_parameters2
   label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
   xpos -2179
   ypos 3608
  }
set N67abf900 [stack 0]
  Dot {
   name Dot19
   label Iabz
   xpos -2092
   ypos 3678
  }
  Add {
   value 3.703522621e-11
   name Add2
   label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
   xpos -2126
   ypos 3712
  }
  ColorMatrix {
   matrix {
       {0 1 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   invert true
   name _M_LMSP_TO_IAB_ZCAM1
   xpos -2126
   ypos 3750
  }
push $N67abf900
  Dot {
   name Dot18
   label Iabz
   xpos -2216
   ypos 3683
  }
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   invert true
   name _M_LMSP_TO_IAB_JABZ1
   xpos -2250
   ypos 3748
  }
  Switch {
   inputs 2
   which 1
   name use_zcam_parameters3
   xpos -2182
   ypos 3844
  }
  Expression {
   expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
   expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
   expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
   name Expression4
   label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
   xpos -2182
   ypos 3874
   addUserKnob {20 _PQ_PARAMETERS}
   addUserKnob {7 c1}
   c1 {{3424/2**12}}
   addUserKnob {7 c2}
   c2 {{2413/2**7}}
   addUserKnob {7 c3}
   c3 {{2392/2**7}}
   addUserKnob {7 n}
   n {{2610/2**14}}
   addUserKnob {7 p}
   p {{1.7*2523/2**5}}
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   invert true
   name _M_XYZP_TO_LMS1
   label "# Define X',Y',Z' to L,M,S conversion matrix:"
   xpos -2182
   ypos 3949
  }
  ColorMatrix {
   matrix {
       {{b} 0 {1-b}}
       {{1-g} {g} 0}
       {0 0 1}
     }
   invert true
   name M_to_xyzp1
   label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
   xpos -2182
   ypos 3981
   addUserKnob {20 User}
   addUserKnob {7 b}
   b 1.15
   addUserKnob {7 g}
   g 0.66
  }
push $N67c3e400
  Switch {
   inputs 2
   which {{parent.direction}}
   name direction
   xpos -1519
   ypos 4172
  }
  Output {
   name Output1
   xpos -1519
   ypos 4272
  }
push $N67c3e400
  Dot {
   name Dot11
   label aM
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1535
   ypos 2170
  }
push $N67c3e400
  Dot {
   name Dot12
   label bM
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1439
   ypos 2173
  }
push $N67d6c800
push $N67c3e400
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_Sz
   fromInput2 {{0} B}
   mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
   name Shuffle15
   xpos -1870
   ypos 2254
  }
  Dot {
   name Dot10
   label Sz
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1836
   ypos 2342
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy4
   xpos -1770
   ypos 2555
  }
  Expression {
   expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
   name inv_C
   label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
   xpos -1770
   ypos 2587
  }
push $N67bdfc00
  Dot {
   name Dot23
   label "H in outIn"
   xpos -1509
   ypos 2582
  }
  Dot {
   inputs 0
   name Dot32
   label "H in outIn"
   xpos -1108
   ypos 2620
  }
push $N67b94c00
  Expression {
   channel0 rgba
   expr0 "100.0* (r/Constants.Qw)"
   name J_from_Q
   xpos -2030
   ypos 2479
  }
push $N67b47c00
  Switch {
   inputs 2
   which {{parent.inverseData0}}
   name InverseData0_Mode1
   label J
   xpos -2030
   ypos 2527
  }
push $N67d6cf00
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy23
   xpos -1596
   ypos 2681
  }
  Expression {
   channel0 rgba
   expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
   name inv3_C
   label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
   xpos -1596
   ypos 2713
  }
  Constant {
   inputs 0
   channels rgb
   color 0.034705
   name Constant1
   xpos -440
   ypos 2450
  }
 end_group
set N67f70100 [stack 0]
 Ramp {
  replace true
  p0 {0 0}
  p1 {{width} 0}
  color 1.5
  name Ramp1
  xpos 1208
  ypos 175
 }
set N67a71c00 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle1
  xpos 1208
  ypos 206
 }
set N67a71800 [stack 0]
push $N67a71c00
push $N67f70100
 Multiply {
  inputs 1+1
  channels zcam_M
  value 0
  name Multiply1
  xpos 1344
  ypos 199
  disable true
 }
 Merge2 {
  inputs 2
  operation multiply
  Achannels none
  Bchannels none
  output none
  also_merge zcam_M
  name Multiply
  xpos 1349
  ypos 248
 }
 Clamp {
  channels zcam_M
  maximum 100
  name Clamp1
  xpos 1349
  ypos 280
 }
set N67a70c00 [stack 0]
 Dot {
  name Dot13
  xpos 1376
  ypos 487
 }
set N67a70800 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle37
  xpos 981
  ypos 194
 }
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  in2 zcam_M
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.blue 0 2 rgba.blue 0 2 rgba.alpha 0 3 rgba.alpha 0 3 zcam_M.green 1 1 rgba.green 0 1"
  name Shuffle48
  xpos 981
  ypos 218
 }
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  in2 zcam_h
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.alpha 0 3 rgba.alpha 0 3 zcam_h.blue 1 2 rgba.blue 0 2"
  name Shuffle49
  xpos 981
  ypos 242
 }
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.alpha
  name Copy9
  xpos 981
  ypos 409
 }
set N768e7400 [stack 0]
 Expression {
  temp_name0 limit
  temp_expr0 a(((b/360+.5)*1023),(r/100*1023))
  temp_name1 scaledVal
  temp_expr1 g/limit
  temp_name2 scale
  temp_expr2 1-thr
  expr2 "(scaledVal>thr? ( ((scaledVal-thr)/scale) / (((scaledVal-thr)/scale)+1) * scale + thr  )   : scaledVal ) * limit"
  channel3 alpha
  expr3 limit
  name clipToLimit2
  xpos 1064
  ypos 470
  addUserKnob {20 User}
  addUserKnob {7 limitScale R 0 100}
  limitScale 100
  addUserKnob {7 thr}
  thr 0.765
 }
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.alpha 0 3"
  name Shuffle50
  xpos 1064
  ypos 499
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.green 0 1 zcam_M.alpha 0 3"
  name Shuffle39
  xpos 1193
  ypos 550
 }
push $N67a70800
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy7
  xpos 1354
  ypos 595
  disable true
 }
 Group {
  name ZCAM11
  label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
  xpos 1354
  ypos 663
  addUserKnob {20 ZCAM}
  addUserKnob {4 direction M {forward inverse}}
  direction inverse
  addUserKnob {26 ""}
  addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
  addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
  addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
  inverseData1 M,h
  addUserKnob {26 ""}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {41 surrounds T Constants.surrounds}
  addUserKnob {41 c T Constants.c}
  addUserKnob {41 Nc T Constants.Nc}
  addUserKnob {41 F T Constants.F}
  addUserKnob {41 FLL T Constants.FLL}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {41 La T Constants.La}
  addUserKnob {41 Yb T Constants.Yb}
  addUserKnob {41 surround T Constants.surround}
  addUserKnob {41 D T Constants.D}
  addUserKnob {41 Dtype T Constants.Dtype}
  addUserKnob {26 ""}
  addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
  addUserKnob {41 xyzw T Constants.xyzw}
  addUserKnob {26 ""}
  addUserKnob {41 Yw T Constants.Yw}
  addUserKnob {41 FL T Constants.FL}
  addUserKnob {41 n T Constants.n}
  addUserKnob {41 Fb T Constants.Fb}
  addUserKnob {41 Fs T Constants.Fs}
  addUserKnob {26 ""}
  addUserKnob {41 xyzwc T Constants.xyzwc}
  addUserKnob {41 iabzw T Constants.iabzw}
  addUserKnob {41 Qw T Constants.Qw}
 }
  BackdropNode {
   inputs 0
   name BackdropNode1
   tile_color 0x71c67100
   label xyz_to_jabz
   note_font_size 42
   xpos -1063
   ypos -50
   bdwidth 255
   bdheight 678
  }
  BackdropNode {
   inputs 0
   name BackdropNode2
   tile_color 0x388e8e00
   label Forward
   note_font_size 42
   xpos -1278
   ypos 673
   bdwidth 1634
   bdheight 582
  }
  BackdropNode {
   inputs 0
   name BackdropNode3
   tile_color 0x388e8e00
   label Inverse
   note_font_size 42
   xpos -2310
   ypos 2374
   bdwidth 1715
   bdheight 953
  }
  BackdropNode {
   inputs 0
   name BackdropNode4
   tile_color 0x388e8e00
   label "jabz to xyz"
   note_font_size 42
   xpos -2260
   ypos 3390
   bdwidth 300
   bdheight 667
  }
  BackdropNode {
   inputs 0
   name BackdropNode5
   label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
   xpos -1922
   ypos 791
   bdwidth 411
   bdheight 201
  }
  Input {
   inputs 0
   name Input1
   xpos -984
   ypos -137
  }
  Dot {
   name Dot4
   label xyzc
   xpos -950
   ypos -97
  }
  Dot {
   name Dot5
   xpos -950
   ypos -21
  }
set N768e5800 [stack 0]
  ColorMatrix {
   matrix {
       {{b} 0 {1-b}}
       {{1-g} {g} 0}
       {0 0 1}
     }
   name M_to_xyzp
   label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
   xpos -984
   ypos 30
   addUserKnob {20 User}
   addUserKnob {7 b}
   b 1.15
   addUserKnob {7 g}
   g 0.66
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   name _M_XYZP_TO_LMS
   label "# Define X',Y',Z' to L,M,S conversion matrix:"
   xpos -984
   ypos 102
  }
  Dot {
   name Dot1
   label LMS
   xpos -950
   ypos 154
  }
  Expression {
   expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
   expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
   expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
   name Expression1
   label "# response compression: lms to lms'"
   xpos -984
   ypos 199
   addUserKnob {20 _PQ_PARAMETERS}
   addUserKnob {7 c1}
   c1 {{3424/2**12}}
   addUserKnob {7 c2}
   c2 {{2413/2**7}}
   addUserKnob {7 c3}
   c3 {{2392/2**7}}
   addUserKnob {7 n}
   n {{2610/2**14}}
   addUserKnob {7 p}
   p {{1.7*2523/2**5}}
  }
  Dot {
   name Dot2
   label lmsp
   xpos -950
   ypos 260
  }
set N768e4400 [stack 0]
  ColorMatrix {
   matrix {
       {0 1 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name _M_LMSP_TO_IAB_ZCAM
   xpos -912
   ypos 329
  }
  Add {
   value -3.703522621e-11
   name Add1
   label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
   xpos -912
   ypos 353
  }
  Dot {
   name Dot6
   label Iabz
   xpos -878
   ypos 411
  }
push $N768e4400
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name _M_LMSP_TO_IAB_JABZ
   xpos -1053
   ypos 328
  }
  Dot {
   name Dot7
   label Iabz
   xpos -1019
   ypos 410
  }
  Switch {
   inputs 2
   which 1
   name use_zcam_parameters
   xpos -978
   ypos 441
  }
set N7686f200 [stack 0]
  Expression {
   expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
   name Expression2
   label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
   xpos -886
   ypos 492
  }
push $N7686f200
  Switch {
   inputs 2
   name use_zcam_parameters1
   label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
   xpos -978
   ypos 564
  }
  Dot {
   name Dot3
   label iabz
   xpos -944
   ypos 753
  }
set N7687e400 [stack 0]
  Expression {
   temp_name0 r2d
   temp_expr0 180.0/pi
   temp_name1 h360
   temp_expr1 "360.0\n"
   temp_name2 h
   temp_expr2 atan2(b,g)*r2d
   channel0 rgba
   expr0 h
   name h
   xpos -1074
   ypos 904
  }
set N7687e000 [stack 0]
  Expression {
   temp_name0 h
   temp_expr0 r
   channel0 rgba
   expr0 "1.015 + cos((h + 89.038)*pi/180)"
   name ez
   xpos -1074
   ypos 928
  }
push $N7687e400
  Copy {
   inputs 2
   from0 rgba.red
   to0 rgba.red
   name Copy1
   xpos -894
   ypos 989
  }
  Expression {
   channel0 rgba
   expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
   name M_colorfulness
   label "# calculate colorfulness, M:"
   xpos -894
   ypos 1021
  }
set N7687d400 [stack 0]
  Expression {
   channel0 rgba
   expr0 100*r/Constants.Qw
   name C
   label "# calculate chroma, C:"
   xpos -894
   ypos 1118
  }
set N7687d000 [stack 0]
push $N7687e400
  Expression {
   channel0 rgba
   expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
   name Q
   label "# calculate brightness, Q:"
   xpos -1030
   ypos 1019
  }
set N7687cc00 [stack 0]
  Expression {
   channel0 rgba
   expr0 "100.0 * (r/Constants.Qw)"
   name J
   label "# calculate lightness, J:"
   xpos -1030
   ypos 1117
  }
set N7687c800 [stack 0]
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy3
   xpos -1030
   ypos 1155
  }
set N7687c400 [stack 0]
  Expression {
   channel0 rgba
   expr0 "100 - ((100-r)**2 + g**2)**0.5"
   name Wz
   label "# calculate whiteness, W:"
   xpos -1030
   ypos 1195
  }
set N767f3c00 [stack 0]
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam
   fromInput2 {{0} B}
   mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
   name Shuffle2
   xpos -1202
   ypos 1199
  }
push $N7687e000
  Dot {
   name Dot9
   label h
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1975
   ypos 2339
  }
push $N7687e400
  Shuffle2 {
   fromInput1 {{0} B}
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
   name Iz
   xpos -1127
   ypos 835
  }
push $N7687e400
  Shuffle2 {
   fromInput1 {{0} B}
   fromInput2 {{0} B}
   mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
   name az
   xpos -978
   ypos 837
  }
push $N7687e400
  Shuffle2 {
   fromInput1 {{0} B}
   fromInput2 {{0} B}
   mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
   name bz
   xpos -825
   ypos 835
  }
  NoOp {
   inputs 0
   name Constants
   xpos -527
   ypos 180
   addUserKnob {20 User}
   addUserKnob {26 _1 l _SURROUND_PARAMETERS}
   addUserKnob {4 surrounds M {average dim dark}}
   addUserKnob {7 c}
   c {{curve(surrounds) 0.69 0.59 0.525}}
   addUserKnob {7 Nc}
   Nc {{curve(surrounds) 1 0.9 0.8}}
   addUserKnob {7 F}
   F {{curve(surrounds) 1 0.9 0.8}}
   addUserKnob {7 FLL}
   FLL {{curve(surrounds) 1 1 1}}
   addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
   addUserKnob {7 La}
   La 100
   addUserKnob {7 Yb}
   Yb 20
   addUserKnob {4 surround M {avg dim dark}}
   addUserKnob {7 D}
   D 1
   addUserKnob {7 Dtype}
   addUserKnob {26 ""}
   addUserKnob {18 xyzw_d65}
   xyzw_d65 {95.043 100 108.89}
   addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {18 xyzw}
   xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
   addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {26 ""}
   addUserKnob {7 Yw}
   Yw 100
   addUserKnob {7 FL}
   FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
   addUserKnob {7 n}
   n {{Yb/Yw}}
   addUserKnob {7 Fb}
   Fb {{n**0.5}}
   addUserKnob {7 Fs}
   Fs {{c}}
   addUserKnob {26 ""}
   addUserKnob {18 xyzwc}
   xyzwc {95.043 100 108.89}
   addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {18 iabzw}
   iabzw {0.31331 -0.00014318 -8.9369e-05}
   addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {7 Qw}
   Qw 185.85
  }
push $N768e5800
push $N7687e000
push $N7687d400
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy5
   xpos 67
   ypos 1136
  }
set N767f2000 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180.0)
   name bM
   xpos 163
   ypos 1202
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_bM
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
   name Shuffle11
   xpos -752
   ypos 1400
  }
push $N767f2000
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180.0)
   name aM
   xpos 67
   ypos 1203
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_aM
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
   name Shuffle10
   xpos -848
   ypos 1400
  }
push $N7687e000
push $N7687d000
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy25
   xpos -164
   ypos 1149
  }
set N767f0c00 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180.0)
   name bC
   xpos -76
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_bC
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
   name Shuffle25
   xpos -949
   ypos 1399
  }
push $N767f0c00
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180.0)
   name aC
   xpos -164
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_aC
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
   name Shuffle24
   xpos -1048
   ypos 1397
  }
push $N7687e000
push $N7687cc00
push $N7687d400
  Copy {
   inputs 2
   from1 rgba.green
   to1 rgba.green
   name Copy2
   xpos -734
   ypos 1076
  }
  Expression {
   channel0 rgba
   expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
   name s
   label "# calculate saturation, s:"
   xpos -734
   ypos 1118
  }
set N76793000 [stack 0]
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy24
   xpos -381
   ypos 1143
  }
set N76792c00 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180.0)
   name bS
   xpos -287
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_bS
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
   name Shuffle23
   xpos -1150
   ypos 1398
  }
push $N76792c00
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180.0)
   name aS
   xpos -381
   ypos 1207
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_aS
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
   name Shuffle22
   xpos -1254
   ypos 1395
  }
push $N7687c400
  Expression {
   channel0 rgba
   expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
   name Vz
   label "# calculate vividness, V:"
   xpos -583
   ypos 1200
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Vz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
   name Shuffle9
   xpos -1345
   ypos 1396
  }
push $N76793000
  Expression {
   channel0 rgba
   name Sz
   label "# calculate saturation, S:"
   xpos -734
   ypos 1196
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Sz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
   name Shuffle8
   xpos -1436
   ypos 1395
  }
push $N7687c400
  Expression {
   channel0 rgba
   expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
   name Kz
   label "# calculate blackness, K:"
   xpos -895
   ypos 1195
  }
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Kz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
   name Shuffle7
   xpos -1524
   ypos 1393
  }
push $N767f3c00
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Wz
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
   name Shuffle6
   xpos -1613
   ypos 1393
  }
push $N76793000
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_s
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
   name Shuffle5
   xpos -1708
   ypos 1392
  }
push $N7687d000
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_C
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
   name Shuffle4
   xpos -1798
   ypos 1391
  }
push $N7687c800
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_J
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
   name Shuffle1
   xpos -1900
   ypos 1390
  }
push $N7687d400
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_M
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
   name Shuffle12
   xpos -1999
   ypos 1389
  }
push $N7687cc00
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_Q
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
   name Shuffle3
   xpos -2089
   ypos 1391
  }
push $N7687e000
  Shuffle2 {
   fromInput1 {{0} B}
   out1 zcam_h
   fromInput2 {{0} B}
   mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
   name Shuffle13
   xpos -2182
   ypos 1392
  }
push $N768e5800
  Dot {
   name Dot16
   xpos -2265
   ypos 1253
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_h
   name Copy21
   xpos -2299
   ypos 1416
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Q
   name Copy22
   xpos -2299
   ypos 1458
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_M
   name Copy20
   xpos -2298
   ypos 1505
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_J
   name Copy11
   xpos -2298
   ypos 1547
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_C
   name Copy12
   xpos -2298
   ypos 1589
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_s
   name Copy13
   xpos -2302
   ypos 1631
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Wz
   name Copy14
   xpos -2302
   ypos 1673
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Kz
   name Copy15
   xpos -2302
   ypos 1715
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Sz
   name Copy16
   xpos -2302
   ypos 1757
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_Vz
   name Copy17
   xpos -2302
   ypos 1799
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_aS
   name Copy26
   xpos -2302
   ypos 1841
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_bS
   name Copy27
   xpos -2302
   ypos 1883
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_aC
   name Copy28
   xpos -2302
   ypos 1925
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_bC
   name Copy29
   xpos -2302
   ypos 1963
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_aM
   name Copy18
   xpos -2302
   ypos 2005
  }
  Copy {
   inputs 2
   from0 -rgba.alpha
   to0 -rgba.alpha
   channels zcam_bM
   name Copy19
   xpos -2302
   ypos 2047
  }
  Switch {
   inputs 2
   which {{parent.direction}}
   name direction1
   xpos -2302
   ypos 2112
  }
  Dot {
   name Dot17
   xpos -2268
   ypos 2157
  }
set N766c5800 [stack 0]
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_h
   fromInput2 {{0} B}
   mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
   name Shuffle20
   xpos -1041
   ypos 2260
  }
  Dot {
   name Dot41
   label h
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1007
   ypos 2349
  }
  Dot {
   name Dot33
   label "h in outIn"
   xpos -1007
   ypos 2613
  }
set N766c4c00 [stack 0]
  Dot {
   name Dot34
   xpos -1007
   ypos 2652
  }
push $N766c4c00
  Dot {
   name Dot35
   xpos -1034
   ypos 2640
  }
push $N766c5800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_bS
   fromInput2 {{0} B}
   in2 zcam_aS
   mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
   name Shuffle16
   label "aS & bS"
   note_font_size 15
   xpos -1489
   ypos 2304
  }
push $N766c5800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_bC
   fromInput2 {{0} B}
   in2 zcam_aC
   mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
   name Shuffle17
   label "aC & bC"
   note_font_size 15
   xpos -1585
   ypos 2304
  }
push $N766c5800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_bM
   fromInput2 {{0} B}
   in2 zcam_aM
   mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
   name Shuffle26
   label "aM & bM"
   note_font_size 15
   xpos -1682
   ypos 2303
  }
  Switch {
   inputs 3
   which {{parent.inverseData1}}
   name inputdata_abX_mode
   xpos -1543
   ypos 2400
  }
  Dot {
   name Dot30
   xpos -1509
   ypos 2449
  }
set N7665f000 [stack 0]
  Dot {
   name Dot29
   xpos -1210
   ypos 2483
  }
  Expression {
   temp_name0 r2d
   temp_expr0 180.0/pi
   temp_name1 h360
   temp_expr1 "360.0\n"
   temp_name2 h
   temp_expr2 atan2(g,r)*r2d
   channel0 rgba
   expr0 h
   name inv_h
   label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
   xpos -1244
   ypos 2546
  }
  Dot {
   name Dot36
   label "a in outIn"
   xpos -1210
   ypos 2619
  }
set N7665e400 [stack 0]
  Dot {
   name Dot37
   xpos -1163
   ypos 2636
  }
push $N7665e400
  Dot {
   name Dot38
   xpos -1185
   ypos 2648
  }
push $N7665e400
  Dot {
   name Dot39
   xpos -1210
   ypos 2663
  }
  Switch {
   inputs 5
   which {{parent.inverseData1}}
   name inverseData1_Mode1
   label MCs
   xpos -1116
   ypos 2672
  }
  Dot {
   name Dot40
   xpos -1210
   ypos 2719
  }
set N7665d400 [stack 0]
push $N7665d400
  Expression {
   channel0 rgba
   expr0 "1.015 + cos((r + 89.038)*pi/180)"
   name inv_ez
   xpos -1244
   ypos 2756
  }
push $N766c5800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_C
   fromInput2 {{0} B}
   mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
   name Shuffle21
   xpos -1357
   ypos 2252
  }
  Dot {
   name Dot42
   label C
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1323
   ypos 2341
  }
  Expression {
   channel0 rgba
   expr0 r
   name MCs2
   label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
   xpos -1357
   ypos 2501
  }
  Dot {
   name Dot43
   label "h in outIn"
   xpos -1323
   ypos 2578
  }
push $N766c5800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_M
   fromInput2 {{0} B}
   mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
   name Shuffle19
   xpos -1442
   ypos 2252
  }
  Dot {
   name Dot31
   label M
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1408
   ypos 2341
  }
  Expression {
   channel0 rgba
   expr0 r
   name MCs1
   label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
   xpos -1442
   ypos 2501
  }
  Dot {
   name Dot25
   label "h in outIn"
   xpos -1408
   ypos 2575
  }
push $N7665f000
  Expression {
   channel0 rgba
   expr0 "(r**2.0 + g**2.0)**0.5"
   name MCs
   label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
   xpos -1645
   ypos 2460
  }
  Dot {
   name Dot24
   label "a in outIn"
   xpos -1611
   ypos 2581
  }
set N7660e400 [stack 0]
  Dot {
   name Dot28
   xpos -1564
   ypos 2598
  }
push $N7660e400
  Dot {
   name Dot27
   xpos -1586
   ypos 2610
  }
push $N7660e400
  Dot {
   name Dot26
   xpos -1611
   ypos 2625
  }
  Switch {
   inputs 5
   which {{parent.inverseData1}}
   name inverseData1_Mode
   label MCs
   xpos -1517
   ypos 2634
  }
set N7662b200 [stack 0]
  Expression {
   channel0 rgba
   expr0 r
   name C_from_aC
   label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
   xpos -1926
   ypos 2714
  }
set N7660d400 [stack 0]
  Dot {
   name Dot44
   label C,h
   xpos -1673
   ypos 2768
  }
push $N7662b200
  Expression {
   channel0 rgba
   expr0 100*r/Constants.Qw
   name C_from_aM
   label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
   xpos -2036
   ypos 2713
  }
set N7660cc00 [stack 0]
  Dot {
   name Dot20
   label M,h
   xpos -1737
   ypos 2767
  }
push $N7662b200
push $N766c5800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_Q
   fromInput2 {{0} B}
   mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
   name Shuffle18
   xpos -2182
   ypos 2257
  }
  Dot {
   name Dot21
   label Q
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1996
   ypos 2435
  }
set N765b3c00 [stack 0]
push $N766c5800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_J
   fromInput2 {{0} B}
   mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
   name Shuffle14
   xpos -2302
   ypos 2259
  }
  Dot {
   name Dot8
   label J
   note_font_size 20
   note_font_color 0x677754ff
   xpos -2229
   ypos 2434
  }
  Dot {
   name Dot22
   xpos -2229
   ypos 2456
  }
set N765b3000 [stack 0]
  Expression {
   channel0 rgba
   expr0 Constants.Qw*(r/100)
   name Q_from_J
   label "# Get Lightness J and brightness Q from data:"
   xpos -2263
   ypos 2519
  }
  Switch {
   inputs 2
   which {{parent.inverseData0}}
   name InverseData0_Mode
   label Q
   xpos -2263
   ypos 2564
  }
set N7662ab00 [stack 0]
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy30
   xpos -1818
   ypos 2676
  }
  Expression {
   temp_name0 M
   temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
   channel0 rgba
   expr0 100*M/Constants.Qw
   name C_from_aS
   label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
   xpos -1818
   ypos 2708
  }
push $N7660d400
push $N7660cc00
  Switch {
   inputs 5
   which {{parent.inverseData1}}
   name inputdata_abX_mode1
   xpos -1926
   ypos 2799
  }
  Expression {
   channel0 rgba
   expr0 "Constants.Qw * r / 100"
   name inv_M
   label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
   xpos -1543
   ypos 2822
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy7
   xpos -1543
   ypos 2874
  }
  Expression {
   channel0 rgba
   expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
   name inv_t
   label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
   xpos -1543
   ypos 2906
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy8
   xpos -1543
   ypos 2986
  }
set N765b1400 [stack 0]
  Expression {
   channel0 rgba
   expr0 r*sin(g*pi/180)
   name inv_bz
   label t*np.sin(h*np.pi/180)
   xpos -1402
   ypos 3067
  }
push $N765b1400
  Expression {
   channel0 rgba
   expr0 r*cos(g*pi/180)
   name inv_az
   label "az = t*np.cos(h*np.pi/180)"
   xpos -1543
   ypos 3064
  }
push $N7662ab00
  Expression {
   channel0 rgba
   expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
   name inv_Iz
   label "# calculate achromatic signal, Iz:"
   xpos -2263
   ypos 2619
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy9
   xpos -2181
   ypos 3184
  }
  Copy {
   inputs 2
   from0 rgba.blue
   to0 rgba.blue
   name Copy10
   xpos -2181
   ypos 3216
  }
  Dot {
   name Dot15
   label iabz
   note_font_size 20
   xpos -2147
   ypos 3275
  }
  Dot {
   name Dot13
   xpos -2145
   ypos 3414
  }
  Dot {
   name Dot14
   xpos -2145
   ypos 3470
  }
set N7e8ff000 [stack 0]
  Expression {
   expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
   name Expression3
   label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
   xpos -2050
   ypos 3532
  }
push $N7e8ff000
  Switch {
   inputs 2
   name use_zcam_parameters2
   label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
   xpos -2179
   ypos 3608
  }
set N76629d00 [stack 0]
  Dot {
   name Dot19
   label Iabz
   xpos -2092
   ypos 3678
  }
  Add {
   value 3.703522621e-11
   name Add2
   label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
   xpos -2126
   ypos 3712
  }
  ColorMatrix {
   matrix {
       {0 1 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   invert true
   name _M_LMSP_TO_IAB_ZCAM1
   xpos -2126
   ypos 3750
  }
push $N76629d00
  Dot {
   name Dot18
   label Iabz
   xpos -2216
   ypos 3683
  }
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   invert true
   name _M_LMSP_TO_IAB_JABZ1
   xpos -2250
   ypos 3748
  }
  Switch {
   inputs 2
   which 1
   name use_zcam_parameters3
   xpos -2182
   ypos 3844
  }
  Expression {
   expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
   expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
   expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
   name Expression4
   label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
   xpos -2182
   ypos 3874
   addUserKnob {20 _PQ_PARAMETERS}
   addUserKnob {7 c1}
   c1 {{3424/2**12}}
   addUserKnob {7 c2}
   c2 {{2413/2**7}}
   addUserKnob {7 c3}
   c3 {{2392/2**7}}
   addUserKnob {7 n}
   n {{2610/2**14}}
   addUserKnob {7 p}
   p {{1.7*2523/2**5}}
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   invert true
   name _M_XYZP_TO_LMS1
   label "# Define X',Y',Z' to L,M,S conversion matrix:"
   xpos -2182
   ypos 3949
  }
  ColorMatrix {
   matrix {
       {{b} 0 {1-b}}
       {{1-g} {g} 0}
       {0 0 1}
     }
   invert true
   name M_to_xyzp1
   label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
   xpos -2182
   ypos 3981
   addUserKnob {20 User}
   addUserKnob {7 b}
   b 1.15
   addUserKnob {7 g}
   g 0.66
  }
push $N766c5800
  Switch {
   inputs 2
   which {{parent.direction}}
   name direction
   xpos -1519
   ypos 4172
  }
  Output {
   name Output1
   xpos -1519
   ypos 4272
  }
push $N766c5800
  Dot {
   name Dot11
   label aM
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1535
   ypos 2170
  }
push $N766c5800
  Dot {
   name Dot12
   label bM
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1439
   ypos 2173
  }
push $N7662ab00
push $N766c5800
  Shuffle2 {
   fromInput1 {{0} B}
   in1 zcam_Sz
   fromInput2 {{0} B}
   mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
   name Shuffle15
   xpos -1870
   ypos 2254
  }
  Dot {
   name Dot10
   label Sz
   note_font_size 20
   note_font_color 0x677754ff
   xpos -1836
   ypos 2342
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy4
   xpos -1770
   ypos 2555
  }
  Expression {
   expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
   name inv_C
   label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
   xpos -1770
   ypos 2587
  }
push $N7665f000
  Dot {
   name Dot23
   label "H in outIn"
   xpos -1509
   ypos 2582
  }
  Dot {
   inputs 0
   name Dot32
   label "H in outIn"
   xpos -1108
   ypos 2620
  }
push $N765b3c00
  Expression {
   channel0 rgba
   expr0 "100.0* (r/Constants.Qw)"
   name J_from_Q
   xpos -2030
   ypos 2479
  }
push $N765b3000
  Switch {
   inputs 2
   which {{parent.inverseData0}}
   name InverseData0_Mode1
   label J
   xpos -2030
   ypos 2527
  }
push $N7662b200
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy23
   xpos -1596
   ypos 2681
  }
  Expression {
   channel0 rgba
   expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
   name inv3_C
   label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
   xpos -1596
   ypos 2713
  }
  Constant {
   inputs 0
   channels rgb
   color 0.034705
   name Constant1
   xpos -440
   ypos 2450
  }
 end_group
 Multiply {
  value 0.01
  name Multiply13
  label "Div by 100 to go from nits"
  xpos 1354
  ypos 715
 }
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.blue 0 2 white -1 -1 rgba.alpha 0 3"
  name Shuffle36
  xpos 1354
  ypos 757
 }
 Colorspace {
  colorspace_in CIE-XYZ
  name Colorspace25
  label "XYZ to sRGB Prims"
  xpos 1354
  ypos 781
 }
 Output {
  name Output1
  xpos 1354
  ypos 888
 }
push $N768e7400
 Expression {
  temp_name0 limit
  temp_expr0 a(((b/360+.5)*width),(r/100*height))
  temp_name1 scaledVal
  temp_expr1 g/limit
  temp_name2 scale
  temp_expr2 1-thr
  expr2 "(scaledVal>thr? ( ((scaledVal-thr)/scale) / (((scaledVal-thr)/scale)+1) * scale + thr  )   : scaledVal ) * limit"
  channel3 alpha
  expr3 limit
  name clipToLimit3
  xpos 981
  ypos 546
  addUserKnob {20 User}
  addUserKnob {7 limitScale R 0 100}
  limitScale 100
  addUserKnob {7 thr}
  thr 0.9
 }
push $N67a71800
push $N67a70c00
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy1
  xpos 1349
  ypos 334
 }
set N7e847800 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle51
  xpos 1588
  ypos 227
 }
 Multiply {
  value {{1/parent.Multiply19.value}}
  name Multiply20
  label "Div by 100 to go from nits"
  xpos 1588
  ypos 251
 }
 ColorLookup {
  channels all
  lut {master {curve x0.02407439426 0 x0.04948588461 5.620706361e-06 x0.0808724314 5.995634638e-05 x0.1089436561 0.0002520732232 x0.1538826674 0.0009655252215 x0.1705526412 0.001552375033 x0.1965807676 0.003411091166 x0.2212548852 0.005432802252 x0.2435974032 0.008078291081 x0.2744711637 0.01258628722 x0.335355252 0.02872310206 x0.3656598926 0.0391706787 x0.4067366123 0.05722413212 x0.451582104 0.08477441967 x0.5436673164 0.1626682729 x0.6915633678 0.3178558648 x0.7352961302 0.3736175299 x0.8164004087 0.4692641795 x0.8752408028 0.5275940299 x0.9309006333 0.5828329325 x0.9754681587 0.6187173724 x1.033632636 0.6637632847 x1.16960156 0.745464921 x1.235319972 0.7762671709 x1.356181145 0.8217196465 x1.508617401 0.8695153594 x1.637787938 0.8979744911 x1.822932601 0.9321763515 x1.905457973 0.9441890717 x2.068963289 0.9626951218 x2.316649675 0.9837986231 x2.455148697 0.9925647378 x2.621634722 1}
    red {}
    green {}
    blue {}
    alpha {}}
  name ColorLookup1
  xpos 1588
  ypos 293
 }
 Gamma {
  value 2.2
  name Gamma2
  xpos 1588
  ypos 325
 }
 Multiply {
  value {{parent.Multiply19.value}}
  name Multiply21
  label "Mult by 100 to put in absolute nits"
  xpos 1588
  ypos 357
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle52
  xpos 1588
  ypos 399
 }
push $N7e847800
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy10
  xpos 1345
  ypos 390
 }
end_group
Group {
 name PlotChromaticity1
 xpos 2797
 ypos 2123
 addUserKnob {20 PlotChromaticity_tab l PlotChromaticity}
 addUserKnob {6 use_gpu l "Use GPU if available" +STARTLINE}
 use_gpu true
 addUserKnob {26 ""}
 addUserKnob {6 plot_input l "plot input" t "Enable plotting of the input pixels" +STARTLINE}
 plot_input true
 addUserKnob {41 input_gamut l gamut t "Set the gamut that the input colors are encoded in" -STARTLINE T GamutToXYZ.gamut}
 addUserKnob {4 diagram l in t "Choose the type of chromaticity diagram: \nCIE 1931 xy Chromaticity Diagram\nCIE 1976 u' v' Uniform Chromaticity Scale Diagram" -STARTLINE M {"CIE 1931 xy" "CIE 1976 u' v'" "" ""}}
 addUserKnob {6 enable_sample_color l "sample color" t "Enable plotting of the sampled color" +STARTLINE}
 enable_sample_color true
 addUserKnob {41 sample_color l color t "sample and plot selected color" T SampleColor.color}
 addUserKnob {22 follow_viewer l "follow viewer" t "Follow the selected viewer node. This causes this node to automatically connect to whatever the followed viewer is connected to.\n\nThis is useful if you want to have a 2nd viewer showing a chromaticity plot for whever you're looking at in your main viewer." T "n = nuke.thisNode()\nnuke.root().begin()\nv = nuke.selectedNode()\nif not v or v.Class() != 'Viewer':\n    nuke.message('Please select a viewer node to follow.')\nelse:\n    v\['knobChanged'].setValue('v = nuke.activeViewer().node()\\nif v and v.name() == nuke.thisNode().name():\\n    con = v.input(nuke.activeViewer().activeInput())\\n    plt = nuke.toNode(\"\{0\}\")\\n    plt.setInput(0, con)'.format(n.name()))" +STARTLINE}
 addUserKnob {22 unfollow_viewer l "unfollow viewer" -STARTLINE T "n = nuke.thisNode()\nnuke.root().begin()\nv = nuke.selectedNode()\nif not v or v.Class() != 'Viewer':\n    nuke.message('Please select a viewer node to unfollow.')\nelse:\n    v\['knobChanged'].setValue('')"}
 addUserKnob {26 plot_dimensions_label l " " T "<b>Chromaticity Diagram"}
 addUserKnob {3 resolution l " resolution" t "resolution to output"}
 resolution 2048
 addUserKnob {7 right_margin l "right margin" R 1 1.5}
 right_margin 1.1
 addUserKnob {7 left_margin l "left margin" R 0 0.2}
 left_margin 0.1
 addUserKnob {6 draw_spectral_locus l "spectrum locus" t "draw the spectrum locus: the boundary of color the human eye can see." +STARTLINE}
 draw_spectral_locus true
 addUserKnob {6 draw_line_of_purples l "line of purples" t "draw the \"line of purples\"" -STARTLINE}
 draw_line_of_purples true
 addUserKnob {6 draw_planckian_locus l "planckian locus" t "Display the planckian locus or the blackbody locus." +STARTLINE}
 addUserKnob {6 gamut_grid l "gamut grid" t "Display a gamut boundary with a grid or dot pattern" +STARTLINE}
 addUserKnob {41 gamut_gamutgrid l "" t "gamut for gamutgrid" -STARTLINE T RGBToXYZ_GamutGrid.gamut}
 addUserKnob {4 gamut_grid_style l style t "Choose the style to display the gamut plot" -STARTLINE M {grid dots "" "" "" ""}}
 addUserKnob {4 distribution l dist t "Which chromaticity space should the overlays be constructed in? \n\nYxy is familiar, but not very perceptually uniform.\n\nu'v' is designed to be more perceptually uniform." -STARTLINE M {"1931 Yxy" "1976 u'v'" "" ""}}
 addUserKnob {7 density t "Density of the grid or points" R 10 100}
 density 50
 addUserKnob {6 gamut_a l "gamut a" t "Display a gamut outline" +STARTLINE}
 gamut_a true
 addUserKnob {41 gamut_a_1 l "" -STARTLINE T RGBToXYZ_GamutA.gamut}
 addUserKnob {6 gamut_b l "gamut b" t "Display a gamut outline" +STARTLINE}
 addUserKnob {41 gamut_b_1 l "" -STARTLINE T RGBToXYZ_GamutB.gamut}
 addUserKnob {6 gamut_c l "gamut c" t "Display a gamut outline" +STARTLINE}
 gamut_c true
 addUserKnob {41 gamut_c_1 l "" -STARTLINE T RGBToXYZ_GamutC.gamut}
 addUserKnob {6 draw_pointers_gamut l "pointer's gamut" t "DrawPointer's gamut boundary" +STARTLINE}
 addUserKnob {6 draw_pointers_samples l "pointers sample colors" t "show the individual pointer gamut samples" -STARTLINE}
 addUserKnob {6 draw_macbeth_chart l "macbeth chart" t "draw a ColorChecker24 aka Macbeth Chart" +STARTLINE}
 addUserKnob {6 coordinate_system l "coordinate system" t "Draw CIE xy coordinate grid x and y axes" +STARTLINE}
 coordinate_system true
 addUserKnob {6 map_overlays_to_input_gamut l "map overlays to input gamut" t "This maps the overlays like the spectral locus, pointer's gamut, and the gamut overlay to the working gamut instead of keeping them as XYZ.\n\nFor example if the input gamut is ACEScg, these overlays will be mapped to that. Note that this can cause most of the overlays to be negative or highly saturated which might harm the visual appearance." +STARTLINE}
 map_overlays_to_input_gamut true
}
 Group {
  inputs 0
  name GamutGrid1
  xpos -920
  ypos -201
  postage_stamp true
  addUserKnob {20 GamutGrid}
  addUserKnob {3 style}
  style {{!parent.gamut_grid_style}}
  addUserKnob {3 distribution -STARTLINE}
  distribution {{parent.distribution}}
  addUserKnob {7 density R 10 150}
  density {{parent.density}}
  addUserKnob {26 ""}
  addUserKnob {41 matrix T ColorMatrix.matrix}
  addUserKnob {12 wxy}
  wxy {{parent.RGBToXYZ_GamutGrid.wxy} {parent.RGBToXYZ_GamutGrid.wxy}}
 }
  ColorWheel {
   inputs 0
   format "512 512 0 0 512 512 1 square_512"
   centerSaturation 1
   fillFormat false
   area {-170 -158 682 670}
   name ColorWheel4
   xpos -260
   ypos -15
   postage_stamp false
  }
  Crop {
   box {0 0 {width} {height}}
   crop false
   name Crop2
   xpos -260
   ypos 27
  }
  Reformat {
   type scale
   scale {{max(parent.density/50,0.25)}}
   resize distort
   filter impulse
   pbb true
   name Reformat3
   xpos -260
   ypos 110
  }
set N7e845000 [stack 0]
push $N7e845000
  ContactSheet {
   inputs 2
   width {{width*columns}}
   height {{height/pixel_aspect*rows}}
   rows 1
   columns 2
   roworder TopBottom
   name ContactSheet2
   xpos -260
   ypos 169
  }
  Dot {
   name Dot1
   label " "
   note_font "Helvetica Bold"
   note_font_size 24
   note_font_color 0xa5a5a501
   xpos -226
   ypos 246
  }
  ColorWheel {
   inputs 0
   format "512 512 0 0 512 512 1 square_512"
   fillFormat false
   area {40 40 472 472}
   name ColorWheel1
   xpos -40
   ypos -664
   postage_stamp false
  }
  Reformat {
   type scale
   scale {{max(parent.density/50,0.25)}}
   resize distort
   filter impulse
   pbb true
   name Reformat1
   xpos -40
   ypos -628
  }
  Crop {
   box {0 0 {width} {height}}
   reformat true
   name Crop1
   xpos -40
   ypos -602
  }
  Unpremult {
   name Unpremult1
   xpos -40
   ypos -526
  }
  ColorMatrix {
   matrix {
       {{parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix}}
       {{parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix}}
       {{parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix}}
     }
   name ColorMatrix
   label "RGB to XYZ"
   xpos -40
   ypos -415
  }
  Colorspace {
   colorspace_in CIE-XYZ
   colorspace_out CIE-Yxy
   name Colorspace1
   label "\[value colorspace_in] -> \[value colorspace_out]"
   xpos -40
   ypos -341
  }
set N7e7be400 [stack 0]
  Dot {
   name Dot2
   label " "
   note_font "Helvetica Bold"
   note_font_size 24
   note_font_color 0xa5a5a501
   xpos -556
   ypos -331
  }
  Expression {
   expr0 r
   expr1 "4*g / ( -2*g + 12*b + 3)"
   expr2 "9*b / ( -2*g + 12*b + 3)"
   name Expression5
   label "CIE Yxy to CIELuv"
   xpos -590
   ypos -304
   disable {{!parent.distribution}}
  }
  Expression {
   expr0 r
   expr1 "(-(degrees(atan2(g-white.x, b-white.y))-180)+270)%360/360"
   expr2 "hypot(g-white.x, b-white.y)"
   expr3 a
   name Expression3
   xpos -590
   ypos -261
   cached true
   addUserKnob {20 User}
   addUserKnob {12 white}
   white {{"parent.distribution ? 4*parent.wxy.x / ( -2 * parent.wxy.x + 12 * parent.wxy.y + 3) : parent.wxy"} {"parent.distribution ? 9*parent.wxy.y / ( -2*parent.wxy.x + 12*parent.wxy.y + 3) : parent.wxy"}}
  }
set N7e7bd800 [stack 0]
  Posterize {
   channels rgb
   Colors {{rint(parent.density/3*2)}}
   name Posterize1
   xpos -590
   ypos -191
  }
set N7e7bd400 [stack 0]
push $N7e7bd800
  Dot {
   name Dot15
   xpos -446
   ypos -257
  }
  Copy {
   inputs 2
   from0 rgba.blue
   to0 rgba.blue
   name Copy1
   xpos -480
   ypos -154
  }
push $N7e7bd400
push $N7e7bd800
  Dot {
   name Dot16
   xpos -666
   ypos -257
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy2
   xpos -700
   ypos -153
  }
  ContactSheet {
   inputs 2
   width {{width*columns}}
   height {{height/pixel_aspect*rows}}
   rows 1
   columns 2
   center true
   roworder TopBottom
   name ContactSheet3
   xpos -590
   ypos -106
  }
  Expression {
   expr0 r
   expr1 cos(radians(g*360))*b+white.x
   expr2 sin(radians(g*360))*b+white.y
   expr3 a
   name Expression19
   xpos -590
   ypos -58
   cached true
   addUserKnob {20 User}
   addUserKnob {12 white}
   white {{parent.Expression3.white} {parent.Expression3.white}}
  }
  Expression {
   expr0 r
   expr1 "9*g / ( 6*g - 16*b + 12)"
   expr2 "4*b/ ( 6*g - 16*b + 12)"
   name Expression2
   label "CIELuv to CIE Yxy"
   xpos -590
   ypos -16
   disable {{!parent.distribution}}
  }
  Colorspace {
   colorspace_in CIE-Yxy
   colorspace_out CIE-XYZ
   name Colorspace2
   label "\[value colorspace_in] -> \[value colorspace_out]"
   xpos -590
   ypos 32
  }
  ColorMatrix {
   matrix {
       {{parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix}}
       {{parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix}}
       {{parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix}}
     }
   invert true
   name ColorMatrix1
   label "XYZ to RGB"
   xpos -590
   ypos 81
  }
  Clamp {
   channels rgba
   maximum_enable false
   name ClampMin2
   xpos -590
   ypos 119
  }
  Clamp {
   channels alpha
   minimum 1
   MinClampTo_enable true
   MaxClampTo_enable true
   name Clamp1
   xpos -590
   ypos 152
  }
  Premult {
   name Premult1
   xpos -590
   ypos 194
  }
  Merge2 {
   inputs 2
   operation under
   bbox B
   name Merge2
   xpos -590
   ypos 242
  }
  Fill {
   output alpha
   name Fill1
   xpos -590
   ypos 297
  }
  Dot {
   name Dot3
   label " GRID"
   note_font "Helvetica Bold"
   note_font_size 24
   note_font_color 0xa5a5a501
   xpos -556
   ypos 378
  }
push $N7e845000
push $N7e7be400
  Expression {
   expr0 r
   expr1 "4*g / ( -2*g + 12*b + 3)"
   expr2 "9*b / ( -2*g + 12*b + 3)"
   name Expression4
   label "CIE Yxy to CIELuv"
   xpos -40
   ypos -280
   disable {{!parent.distribution}}
  }
  Expression {
   expr0 r
   expr1 rint(g*Colors)/Colors
   expr2 rint(b*Colors)/Colors
   expr3 a
   name Expression1
   label rint
   xpos -40
   ypos -232
   addUserKnob {20 User}
   addUserKnob {7 Colors R 1 256}
   Colors {{parent.density}}
  }
  Expression {
   expr0 r
   expr1 "9*g / ( 6*g - 16*b + 12)"
   expr2 "4*b/ ( 6*g - 16*b + 12)"
   name Expression6
   label "CIELuv to CIE Yxy"
   xpos -40
   ypos -184
   disable {{!parent.distribution}}
  }
  Colorspace {
   colorspace_in CIE-Yxy
   colorspace_out CIE-XYZ
   name Colorspace3
   label "\[value colorspace_in] -> \[value colorspace_out]"
   xpos -40
   ypos -112
  }
  ColorMatrix {
   matrix {
       {{parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix}}
       {{parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix}}
       {{parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix}}
     }
   invert true
   name ColorMatrix3
   label "XYZ to RGB"
   xpos -40
   ypos -57
  }
  Clamp {
   channels alpha
   minimum 1
   MinClampTo_enable true
   MaxClampTo_enable true
   name Clamp4
   xpos -40
  }
  Premult {
   name Premult2
   xpos -40
   ypos 55
  }
  Merge2 {
   inputs 2
   operation under
   bbox B
   name Merge1
   xpos -40
   ypos 110
  }
  Clamp {
   channels rgba
   maximum_enable false
   name ClampMin1
   xpos -40
   ypos 273
  }
  Dot {
   name Dot4
   label " DOTS"
   note_font "Helvetica Bold"
   note_font_size 24
   note_font_color 0xa5a5a501
   xpos -6
   ypos 378
  }
  Switch {
   inputs 2
   which {{parent.style}}
   name Switch1
   xpos -257
   ypos 483
  }
  ColorMatrix {
   matrix {
       {{parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix}}
       {{parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix}}
       {{parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix}}
     }
   name ColorMatrix2
   label "RGB to XYZ"
   xpos -257
   ypos 560
  }
  Output {
   name Output
   xpos -257
   ypos 740
  }
  ColorWheel {
   inputs 0
   format "256 256 0 0 256 256 1 square_256"
   area {40 40 472 472}
   name ColorWheel2
   xpos -37
   ypos -705
   postage_stamp false
  }
 end_group
set N7e7f3900 [stack 0]
 Group {
  name RGBToXYZ_GamutGrid
  label "\[if \{\[value invert]\} \{return \"XYZ to \[value gamut]\"\} else \{return \"\[value gamut] to XYZ\"\}]\n\n"
  xpos -1030
  ypos -184
  addUserKnob {20 GamutToXYZ_tab l GamutToXYZ}
  addUserKnob {4 gamut t "Choose gamut" M {XYZ ACES ACEScg "Filmlight E-Gamut" Rec709 Rec2020 P3D60 P3D65 P3DCI "Arri AlexaWideGamut" REDDRAGONcolor REDDRAGONcolor2 REDcolor REDcolor2 REDcolor3 REDcolor4 REDWideGamutRGB "GoPro Protune Native" CanonCinemaGamut SonySGamut SonySGamut3Cine PanasonicVGamut "DJI D-Gamut" "Fujifilm F-Gamut" BMDFilmV1 BMD4kFilmV1 BMD4kFilmV3 BMD46kFilmV1 BMD46kFilmV3 BMDWideGamutV4 "AdobeRGB\t" AdobeWideGamutRGB ROMM RIMM ERIMM ProPhotoRGB RusselRGB SharpRGB AppleRGB BestRGB}}
  gamut ACEScg
  addUserKnob {6 invert +STARTLINE}
  addUserKnob {26 ""}
  addUserKnob {26 chromaticity_coordinates_label l " " T "<b>Chromaticity Coordinates</b>"}
  addUserKnob {41 rxy T ColorMatrix.rxy}
  addUserKnob {41 gxy T ColorMatrix.gxy}
  addUserKnob {41 bxy T ColorMatrix.bxy}
  addUserKnob {41 wxy T ColorMatrix.wxy}
  addUserKnob {41 matrix T ColorMatrix.matrix}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -10
  }
  ColorMatrix {
   matrix {
       {{curve(which) 1 0.9525524378 0.6624541879 0.7053968906 0.4123907983 0.6369580626 0.5049495697 0.4865709841 0.4451698363 0.6380076408 0.5070186853 0.4462202489 0.4300414324 0.4581649601 0.4878340662 0.4517004192 0.7352752686 0.5022571683 0.7160496712 0.7064827085 0.5990839601 0.6796444654 0.6481720209 0.6369580626 0.6390493512 0.6141571999 0.3724023998 0.60689044 0.4017650783 0.6065810919 0.5766690373 0.7165006995 0.797760427 0.797760427 0.797760427 0.7976718545 0.7015837431 0.8156226277 0.4496616423 0.6318944097} {curve(which) 0 0 0.1340042055 0.1640413404 0.3575843275 0.1446169019 0.2646814585 0.2656676769 0.2771343887 0.2147038579 0.3587769568 0.3157556653 0.3700728714 0.3832037449 0.3432727158 0.3178463876 0.06860940903 0.2929667532 0.1296834797 0.1288010478 0.2489254922 0.1522114277 0.1940581352 0.1446169019 0.1578372866 0.2825684249 0.4324877858 0.2193847299 0.4560420811 0.2203479856 0.1855582297 0.1010205746 0.1351858526 0.1351858526 0.1351858526 0.1351878047 0.1554162204 0.04716260359 0.3162561059 0.2053879201} {curve(which) 0 9.367863095e-05 0.1561876982 0.08101774752 0.180480808 0.1688809693 0.1830150485 0.1982172877 0.1722826511 0.09774444997 0.0868505761 0.190669477 0.152531758 0.1112773567 0.1215386018 0.1830992699 0.1465712637 0.1552320272 0.1047228053 0.1151721701 0.1024464965 0.1186000481 0.108225815 0.1688809693 0.1516760886 0.05183707923 0.1436725408 0.124180764 0.09264881909 0.123526901 0.1882286519 0.1467743814 0.03134934977 0.03134934977 0.03134934977 0.03133957833 0.09979832917 0.1372147948 0.1845382005 0.1270133406}}
       {{curve(which) 0 0.3439664543 0.2722287476 0.2801307142 0.2126390189 0.2627002299 0.237623319 0.2289745659 0.209491685 0.2919537723 0.2207257152 0.1942579001 0.2022213936 0.1694435924 0.2289056629 0.2119505703 0.2866941094 0.1387997568 0.2612613738 0.2709796727 0.2150758505 0.2606855333 0.2830046713 0.2627002299 0.1743051857 0.2365771234 0.1383759677 0.1973138005 0.1721783578 0.2680045366 0.2973450124 0.258728236 0.2880711257 0.2880711257 0.2880711257 0.2880405784 0.3152042925 0.3790788651 0.2446159422 0.2276017666} {curve(which) 1 0.7281661034 0.6740817428 0.8202066422 0.7151686549 0.6779980659 0.6891706586 0.6917385459 0.7215952873 0.8238410354 0.839184761 0.7385566831 0.7585275769 0.8648257852 0.7808576822 0.7230190039 0.8429791331 0.910841465 0.8696421385 0.786606431 0.8850684762 0.7748944759 0.8131960034 0.6779980659 0.951146543 0.8896810412 0.911518693 0.943950057 0.8553914428 0.8326833844 0.6273635626 0.7246823311 0.7118432522 0.7118432522 0.7118432522 0.7118694782 0.6648360491 0.5769088268 0.6720442176 0.7383946776} {curve(which) 0 -0.07213255018 0.05368951708 -0.1003373638 0.07219231874 0.05930171534 0.07320601493 0.07928691059 0.06891305745 -0.1157948226 -0.05991046131 0.06718540192 0.03925102949 -0.03426937759 -0.009763340466 0.06503042579 -0.1296732277 -0.04964122549 -0.1309035122 -0.05758608505 -0.1001443192 -0.03558001295 -0.09620071948 0.05930171534 -0.1254517138 -0.1262581497 -0.04989464581 -0.1412638426 -0.02756982669 -0.1006879359 0.07529145479 0.01658944227 8.565396274e-05 8.565396274e-05 8.565396274e-05 8.991353388e-05 0.01995966583 0.04401229322 0.08333983272 0.0340035744}}
       {{curve(which) 0 -3.863927134e-08 -0.005574660841 -0.1037815213 0.01933082007 0 0 0 0 0.0027982709 -0.0544523783 -0.04792318866 -0.0176958181 -0.1061859056 -0.02100777067 -0.01945115253 -0.07968087494 0.07801423222 -0.009676366113 -0.009677864611 -0.03206583485 -0.009310216643 -0.01825834997 0 -0.11669112 -0.02325225808 -0.1602820009 -0.1427432895 -0.10720893 -0.02941203304 0.02703136392 -2.906408625e-08 -3.236030111e-08 -3.236030111e-08 -3.236030111e-08 0 0 -0.01229703799 0.02518104948 0} {curve(which) 0 0 0.004060741514 -0.07290724665 0.1191947311 0.0280726999 0.0449459292 0.04511339962 0.04706057906 -0.06703422964 -0.0003228379355 -0.0002844714036 0.08768811822 0.02554347552 0.01782695204 0.01650637016 -0.3473432064 -0.3148325086 -0.2364816219 0.004600019194 -0.02765839547 -0.004612449091 -0.08316776901 0.0280726999 -0.5518454909 -0.4897170365 -0.171635136 -0.4278847873 0.07809129357 -0.08659287542 0.07068887353 0.05121183768 1.2621717e-08 1.2621717e-08 1.2621717e-08 -1.262213711e-08 0.04317118227 0.01672476344 0.1411857158 0.01001892332} {curve(which) 1 1.008825183 1.010339141 1.265746474 0.950532198 1.060985088 0.9638792276 1.043944359 0.9073553085 1.153293729 1.063571215 1.057001948 0.9388025999 1.089437366 1.01197505 1.011739731 1.51608181 1.325875998 1.335215807 1.094135642 1.148782015 1.102980375 1.190483928 1.060985088 1.745692492 1.590125084 1.409072995 1.65968585 1.118175387 1.205062628 0.9913375378 0.7738927603 0.8251045942 0.8251045942 0.8251045942 0.8248898983 0.8782252669 0.9955722094 0.9226909876 0.8150856495}}
     }
   invert {{parent.invert}}
   name ColorMatrix
   label "RGB to XYZ"
   xpos -40
   ypos 32
   addUserKnob {20 Gamut}
   addUserKnob {3 which}
   which {{parent.gamut}}
   addUserKnob {12 rxy}
   rxy {{curve(which) 1 0.7347 0.713 0.8 0.64 0.708 0.68 0.68 0.68 0.684 0.7530442228 0.7530444911 0.6997470013 0.8786825105 0.7011810359 0.7011805919 0.780308 0.69848046 0.74 0.73 0.766 0.73 0.71 0.708 0.9173 0.7422 1.0625 0.9175 0.8608 0.7177 0.64 0.7347 0.7347 0.7347 0.7347 0.734699 0.69 0.6898 0.625 0.7351916376} {curve(which) 0 0.2653 0.293 0.3177 0.33 0.292 0.32 0.32 0.32 0.313 0.3278305767 0.3278310295 0.3290469303 0.3249640074 0.3290141556 0.3290136991 0.304253 0.19302645 0.27 0.28 0.275 0.28 0.31 0.292 0.2502 0.2859 0.3948 0.2983 0.3689 0.3171 0.33 0.2653 0.2653 0.2653 0.2653 0.265301 0.31 0.3206 0.34 0.2648083624}}
   addUserKnob {12 gxy}
   gxy {{curve(which) 0 0 0.165 0.18 0.3 0.17 0.265 0.265 0.265 0.221 0.2995702285 0.2995704905 0.304264039 0.3008887144 0.3006003047 0.3006003955 0.121595 0.32955538 0.17 0.14 0.225 0.165 0.21 0.17 0.2833 0.414 0.3689 0.2983 0.3282 0.228 0.21 0.1152 0.1596 0.1596 0.1596 0.159597 0.18 0.0736 0.28 0.2153361345} {curve(which) 1 1 0.83 0.9 0.6 0.797 0.69 0.69 0.69 0.848 0.700699322 0.7006994156 0.6236411451 0.6790547558 0.6837888343 0.6837888243 1.493994 1.02459662 1.14 0.855 0.8 0.84 0.88 0.797 1.7072 1.3035 0.7775 1.2835 0.6156 0.8616 0.71 0.8264 0.8404 0.8404 0.8404 0.840403 0.77 0.9003 0.595 0.7741596639}}
   addUserKnob {12 bxy}
   bxy {{curve(which) 0 0.0001 0.128 0.065 0.15 0.131 0.15 0.15 0.15 0.0861 0.07964206674 0.1450115843 0.1349139613 0.09539869461 0.1081544556 0.1453319462 0.095612 0.10844263 0.08 0.1 0.089 0.1 0.09 0.131 0.0856 0.0342 0.0956 0.0756 0.0783 0.1006 0.15 0.1566 0.0366 0.0366 0.0366 0.036598 0.1 0.1166 0.155 0.1301229508} {curve(which) 0 -0.077 0.044 -0.0805 0.06 0.046 0.06 0.06 0.06 -0.102 -0.05493795109 0.05109712509 0.03471744128 -0.02937932683 -0.008688175787 0.05161680362 -0.084589 -0.03467857 -0.1 -0.05 -0.087 -0.03 -0.08 0.046 -0.0708 -0.0833 -0.0332 -0.086 -0.0233 -0.082 0.06 0.0177 0.0001 0.0001 0.0001 0.000105 0.02 0.0374 0.07 0.03483606557}}
   addUserKnob {12 wxy}
   wxy {{curve(which) 0.33333333 0.32168 0.32168 0.3127 0.3127 0.3127 0.32168 0.3127 0.314 0.3127 0.3216831877 0.3216832104 0.3216832894 0.3216832894 0.3216832104 0.3216832894 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3135 0.3135 0.3135 0.3127 0.3127 0.3127 0.3127 0.3457 0.3457 0.3457 0.3457 0.345704 0.33243 0.33333333 0.3127 0.3457} {curve(which) 0.33333333 0.33767 0.33767 0.329 0.329 0.329 0.33767 0.329 0.351 0.329 0.337673316 0.3376736101 0.3376734472 0.3376734472 0.3376736101 0.3376734472 0.329 0.329 0.329 0.329 0.329 0.329 0.329 0.329 0.3305 0.3305 0.3305 0.329 0.329 0.329 0.329 0.3585 0.3585 0.3585 0.3585 0.35854 0.34744 0.33333333 0.329 0.3585}}
  }
  Output {
   name Output
   xpos -40
   ypos 86
  }
 end_group
 ColorWheel {
  inputs 0
  format "512 512 0 0 512 512 1 square_512"
  centerSaturation 1
  fillFormat false
  area {-196 -184 708 696}
  name ColorWheel1
  xpos -920
  ypos 5
 }
 Crop {
  box {0 0 {width} {height}}
  name Crop1
  xpos -920
  ypos 87
 }
 BlackOutside {
  name BlackOutside3
  xpos -920
  ypos 134
 }
set N7e6f8400 [stack 0]
 Group {
  name RGBToXYZ_GamutC
  label "\[if \{\[value invert]\} \{return \"XYZ to \[value gamut]\"\} else \{return \"\[value gamut] to XYZ\"\}]\n\n"
  xpos -1140
  ypos 176
  addUserKnob {20 GamutToXYZ_tab l GamutToXYZ}
  addUserKnob {4 gamut t "Choose gamut" M {XYZ ACES ACEScg "Filmlight E-Gamut" "DaVinci WG" Rec709 Rec2020 P3D60 P3D65 P3DCI "Arri AlexaWideGamut" REDDRAGONcolor REDDRAGONcolor2 REDcolor REDcolor2 REDcolor3 REDcolor4 REDWideGamutRGB "GoPro Protune Native" CanonCinemaGamut SonySGamut SonySGamut3Cine PanasonicVGamut "DJI D-Gamut" "Fujifilm F-Gamut" BMDFilmV1 BMD4kFilmV1 BMD4kFilmV3 BMD46kFilmV1 BMD46kFilmV3 BMDWideGamutV4 "AdobeRGB\t" AdobeWideGamutRGB ROMM RIMM ERIMM ProPhotoRGB RusselRGB SharpRGB AppleRGB BestRGB}}
  gamut Rec709
  addUserKnob {6 invert +STARTLINE}
  addUserKnob {26 ""}
  addUserKnob {26 chromaticity_coordinates_label l " " T "<b>Chromaticity Coordinates</b>"}
  addUserKnob {41 rxy T ColorMatrix.rxy}
  addUserKnob {41 gxy T ColorMatrix.gxy}
  addUserKnob {41 bxy T ColorMatrix.bxy}
  addUserKnob {41 wxy T ColorMatrix.wxy}
  addUserKnob {41 matrix T ColorMatrix.matrix}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -10
  }
  ColorMatrix {
   matrix {
       {{curve(which) 1 0.9525524378 0.6624541879 0.7053968906 0.7006223798 0.4123907983 0.6369580626 0.5049495697 0.4865709841 0.4451698363 0.6380076408 0.5070186853 0.4462202489 0.4300414324 0.4581649601 0.4878340662 0.4517004192 0.7352752686 0.5022571683 0.7160496712 0.7064827085 0.5990839601 0.6796444654 0.6481720209 0.6369580626 0.6390493512 0.6141571999 0.3724023998 0.60689044 0.4017650783 0.6065810919 0.5766690373 0.7165006995 0.797760427 0.797760427 0.797760427 0.7976718545 0.7015837431 0.8156226277 0.4496616423 0.6318944097} {curve(which) 0 0 0.1340042055 0.1640413404 0.1487748176 0.3575843275 0.1446169019 0.2646814585 0.2656676769 0.2771343887 0.2147038579 0.3587769568 0.3157556653 0.3700728714 0.3832037449 0.3432727158 0.3178463876 0.06860940903 0.2929667532 0.1296834797 0.1288010478 0.2489254922 0.1522114277 0.1940581352 0.1446169019 0.1578372866 0.2825684249 0.4324877858 0.2193847299 0.4560420811 0.2203479856 0.1855582297 0.1010205746 0.1351858526 0.1351858526 0.1351858526 0.1351878047 0.1554162204 0.04716260359 0.3162561059 0.2053879201} {curve(which) 0 9.367863095e-05 0.1561876982 0.08101774752 0.101058729 0.180480808 0.1688809693 0.1830150485 0.1982172877 0.1722826511 0.09774444997 0.0868505761 0.190669477 0.152531758 0.1112773567 0.1215386018 0.1830992699 0.1465712637 0.1552320272 0.1047228053 0.1151721701 0.1024464965 0.1186000481 0.108225815 0.1688809693 0.1516760886 0.05183707923 0.1436725408 0.124180764 0.09264881909 0.123526901 0.1882286519 0.1467743814 0.03134934977 0.03134934977 0.03134934977 0.03133957833 0.09979832917 0.1372147948 0.1845382005 0.1270133406}}
       {{curve(which) 0 0.3439664543 0.2722287476 0.2801307142 0.2741185129 0.2126390189 0.2627002299 0.237623319 0.2289745659 0.209491685 0.2919537723 0.2207257152 0.1942579001 0.2022213936 0.1694435924 0.2289056629 0.2119505703 0.2866941094 0.1387997568 0.2612613738 0.2709796727 0.2150758505 0.2606855333 0.2830046713 0.2627002299 0.1743051857 0.2365771234 0.1383759677 0.1973138005 0.1721783578 0.2680045366 0.2973450124 0.258728236 0.2880711257 0.2880711257 0.2880711257 0.2880405784 0.3152042925 0.3790788651 0.2446159422 0.2276017666} {curve(which) 1 0.7281661034 0.6740817428 0.8202066422 0.8736318946 0.7151686549 0.6779980659 0.6891706586 0.6917385459 0.7215952873 0.8238410354 0.839184761 0.7385566831 0.7585275769 0.8648257852 0.7808576822 0.7230190039 0.8429791331 0.910841465 0.8696421385 0.786606431 0.8850684762 0.7748944759 0.8131960034 0.6779980659 0.951146543 0.8896810412 0.911518693 0.943950057 0.8553914428 0.8326833844 0.6273635626 0.7246823311 0.7118432522 0.7118432522 0.7118432522 0.7118694782 0.6648360491 0.5769088268 0.6720442176 0.7383946776} {curve(which) 0 -0.07213255018 0.05368951708 -0.1003373638 -0.1477504075 0.07219231874 0.05930171534 0.07320601493 0.07928691059 0.06891305745 -0.1157948226 -0.05991046131 0.06718540192 0.03925102949 -0.03426937759 -0.009763340466 0.06503042579 -0.1296732277 -0.04964122549 -0.1309035122 -0.05758608505 -0.1001443192 -0.03558001295 -0.09620071948 0.05930171534 -0.1254517138 -0.1262581497 -0.04989464581 -0.1412638426 -0.02756982669 -0.1006879359 0.07529145479 0.01658944227 8.565396274e-05 8.565396274e-05 8.565396274e-05 8.991353388e-05 0.01995966583 0.04401229322 0.08333983272 0.0340035744}}
       {{curve(which) 0 -3.863927134e-08 -0.005574660841 -0.1037815213 -0.09896291792 0.01933082007 0 0 0 0 0.0027982709 -0.0544523783 -0.04792318866 -0.0176958181 -0.1061859056 -0.02100777067 -0.01945115253 -0.07968087494 0.07801423222 -0.009676366113 -0.009677864611 -0.03206583485 -0.009310216643 -0.01825834997 0 -0.11669112 -0.02325225808 -0.1602820009 -0.1427432895 -0.10720893 -0.02941203304 0.02703136392 -2.906408625e-08 -3.236030111e-08 -3.236030111e-08 -3.236030111e-08 0 0 -0.01229703799 0.02518104948 0} {curve(which) 0 0 0.004060741514 -0.07290724665 -0.1378953159 0.1191947311 0.0280726999 0.0449459292 0.04511339962 0.04706057906 -0.06703422964 -0.0003228379355 -0.0002844714036 0.08768811822 0.02554347552 0.01782695204 0.01650637016 -0.3473432064 -0.3148325086 -0.2364816219 0.004600019194 -0.02765839547 -0.004612449091 -0.08316776901 0.0280726999 -0.5518454909 -0.4897170365 -0.171635136 -0.4278847873 0.07809129357 -0.08659287542 0.07068887353 0.05121183768 1.2621717e-08 1.2621717e-08 1.2621717e-08 -1.262213711e-08 0.04317118227 0.01672476344 0.1411857158 0.01001892332} {curve(which) 1 1.008825183 1.010339141 1.265746474 1.325916052 0.950532198 1.060985088 0.9638792276 1.043944359 0.9073553085 1.153293729 1.063571215 1.057001948 0.9388025999 1.089437366 1.01197505 1.011739731 1.51608181 1.325875998 1.335215807 1.094135642 1.148782015 1.102980375 1.190483928 1.060985088 1.745692492 1.590125084 1.409072995 1.65968585 1.118175387 1.205062628 0.9913375378 0.7738927603 0.8251045942 0.8251045942 0.8251045942 0.8248898983 0.8782252669 0.9955722094 0.9226909876 0.8150856495}}
     }
   invert {{parent.invert}}
   name ColorMatrix
   label "RGB to XYZ"
   xpos -40
   ypos 32
   addUserKnob {20 Gamut}
   addUserKnob {3 which}
   which {{parent.gamut}}
   addUserKnob {12 rxy}
   rxy {{curve(which) 1 0.7347 0.713 0.8 0.8 0.64 0.708 0.68 0.68 0.68 0.684 0.7530442228 0.7530444911 0.6997470013 0.8786825105 0.7011810359 0.7011805919 0.780308 0.69848046 0.74 0.73 0.766 0.73 0.71 0.708 0.9173 0.7422 1.0625 0.9175 0.8608 0.7177 0.64 0.7347 0.7347 0.7347 0.7347 0.734699 0.69 0.6898 0.625 0.7351916376} {curve(which) 0 0.2653 0.293 0.3177 0.313 0.33 0.292 0.32 0.32 0.32 0.313 0.3278305767 0.3278310295 0.3290469303 0.3249640074 0.3290141556 0.3290136991 0.304253 0.19302645 0.27 0.28 0.275 0.28 0.31 0.292 0.2502 0.2859 0.3948 0.2983 0.3689 0.3171 0.33 0.2653 0.2653 0.2653 0.2653 0.265301 0.31 0.3206 0.34 0.2648083624}}
   addUserKnob {12 gxy}
   gxy {{curve(which) 0 0 0.165 0.18 0.1682 0.3 0.17 0.265 0.265 0.265 0.221 0.2995702285 0.2995704905 0.304264039 0.3008887144 0.3006003047 0.3006003955 0.121595 0.32955538 0.17 0.14 0.225 0.165 0.21 0.17 0.2833 0.414 0.3689 0.2983 0.3282 0.228 0.21 0.1152 0.1596 0.1596 0.1596 0.159597 0.18 0.0736 0.28 0.2153361345} {curve(which) 1 1 0.83 0.9 0.9877 0.6 0.797 0.69 0.69 0.69 0.848 0.700699322 0.7006994156 0.6236411451 0.6790547558 0.6837888343 0.6837888243 1.493994 1.02459662 1.14 0.855 0.8 0.84 0.88 0.797 1.7072 1.3035 0.7775 1.2835 0.6156 0.8616 0.71 0.8264 0.8404 0.8404 0.8404 0.840403 0.77 0.9003 0.595 0.7741596639}}
   addUserKnob {12 bxy}
   bxy {{curve(which) 0 0.0001 0.128 0.065 0.079 0.15 0.131 0.15 0.15 0.15 0.0861 0.07964206674 0.1450115843 0.1349139613 0.09539869461 0.1081544556 0.1453319462 0.095612 0.10844263 0.08 0.1 0.089 0.1 0.09 0.131 0.0856 0.0342 0.0956 0.0756 0.0783 0.1006 0.15 0.1566 0.0366 0.0366 0.0366 0.036598 0.1 0.1166 0.155 0.1301229508} {curve(which) 0 -0.077 0.044 -0.0805 -0.1155 0.06 0.046 0.06 0.06 0.06 -0.102 -0.05493795109 0.05109712509 0.03471744128 -0.02937932683 -0.008688175787 0.05161680362 -0.084589 -0.03467857 -0.1 -0.05 -0.087 -0.03 -0.08 0.046 -0.0708 -0.0833 -0.0332 -0.086 -0.0233 -0.082 0.06 0.0177 0.0001 0.0001 0.0001 0.000105 0.02 0.0374 0.07 0.03483606557}}
   addUserKnob {12 wxy}
   wxy {{curve(which) 0.33333333 0.32168 0.32168 0.3127 0.3127 0.3127 0.3127 0.32168 0.3127 0.314 0.3127 0.3216831877 0.3216832104 0.3216832894 0.3216832894 0.3216832104 0.3216832894 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3135 0.3135 0.3135 0.3127 0.3127 0.3127 0.3127 0.3457 0.3457 0.3457 0.3457 0.345704 0.33243 0.33333333 0.3127 0.3457} {curve(which) 0.33333333 0.33767 0.33767 0.329 0.329 0.329 0.329 0.33767 0.329 0.351 0.329 0.337673316 0.3376736101 0.3376734472 0.3376734472 0.3376736101 0.3376734472 0.329 0.329 0.329 0.329 0.329 0.329 0.329 0.329 0.3305 0.3305 0.3305 0.329 0.329 0.329 0.329 0.3585 0.3585 0.3585 0.3585 0.35854 0.34744 0.33333333 0.329 0.3585}}
  }
  Output {
   name Output
   xpos -40
   ypos 86
  }
 end_group
 Position {
  translate {{parent.Reformat1.box_width+Rectangle1.area.r+input.width} {parent.ReformatBox4.box_width-input.height}}
  name Position6
  xpos -1140
  ypos 254
 }
push $N7e6f8400
 Group {
  name RGBToXYZ_GamutB
  label "\[if \{\[value invert]\} \{return \"XYZ to \[value gamut]\"\} else \{return \"\[value gamut] to XYZ\"\}]\n\n"
  xpos -1030
  ypos 176
  addUserKnob {20 GamutToXYZ_tab l GamutToXYZ}
  addUserKnob {4 gamut t "Choose gamut" M {XYZ ACES ACEScg "Filmlight E-Gamut" "DaVinci WG" Rec709 Rec2020 P3D60 P3D65 P3DCI "Arri AlexaWideGamut" REDDRAGONcolor REDDRAGONcolor2 REDcolor REDcolor2 REDcolor3 REDcolor4 REDWideGamutRGB "GoPro Protune Native" CanonCinemaGamut SonySGamut SonySGamut3Cine PanasonicVGamut "DJI D-Gamut" "Fujifilm F-Gamut" BMDFilmV1 BMD4kFilmV1 BMD4kFilmV3 BMD46kFilmV1 BMD46kFilmV3 BMDWideGamutV4 "AdobeRGB\t" AdobeWideGamutRGB ROMM RIMM ERIMM ProPhotoRGB RusselRGB SharpRGB AppleRGB BestRGB}}
  gamut P3D65
  addUserKnob {6 invert +STARTLINE}
  addUserKnob {26 ""}
  addUserKnob {26 chromaticity_coordinates_label l " " T "<b>Chromaticity Coordinates</b>"}
  addUserKnob {41 rxy T ColorMatrix.rxy}
  addUserKnob {41 gxy T ColorMatrix.gxy}
  addUserKnob {41 bxy T ColorMatrix.bxy}
  addUserKnob {41 wxy T ColorMatrix.wxy}
  addUserKnob {41 matrix T ColorMatrix.matrix}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -10
  }
  ColorMatrix {
   matrix {
       {{curve(which) 1 0.9525524378 0.6624541879 0.7053968906 0.7006223798 0.4123907983 0.6369580626 0.5049495697 0.4865709841 0.4451698363 0.6380076408 0.5070186853 0.4462202489 0.4300414324 0.4581649601 0.4878340662 0.4517004192 0.7352752686 0.5022571683 0.7160496712 0.7064827085 0.5990839601 0.6796444654 0.6481720209 0.6369580626 0.6390493512 0.6141571999 0.3724023998 0.60689044 0.4017650783 0.6065810919 0.5766690373 0.7165006995 0.797760427 0.797760427 0.797760427 0.7976718545 0.7015837431 0.8156226277 0.4496616423 0.6318944097} {curve(which) 0 0 0.1340042055 0.1640413404 0.1487748176 0.3575843275 0.1446169019 0.2646814585 0.2656676769 0.2771343887 0.2147038579 0.3587769568 0.3157556653 0.3700728714 0.3832037449 0.3432727158 0.3178463876 0.06860940903 0.2929667532 0.1296834797 0.1288010478 0.2489254922 0.1522114277 0.1940581352 0.1446169019 0.1578372866 0.2825684249 0.4324877858 0.2193847299 0.4560420811 0.2203479856 0.1855582297 0.1010205746 0.1351858526 0.1351858526 0.1351858526 0.1351878047 0.1554162204 0.04716260359 0.3162561059 0.2053879201} {curve(which) 0 9.367863095e-05 0.1561876982 0.08101774752 0.101058729 0.180480808 0.1688809693 0.1830150485 0.1982172877 0.1722826511 0.09774444997 0.0868505761 0.190669477 0.152531758 0.1112773567 0.1215386018 0.1830992699 0.1465712637 0.1552320272 0.1047228053 0.1151721701 0.1024464965 0.1186000481 0.108225815 0.1688809693 0.1516760886 0.05183707923 0.1436725408 0.124180764 0.09264881909 0.123526901 0.1882286519 0.1467743814 0.03134934977 0.03134934977 0.03134934977 0.03133957833 0.09979832917 0.1372147948 0.1845382005 0.1270133406}}
       {{curve(which) 0 0.3439664543 0.2722287476 0.2801307142 0.2741185129 0.2126390189 0.2627002299 0.237623319 0.2289745659 0.209491685 0.2919537723 0.2207257152 0.1942579001 0.2022213936 0.1694435924 0.2289056629 0.2119505703 0.2866941094 0.1387997568 0.2612613738 0.2709796727 0.2150758505 0.2606855333 0.2830046713 0.2627002299 0.1743051857 0.2365771234 0.1383759677 0.1973138005 0.1721783578 0.2680045366 0.2973450124 0.258728236 0.2880711257 0.2880711257 0.2880711257 0.2880405784 0.3152042925 0.3790788651 0.2446159422 0.2276017666} {curve(which) 1 0.7281661034 0.6740817428 0.8202066422 0.8736318946 0.7151686549 0.6779980659 0.6891706586 0.6917385459 0.7215952873 0.8238410354 0.839184761 0.7385566831 0.7585275769 0.8648257852 0.7808576822 0.7230190039 0.8429791331 0.910841465 0.8696421385 0.786606431 0.8850684762 0.7748944759 0.8131960034 0.6779980659 0.951146543 0.8896810412 0.911518693 0.943950057 0.8553914428 0.8326833844 0.6273635626 0.7246823311 0.7118432522 0.7118432522 0.7118432522 0.7118694782 0.6648360491 0.5769088268 0.6720442176 0.7383946776} {curve(which) 0 -0.07213255018 0.05368951708 -0.1003373638 -0.1477504075 0.07219231874 0.05930171534 0.07320601493 0.07928691059 0.06891305745 -0.1157948226 -0.05991046131 0.06718540192 0.03925102949 -0.03426937759 -0.009763340466 0.06503042579 -0.1296732277 -0.04964122549 -0.1309035122 -0.05758608505 -0.1001443192 -0.03558001295 -0.09620071948 0.05930171534 -0.1254517138 -0.1262581497 -0.04989464581 -0.1412638426 -0.02756982669 -0.1006879359 0.07529145479 0.01658944227 8.565396274e-05 8.565396274e-05 8.565396274e-05 8.991353388e-05 0.01995966583 0.04401229322 0.08333983272 0.0340035744}}
       {{curve(which) 0 -3.863927134e-08 -0.005574660841 -0.1037815213 -0.09896291792 0.01933082007 0 0 0 0 0.0027982709 -0.0544523783 -0.04792318866 -0.0176958181 -0.1061859056 -0.02100777067 -0.01945115253 -0.07968087494 0.07801423222 -0.009676366113 -0.009677864611 -0.03206583485 -0.009310216643 -0.01825834997 0 -0.11669112 -0.02325225808 -0.1602820009 -0.1427432895 -0.10720893 -0.02941203304 0.02703136392 -2.906408625e-08 -3.236030111e-08 -3.236030111e-08 -3.236030111e-08 0 0 -0.01229703799 0.02518104948 0} {curve(which) 0 0 0.004060741514 -0.07290724665 -0.1378953159 0.1191947311 0.0280726999 0.0449459292 0.04511339962 0.04706057906 -0.06703422964 -0.0003228379355 -0.0002844714036 0.08768811822 0.02554347552 0.01782695204 0.01650637016 -0.3473432064 -0.3148325086 -0.2364816219 0.004600019194 -0.02765839547 -0.004612449091 -0.08316776901 0.0280726999 -0.5518454909 -0.4897170365 -0.171635136 -0.4278847873 0.07809129357 -0.08659287542 0.07068887353 0.05121183768 1.2621717e-08 1.2621717e-08 1.2621717e-08 -1.262213711e-08 0.04317118227 0.01672476344 0.1411857158 0.01001892332} {curve(which) 1 1.008825183 1.010339141 1.265746474 1.325916052 0.950532198 1.060985088 0.9638792276 1.043944359 0.9073553085 1.153293729 1.063571215 1.057001948 0.9388025999 1.089437366 1.01197505 1.011739731 1.51608181 1.325875998 1.335215807 1.094135642 1.148782015 1.102980375 1.190483928 1.060985088 1.745692492 1.590125084 1.409072995 1.65968585 1.118175387 1.205062628 0.9913375378 0.7738927603 0.8251045942 0.8251045942 0.8251045942 0.8248898983 0.8782252669 0.9955722094 0.9226909876 0.8150856495}}
     }
   invert {{parent.invert}}
   name ColorMatrix
   label "RGB to XYZ"
   xpos -40
   ypos 32
   addUserKnob {20 Gamut}
   addUserKnob {3 which}
   which {{parent.gamut}}
   addUserKnob {12 rxy}
   rxy {{curve(which) 1 0.7347 0.713 0.8 0.8 0.64 0.708 0.68 0.68 0.68 0.684 0.7530442228 0.7530444911 0.6997470013 0.8786825105 0.7011810359 0.7011805919 0.780308 0.69848046 0.74 0.73 0.766 0.73 0.71 0.708 0.9173 0.7422 1.0625 0.9175 0.8608 0.7177 0.64 0.7347 0.7347 0.7347 0.7347 0.734699 0.69 0.6898 0.625 0.7351916376} {curve(which) 0 0.2653 0.293 0.3177 0.313 0.33 0.292 0.32 0.32 0.32 0.313 0.3278305767 0.3278310295 0.3290469303 0.3249640074 0.3290141556 0.3290136991 0.304253 0.19302645 0.27 0.28 0.275 0.28 0.31 0.292 0.2502 0.2859 0.3948 0.2983 0.3689 0.3171 0.33 0.2653 0.2653 0.2653 0.2653 0.265301 0.31 0.3206 0.34 0.2648083624}}
   addUserKnob {12 gxy}
   gxy {{curve(which) 0 0 0.165 0.18 0.1682 0.3 0.17 0.265 0.265 0.265 0.221 0.2995702285 0.2995704905 0.304264039 0.3008887144 0.3006003047 0.3006003955 0.121595 0.32955538 0.17 0.14 0.225 0.165 0.21 0.17 0.2833 0.414 0.3689 0.2983 0.3282 0.228 0.21 0.1152 0.1596 0.1596 0.1596 0.159597 0.18 0.0736 0.28 0.2153361345} {curve(which) 1 1 0.83 0.9 0.9877 0.6 0.797 0.69 0.69 0.69 0.848 0.700699322 0.7006994156 0.6236411451 0.6790547558 0.6837888343 0.6837888243 1.493994 1.02459662 1.14 0.855 0.8 0.84 0.88 0.797 1.7072 1.3035 0.7775 1.2835 0.6156 0.8616 0.71 0.8264 0.8404 0.8404 0.8404 0.840403 0.77 0.9003 0.595 0.7741596639}}
   addUserKnob {12 bxy}
   bxy {{curve(which) 0 0.0001 0.128 0.065 0.079 0.15 0.131 0.15 0.15 0.15 0.0861 0.07964206674 0.1450115843 0.1349139613 0.09539869461 0.1081544556 0.1453319462 0.095612 0.10844263 0.08 0.1 0.089 0.1 0.09 0.131 0.0856 0.0342 0.0956 0.0756 0.0783 0.1006 0.15 0.1566 0.0366 0.0366 0.0366 0.036598 0.1 0.1166 0.155 0.1301229508} {curve(which) 0 -0.077 0.044 -0.0805 -0.1155 0.06 0.046 0.06 0.06 0.06 -0.102 -0.05493795109 0.05109712509 0.03471744128 -0.02937932683 -0.008688175787 0.05161680362 -0.084589 -0.03467857 -0.1 -0.05 -0.087 -0.03 -0.08 0.046 -0.0708 -0.0833 -0.0332 -0.086 -0.0233 -0.082 0.06 0.0177 0.0001 0.0001 0.0001 0.000105 0.02 0.0374 0.07 0.03483606557}}
   addUserKnob {12 wxy}
   wxy {{curve(which) 0.33333333 0.32168 0.32168 0.3127 0.3127 0.3127 0.3127 0.32168 0.3127 0.314 0.3127 0.3216831877 0.3216832104 0.3216832894 0.3216832894 0.3216832104 0.3216832894 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3135 0.3135 0.3135 0.3127 0.3127 0.3127 0.3127 0.3457 0.3457 0.3457 0.3457 0.345704 0.33243 0.33333333 0.3127 0.3457} {curve(which) 0.33333333 0.33767 0.33767 0.329 0.329 0.329 0.329 0.33767 0.329 0.351 0.329 0.337673316 0.3376736101 0.3376734472 0.3376734472 0.3376736101 0.3376734472 0.329 0.329 0.329 0.329 0.329 0.329 0.329 0.329 0.3305 0.3305 0.3305 0.329 0.329 0.329 0.329 0.3585 0.3585 0.3585 0.3585 0.35854 0.34744 0.33333333 0.329 0.3585}}
  }
  Output {
   name Output
   xpos -40
   ypos 86
  }
 end_group
 Position {
  translate {{parent.Reformat1.box_width+Rectangle1.area.r} {parent.ReformatBox4.box_width-input.height*2}}
  name Position5
  xpos -1030
  ypos 254
 }
push $N7e6f8400
 Group {
  name RGBToXYZ_GamutA
  label "\[if \{\[value invert]\} \{return \"XYZ to \[value gamut]\"\} else \{return \"\[value gamut] to XYZ\"\}]\n\n"
  xpos -920
  ypos 176
  addUserKnob {20 GamutToXYZ_tab l GamutToXYZ}
  addUserKnob {4 gamut t "Choose gamut" M {XYZ ACES ACEScg "Filmlight E-Gamut" "DaVinci WG" Rec709 Rec2020 P3D60 P3D65 P3DCI "Arri AlexaWideGamut" REDDRAGONcolor REDDRAGONcolor2 REDcolor REDcolor2 REDcolor3 REDcolor4 REDWideGamutRGB "GoPro Protune Native" CanonCinemaGamut SonySGamut SonySGamut3Cine PanasonicVGamut "DJI D-Gamut" "Fujifilm F-Gamut" BMDFilmV1 BMD4kFilmV1 BMD4kFilmV3 BMD46kFilmV1 BMD46kFilmV3 BMDWideGamutV4 "AdobeRGB\t" AdobeWideGamutRGB ROMM RIMM ERIMM ProPhotoRGB RusselRGB SharpRGB AppleRGB BestRGB}}
  gamut ACEScg
  addUserKnob {6 invert +STARTLINE}
  addUserKnob {26 ""}
  addUserKnob {26 chromaticity_coordinates_label l " " T "<b>Chromaticity Coordinates</b>"}
  addUserKnob {41 rxy T ColorMatrix.rxy}
  addUserKnob {41 gxy T ColorMatrix.gxy}
  addUserKnob {41 bxy T ColorMatrix.bxy}
  addUserKnob {41 wxy T ColorMatrix.wxy}
  addUserKnob {41 matrix T ColorMatrix.matrix}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -10
  }
  ColorMatrix {
   matrix {
       {{curve(which) 1 0.9525524378 0.6624541879 0.7053968906 0.7006223798 0.4123907983 0.6369580626 0.5049495697 0.4865709841 0.4451698363 0.6380076408 0.5070186853 0.4462202489 0.4300414324 0.4581649601 0.4878340662 0.4517004192 0.7352752686 0.5022571683 0.7160496712 0.7064827085 0.5990839601 0.6796444654 0.6481720209 0.6369580626 0.6390493512 0.6141571999 0.3724023998 0.60689044 0.4017650783 0.6065810919 0.5766690373 0.7165006995 0.797760427 0.797760427 0.797760427 0.7976718545 0.7015837431 0.8156226277 0.4496616423 0.6318944097} {curve(which) 0 0 0.1340042055 0.1640413404 0.1487748176 0.3575843275 0.1446169019 0.2646814585 0.2656676769 0.2771343887 0.2147038579 0.3587769568 0.3157556653 0.3700728714 0.3832037449 0.3432727158 0.3178463876 0.06860940903 0.2929667532 0.1296834797 0.1288010478 0.2489254922 0.1522114277 0.1940581352 0.1446169019 0.1578372866 0.2825684249 0.4324877858 0.2193847299 0.4560420811 0.2203479856 0.1855582297 0.1010205746 0.1351858526 0.1351858526 0.1351858526 0.1351878047 0.1554162204 0.04716260359 0.3162561059 0.2053879201} {curve(which) 0 9.367863095e-05 0.1561876982 0.08101774752 0.101058729 0.180480808 0.1688809693 0.1830150485 0.1982172877 0.1722826511 0.09774444997 0.0868505761 0.190669477 0.152531758 0.1112773567 0.1215386018 0.1830992699 0.1465712637 0.1552320272 0.1047228053 0.1151721701 0.1024464965 0.1186000481 0.108225815 0.1688809693 0.1516760886 0.05183707923 0.1436725408 0.124180764 0.09264881909 0.123526901 0.1882286519 0.1467743814 0.03134934977 0.03134934977 0.03134934977 0.03133957833 0.09979832917 0.1372147948 0.1845382005 0.1270133406}}
       {{curve(which) 0 0.3439664543 0.2722287476 0.2801307142 0.2741185129 0.2126390189 0.2627002299 0.237623319 0.2289745659 0.209491685 0.2919537723 0.2207257152 0.1942579001 0.2022213936 0.1694435924 0.2289056629 0.2119505703 0.2866941094 0.1387997568 0.2612613738 0.2709796727 0.2150758505 0.2606855333 0.2830046713 0.2627002299 0.1743051857 0.2365771234 0.1383759677 0.1973138005 0.1721783578 0.2680045366 0.2973450124 0.258728236 0.2880711257 0.2880711257 0.2880711257 0.2880405784 0.3152042925 0.3790788651 0.2446159422 0.2276017666} {curve(which) 1 0.7281661034 0.6740817428 0.8202066422 0.8736318946 0.7151686549 0.6779980659 0.6891706586 0.6917385459 0.7215952873 0.8238410354 0.839184761 0.7385566831 0.7585275769 0.8648257852 0.7808576822 0.7230190039 0.8429791331 0.910841465 0.8696421385 0.786606431 0.8850684762 0.7748944759 0.8131960034 0.6779980659 0.951146543 0.8896810412 0.911518693 0.943950057 0.8553914428 0.8326833844 0.6273635626 0.7246823311 0.7118432522 0.7118432522 0.7118432522 0.7118694782 0.6648360491 0.5769088268 0.6720442176 0.7383946776} {curve(which) 0 -0.07213255018 0.05368951708 -0.1003373638 -0.1477504075 0.07219231874 0.05930171534 0.07320601493 0.07928691059 0.06891305745 -0.1157948226 -0.05991046131 0.06718540192 0.03925102949 -0.03426937759 -0.009763340466 0.06503042579 -0.1296732277 -0.04964122549 -0.1309035122 -0.05758608505 -0.1001443192 -0.03558001295 -0.09620071948 0.05930171534 -0.1254517138 -0.1262581497 -0.04989464581 -0.1412638426 -0.02756982669 -0.1006879359 0.07529145479 0.01658944227 8.565396274e-05 8.565396274e-05 8.565396274e-05 8.991353388e-05 0.01995966583 0.04401229322 0.08333983272 0.0340035744}}
       {{curve(which) 0 -3.863927134e-08 -0.005574660841 -0.1037815213 -0.09896291792 0.01933082007 0 0 0 0 0.0027982709 -0.0544523783 -0.04792318866 -0.0176958181 -0.1061859056 -0.02100777067 -0.01945115253 -0.07968087494 0.07801423222 -0.009676366113 -0.009677864611 -0.03206583485 -0.009310216643 -0.01825834997 0 -0.11669112 -0.02325225808 -0.1602820009 -0.1427432895 -0.10720893 -0.02941203304 0.02703136392 -2.906408625e-08 -3.236030111e-08 -3.236030111e-08 -3.236030111e-08 0 0 -0.01229703799 0.02518104948 0} {curve(which) 0 0 0.004060741514 -0.07290724665 -0.1378953159 0.1191947311 0.0280726999 0.0449459292 0.04511339962 0.04706057906 -0.06703422964 -0.0003228379355 -0.0002844714036 0.08768811822 0.02554347552 0.01782695204 0.01650637016 -0.3473432064 -0.3148325086 -0.2364816219 0.004600019194 -0.02765839547 -0.004612449091 -0.08316776901 0.0280726999 -0.5518454909 -0.4897170365 -0.171635136 -0.4278847873 0.07809129357 -0.08659287542 0.07068887353 0.05121183768 1.2621717e-08 1.2621717e-08 1.2621717e-08 -1.262213711e-08 0.04317118227 0.01672476344 0.1411857158 0.01001892332} {curve(which) 1 1.008825183 1.010339141 1.265746474 1.325916052 0.950532198 1.060985088 0.9638792276 1.043944359 0.9073553085 1.153293729 1.063571215 1.057001948 0.9388025999 1.089437366 1.01197505 1.011739731 1.51608181 1.325875998 1.335215807 1.094135642 1.148782015 1.102980375 1.190483928 1.060985088 1.745692492 1.590125084 1.409072995 1.65968585 1.118175387 1.205062628 0.9913375378 0.7738927603 0.8251045942 0.8251045942 0.8251045942 0.8248898983 0.8782252669 0.9955722094 0.9226909876 0.8150856495}}
     }
   invert {{parent.invert}}
   name ColorMatrix
   label "RGB to XYZ"
   xpos -40
   ypos 32
   addUserKnob {20 Gamut}
   addUserKnob {3 which}
   which {{parent.gamut}}
   addUserKnob {12 rxy}
   rxy {{curve(which) 1 0.7347 0.713 0.8 0.8 0.64 0.708 0.68 0.68 0.68 0.684 0.7530442228 0.7530444911 0.6997470013 0.8786825105 0.7011810359 0.7011805919 0.780308 0.69848046 0.74 0.73 0.766 0.73 0.71 0.708 0.9173 0.7422 1.0625 0.9175 0.8608 0.7177 0.64 0.7347 0.7347 0.7347 0.7347 0.734699 0.69 0.6898 0.625 0.7351916376} {curve(which) 0 0.2653 0.293 0.3177 0.313 0.33 0.292 0.32 0.32 0.32 0.313 0.3278305767 0.3278310295 0.3290469303 0.3249640074 0.3290141556 0.3290136991 0.304253 0.19302645 0.27 0.28 0.275 0.28 0.31 0.292 0.2502 0.2859 0.3948 0.2983 0.3689 0.3171 0.33 0.2653 0.2653 0.2653 0.2653 0.265301 0.31 0.3206 0.34 0.2648083624}}
   addUserKnob {12 gxy}
   gxy {{curve(which) 0 0 0.165 0.18 0.1682 0.3 0.17 0.265 0.265 0.265 0.221 0.2995702285 0.2995704905 0.304264039 0.3008887144 0.3006003047 0.3006003955 0.121595 0.32955538 0.17 0.14 0.225 0.165 0.21 0.17 0.2833 0.414 0.3689 0.2983 0.3282 0.228 0.21 0.1152 0.1596 0.1596 0.1596 0.159597 0.18 0.0736 0.28 0.2153361345} {curve(which) 1 1 0.83 0.9 0.9877 0.6 0.797 0.69 0.69 0.69 0.848 0.700699322 0.7006994156 0.6236411451 0.6790547558 0.6837888343 0.6837888243 1.493994 1.02459662 1.14 0.855 0.8 0.84 0.88 0.797 1.7072 1.3035 0.7775 1.2835 0.6156 0.8616 0.71 0.8264 0.8404 0.8404 0.8404 0.840403 0.77 0.9003 0.595 0.7741596639}}
   addUserKnob {12 bxy}
   bxy {{curve(which) 0 0.0001 0.128 0.065 0.079 0.15 0.131 0.15 0.15 0.15 0.0861 0.07964206674 0.1450115843 0.1349139613 0.09539869461 0.1081544556 0.1453319462 0.095612 0.10844263 0.08 0.1 0.089 0.1 0.09 0.131 0.0856 0.0342 0.0956 0.0756 0.0783 0.1006 0.15 0.1566 0.0366 0.0366 0.0366 0.036598 0.1 0.1166 0.155 0.1301229508} {curve(which) 0 -0.077 0.044 -0.0805 -0.1155 0.06 0.046 0.06 0.06 0.06 -0.102 -0.05493795109 0.05109712509 0.03471744128 -0.02937932683 -0.008688175787 0.05161680362 -0.084589 -0.03467857 -0.1 -0.05 -0.087 -0.03 -0.08 0.046 -0.0708 -0.0833 -0.0332 -0.086 -0.0233 -0.082 0.06 0.0177 0.0001 0.0001 0.0001 0.000105 0.02 0.0374 0.07 0.03483606557}}
   addUserKnob {12 wxy}
   wxy {{curve(which) 0.33333333 0.32168 0.32168 0.3127 0.3127 0.3127 0.3127 0.32168 0.3127 0.314 0.3127 0.3216831877 0.3216832104 0.3216832894 0.3216832894 0.3216832104 0.3216832894 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3135 0.3135 0.3135 0.3127 0.3127 0.3127 0.3127 0.3457 0.3457 0.3457 0.3457 0.345704 0.33243 0.33333333 0.3127 0.3457} {curve(which) 0.33333333 0.33767 0.33767 0.329 0.329 0.329 0.329 0.33767 0.329 0.351 0.329 0.337673316 0.3376736101 0.3376734472 0.3376734472 0.3376736101 0.3376734472 0.329 0.329 0.329 0.329 0.329 0.329 0.329 0.329 0.3305 0.3305 0.3305 0.329 0.329 0.329 0.329 0.3585 0.3585 0.3585 0.3585 0.35854 0.34744 0.33333333 0.329 0.3585}}
  }
  Output {
   name Output
   xpos -40
   ypos 86
  }
 end_group
 Position {
  translate {{parent.Reformat1.box_width+Rectangle1.area.r} {parent.ReformatBox4.box_width-input.height}}
  name Position4
  xpos -920
  ypos 254
 }
push $N7e7f3900
 Reformat {
  type scale
  scale 0.8
  turn true
  filter impulse
  black_outside true
  name Reformat2
  xpos -920
  ypos -129
 }
 BlackOutside {
  name BlackOutside2
  xpos -920
  ypos -106
 }
 Position {
  translate {{Rectangle1.area.r} {parent.Position3.translate.y-input.height}}
  name Position2
  xpos -920
  ypos -81
 }
 Group {
  inputs 0
  name ColorChecker24_After_November_2014
  label "CIE XYZ D50"
  xpos -920
  ypos -352
  addUserKnob {20 colorchecker_tab l "ColorChecker24 - After November 2014"}
  addUserKnob {3 patch_resolution}
  patch_resolution 48
 }
  Group {
   inputs 0
   name bluish_green
   selected true
   xpos 622
   ypos -321
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.30451114 0.4143554688 0.344352688 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob "bluish green"
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 6
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
    xpos 262
    ypos 125
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name blue_flower
   xpos 512
   ypos -321
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.2419823988 0.2287175998 0.3282104382 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob "blue flower"
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 5
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name foliage
   xpos 402
   ypos -321
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.1114392339 0.1346792679 0.05239320311 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob foliage
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 4
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name blue_sky
   xpos 292
   ypos -321
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.1652470004 0.1785519348 0.2546024121 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob "blue sky"
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 3
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name light_skin
   xpos 180
   ypos -321
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.3811104477 0.336202304 0.1852590702 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob "light skin"
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 2
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 63
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
    xpos 262
    ypos 135
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name dark_skin
   xpos 70
   ypos -321
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.1136398927 0.09832436105 0.047793811 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob "dark skin"
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 1
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 290
    ypos 63
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
    xpos 290
    ypos 158
   }
   Output {
    name Output
    xpos 290
    ypos 230
   }
  end_group
  Group {
   inputs 0
   name orange_yellow
   xpos 622
   ypos -201
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.4769723742 0.4293377578 0.06005041429 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob "orange yellow"
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 12
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name yellow_green
   xpos 512
   ypos -201
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.3427379502 0.4331759409 0.08330791241 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob "yellow green"
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 11
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name purple
   xpos 401
   ypos -201
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.08353888545 0.06276662955 0.1042075686 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob purple
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 10
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name moderate_red
   xpos 290
   ypos -201
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.2915036416 0.188999956 0.09736350318 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob "moderate red"
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 9
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name purplish_blue
   xpos 180
   ypos -201
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.1200518326 0.1091090233 0.2874447494 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob "purplish blue"
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 8
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name orange
   xpos 74
   ypos -201
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.4073691399 0.3126416159 0.05130591012 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob orange
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 7
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name cyan
   xpos 622
   ypos -81
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.1247966941 0.180609913 0.2913392383 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob cyan
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 18
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name magenta
   xpos 512
   ypos -81
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.299122798 0.1895114577 0.2213469194 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob magenta
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 17
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name yellow
   xpos 399
   ypos -81
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.5888922356 0.5992976803 0.07077420003 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob yellow
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 16
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
    xpos 262
    ypos 125
   }
   Output {
    name Output
    xpos 262
    ypos 182
   }
  end_group
  Group {
   inputs 0
   name red
   xpos 292
   ypos -81
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.2143728424 0.127800835 0.03868150726 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob red
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 15
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name green
   xpos 182
   ypos -81
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.1413517689 0.2233437582 0.07287461742 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob green
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 14
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name blue
   xpos 72
   ypos -81
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.06809095613 0.05596214063 0.2077405936 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob blue
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 13
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name black_2
   xpos 623
   ypos 39
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.03042544265 0.03151319431 0.02656724434 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob "black 2 (1.5 D)"
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 24
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
    xpos 262
    ypos 125
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name neutral_3
   xpos 512
   ypos 39
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.08448968042 0.08817234828 0.07391630753 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob "neutral 3.5 (1.05 D)"
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 23
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name neutral_5
   xpos 403
   ypos 39
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.1835495863 0.1906228754 0.1566717383 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob "neutral 5 (.70 D)"
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 22
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name neutral_6
   xpos 292
   ypos 39
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.3495921991 0.3648652066 0.3013565492 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob "neutral 6.5 (.44 D)"
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 21
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name neutral_8
   xpos 179
   ypos 39
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.5665335579 0.5899709702 0.4828473821 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob "neutral 8 (.23 D)"
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 20
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name white_9
   xpos 70
   ypos 39
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.8436985288 0.8806903203 0.6936778752 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob "white 9.5 (.05 D)"
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 19
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
    xpos 262
    ypos 134
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  ContactSheet {
   inputs 24
   width {{"rint(parent.patch_resolution * 6 + gap * 7)"}}
   height {{"rint(parent.patch_resolution * 4 + gap * 5)"}}
   rows 4
   columns 6
   startframe 1
   endframe 1
   name ContactSheet
   xpos 620
   ypos 206
  }
  Unpremult {
   name Unpremult1
   xpos 620
   ypos 278
  }
  Output {
   name Output
   xpos 620
   ypos 446
  }
 end_group
 BlackOutside {
  name BlackOutside4
  xpos -920
  ypos -298
 }
 Position {
  translate {{parent.Reformat1.box_width*3+Rectangle1.area.r} {parent.ReformatBox4.box_width-input.height}}
  name Position7
  xpos -920
  ypos -273
 }
 Constant {
  inputs 0
  format "256 256 0 0 256 256 1 square_256"
  name Constant5
  xpos -700
  ypos -1354
  postage_stamp false
 }
 Dot {
  name Dot25
  xpos -666
  ypos -1302
 }
set N77040800 [stack 0]
 Dot {
  name Dot27
  xpos -1546
  ypos -1302
 }
 Reformat {
  type "to box"
  box_width {{parent.Reformat1.box_width}}
  box_height 100
  box_fixed true
  name ReformatBox1
  xpos -1580
  ypos -994
 }
 Ramp {
  p0 {0 0}
  p1 {{input.width} 0}
  color {{p1}}
  name Ramp3
  xpos -1580
  ypos -898
 }
 ColorLookup {
  lut {master {}
    red {curve 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914}
    green {curve 0.433 0.464 0.513 0.611 0.576 0.46 0.426 0.412 0.404 0.397 0.384 0.374 0.346 0.333 0.311 0.287 0.257 0.23 0.21 0.219 0.208 0.211 0.208 0.187 0.191 0.187 0.18 0.164 0.17 0.177 0.175 0.188 0.252 0.325 0.385 0.416 0.433 0.487 0.532 0.588 0.637 0.634 0.549 0.506 0.49 0.458 0.426 0.412 0.397 0.365 0.337 0.301 0.262 0.221 0.192 0.164 0.167 0.162 0.176 0.179 0.148 0.156 0.142 0.148 0.138 0.145 0.145 0.161 0.197 0.256 0.324 0.393 0.451 0.487 0.508 0.538 0.587 0.634 0.659 0.611 0.552 0.526 0.484 0.452 0.428 0.406 0.371 0.334 0.293 0.243 0.204 0.177 0.151 0.151 0.162 0.158 0.161 0.142 0.141 0.129 0.134 0.14 0.156 0.166 0.192 0.221 0.265 0.325 0.392 0.451 0.508 0.48 0.513 0.554 0.597 0.63 0.634 0.58 0.546 0.499 0.466 0.434 0.408 0.372 0.332 0.288 0.242 0.202 0.179 0.16 0.157 0.162 0.157 0.159 0.149 0.153 0.147 0.154 0.164 0.18 0.199 0.226 0.25 0.279 0.325 0.38 0.439 0.48 0.436 0.468 0.502 0.541 0.57 0.605 0.594 0.555 0.511 0.473 0.439 0.409 0.371 0.332 0.288 0.252 0.217 0.196 0.181 0.178 0.185 0.176 0.173 0.168 0.176 0.178 0.19 0.202 0.214 0.235 0.254 0.27 0.291 0.323 0.366 0.41 0.436 0.396 0.414 0.438 0.465 0.485 0.527 0.566 0.557 0.523 0.478 0.442 0.409 0.371 0.334 0.294 0.265 0.244 0.223 0.225 0.212 0.218 0.211 0.211 0.207 0.214 0.217 0.229 0.237 0.244 0.264 0.275 0.285 0.3 0.321 0.348 0.376 0.396 0.357 0.368 0.377 0.391 0.402 0.431 0.481 0.503 0.521 0.482 0.444 0.409 0.372 0.337 0.307 0.286 0.27 0.257 0.247 0.251 0.257 0.255 0.254 0.25 0.258 0.259 0.265 0.269 0.278 0.284 0.292 0.297 0.305 0.317 0.33 0.344 0.357 0.321 0.322 0.328 0.332 0.333 0.346 0.365 0.389 0.411 0.459 0.443 0.399 0.352 0.327 0.313 0.304 0.3 0.294 0.295 0.294 0.293 0.292 0.291 0.295 0.3 0.301 0.302 0.304 0.304 0.304 0.305 0.307 0.309 0.312 0.313 0.316 0.321}
    blue {curve 0.26 0.281 0.298 0.306 0.342 0.365 0.39 0.381 0.392 0.416 0.413 0.43 0.448 0.446 0.433 0.425 0.419 0.394 0.362 0.328 0.305 0.298 0.286 0.247 0.26 0.219 0.199 0.168 0.178 0.14 0.11 0.084 0.104 0.158 0.18 0.225 0.26 0.235 0.26 0.28 0.298 0.327 0.372 0.395 0.417 0.43 0.435 0.455 0.488 0.479 0.521 0.522 0.515 0.49 0.436 0.383 0.331 0.295 0.282 0.258 0.219 0.208 0.179 0.168 0.141 0.129 0.106 0.094 0.095 0.112 0.127 0.165 0.199 0.235 0.226 0.258 0.28 0.298 0.316 0.361 0.399 0.427 0.446 0.461 0.482 0.52 0.521 0.553 0.563 0.573 0.524 0.454 0.389 0.33 0.295 0.266 0.247 0.214 0.195 0.168 0.178 0.142 0.14 0.128 0.129 0.126 0.131 0.144 0.167 0.199 0.226 0.238 0.266 0.289 0.31 0.329 0.351 0.395 0.428 0.453 0.475 0.494 0.533 0.542 0.568 0.584 0.576 0.53 0.451 0.385 0.331 0.299 0.266 0.245 0.22 0.206 0.184 0.174 0.167 0.166 0.166 0.173 0.172 0.165 0.172 0.187 0.208 0.238 0.258 0.28 0.3 0.321 0.343 0.362 0.391 0.427 0.458 0.482 0.503 0.546 0.554 0.573 0.582 0.546 0.499 0.431 0.375 0.33 0.304 0.275 0.254 0.234 0.225 0.212 0.209 0.206 0.203 0.21 0.215 0.212 0.204 0.208 0.214 0.231 0.258 0.277 0.294 0.31 0.328 0.348 0.372 0.397 0.427 0.462 0.487 0.51 0.544 0.558 0.559 0.556 0.503 0.444 0.402 0.355 0.329 0.309 0.289 0.275 0.26 0.254 0.245 0.245 0.241 0.238 0.249 0.249 0.245 0.241 0.242 0.246 0.258 0.277 0.295 0.305 0.315 0.327 0.339 0.359 0.39 0.421 0.461 0.491 0.515 0.54 0.546 0.522 0.478 0.429 0.393 0.368 0.345 0.325 0.313 0.303 0.295 0.286 0.284 0.279 0.277 0.274 0.277 0.277 0.28 0.276 0.273 0.274 0.279 0.285 0.295 0.311 0.314 0.316 0.32 0.323 0.331 0.346 0.367 0.397 0.468 0.513 0.494 0.425 0.388 0.372 0.348 0.336 0.331 0.326 0.32 0.316 0.314 0.312 0.309 0.321 0.32 0.319 0.305 0.317 0.316 0.316 0.315 0.316 0.317 0.319 0.321 0.311}
    alpha {}}
  name ColorLookup7
  label "Pointers Samples Yxy\nSource: https://www.rit.edu/cos/colorscience/rc_useful_data.php"
  xpos -1580
  ypos -790
 }
 Colorspace {
  colorspace_in CIE-Yxy
  primary_in "Adobe (1998)"
  colorspace_out CIE-XYZ
  name Colorspace12
  label "\[value colorspace_in] -> \[value colorspace_out]"
  xpos -1580
  ypos -688
 }
 Fill {
  output alpha
  name Fill5
  xpos -1580
  ypos -639
 }
 BlackOutside {
  name BlackOutside7
  xpos -1580
  ypos -562
 }
 Position {
  translate {6 {parent.Position1.translate.y-input.height}}
  name Position3
  xpos -1580
  ypos -538
 }
 Dot {
  name Dot15
  xpos -1546
  ypos -414
 }
push $N77040800
 Reformat {
  type "to box"
  box_width 2048
  box_height 2048
  box_fixed true
  name ReformatBox4
  xpos -700
  ypos -1258
 }
 Expression {
  temp_name0 n
  temp_expr0 input.width/8
  channel0 {rgba.red rgba.green rgba.blue none}
  expr0 x/width*(1-y/height)
  channel3 alpha
  expr3 1
  name Expression7
  xpos -700
  ypos -1209
 }
 Dot {
  name Dot10
  xpos -666
  ypos -1158
 }
set N77004c00 [stack 0]
 Dot {
  name Dot26
  xpos -886
  ypos -1158
 }
set N77004800 [stack 0]
 Dot {
  name Dot23
  xpos -1106
  ypos -1158
 }
set N77004400 [stack 0]
 Dot {
  name Dot12
  xpos -1326
  ypos -1158
 }
 Mirror2 {
  flip true
  flop true
  name Mirror2_1
  xpos -1360
  ypos -1042
 }
 Reformat {
  type "to box"
  box_width 512
  box_height {{box_width}}
  box_fixed true
  name Reformat1
  xpos -1360
  ypos -994
 }
 Gamma {
  channels rgb
  value 2
  name Gamma1
  xpos -1360
  ypos -898
 }
 Multiply {
  channels rgb
  value 8000
  name Multiply1
  label "\[value value]"
  xpos -1360
  ypos -811
 }
 ColorLookup {
  lut {master {}
    red {curve R 0.4830000103 x50 0.5045000315 0.5260000229 0.5475000143 0.5690000057 0.5904999971 0.6119999886 0.63349998 0.6549999714 0.6805312037 0.7087500095 0.7315937281 0.7409999967 0.7409999967 0.7409999967 0.7409999967 0.7409999967 0.75459373 0.7845000029 0.8144062757 0.8280000091 0.8280000091 0.8280000091 0.8280000091 0.8280000091 0.8009687662 0.74150002 0.6820312142 0.6549999714 0.6684374809 0.6980000138 0.7275624871 0.7409999967 0.7315937281 0.7087500095 0.6805312037 0.6549999714 0.629468739 0.6012499928 0.5784062743 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5555624962 0.5260000229 0.4964375198 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4964375198 0.5260000229 0.5555624962 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5653046966 0.5555624962 0.5417890549 0.5260000229 0.5102109313 0.4964375198 0.4866953194 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4695625007 0.4400000274 0.4104375243 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.4104375243 0.4400000274 0.4695625007 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103}
    green {curve R 0.6589999795 x50 0.6542205811 0.6484853029 0.6414804459 0.6340000033 0.6249843836 0.6147499681 0.6041406393 0.5939999819 0.5844687223 0.575124979 0.5659687519 0.5569999814 0.5484530926 0.5402500033 0.5319218636 0.5230000019 0.5131718516 0.5027499795 0.4922031164 0.4819999933 0.4722187519 0.4626249969 0.4532187581 0.4440000057 0.4351093769 0.4265000224 0.4178906381 0.4090000093 0.3997343779 0.3902499974 0.380640626 0.3709999919 0.3614374995 0.3518749774 0.3421249986 0.3319999874 0.321398437 0.3104375005 0.2992577851 0.2879999876 0.2764999866 0.2647500038 0.2531249821 0.2419999987 0.2312265635 0.2206875086 0.2108047009 0.202000007 0.1947187632 0.1886250079 0.1829687506 0.1770000011 0.1693515629 0.1608124971 0.1538671851 0.1509999931 0.1509999931 0.1509999931 0.1509999931 0.1509999931 0.1527187377 0.1564999968 0.1602812558 0.1620000005 0.1620000005 0.1620000005 0.1620000005 0.1620000005 0.1612187475 0.1595000029 0.1577812582 0.1570000052 0.1573124975 0.1579999924 0.1586875021 0.1589999944 0.1575781256 0.1543750018 0.1509843767 0.1490000039 0.1485625058 0.1484999955 0.1484375 0.1480000019 0.1467812508 0.1449999958 0.1432187557 0.1420000046 0.1415625066 0.1414999962 0.1414375007 0.1410000026 0.1397656202 0.1378750056 0.1357968748 0.1340000033 0.1323750019 0.1307500005 0.1295000017 0.1289999932 0.130031243 0.1324999928 0.1354687512 0.1379999965 0.1402187496 0.1424999982 0.1442812532 0.1449999958 0.1449999958 0.1449999958 0.1449999958 0.1449999958 0.1464921832 0.1503124982 0.1554765552 0.1609999985 0.1673984379 0.1749375015 0.1822578013 0.1879999936 0.1906718612 0.1913749874 0.1926406175 0.1969999969 0.2064140588 0.2199375033 0.2357421964 0.2520000041 0.2688750029 0.2871249914 0.3058125079 0.324000001 0.3417187631 0.359375 0.3765937686 0.3930000067 0.4082968831 0.4227499962 0.4368281364 0.451000005 0.4659531415 0.4812500179 0.4956718981 0.5080000162 0.5169296861 0.5234375 0.5297265649 0.5379999876 0.5491171479 0.5618124604 0.5751015544 0.5879999995 0.6009531021 0.6142500043 0.6266719103 0.6370000243 0.6457066536 0.6532088518 0.6575522423 0.6589999795}
    blue {curve R 0.3160000145 x50 0.324739933 0.3330312669 0.3418398499 0.351000011 0.3607422113 0.3709374964 0.3811640739 0.3910000026 0.4003046751 0.4093124866 0.4181640446 0.4269999862 0.4359609187 0.4449374974 0.453695327 0.4620000124 0.4697890878 0.4771875143 0.4842422009 0.4909999967 0.4971874952 0.5028749704 0.5086249709 0.5149999857 0.5227031112 0.53125 0.5394218564 0.5460000038 0.5502656102 0.5530000329 0.5552343726 0.5580000281 0.561632812 0.5655625463 0.5694609284 0.5730000138 0.5765469074 0.5801249743 0.5828906298 0.5839999914 0.5838750005 0.5830000043 0.5806249976 0.5759999752 0.5682968497 0.5576249957 0.5446406007 0.5299999714 0.5128515363 0.4931874871 0.4729296863 0.4539999962 0.4368359447 0.420437485 0.4045703113 0.3889999986 0.3731718659 0.3573749959 0.3426406384 0.3300000131 0.3193906248 0.310375005 0.3034218848 0.298999995 0.2972500026 0.2969999909 0.2967499793 0.2949999869 0.2899531126 0.2821249962 0.2734843791 0.2660000026 0.2602812648 0.2552500069 0.2503437698 0.2450000048 0.2380000055 0.2300000042 0.2232500017 0.2199999988 0.2195625007 0.2194999903 0.2194374949 0.2189999968 0.2183593661 0.2176249921 0.2163281292 0.2140000015 0.2101874948 0.205249995 0.1999374926 0.1949999928 0.1904453039 0.185937494 0.1817109436 0.1780000031 0.1754062474 0.1736250073 0.1715312451 0.1679999977 0.1620937437 0.1546249986 0.147093758 0.1410000026 0.1372031271 0.1347499937 0.1324218661 0.1289999932 0.1237656176 0.1174999923 0.1112343743 0.1059999987 0.1021796837 0.09918750077 0.09660156071 0.09399999678 0.09089062363 0.0876249969 0.0850468725 0.08399999887 0.08524999768 0.0882499963 0.09187500179 0.09499999881 0.09706249833 0.09875000268 0.1008125022 0.1040000021 0.1084140688 0.1136875004 0.1198671907 0.1270000041 0.1355390698 0.145312503 0.1554296911 0.1650000066 0.1739453226 0.1826875061 0.1910859346 0.199000001 0.2061250061 0.2126249969 0.2190624923 0.2259999961 0.2338827997 0.2423124909 0.2505859137 0.2579999864 0.2642968595 0.26987499 0.2750156224 0.2800000012 0.2847812474 0.2892500162 0.2935937643 0.2980000079 0.3025000095 0.3070000112 0.3115000129 0.3160000145}
    alpha {}}
  name ColorLookup5
  label "Pointer's Gamut Boundary Yxy\ninterpolated: incr 50 - 0 to 8000"
  xpos -1360
  ypos -775
 }
 Multiply {
  channels rgb
  value {0.31 1 1 1}
  name Multiply2
  label "dim boundary"
  xpos -1360
  ypos -725
 }
 Colorspace {
  colorspace_in CIE-Yxy
  primary_in "Adobe (1998)"
  colorspace_out CIE-XYZ
  name Colorspace5
  label "\[value colorspace_in] -> \[value colorspace_out]"
  xpos -1360
  ypos -688
 }
 Fill {
  output alpha
  name Fill4
  xpos -1360
  ypos -639
 }
 BlackOutside {
  name BlackOutside1
  xpos -1360
  ypos -562
 }
 Position {
  translate {6 {ReformatBox4.box_width-input.width}}
  name Position1
  xpos -1360
  ypos -538
 }
 Dot {
  name Dot24
  xpos -1326
  ypos -486
 }
push $N77004400
 Reformat {
  type "to box"
  box_width {{parent.Reformat1.box_width}}
  box_height 100
  box_fixed true
  name ReformatBox2
  xpos -1140
  ypos -994
 }
 Expression {
  temp_name0 n
  temp_expr0 input.width/8
  channel0 {rgba.red rgba.green rgba.blue none}
  expr0 x/width*(1-y/height)
  channel3 alpha
  expr3 1
  name Expression1
  xpos -1140
  ypos -898
 }
set N76f63c00 [stack 0]
 Dot {
  name Dot8
  xpos -996
  ypos -894
 }
 ColorLookup {
  lut {master {curve L 0 s0 t0.9499999881 C k x0.308139503 1 s0}
    red {}
    green {}
    blue {}
    alpha {}}
  name ColorLookup1
  xpos -1030
  ypos -849
 }
 Dot {
  name Dot14
  xpos -996
  ypos -750
 }
push $N76f63c00
 Multiply {
  channels rgb
  value 269
  name Multiply5
  label "\[value value]"
  xpos -1140
  ypos -856
 }
 ColorLookup {
  lut {master {}
    red {curve C 1.8783474 1.85965741 1.8410753 1.82260251 1.80424976 1.78602886 1.76794314 1.75000143 1.73221421 1.71458244 1.69711792 1.67982578 1.66271067 1.6457777 1.62903571 1.6124835 1.59613538 1.57998943 1.56404996 1.54832447 1.5328095 1.51751649 1.50244594 1.48759735 1.47297573 1.45858264 1.44442391 1.43049574 1.41680288 1.40334678 1.39012623 1.37714779 1.36440396 1.35190022 1.33963728 1.32761216 1.31582856 1.30428183 1.29297352 1.28190565 1.27107596 1.2604804 1.25012183 1.23999798 1.23010659 1.22044563 1.21101499 1.20181489 1.19284034 1.18408906 1.17556167 1.16725397 1.15916491 1.15129638 1.14363372 1.13618886 1.12895167 1.12192106 1.11509454 1.10846853 1.10204577 1.09580922 1.08977199 1.08392429 1.07826447 1.07278681 1.06749392 1.06237841 1.05743873 1.05267084 1.04807138 1.04364109 1.03937256 1.03526449 1.03131545 1.02751946 1.02387333 1.02037668 1.01702523 1.01381445 1.01074362 1.00780725 1.00500631 1.00233305 0.99978602 0.99736285 0.9950608 0.99287677 0.99080539 0.98884678 0.98699367 0.9852494 0.98361033 0.98206747 0.98062134 0.97926998 0.97800934 0.97683728 0.97575116 0.97474778 0.97382426 0.97297859 0.97220623 0.97150886 0.97087657 0.97031689 0.96981871 0.96938527 0.96900952 0.96869147 0.96842706 0.96821606 0.96805781 0.96794283 0.96787858 0.96785843 0.96787864 0.96793604 0.96803701 0.96817231 0.96833968 0.96854311 0.96877253 0.96903455 0.96932232 0.96963543 0.96997368 0.97033387 0.97071254 0.9711163 0.97153723 0.97197378 0.97242606 0.97289121 0.97337079 0.97386622 0.97437072 0.97488332 0.97540969 0.97594237 0.97647977 0.97702706 0.97757769 0.97813445 0.97869468 0.97925854 0.97982538 0.98039114 0.98096472 0.98153675 0.98210776 0.98267955 0.98325121 0.98382008 0.98438704 0.9849571 0.98552132 0.98608243 0.98664182 0.98719966 0.98775077 0.98829895 0.98884273 0.98938417 0.98991877 0.9904511 0.99097681 0.99149919 0.99201453 0.99252397 0.99303031 0.99353105 0.99402624 0.99451613 0.99499857 0.99547589 0.99594522 0.99641174 0.99687338 0.99732745 0.99777603 0.9982177 0.99865389 0.999084 0.99950838 0.99992663 1.00033772 1.00074494 1.00114489 1.00153947 1.00192833 1.00231075 1.00268865 1.00305855 1.00342607 1.00378489 1.00413895 1.00448751 1.00483036 1.00517035 1.00550389 1.00583148 1.00615203 1.00646758 1.00678015 1.00708604 1.00738645 1.00768471 1.00797844 1.0082655 1.00854778 1.00882483 1.00909901 1.00936711 1.00963116 1.00989032 1.0101465 1.01039672 1.01064491 1.01088691 1.0111258 1.01135957 1.01158977 1.01181614 1.01203847 1.01225793 1.01247287 1.01268291 1.01289058 1.01309609 1.01329684 1.01349473 1.0136888 1.0138787 1.01406395 1.01424909 1.01442885 1.01460576 1.01478052 1.01495218 1.01512218 1.01528883 1.01545072 1.01561022 1.01576698 1.01592219 1.01607502 1.01622343 1.01636875 1.0165143 1.01665616 1.01679492 1.0169313 1.01706588 1.01719737 1.01732695 1.01745498 1.01757956 1.01770294 1.01782393 1.01794255 1.0180583 1.01817465 1.01828551 1.01839495 1.01850486 1.01861191 1.01871693 1.01882088 1.01891339}
    green {curve C 1}
    blue {curve C 0.00879261 0.00962762 0.010532 0.01151017 0.01256675 0.01370643 0.01493413 0.01625487 0.01767381 0.01919618 0.02082733 0.02257277 0.02443803 0.02642871 0.02855051 0.03080913 0.0332104 0.0357601 0.03846392 0.04132775 0.04435719 0.04755813 0.05093599 0.05449668 0.0582453 0.0621875 0.06632853 0.07067341 0.07522713 0.07999477 0.08498063 0.09018957 0.09562518 0.10129225 0.10719412 0.11333443 0.11971687 0.12634411 0.133219 0.14034435 0.14772213 0.15535444 0.16324303 0.17138906 0.179794 0.18845794 0.197382 0.20656651 0.21601067 0.22571453 0.23567709 0.24589771 0.25637382 0.26710594 0.2780903 0.28932518 0.30080822 0.3125369 0.32450783 0.33671761 0.34916404 0.36183971 0.37474373 0.38787127 0.40121818 0.41477671 0.42854655 0.44251823 0.45668846 0.47105014 0.48559928 0.50033116 0.5152359 0.5303098 0.5455451 0.56093836 0.5764783 0.59215891 0.60797763 0.62392306 0.63999057 0.65616876 0.6724565 0.68884456 0.70532417 0.72188419 0.73852479 0.7552371 0.77200818 0.78883314 0.80570388 0.82261622 0.83956301 0.8565321 0.87351894 0.89051074 0.90751225 0.92450547 0.94148719 0.95845115 0.97538745 0.99229181 1.00915313 1.02597356 1.04273522 1.05944169 1.07608175 1.09265125 1.10914159 1.12555146 1.14187002 1.15809321 1.1742171 1.190238 1.20614767 1.22194457 1.23762202 1.2531724 1.26859927 1.28389311 1.29905295 1.31407428 1.32895291 1.34368753 1.35827363 1.3727088 1.38699389 1.40111876 1.41508293 1.42889357 1.44254065 1.45602405 1.46934104 1.48249614 1.49548101 1.50830269 1.5209527 1.53343177 1.54574537 1.5578897 1.56985986 1.5816654 1.59329891 1.60476208 1.61605716 1.62718153 1.63813758 1.64892519 1.65955138 1.67000985 1.68030369 1.69043732 1.70040607 1.71021223 1.71985734 1.72934508 1.73867714 1.74785423 1.75688136 1.76575518 1.77447391 1.78304338 1.79146802 1.79975164 1.80788386 1.81587982 1.82373333 1.83144975 1.83902776 1.84647095 1.85378456 1.86096811 1.86802399 1.87495112 1.88175035 1.88842535 1.89497983 1.90141833 1.90774179 1.91394711 1.92004013 1.92602086 1.93188739 1.93765306 1.94330883 1.94886208 1.95430994 1.95965815 1.96490622 1.97005856 1.97511387 1.98007631 1.98494554 1.98972344 1.99441445 1.99901712 2.00353193 2.00796437 2.01231384 2.01658392 2.02076721 2.02487659 2.02890825 2.03286695 2.03675175 2.04056406 2.04430199 2.04797506 2.05157685 2.05511236 2.0585804 2.06198287 2.06532407 2.06860161 2.07181907 2.07497644 2.07807779 2.0811162 2.08409977 2.08702946 2.08990335 2.09272337 2.09549189 2.0982089 2.10087585 2.10349345 2.10606146 2.1085825 2.11105394 2.11348104 2.11586332 2.11820364 2.12050176 2.12275648 2.12496805 2.127141 2.12927723 2.13136625 2.13341999 2.13543844 2.13741732 2.13936305 2.1412704 2.1431427 2.14498401 2.14678812 2.14856291 2.1503005 2.15200949 2.15368938 2.15533352 2.15695238 2.15853977 2.16009951 2.16162968 2.16313291 2.16460824 2.16605687 2.16747928 2.16887903 2.17024994 2.1715951 2.17291784 2.17421341 2.17548871 2.17674041 2.17797112 2.17918396 2.18036819 2.18143296}
    alpha {}}
  name ColorLookup3
  label "Planckian Locus 0-269"
  xpos -1140
  ypos -808
 }
 Multiply {
  inputs 1+1
  channels rgb
  value 0
  maskChannelMask rgba.red
  invert_mask true
  name Multiply3
  label dim
  xpos -1140
  ypos -760
 }
 BlackOutside {
  name BlackOutside6
  xpos -1140
  ypos -706
 }
 Position {
  translate {6 {parent.Position2.translate.y-input.height}}
  name Position8
  xpos -1140
  ypos -682
 }
 Dot {
  name Dot28
  xpos -1106
  ypos -654
 }
push $N77004800
 Dot {
  name Dot4
  xpos -886
  ypos -1086
 }
set N76f61400 [stack 0]
 Rectangle {
  replace true
  area {0 0 6 {height}}
  name Rectangle1
  xpos -810
  ypos -1089
 }
 BlackOutside {
  name BlackOutside5
  xpos -810
  ypos -1041
 }
push $N76f61400
 Radial {
  inputs 1+1
  replace true
  area {-5422 -3542 7470 5590}
  softness 0
  ramp linear
  color {0.0719 0.02604 0.0001 1}
  p1 {0 0}
  color0 {0.039378 0.001097 0.188331 1}
  p0 {0 2048}
  name Radial1
  xpos -920
  ypos -1041
 }
 Dot {
  name Dot9
  xpos -886
  ypos -894
 }
push $N77004c00
 Gamma {
  channels rgba
  value 0.5
  name Gamma2
  xpos -700
  ypos -1120
 }
 Expression {
  temp_name0 start
  temp_expr0 360
  temp_name1 end
  temp_expr1 830
  channel0 {rgba.red rgba.green rgba.blue none}
  expr0 r*(end-start)+start
  channel1 none
  channel2 none
  expr3 1
  name Expression2
  label "360nm to 830nm"
  xpos -700
  ypos -1096
 }
 ColorLookup {
  lut {master {}
    red {curve x360 0.0001299 C 0.00014585 0.0001638 0.000184 0.00020669 0.0002321 0.00026073 0.00029307 0.00032939 0.00036991 0.0004149 0.00046416 0.00051899 0.00058185 0.00065523 0.0007416 0.00084503 0.00096453 0.00109495 0.00123115 0.001368 0.00150205 0.00164233 0.00180238 0.00199576 0.002236 0.00253539 0.0028926 0.00330083 0.00375324 0.004243 0.00476239 0.00533005 0.00597871 0.00674112 0.00765 0.00875137 0.01002888 0.0114217 0.01286901 0.01431 0.01570443 0.01714744 0.01878122 0.02074801 0.02319 0.02620736 0.02978248 0.03388092 0.03846824 0.04351 0.0489956 0.0550226 0.0617188 0.069212 0.07763 0.08695811 0.09717672 0.1084063 0.1207672 0.13438 0.1493582 0.16539571 0.1819831 0.19861101 0.21477 0.23018681 0.24487969 0.25877729 0.27180791 0.28389999 0.29494381 0.3048965 0.31378731 0.32164541 0.3285 0.3343513 0.33921009 0.34312129 0.3461296 0.34828001 0.3495999 0.3501474 0.35001299 0.349287 0.34806001 0.34637329 0.34426239 0.3418088 0.3390941 0.3362 0.33319771 0.33004111 0.32663569 0.32288679 0.31869999 0.3140251 0.30888399 0.3032904 0.2972579 0.29080001 0.28397009 0.27672139 0.2689178 0.26042271 0.2511 0.2408475 0.2298512 0.2184072 0.2068115 0.19536 0.18421359 0.1733273 0.16268811 0.1522833 0.14210001 0.1321786 0.1225696 0.1132752 0.1042979 0.09564 0.08729955 0.07930804 0.07171776 0.06458099 0.05795001 0.05186211 0.04628152 0.04115088 0.03641283 0.03201 0.0279172 0.0241444 0.020687 0.0175404 0.0147 0.01216179 0.00991996 0.00796724 0.00629635 0.0049 0.00377717 0.00294532 0.00242488 0.00223629 0.0024 0.00292552 0.00383656 0.00517484 0.00698208 0.0093 0.01214949 0.01553588 0.01947752 0.02399277 0.0291 0.03481485 0.04112016 0.04798504 0.05537861 0.06327 0.07163501 0.08046224 0.08973996 0.09945645 0.1096 0.1201674 0.1311145 0.1423679 0.15385421 0.1655 0.17725711 0.18914001 0.2011694 0.21336579 0.2257499 0.2383209 0.2510668 0.26399219 0.2771017 0.2904 0.30389121 0.31757259 0.33143839 0.3454828 0.35969999 0.37408391 0.3886396 0.4033784 0.41831151 0.43344989 0.44879529 0.46433601 0.480064 0.49597129 0.51205009 0.52829587 0.54469162 0.56120938 0.57782149 0.59450001 0.6112209 0.62797582 0.64476019 0.66156971 0.67839998 0.69523919 0.7120586 0.72882837 0.7455188 0.76209998 0.77854317 0.79482561 0.81092638 0.82682478 0.84249997 0.85793251 0.87308162 0.88789439 0.90231812 0.9163 0.9297995 0.94279838 0.95527762 0.96721792 0.97860003 0.9893856 0.99954879 1.00908923 1.01800644 1.02629995 1.03398275 1.04098594 1.04718804 1.05246675 1.05669999 1.05979443 1.06179917 1.06280684 1.0629096 1.06219995 1.06073523 1.05844355 1.05522442 1.05097675 1.04560006 1.03903687 1.03136074 1.02266622 1.0130477 1.00259995 0.99136752 0.97933137 0.96649158 0.9528479 0.93839997 0.92319399 0.90724403 0.89050198 0.87291998 0.85444993 0.83508402 0.814946 0.794186 0.77295399 0.75139999 0.72958362 0.70758879 0.68560219 0.66381037 0.64240003 0.62151492 0.6011138 0.58110517 0.56139767 0.54189998 0.52259952 0.50354642 0.4847436 0.46619391 0.4479 0.42986131 0.41209799 0.39464399 0.37753329 0.3608 0.34445629 0.32851681 0.31301919 0.29800111 0.28349999 0.26954481 0.25611839 0.2431896 0.2307272 0.21870001 0.2070971 0.19592319 0.1851708 0.1748323 0.1649 0.1553667 0.14623 0.13749 0.1291467 0.1212 0.1136397 0.106465 0.09969044 0.09333061 0.0874 0.08190096 0.07680428 0.07207712 0.06768664 0.0636 0.05980685 0.05628216 0.05297104 0.04981861 0.04677 0.04378405 0.04087536 0.03807264 0.03540461 0.0329 0.03056419 0.02838056 0.02634484 0.02445275 0.0227 0.02108429 0.01959988 0.01823732 0.01698717 0.01584 0.01479064 0.01383132 0.01294868 0.0121292 0.01135916 0.01062935 0.00993885 0.00928842 0.00867885 0.00811092 0.00758239 0.00708875 0.00662731 0.00619541 0.00579035 0.00540983 0.00505258 0.00471751 0.00440351 0.00410946 0.00383391 0.00357575 0.00333434 0.00310907 0.00289933 0.00270435 0.00252302 0.00235417 0.00219662 0.00204919 0.00191096 0.00178144 0.00166011 0.00154646 0.00143997 0.00134004 0.00124628 0.00115847 0.00107643 0.00099995 0.00092874 0.00086243 0.00080075 0.0007434 0.00069008 0.00064052 0.0005945 0.00055186 0.00051243 0.00047602 0.00044245 0.00041151 0.00038298 0.00035665 0.0003323 0.00030976 0.00028889 0.00026954 0.00025157 0.00023483 0.00021917 0.00020453 0.00019084 0.00017807 0.00016615 0.00015502 0.00014462 0.00013491 0.00012585 0.00011741 0.00010955 0.00010222 9.539e-05 8.902e-05 8.308e-05 7.751e-05 7.231e-05 6.746e-05 6.293e-05 5.871e-05 5.477e-05 5.11e-05 4.768e-05 4.449e-05 4.151e-05 3.873e-05 3.614e-05 3.372e-05 3.146e-05 2.935e-05 2.738e-05 2.552e-05 2.379e-05 2.218e-05 2.067e-05 1.927e-05 1.797e-05 1.675e-05 1.562e-05 1.456e-05 1.357e-05 1.265e-05 1.18e-05 1.1e-05 1.025e-05 9.56e-06 8.91e-06 8.31e-06 7.75e-06 7.22e-06 6.73e-06 6.28e-06 5.85e-06 5.46e-06 5.09e-06 4.74e-06 4.42e-06 4.12e-06 3.84e-06 3.58e-06 3.34e-06 3.11e-06 2.9e-06 2.71e-06 2.52e-06 2.35e-06 2.19e-06 2.04e-06 1.91e-06 1.78e-06 1.66e-06 1.54e-06 1.44e-06 1.34e-06 S 1.25e-06}
    green {curve x360 3.92e-06 C 4.39e-06 4.93e-06 5.53e-06 6.21e-06 6.97e-06 7.81e-06 8.77e-06 9.84e-06 1.104e-05 1.239e-05 1.389e-05 1.556e-05 1.744e-05 1.958e-05 2.202e-05 2.484e-05 2.804e-05 3.153e-05 3.522e-05 3.9e-05 4.283e-05 4.691e-05 5.159e-05 5.718e-05 6.4e-05 7.234e-05 8.221e-05 9.351e-05 0.00010614 0.00012 0.00013498 0.00015149 0.00017021 0.00019182 0.000217 0.00024691 0.00028124 0.00031852 0.00035727 0.000396 0.00043371 0.00047302 0.00051788 0.00057222 0.00064 0.00072456 0.0008255 0.00094116 0.00106988 0.00121 0.00136209 0.00153075 0.00172037 0.00193532 0.00218 0.0024548 0.002764 0.0031178 0.0035264 0.004 0.00454624 0.00515932 0.00582928 0.00654616 0.0073 0.00808651 0.00890872 0.00976768 0.01066443 0.0116 0.01257317 0.01358272 0.01462968 0.01571509 0.01684 0.01800736 0.01921448 0.02045392 0.02171824 0.023 0.02429461 0.02561024 0.02695857 0.02835125 0.0298 0.03131083 0.03288368 0.03452112 0.03622571 0.038 0.03984667 0.041768 0.043766 0.04584267 0.048 0.05024368 0.05257304 0.05498056 0.05745872 0.06 0.06260197 0.06527752 0.06804208 0.07091109 0.0739 0.077016 0.0802664 0.0836668 0.0872328 0.09098 0.09491755 0.09904584 0.1033674 0.1078846 0.1126 0.117532 0.1226744 0.12799279 0.1334528 0.13902 0.1446764 0.1504693 0.15646189 0.1627177 0.1693 0.1762431 0.18355811 0.1912735 0.19941799 0.20802 0.2171199 0.2267345 0.2368571 0.2474812 0.2586 0.2701849 0.28229389 0.2950505 0.30857801 0.32300001 0.33840209 0.35468581 0.37169859 0.3892875 0.4073 0.42562991 0.44430959 0.4633944 0.48293951 0.50300002 0.52356929 0.54451197 0.56568998 0.58696532 0.60820001 0.6293456 0.65030682 0.67087519 0.69084239 0.70999998 0.72818518 0.74546361 0.76196939 0.7778368 0.79320002 0.80811042 0.82249618 0.83630681 0.8494916 0.86199999 0.87381083 0.88496238 0.89549363 0.90544319 0.91485012 0.92373478 0.93209243 0.93992257 0.94722521 0.954 0.9602561 0.96600741 0.97126061 0.97602248 0.98030001 0.98409241 0.98741817 0.99031281 0.99281162 0.99495012 0.99671078 0.99809831 0.99911201 0.99974817 1 0.99985671 0.99930459 0.99832553 0.99689871 0.995 0.9926005 0.98974258 0.98644441 0.98272407 0.97860003 0.97408372 0.96917123 0.96385682 0.95813489 0.95200002 0.94545043 0.93849921 0.93116277 0.92345762 0.91540003 0.90700638 0.89827722 0.8892048 0.8797816 0.87 0.85986131 0.849392 0.83862197 0.82758129 0.81629997 0.80479473 0.793082 0.781192 0.76915473 0.75700003 0.74475408 0.73242241 0.7200036 0.70749652 0.69489998 0.68221921 0.66947162 0.65667439 0.64384478 0.63099998 0.61815548 0.60531437 0.59247559 0.57963789 0.5668 0.5539611 0.54113722 0.5283528 0.51563227 0.50300002 0.4904688 0.47803041 0.46567759 0.4534032 0.44119999 0.42908001 0.417036 0.40503201 0.39303201 0.38100001 0.36891839 0.3568272 0.34477681 0.33281761 0.32100001 0.30933809 0.2978504 0.28659359 0.27562451 0.26499999 0.25476319 0.2448896 0.2353344 0.22605281 0.21699999 0.20816161 0.1995488 0.1911552 0.1829744 0.175 0.1672235 0.15964641 0.1522776 0.1451259 0.1382 0.1315003 0.1250248 0.1187792 0.1127691 0.107 0.1014762 0.09618864 0.09112296 0.08626485 0.0816 0.07712064 0.07282552 0.06871008 0.06476976 0.061 0.05739621 0.05395504 0.05067376 0.04754965 0.04458 0.04175872 0.03908496 0.03656384 0.03420048 0.032 0.02996261 0.02807664 0.02632936 0.02470805 0.0232 0.02180077 0.02050112 0.01928108 0.01812069 0.017 0.01590379 0.01483718 0.01381068 0.01283478 0.01192 0.01106831 0.01027339 0.00953331 0.00884616 0.00821 0.00762378 0.00708542 0.00659148 0.00613848 0.005723 0.00534306 0.0049958 0.0046764 0.00438007 0.004102 0.00383845 0.0035891 0.00335422 0.00313409 0.002929 0.00273814 0.00255988 0.00239324 0.00223728 0.002091 0.00195359 0.00182458 0.00170358 0.00159019 0.001484 0.0013845 0.00129127 0.00120409 0.00112274 0.001047 0.00097659 0.00091111 0.00085013 0.00079324 0.00074 0.00069008 0.00064331 0.0005995 0.00055845 0.00052 0.00048391 0.00045005 0.00041835 0.00038872 0.0003611 0.00033538 0.00031144 0.00028917 0.00026845 0.0002492 0.0002313 0.00021469 0.00019929 0.00018505 0.0001719 0.00015978 0.0001486 0.0001383 0.00012879 0.00012 0.00011186 0.00010432 9.734e-05 9.085e-05 8.48e-05 7.915e-05 7.386e-05 6.892e-05 6.43e-05 6e-05 5.598e-05 5.223e-05 4.872e-05 4.545e-05 4.24e-05 3.956e-05 3.692e-05 3.445e-05 3.215e-05 3e-05 2.799e-05 2.611e-05 2.436e-05 2.272e-05 2.12e-05 1.978e-05 1.845e-05 1.722e-05 1.606e-05 1.499e-05 1.399e-05 1.305e-05 1.218e-05 1.136e-05 1.06e-05 9.89e-06 9.22e-06 8.59e-06 8.01e-06 7.47e-06 6.96e-06 6.49e-06 6.05e-06 5.64e-06 5.26e-06 4.9e-06 4.57e-06 4.26e-06 3.97e-06 3.7e-06 3.45e-06 3.22e-06 3e-06 2.8e-06 2.61e-06 2.43e-06 2.27e-06 2.11e-06 1.97e-06 1.84e-06 1.71e-06 1.6e-06 1.49e-06 1.39e-06 1.29e-06 1.21e-06 1.12e-06 1.05e-06 9.8e-07 9.1e-07 8.5e-07 7.9e-07 7.4e-07 6.9e-07 6.4e-07 6e-07 5.6e-07 5.2e-07 4.8e-07 S 4.5e-07}
    blue {curve x360 0.0006061 C 0.00068088 0.00076515 0.00086001 0.00096659 0.001086 0.00122059 0.00137273 0.00154358 0.00173429 0.001946 0.00217778 0.00243581 0.00273195 0.00307806 0.003486 0.00397523 0.00454088 0.00515832 0.00580291 0.00645 0.00708322 0.00774549 0.00850115 0.00941454 0.01054999 0.0119658 0.01365587 0.01558805 0.01773015 0.02005001 0.02251136 0.02520288 0.02827972 0.03189704 0.03621 0.04143771 0.04750372 0.05411988 0.06099803 0.06785001 0.07448632 0.08136156 0.08915364 0.09854048 0.1102 0.1246133 0.1417017 0.16130351 0.1832568 0.20739999 0.23369209 0.26261139 0.29477459 0.33079851 0.37130001 0.4162091 0.4654642 0.51969481 0.5795303 0.64560002 0.71848381 0.79671329 0.87784588 0.95943898 1.0390501 1.11536729 1.18849707 1.25812328 1.32392955 1.38559997 1.44263518 1.49480355 1.54219031 1.58488071 1.62295997 1.65640485 1.68529594 1.70987451 1.73038209 1.74705994 1.76004458 1.76962328 1.77626371 1.78043342 1.78260004 1.78296816 1.78169978 1.77919817 1.7758671 1.77210998 1.76825893 1.76403904 1.7589438 1.75246632 1.74409997 1.73355949 1.7208581 1.70593691 1.68873715 1.66919994 1.64752865 1.62341273 1.59602225 1.56452799 1.52810001 1.4861114 1.43952155 1.38987994 1.33873618 1.28763998 1.23742235 1.18782425 1.13876104 1.09014797 1.04190004 0.99419761 0.94734728 0.90145308 0.8566193 0.81295007 0.77051729 0.7294448 0.68991357 0.65210491 0.61619997 0.58232862 0.55041617 0.52033758 0.49196729 0.46518001 0.4399246 0.41618359 0.39388219 0.3729459 0.35330001 0.33485779 0.31755209 0.30133751 0.28616861 0.27200001 0.25881711 0.2464838 0.2347718 0.2234533 0.2123 0.20116919 0.19011959 0.1792254 0.1685608 0.1582 0.1481383 0.1383758 0.1289942 0.1200751 0.1117 0.1039048 0.09666748 0.08998272 0.08384531 0.07824999 0.07320899 0.06867816 0.06456784 0.06078835 0.05725001 0.05390435 0.05074664 0.04775276 0.04489859 0.04216 0.03950728 0.03693564 0.03445836 0.03208872 0.02984 0.02771181 0.02569444 0.02378716 0.02198925 0.0203 0.01871805 0.01724036 0.01586364 0.01458461 0.0134 0.01230723 0.01130188 0.01037792 0.00952931 0.00875 0.0080352 0.0073816 0.0067854 0.0062428 0.00575 0.0053036 0.0048998 0.0045342 0.0042024 0.0039 0.0036232 0.0033706 0.0031414 0.0029348 0.00275 0.0025852 0.0024386 0.0023094 0.0021968 0.0021 0.00201773 0.0019482 0.0018898 0.00184093 0.0018 0.00176627 0.0017378 0.0017112 0.00168307 0.00165 0.00161013 0.0015644 0.0015136 0.00145853 0.0014 0.00133667 0.00127 0.001205 0.00114667 0.0011 0.0010688 0.0010494 0.0010356 0.0010212 0.001 0.00096864 0.00092992 0.00088688 0.00084256 0.0008 0.00076096 0.00072368 0.00068592 0.00064544 0.0006 0.00054787 0.0004916 0.0004354 0.00038347 0.00034 0.00030725 0.00028316 0.00026544 0.00025181 0.00024 0.00022955 0.00022064 0.00021196 0.00020219 0.00019 0.00017421 0.00015564 0.00013596 0.00011685 0.0001 8.613e-05 7.46e-05 6.5e-05 5.693e-05 5e-05 4.416e-05 3.948e-05 3.572e-05 3.264e-05 3e-05 2.765e-05 2.556e-05 2.364e-05 2.181e-05 2e-05 1.813e-05 1.62e-05 1.42e-05 1.213e-05 1e-05 7.73e-06 5.4e-06 3.2e-06 1.33e-06 0 0 0 0 0 0 0 0 S 0}
    alpha {}}
  name ColorLookup4
  label "CIE 1931 2 Degree Standard Observer\n360nm to 830nm"
  xpos -700
  ypos -1030
 }
 Merge2 {
  inputs 2
  bbox B
  name MergeLineOfPurples
  xpos -700
  ypos -897
  disable {{!parent.draw_line_of_purples}}
 }
 Fill {
  color {0 0 0 1}
  name Disable_SpectralLocus
  xpos -700
  ypos -826
  disable {{parent.draw_spectral_locus}}
 }
 Merge2 {
  inputs 2
  bbox B
  name MergePlanckianLocus
  xpos -700
  ypos -658
  disable {{!parent.draw_planckian_locus}}
 }
 Merge2 {
  inputs 2
  bbox B
  name MergePointerGamut
  xpos -700
  ypos -489
  disable {{!parent.draw_pointers_gamut}}
 }
 Merge2 {
  inputs 2
  bbox B
  name MergePointerGamut_Samples
  xpos -700
  ypos -417
  disable {{!draw_pointers_samples}}
 }
 Merge2 {
  inputs 2
  bbox B
  name MergeMacbeth
  xpos -700
  ypos -273
  disable {{!parent.draw_macbeth_chart}}
 }
 Merge2 {
  inputs 2
  bbox B
  name MergeGamutGrid
  xpos -700
  ypos -81
  disable {{!parent.gamut_grid}}
 }
 Merge2 {
  inputs 2
  bbox B
  name MergeGamutA
  xpos -700
  ypos 255
  disable {{!parent.gamut_a}}
 }
 Merge2 {
  inputs 2
  bbox B
  name MergeGamutB
  xpos -700
  ypos 279
  disable {{!parent.gamut_b}}
 }
 Merge2 {
  inputs 2
  bbox B
  name MergeGamutC
  xpos -700
  ypos 303
  disable {{!parent.gamut_c}}
 }
 Dot {
  name Dot2
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -666
  ypos 450
 }
set N76f08800 [stack 0]
 Dot {
  name Dot5
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -556
  ypos 450
 }
 Colorspace {
  colorspace_in CIE-XYZ
  primary_in "Adobe (1998)"
  colorspace_out CIE-Yxy
  name Colorspace6
  label "\[value colorspace_in] -> \[value colorspace_out]"
  xpos -590
  ypos 488
 }
 Expression {
  expr0 r
  expr1 "4*g / ( -2*g + 12*b + 3)"
  expr2 "9*b / ( -2*g + 12*b + 3)"
  name Expression5
  label "CIE Yxy to CIELuv"
  xpos -590
  ypos 536
  disable {{!parent.diagram}}
 }
 Dot {
  name Dot11
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -556
  ypos 618
 }
push $N76f08800
 ColorMatrix {
  matrix {
      {{parent.GamutToXYZ.ColorMatrix.matrix} {parent.GamutToXYZ.ColorMatrix.matrix} {parent.GamutToXYZ.ColorMatrix.matrix}}
      {{parent.GamutToXYZ.ColorMatrix.matrix} {parent.GamutToXYZ.ColorMatrix.matrix} {parent.GamutToXYZ.ColorMatrix.matrix}}
      {{parent.GamutToXYZ.ColorMatrix.matrix} {parent.GamutToXYZ.ColorMatrix.matrix} {parent.GamutToXYZ.ColorMatrix.matrix}}
    }
  invert true
  name ColorMatrix1
  label "XYZ to working"
  xpos -700
  ypos 488
  disable {{!map_overlays_to_input_gamut}}
 }
 BlinkScript {
  inputs 2
  KernelDescription "2 \"PlotChromaticity_grid\" iterate pixelWise b2e7b5f8a89bdb0629aa8cc2eae387ef3436f24cb0af642eeba41235874506c4 3 \"col\" Read Random \"Yxy\" Read Random \"dst\" Write Random 6 \"padding\" Float 1 AAAAAA== \"left_margin\" Float 1 AAAAAA== \"tolerance\" Float 1 AAAAAA== \"antialias\" Bool 1 AA== \"draw_axes\" Bool 1 AA== \"grid_color\" Float 4 AAAAAAAAAAAAAAAAAAAAAA== 6 \"padding\" 1 1 \"left_margin\" 1 1 \"tolerance\" 1 1 \"antialias\" 1 1 \"draw_axes\" 1 1 \"grid_color\" 4 1 2 \"outsize\" Float 1 1 AAAAAA== \"offset\" Float 1 1 AAAAAA=="
  kernelSource "kernel PlotChromaticity_grid : public ImageComputationKernel<ePixelWise>\n\{\n  Image<eRead, eAccessRandom, eEdgeClamped> col;\n  Image<eRead, eAccessRandom, eEdgeClamped> Yxy;\n  Image<eWrite, eAccessRandom> dst;\n\nparam:\n  float padding;\n  float left_margin;\n  float tolerance;\n  bool antialias;\n  bool draw_axes;\n  float4 grid_color;\n\nlocal:\n  float outsize;\n  float offset;\n\n  void init() \{\n    // calculate output width and height and offset based on padding\n    outsize = float(dst.bounds.height()/padding);\n    // xy offset for margin on lower left corner\n    offset = dst.bounds.height()*left_margin;\n  \}\n\n  float gaussian(float d, float a, float expv) \{\n    return max(0.0f, exp(-a*d*d)-expv);\n  \}\n\n  float gaussian_filter(float x, float y, float r) \{\n    // return gaussian weighted distance from origin (0, 0)\n    // given coordinate (x, y) and radius r\n    float a = 1.5f; // rate falloff\n    float expv = exp(-a*r*r);\n    return gaussian(x, a, expv) * gaussian(y, a, expv);\n  \}\n\n  void write_aa(float x, float y, float4 rgb) \{\n    // skip black pixels\n    if (rgb.x == 0.0f && rgb.y == 0.0f && rgb.z == 0.0f) return;\n    \n    // size of pixel neighborhood = n*2+1 by n*2+1\n    int n = 2;\n\n    // center of neighborhood\n    int u0 = round(x);\n    int v0 = round(y);\n\n    // skip if center pixel weight is greater than tolerance\n    if ( dst.bounds.inside(u0, v0)) \{\n      if (dst(u0, v0, 3) >= tolerance) return;\n    \}\n\n    // loop over neighborhood\n    for (int j = -n; j <= n; j++) \{\n      int v = v0 + j;\n      for (int i = -n; i <= n; i++) \{\n        int u = u0 + i;\n        if ( dst.bounds.inside(u, v)) \{\n          // get filter weight for coord (u,v)\n          float w = gaussian_filter(u-x, v-y, float(n));\n          float4 c0 = dst(u, v); // existing color\n\n          // merge current color sample over existing color sample\n          for (int k=0; k<3; k++) \{\n            dst(u, v, k) = rgb\[k]*w+c0\[k]*(1-w); \n          \}\n\n          // merge current weight over existing weight\n          float w0 = dst(u, v, 3);\n          dst(u, v, 3) = w+w0*(1-w);\n        \}\n      \}\n    \}\n  \}\n\n  void draw_grid() \{\n    // grid width in pixels. expresses a 0 to 1 range in CIE xy\n    float grid_width = 1.0f * outsize + offset;\n    // draw grid lines\n    float i = offset;\n    while (i <= grid_width && i > 0.0f) \{\n      write_aa(offset, i, grid_color);\n      write_aa(i, offset, grid_color);\n      i += 1.0;\n    \}\n    // cross-hatching interval in pixels\n    float hatch_interval = (grid_width - offset) * 0.1f;\n    // cross-hatch length in pixels\n    float hatch_width = outsize * 0.01f;\n    i = offset;\n    while (i <= grid_width) \{\n      i += hatch_interval;\n      float j = 0.0;\n      while (j <= hatch_width/2) \{\n        write_aa(offset+j, i, grid_color);\n        write_aa(offset-j, i, grid_color);\n        write_aa(i, offset+j, grid_color);\n        write_aa(i, offset-j, grid_color);\n        j += 1.0;\n      \}\n    \}\n  \}\n\n  void process(int2 pos) \{\n    float4 rgba = col(pos.x, pos.y);\n    \n    // Get CIE xy position from Yxy input for current pixel\n    float2 xy = float2(Yxy(pos.x, pos.y, 1), Yxy(pos.x, pos.y, 2));\n    \n    // Find output pixel coordinate for this CIE xy pixel value\n    float2 out_coord = float2(xy.x * outsize + offset, xy.y * outsize + offset);\n\n    // For each RGB component, write value from color input to output coordinate\n    if (antialias) \{\n      write_aa(out_coord.x, out_coord.y, rgba);\n    \} else \{\n      // For each RGB component, write value from color input to output coordinate\n      int2 p = int2(round(out_coord.x), round(out_coord.y));\n      if (dst.bounds.inside(p.x, p.y)) \{\n        for (int k=0; k<3; k++) \{\n          dst(p.x, p.y, k) = col(pos.x, pos.y, k);\n        \}\n        dst(p.x, p.y, 3) = 1.0f;\n      \}\n    \}\n\n    // draw CIExy coordinate system axes\n    if (draw_axes && pos.x == 0 && pos.y == 0) \{\n      draw_grid();\n    \}\n  \}\n\};"
  useGPUIfAvailable {{parent.use_gpu}}
  rebuild ""
  PlotChromaticity_grid_padding {{parent.PlotChromaticities.PlotChromaticity_padding}}
  PlotChromaticity_grid_left_margin {{parent.PlotChromaticities.PlotChromaticity_left_margin}}
  PlotChromaticity_grid_tolerance 0.8
  PlotChromaticity_grid_antialias true
  PlotChromaticity_grid_draw_axes {{parent.coordinate_system}}
  PlotChromaticity_grid_grid_color {0.15 0 0.005 1}
  format "2048 2048 0 0 2048 2048 1 square_2K"
  rebuild_finalise ""
  name PlotInput2
  xpos -700
  ypos 608
 }
 FrameHold {
  firstFrame 1
  name FrameHold1
  xpos -700
  ypos 680
  cached true
 }
 Dot {
  name Dot3
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -666
  ypos 762
 }
 Input {
  inputs 0
  name Input
  xpos 620
  ypos -1426
 }
 AddChannels {
  name AddChannels1
  xpos 620
  ypos -1360
 }
 Reformat {
  type "to box"
  box_width {{parent.resolution}}
  box_height {{box_width}}
  box_fixed true
  box_pixel_aspect {{input.pixel_aspect}}
  resize distort
  filter impulse
  name OutputFormat
  xpos 620
  ypos -1282
  disable {{!parent.resample_input}}
 }
 Crop {
  box {0 0 {width} {height}}
  crop false
  name CropBBox
  xpos 620
  ypos -1257
 }
 Dot {
  name Dot7
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 654
  ypos 162
 }
set N76e9d000 [stack 0]
 Constant {
  inputs 0
  channels rgb
  color {0 0 0 1}
  format "256 256 0 0 256 256 1 square_256"
  name Constant2
  xpos 400
  ypos 38
  postage_stamp false
 }
 Reformat {
  type "to box"
  box_width {{parent.resolution}}
  box_height {{box_width}}
  box_fixed true
  box_pixel_aspect {{input.pixel_aspect}}
  resize distort
  filter impulse
  name OutputFormat1
  xpos 400
  ypos 64
  disable {{!parent.resample_input}}
 }
 Switch {
  inputs 2
  which {{"\[exists parent.input0]"}}
  name Switch1
  xpos 400
  ypos 158
 }
 Fill {
  output rgb
  color 0.18
  name SampleColor
  xpos 290
  ypos 158
 }
 Crop {
  box {0 0 {width} {height}}
  crop false
  name Crop2
  xpos 290
  ypos 184
 }
 Fill {
  output alpha
  name Fill3
  xpos 290
  ypos 224
 }
 Dot {
  name Dot6
  xpos 324
  ypos 282
 }
set N76e3b000 [stack 0]
 ColorMatrix {
  matrix {
      {{parent.GamutToXYZ.ColorMatrix.matrix} {parent.GamutToXYZ.ColorMatrix.matrix} {parent.GamutToXYZ.ColorMatrix.matrix}}
      {{parent.GamutToXYZ.ColorMatrix.matrix} {parent.GamutToXYZ.ColorMatrix.matrix} {parent.GamutToXYZ.ColorMatrix.matrix}}
      {{parent.GamutToXYZ.ColorMatrix.matrix} {parent.GamutToXYZ.ColorMatrix.matrix} {parent.GamutToXYZ.ColorMatrix.matrix}}
    }
  name ColorMatrix4
  label "working to XYZ"
  xpos 180
  ypos 272
 }
 Colorspace {
  colorspace_in CIE-XYZ
  primary_in "Adobe (1998)"
  colorspace_out CIE-Yxy
  name Colorspace1
  label "\[value colorspace_in] -> \[value colorspace_out]"
  xpos 180
  ypos 320
 }
 Expression {
  expr0 r
  expr1 "4*g / ( -2*g + 12*b + 3)"
  expr2 "9*b / ( -2*g + 12*b + 3)"
  name Expression6
  label "CIE Yxy to CIELuv"
  xpos 180
  ypos 368
  disable {{!parent.diagram}}
 }
push $N76e3b000
 BlinkScript {
  inputs 2
  KernelDescription "2 \"PlotChromaticity_sample\" iterate pixelWise 20e14b615a937bac78c1a771cbdfd10cc7c5fb6c487f65d0bb2d6633e404b958 3 \"col\" Read Random \"Yxy\" Read Random \"dst\" Write Random 3 \"padding\" Float 1 AAAAAA== \"left_margin\" Float 1 AAAAAA== \"tolerance\" Float 1 AAAAAA== 3 \"padding\" 1 1 \"left_margin\" 1 1 \"tolerance\" 1 1 2 \"outsize\" Float 1 1 AAAAAA== \"offset\" Float 1 1 AAAAAA=="
  kernelSource "kernel PlotChromaticity_sample : public ImageComputationKernel<ePixelWise>\n\{\n  Image<eRead, eAccessRandom, eEdgeClamped> col;\n  Image<eRead, eAccessRandom, eEdgeClamped> Yxy;\n  Image<eWrite, eAccessRandom> dst;\n\nparam:\n  float padding;\n  float left_margin;\n  float tolerance;\n\nlocal:\n  float outsize;\n  float offset;\n\n  void init() \{\n    // calculate output width and height and offset based on padding\n    outsize = float(dst.bounds.height()/padding);\n    // xy offset for margin on lower left corner\n    offset = dst.bounds.height()*left_margin;\n  \}\n\n  void process(int2 pos) \{\n    // only process the first pixel\n    if (pos.x > 0 && pos.y > 0) return;\n\n    // Get CIE xy position from Yxy input for current pixel\n    float2 xy = float2(Yxy(pos.x, pos.y, 1), Yxy(pos.x, pos.y, 2));\n    \n    // Find output pixel coordinate for this CIE xy pixel value\n    float2 out_coord = float2(xy.x * outsize + offset, xy.y * outsize + offset);\n\n    // For each RGB component, write value from color input to output coordinate\n    int2 p = int2(round(out_coord.x), round(out_coord.y));\n    if (dst.bounds.inside(p.x, p.y)) \{\n      for (int k=0; k<3; k++) \{\n        dst(p.x, p.y, k) = col(pos.x, pos.y, k);\n      \}\n      dst(p.x, p.y, 3) = 1.0f;\n    \}\n  \}\n\};"
  useGPUIfAvailable {{parent.use_gpu}}
  rebuild ""
  PlotChromaticity_sample_padding {{"parent.diagram ? parent.right_margin*0.8 : parent.right_margin"}}
  PlotChromaticity_sample_left_margin {{parent.left_margin}}
  PlotChromaticity_sample_tolerance 1
  format "2048 2048 0 0 2048 2048 1 square_2K"
  rebuild_finalise ""
  name PlotChromaticities1
  xpos 290
  ypos 368
 }
 Dot {
  name Dot22
  xpos 324
  ypos 450
 }
set N76e39c00 [stack 0]
 Dilate {
  channels rgba
  size {{Output.width/2048}}
  name Dilate1
  label "\[value size]"
  xpos 290
  ypos 488
 }
set N76e39800 [stack 0]
 Dilate {
  channels rgba
  size {{Output.width/2048*2}}
  name Dilate2
  label "\[value size]"
  xpos 180
  ypos 488
 }
push $N76e39c00
 Dot {
  name Dot21
  xpos -6
  ypos 450
 }
 FilterErode {
  channels rgba
  size {{-Output.width/2048/5}}
  filter triangle
  name FilterErode1
  label "\[value size]"
  xpos -40
  ypos 489
 }
set N76e38c00 [stack 0]
 Dilate {
  channels rgba
  size {0 {parent.Dilate3.size.w}}
  name Dilate4
  label "\[value size]"
  xpos -40
  ypos 584
 }
push $N76e38c00
 Dilate {
  channels rgba
  size {{Output.width*plus_size/100} 0}
  name Dilate3
  label "\[value size]"
  xpos 70
  ypos 488
  addUserKnob {20 User}
  addUserKnob {7 plus_size R 0 4}
  plus_size 0.8
 }
 Merge2 {
  inputs 2
  operation screen
  bbox B
  name Merge9
  xpos 70
  ypos 591
 }
 Merge2 {
  inputs 2
  operation stencil
  bbox B
  name Merge10
  xpos 180
  ypos 591
 }
 Group {
  name HueRotate
  xpos 180
  ypos 639
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -24
  }
  Unpremult {
   name Unpremult1
   xpos -40
   ypos 15
  }
  Colorspace {
   colorspace_out HSV
   name Colorspace1
   xpos -40
   ypos 72
  }
  Add {
   channels {rgba.red -rgba.green -rgba.blue none}
   value 0.5
   name Add1
   xpos -40
   ypos 111
  }
  Fill {
   output {-rgba.red -rgba.green rgba.blue none}
   name Fill1
   xpos -40
   ypos 147
  }
  Colorspace {
   colorspace_in HSV
   name Colorspace2
   xpos -40
   ypos 183
  }
  Premult {
   name Premult1
   xpos -40
   ypos 231
  }
  Output {
   name Output1
   xpos -40
   ypos 302
  }
 end_group
push $N76e39800
 Merge2 {
  inputs 2
  bbox B
  name Merge8
  xpos 290
  ypos 638
 }
 Dot {
  name Dot20
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 324
  ypos 690
 }
push $N76e9d000
 Dot {
  name Dot1
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 764
  ypos 162
 }
 Group {
  name GamutToXYZ
  label "\[if \{\[value invert]\} \{return \"XYZ to \[value gamut]\"\} else \{return \"\[value gamut] to XYZ\"\}]\n\n"
  xpos 730
  ypos 247
  addUserKnob {20 GamutToXYZ_tab l GamutToXYZ}
  addUserKnob {4 gamut t "Choose gamut" M {XYZ ACES ACEScg "Filmlight E-Gamut" Rec709 Rec2020 P3D60 P3D65 P3DCI "Arri AlexaWideGamut" REDDRAGONcolor REDDRAGONcolor2 REDcolor REDcolor2 REDcolor3 REDcolor4 REDWideGamutRGB "GoPro Protune Native" CanonCinemaGamut SonySGamut SonySGamut3Cine PanasonicVGamut "DJI D-Gamut" "Fujifilm F-Gamut" BMDFilmV1 BMD4kFilmV1 BMD4kFilmV3 BMD46kFilmV1 BMD46kFilmV3 BMDWideGamutV4 "AdobeRGB\t" AdobeWideGamutRGB ROMM RIMM ERIMM ProPhotoRGB RusselRGB SharpRGB AppleRGB BestRGB}}
  gamut Rec709
  addUserKnob {6 invert +STARTLINE}
  addUserKnob {26 ""}
  addUserKnob {26 chromaticity_coordinates_label l " " T "<b>Chromaticity Coordinates</b>"}
  addUserKnob {41 rxy T ColorMatrix.rxy}
  addUserKnob {41 gxy T ColorMatrix.gxy}
  addUserKnob {41 bxy T ColorMatrix.bxy}
  addUserKnob {41 wxy T ColorMatrix.wxy}
  addUserKnob {41 matrix T ColorMatrix.matrix}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -10
  }
  ColorMatrix {
   matrix {
       {{curve(which) 1 0.9525524378 0.6624541879 0.7053968906 0.4123907983 0.6369580626 0.5049495697 0.4865709841 0.4451698363 0.6380076408 0.5070186853 0.4462202489 0.4300414324 0.4581649601 0.4878340662 0.4517004192 0.7352752686 0.5022571683 0.7160496712 0.7064827085 0.5990839601 0.6796444654 0.6481720209 0.6369580626 0.6390493512 0.6141571999 0.3724023998 0.60689044 0.4017650783 0.6065810919 0.5766690373 0.7165006995 0.797760427 0.797760427 0.797760427 0.7976718545 0.7015837431 0.8156226277 0.4496616423 0.6318944097} {curve(which) 0 0 0.1340042055 0.1640413404 0.3575843275 0.1446169019 0.2646814585 0.2656676769 0.2771343887 0.2147038579 0.3587769568 0.3157556653 0.3700728714 0.3832037449 0.3432727158 0.3178463876 0.06860940903 0.2929667532 0.1296834797 0.1288010478 0.2489254922 0.1522114277 0.1940581352 0.1446169019 0.1578372866 0.2825684249 0.4324877858 0.2193847299 0.4560420811 0.2203479856 0.1855582297 0.1010205746 0.1351858526 0.1351858526 0.1351858526 0.1351878047 0.1554162204 0.04716260359 0.3162561059 0.2053879201} {curve(which) 0 9.367863095e-05 0.1561876982 0.08101774752 0.180480808 0.1688809693 0.1830150485 0.1982172877 0.1722826511 0.09774444997 0.0868505761 0.190669477 0.152531758 0.1112773567 0.1215386018 0.1830992699 0.1465712637 0.1552320272 0.1047228053 0.1151721701 0.1024464965 0.1186000481 0.108225815 0.1688809693 0.1516760886 0.05183707923 0.1436725408 0.124180764 0.09264881909 0.123526901 0.1882286519 0.1467743814 0.03134934977 0.03134934977 0.03134934977 0.03133957833 0.09979832917 0.1372147948 0.1845382005 0.1270133406}}
       {{curve(which) 0 0.3439664543 0.2722287476 0.2801307142 0.2126390189 0.2627002299 0.237623319 0.2289745659 0.209491685 0.2919537723 0.2207257152 0.1942579001 0.2022213936 0.1694435924 0.2289056629 0.2119505703 0.2866941094 0.1387997568 0.2612613738 0.2709796727 0.2150758505 0.2606855333 0.2830046713 0.2627002299 0.1743051857 0.2365771234 0.1383759677 0.1973138005 0.1721783578 0.2680045366 0.2973450124 0.258728236 0.2880711257 0.2880711257 0.2880711257 0.2880405784 0.3152042925 0.3790788651 0.2446159422 0.2276017666} {curve(which) 1 0.7281661034 0.6740817428 0.8202066422 0.7151686549 0.6779980659 0.6891706586 0.6917385459 0.7215952873 0.8238410354 0.839184761 0.7385566831 0.7585275769 0.8648257852 0.7808576822 0.7230190039 0.8429791331 0.910841465 0.8696421385 0.786606431 0.8850684762 0.7748944759 0.8131960034 0.6779980659 0.951146543 0.8896810412 0.911518693 0.943950057 0.8553914428 0.8326833844 0.6273635626 0.7246823311 0.7118432522 0.7118432522 0.7118432522 0.7118694782 0.6648360491 0.5769088268 0.6720442176 0.7383946776} {curve(which) 0 -0.07213255018 0.05368951708 -0.1003373638 0.07219231874 0.05930171534 0.07320601493 0.07928691059 0.06891305745 -0.1157948226 -0.05991046131 0.06718540192 0.03925102949 -0.03426937759 -0.009763340466 0.06503042579 -0.1296732277 -0.04964122549 -0.1309035122 -0.05758608505 -0.1001443192 -0.03558001295 -0.09620071948 0.05930171534 -0.1254517138 -0.1262581497 -0.04989464581 -0.1412638426 -0.02756982669 -0.1006879359 0.07529145479 0.01658944227 8.565396274e-05 8.565396274e-05 8.565396274e-05 8.991353388e-05 0.01995966583 0.04401229322 0.08333983272 0.0340035744}}
       {{curve(which) 0 -3.863927134e-08 -0.005574660841 -0.1037815213 0.01933082007 0 0 0 0 0.0027982709 -0.0544523783 -0.04792318866 -0.0176958181 -0.1061859056 -0.02100777067 -0.01945115253 -0.07968087494 0.07801423222 -0.009676366113 -0.009677864611 -0.03206583485 -0.009310216643 -0.01825834997 0 -0.11669112 -0.02325225808 -0.1602820009 -0.1427432895 -0.10720893 -0.02941203304 0.02703136392 -2.906408625e-08 -3.236030111e-08 -3.236030111e-08 -3.236030111e-08 0 0 -0.01229703799 0.02518104948 0} {curve(which) 0 0 0.004060741514 -0.07290724665 0.1191947311 0.0280726999 0.0449459292 0.04511339962 0.04706057906 -0.06703422964 -0.0003228379355 -0.0002844714036 0.08768811822 0.02554347552 0.01782695204 0.01650637016 -0.3473432064 -0.3148325086 -0.2364816219 0.004600019194 -0.02765839547 -0.004612449091 -0.08316776901 0.0280726999 -0.5518454909 -0.4897170365 -0.171635136 -0.4278847873 0.07809129357 -0.08659287542 0.07068887353 0.05121183768 1.2621717e-08 1.2621717e-08 1.2621717e-08 -1.262213711e-08 0.04317118227 0.01672476344 0.1411857158 0.01001892332} {curve(which) 1 1.008825183 1.010339141 1.265746474 0.950532198 1.060985088 0.9638792276 1.043944359 0.9073553085 1.153293729 1.063571215 1.057001948 0.9388025999 1.089437366 1.01197505 1.011739731 1.51608181 1.325875998 1.335215807 1.094135642 1.148782015 1.102980375 1.190483928 1.060985088 1.745692492 1.590125084 1.409072995 1.65968585 1.118175387 1.205062628 0.9913375378 0.7738927603 0.8251045942 0.8251045942 0.8251045942 0.8248898983 0.8782252669 0.9955722094 0.9226909876 0.8150856495}}
     }
   invert {{parent.invert}}
   name ColorMatrix
   label "RGB to XYZ"
   xpos -40
   ypos 32
   addUserKnob {20 Gamut}
   addUserKnob {3 which}
   which {{parent.gamut}}
   addUserKnob {12 rxy}
   rxy {{curve(which) 1 0.7347 0.713 0.8 0.64 0.708 0.68 0.68 0.68 0.684 0.7530442228 0.7530444911 0.6997470013 0.8786825105 0.7011810359 0.7011805919 0.780308 0.69848046 0.74 0.73 0.766 0.73 0.71 0.708 0.9173 0.7422 1.0625 0.9175 0.8608 0.7177 0.64 0.7347 0.7347 0.7347 0.7347 0.734699 0.69 0.6898 0.625 0.7351916376} {curve(which) 0 0.2653 0.293 0.3177 0.33 0.292 0.32 0.32 0.32 0.313 0.3278305767 0.3278310295 0.3290469303 0.3249640074 0.3290141556 0.3290136991 0.304253 0.19302645 0.27 0.28 0.275 0.28 0.31 0.292 0.2502 0.2859 0.3948 0.2983 0.3689 0.3171 0.33 0.2653 0.2653 0.2653 0.2653 0.265301 0.31 0.3206 0.34 0.2648083624}}
   addUserKnob {12 gxy}
   gxy {{curve(which) 0 0 0.165 0.18 0.3 0.17 0.265 0.265 0.265 0.221 0.2995702285 0.2995704905 0.304264039 0.3008887144 0.3006003047 0.3006003955 0.121595 0.32955538 0.17 0.14 0.225 0.165 0.21 0.17 0.2833 0.414 0.3689 0.2983 0.3282 0.228 0.21 0.1152 0.1596 0.1596 0.1596 0.159597 0.18 0.0736 0.28 0.2153361345} {curve(which) 1 1 0.83 0.9 0.6 0.797 0.69 0.69 0.69 0.848 0.700699322 0.7006994156 0.6236411451 0.6790547558 0.6837888343 0.6837888243 1.493994 1.02459662 1.14 0.855 0.8 0.84 0.88 0.797 1.7072 1.3035 0.7775 1.2835 0.6156 0.8616 0.71 0.8264 0.8404 0.8404 0.8404 0.840403 0.77 0.9003 0.595 0.7741596639}}
   addUserKnob {12 bxy}
   bxy {{curve(which) 0 0.0001 0.128 0.065 0.15 0.131 0.15 0.15 0.15 0.0861 0.07964206674 0.1450115843 0.1349139613 0.09539869461 0.1081544556 0.1453319462 0.095612 0.10844263 0.08 0.1 0.089 0.1 0.09 0.131 0.0856 0.0342 0.0956 0.0756 0.0783 0.1006 0.15 0.1566 0.0366 0.0366 0.0366 0.036598 0.1 0.1166 0.155 0.1301229508} {curve(which) 0 -0.077 0.044 -0.0805 0.06 0.046 0.06 0.06 0.06 -0.102 -0.05493795109 0.05109712509 0.03471744128 -0.02937932683 -0.008688175787 0.05161680362 -0.084589 -0.03467857 -0.1 -0.05 -0.087 -0.03 -0.08 0.046 -0.0708 -0.0833 -0.0332 -0.086 -0.0233 -0.082 0.06 0.0177 0.0001 0.0001 0.0001 0.000105 0.02 0.0374 0.07 0.03483606557}}
   addUserKnob {12 wxy}
   wxy {{curve(which) 0.33333333 0.32168 0.32168 0.3127 0.3127 0.3127 0.32168 0.3127 0.314 0.3127 0.3216831877 0.3216832104 0.3216832894 0.3216832894 0.3216832104 0.3216832894 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3135 0.3135 0.3135 0.3127 0.3127 0.3127 0.3127 0.3457 0.3457 0.3457 0.3457 0.345704 0.33243 0.33333333 0.3127 0.3457} {curve(which) 0.33333333 0.33767 0.33767 0.329 0.329 0.329 0.33767 0.329 0.351 0.329 0.337673316 0.3376736101 0.3376734472 0.3376734472 0.3376736101 0.3376734472 0.329 0.329 0.329 0.329 0.329 0.329 0.329 0.329 0.3305 0.3305 0.3305 0.329 0.329 0.329 0.329 0.3585 0.3585 0.3585 0.3585 0.35854 0.34744 0.33333333 0.329 0.3585}}
  }
  Output {
   name Output
   xpos -40
   ypos 86
  }
 end_group
 Colorspace {
  colorspace_in CIE-XYZ
  primary_in "Adobe (1998)"
  colorspace_out CIE-Yxy
  name Colorspace2
  label "\[value colorspace_in] -> \[value colorspace_out]"
  xpos 730
  ypos 296
 }
 Expression {
  expr0 r
  expr1 "4*g / ( -2*g + 12*b + 3)"
  expr2 "9*b / ( -2*g + 12*b + 3)"
  name Expression4
  label "CIE Yxy to CIELuv"
  xpos 730
  ypos 344
  disable {{!parent.diagram}}
 }
 Dot {
  name Dot13
  label " Pos"
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 764
  ypos 546
 }
push $N76e9d000
 Dot {
  name Dot16
  label " Col"
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 654
  ypos 450
 }
 BlinkScript {
  inputs 2
  KernelDescription "2 \"PlotChromaticity\" iterate pixelWise 3e86399c7642fe5c35c23528a644f88a8bf13f967de084ae6842f8be55098c6b 3 \"col\" Read Random \"Yxy\" Read Random \"dst\" Write Random 4 \"padding\" Float 1 AAAAAA== \"left_margin\" Float 1 AAAAAA== \"tolerance\" Float 1 AAAAAA== \"antialias\" Bool 1 AA== 4 \"padding\" 1 1 \"left_margin\" 1 1 \"tolerance\" 1 1 \"antialias\" 1 1 2 \"outsize\" Float 1 1 AAAAAA== \"offset\" Float 1 1 AAAAAA=="
  kernelSource "kernel PlotChromaticity : public ImageComputationKernel<ePixelWise>\n\{\n  Image<eRead, eAccessRandom, eEdgeClamped> col;\n  Image<eRead, eAccessRandom, eEdgeClamped> Yxy;\n  Image<eWrite, eAccessRandom> dst;\n\nparam:\n  float padding;\n  float left_margin;\n  float tolerance;\n  bool antialias;\n\nlocal:\n  float outsize;\n  float offset;\n\n  void init() \{\n    // calculate output width and height and offset based on padding\n    outsize = float(dst.bounds.height()/padding);\n    // xy offset for margin on lower left corner\n    offset = dst.bounds.height()*left_margin;\n  \}\n\n  float gaussian(float d, float a, float expv) \{\n    return max(0.0f, exp(-a*d*d)-expv);\n  \}\n\n  float gaussian_filter(float x, float y, float r) \{\n    // return gaussian weighted distance from origin (0, 0)\n    // given coordinate (x, y) and radius r\n    float a = 1.5f; // rate falloff\n    float expv = exp(-a*r*r);\n    return gaussian(x, a, expv) * gaussian(y, a, expv);\n  \}\n\n  void write_aa(float x, float y, float4 rgb) \{\n    // skip black pixels\n    if (rgb.x == 0.0f && rgb.y == 0.0f && rgb.z == 0.0f) return;\n    \n    // size of pixel neighborhood = n*2+1 by n*2+1\n    int n = 2;\n\n    // center of neighborhood\n    int u0 = round(x);\n    int v0 = round(y);\n\n    // skip if center pixel weight is greater than tolerance\n    if ( dst.bounds.inside(u0, v0)) \{\n      if (dst(u0, v0, 3) >= tolerance) return;\n    \}\n\n    // loop over neighborhood\n    for (int j = -n; j <= n; j++) \{\n      int v = v0 + j;\n      for (int i = -n; i <= n; i++) \{\n        int u = u0 + i;\n        if ( dst.bounds.inside(u, v)) \{\n          // get filter weight for coord (u,v)\n          float w = gaussian_filter(u-x, v-y, float(n));\n          float4 c0 = dst(u, v); // existing color\n\n          // merge current color sample over existing color sample\n          for (int k=0; k<3; k++) \{\n            dst(u, v, k) = rgb\[k]*w+c0\[k]*(1-w); \n          \}\n\n          // merge current weight over existing weight\n          float w0 = dst(u, v, 3);\n          dst(u, v, 3) = w+w0*(1-w);\n        \}\n      \}\n    \}\n  \}\n\n\n  void process(int2 pos) \{\n    float4 rgba = col(pos.x, pos.y);\n    \n    // Get CIE xy position from Yxy input for current pixel\n    float2 xy = float2(Yxy(pos.x, pos.y, 1), Yxy(pos.x, pos.y, 2));\n    \n    // Find output pixel coordinate for this CIE xy pixel value\n    float2 out_coord = float2(xy.x * outsize + offset, xy.y * outsize + offset);\n\n    // For each RGB component, write value from color input to output coordinate\n    if (antialias) \{\n      write_aa(out_coord.x, out_coord.y, rgba);\n    \} else \{\n      // For each RGB component, write value from color input to output coordinate\n      int2 p = int2(round(out_coord.x), round(out_coord.y));\n      if (dst.bounds.inside(p.x, p.y)) \{\n        for (int k=0; k<3; k++) \{\n          dst(p.x, p.y, k) = col(pos.x, pos.y, k);\n        \}\n        dst(p.x, p.y, 3) = 1.0f;\n      \}\n    \}\n  \}\n\};"
  useGPUIfAvailable {{parent.use_gpu}}
  rebuild ""
  PlotChromaticity_padding {{"parent.diagram ? parent.right_margin*0.8 : parent.right_margin"}}
  PlotChromaticity_left_margin {{parent.left_margin}}
  PlotChromaticity_tolerance 2
  PlotChromaticity_antialias true
  format "2048 2048 0 0 2048 2048 1 square_2K"
  rebuild_finalise ""
  name PlotChromaticities
  xpos 620
  ypos 536
  disable {{!parent.plot_input}}
 }
 Fill {
  color 0
  name BLACK
  tile_color 0x111111ff
  xpos 620
  ypos 591
  disable {{parent.plot_input}}
 }
 Merge2 {
  inputs 2
  bbox B
  name Merge7
  xpos 620
  ypos 686
  disable {{!parent.enable_sample_color}}
 }
 Merge2 {
  inputs 2
  name Merge1
  xpos 620
  ypos 758
 }
 Output {
  name Output
  xpos 620
  ypos 1046
 }
end_group
Write {
 file /Users/afry/GitHub/nukeZCAM/images/comparisons/ZCAMishDRTv03_709andAP1Arcs_v001.jpg
 file_type jpeg
 checkHashOnRead false
 version 3
 name Write10
 xpos 2797
 ypos 2175
}
push $N76c84f00
Group {
 name AF_WindsorExpBlur2
 tile_color 0x10e9efff
 xpos 2938
 ypos 2114
 addUserKnob {20 User}
 addUserKnob {41 channels T Dissolve2.channels}
 addUserKnob {4 iterations M {1 2 3 4 5 6 7 8 9 10}}
 iterations 10
 addUserKnob {7 size l Size R 0 5}
 size 1.82
 addUserKnob {41 which T Dissolve2.which}
 addUserKnob {26 version l "" +STARTLINE T v001}
}
 Input {
  inputs 0
  name Input1
  xpos 784
  ypos 334
 }
 NoOp {
  name NoOp2
  xpos 784
  ypos 374
  addUserKnob {20 User}
  addUserKnob {7 size R 0 10}
  size {{parent.size}}
 }
set N76ca8800 [stack 0]
 Blur {
  size {{pow(input.size,stepval)}}
  name Blur22
  xpos 1843
  ypos 480
  addUserKnob {20 User}
  addUserKnob {3 stepval l step}
  stepval 10
 }
 Multiply {
  value 0
  name Multiply9
  xpos 1843
  ypos 518
  disable {{parent.iterations<(input.stepval-1)?0:1}}
 }
push $N76ca8800
 Blur {
  size {{pow(input.size,stepval)}}
  name Blur21
  xpos 1708
  ypos 483
  addUserKnob {20 User}
  addUserKnob {3 stepval l step}
  stepval 9
 }
 Multiply {
  value 0
  name Multiply8
  xpos 1708
  ypos 521
  disable {{parent.iterations<(input.stepval-1)?0:1}}
 }
push $N76ca8800
 Blur {
  size {{pow(input.size,stepval)}}
  name Blur20
  xpos 1593
  ypos 481
  addUserKnob {20 User}
  addUserKnob {3 stepval l step}
  stepval 8
 }
 Multiply {
  value 0
  name Multiply7
  xpos 1593
  ypos 519
  disable {{parent.iterations<(input.stepval-1)?0:1}}
 }
push $N76ca8800
 Blur {
  size {{pow(input.size,stepval)}}
  name Blur19
  xpos 1491
  ypos 481
  addUserKnob {20 User}
  addUserKnob {3 stepval l step}
  stepval 7
 }
 Multiply {
  value 0
  name Multiply6
  xpos 1491
  ypos 519
  disable {{parent.iterations<(input.stepval-1)?0:1}}
 }
push $N76ca8800
 Blur {
  size {{pow(input.size,stepval)}}
  name Blur4
  xpos 1378
  ypos 483
  addUserKnob {20 User}
  addUserKnob {3 stepval l step}
  stepval 6
 }
 Multiply {
  value 0
  name Multiply5
  xpos 1378
  ypos 521
  disable {{parent.iterations<(input.stepval-1)?0:1}}
 }
push $N76ca8800
 Blur {
  size {{pow(input.size,stepval)}}
  name Blur5
  xpos 1268
  ypos 481
  addUserKnob {20 User}
  addUserKnob {3 stepval l step}
  stepval 5
 }
 Multiply {
  value 0
  name Multiply4
  xpos 1268
  ypos 519
  disable {{parent.iterations<(input.stepval-1)?0:1}}
 }
push $N76ca8800
 Blur {
  size {{pow(input.size,stepval)}}
  name Blur15
  xpos 1161
  ypos 487
  addUserKnob {20 User}
  addUserKnob {3 stepval l step}
  stepval 4
 }
 Multiply {
  value 0
  name Multiply3
  xpos 1161
  ypos 525
  disable {{parent.iterations<(input.stepval-1)?0:1}}
 }
push $N76ca8800
 Blur {
  size {{pow(input.size,stepval)}}
  name Blur16
  xpos 1062
  ypos 485
  addUserKnob {20 User}
  addUserKnob {3 stepval l step}
  stepval 3
 }
 Multiply {
  value 0
  name Multiply2
  xpos 1062
  ypos 523
  disable {{parent.iterations<(input.stepval-1)?0:1}}
 }
push 0
push $N76ca8800
 Blur {
  size {{pow(input.size,stepval)}}
  name Blur17
  xpos 877
  ypos 487
  addUserKnob {20 User}
  addUserKnob {3 stepval l step}
  stepval 1
 }
push $N76ca8800
 Blur {
  size {{pow(input.size,stepval)}}
  name Blur18
  xpos 970
  ypos 488
  addUserKnob {20 User}
  addUserKnob {3 stepval l step}
  stepval 2
 }
 Multiply {
  value 0
  name Multiply1
  xpos 970
  ypos 526
  disable {{parent.iterations<(input.stepval-1)?0:1}}
 }
 Merge2 {
  inputs 10+1
  operation plus
  name Plus10
  xpos 877
  ypos 608
 }
 Multiply {
  value {{1/(parent.iterations+1)}}
  name Multiply14
  xpos 877
  ypos 634
 }
 Crop {
  box {0 0 {input.width} {input.height}}
  name Crop1
  xpos 877
  ypos 672
 }
push $N76ca8800
 Dissolve {
  inputs 2
  channels rgb
  which 0.16
  name Dissolve2
  xpos 792
  ypos 775
 }
 Output {
  name Output1
  xpos 792
  ypos 875
 }
end_group
push $N8990e400
Group {
 name PlotChromaticity
 xpos 2327
 ypos 2134
 addUserKnob {20 PlotChromaticity_tab l PlotChromaticity}
 addUserKnob {6 use_gpu l "Use GPU if available" +STARTLINE}
 use_gpu true
 addUserKnob {26 ""}
 addUserKnob {6 plot_input l "plot input" t "Enable plotting of the input pixels" +STARTLINE}
 plot_input true
 addUserKnob {41 input_gamut l gamut t "Set the gamut that the input colors are encoded in" -STARTLINE T GamutToXYZ.gamut}
 addUserKnob {4 diagram l in t "Choose the type of chromaticity diagram: \nCIE 1931 xy Chromaticity Diagram\nCIE 1976 u' v' Uniform Chromaticity Scale Diagram" -STARTLINE M {"CIE 1931 xy" "CIE 1976 u' v'" "" ""}}
 addUserKnob {6 enable_sample_color l "sample color" t "Enable plotting of the sampled color" +STARTLINE}
 enable_sample_color true
 addUserKnob {41 sample_color l color t "sample and plot selected color" T SampleColor.color}
 addUserKnob {22 follow_viewer l "follow viewer" t "Follow the selected viewer node. This causes this node to automatically connect to whatever the followed viewer is connected to.\n\nThis is useful if you want to have a 2nd viewer showing a chromaticity plot for whever you're looking at in your main viewer." T "n = nuke.thisNode()\nnuke.root().begin()\nv = nuke.selectedNode()\nif not v or v.Class() != 'Viewer':\n    nuke.message('Please select a viewer node to follow.')\nelse:\n    v\['knobChanged'].setValue('v = nuke.activeViewer().node()\\nif v and v.name() == nuke.thisNode().name():\\n    con = v.input(nuke.activeViewer().activeInput())\\n    plt = nuke.toNode(\"\{0\}\")\\n    plt.setInput(0, con)'.format(n.name()))" +STARTLINE}
 addUserKnob {22 unfollow_viewer l "unfollow viewer" -STARTLINE T "n = nuke.thisNode()\nnuke.root().begin()\nv = nuke.selectedNode()\nif not v or v.Class() != 'Viewer':\n    nuke.message('Please select a viewer node to unfollow.')\nelse:\n    v\['knobChanged'].setValue('')"}
 addUserKnob {26 plot_dimensions_label l " " T "<b>Chromaticity Diagram"}
 addUserKnob {3 resolution l " resolution" t "resolution to output"}
 resolution 2048
 addUserKnob {7 right_margin l "right margin" R 1 1.5}
 right_margin 1.1
 addUserKnob {7 left_margin l "left margin" R 0 0.2}
 left_margin 0.1
 addUserKnob {6 draw_spectral_locus l "spectrum locus" t "draw the spectrum locus: the boundary of color the human eye can see." +STARTLINE}
 draw_spectral_locus true
 addUserKnob {6 draw_line_of_purples l "line of purples" t "draw the \"line of purples\"" -STARTLINE}
 draw_line_of_purples true
 addUserKnob {6 draw_planckian_locus l "planckian locus" t "Display the planckian locus or the blackbody locus." +STARTLINE}
 addUserKnob {6 gamut_grid l "gamut grid" t "Display a gamut boundary with a grid or dot pattern" +STARTLINE}
 addUserKnob {41 gamut_gamutgrid l "" t "gamut for gamutgrid" -STARTLINE T RGBToXYZ_GamutGrid.gamut}
 addUserKnob {4 gamut_grid_style l style t "Choose the style to display the gamut plot" -STARTLINE M {grid dots "" "" "" ""}}
 addUserKnob {4 distribution l dist t "Which chromaticity space should the overlays be constructed in? \n\nYxy is familiar, but not very perceptually uniform.\n\nu'v' is designed to be more perceptually uniform." -STARTLINE M {"1931 Yxy" "1976 u'v'" "" ""}}
 addUserKnob {7 density t "Density of the grid or points" R 10 100}
 density 50
 addUserKnob {6 gamut_a l "gamut a" t "Display a gamut outline" +STARTLINE}
 gamut_a true
 addUserKnob {41 gamut_a_1 l "" -STARTLINE T RGBToXYZ_GamutA.gamut}
 addUserKnob {6 gamut_b l "gamut b" t "Display a gamut outline" +STARTLINE}
 addUserKnob {41 gamut_b_1 l "" -STARTLINE T RGBToXYZ_GamutB.gamut}
 addUserKnob {6 gamut_c l "gamut c" t "Display a gamut outline" +STARTLINE}
 gamut_c true
 addUserKnob {41 gamut_c_1 l "" -STARTLINE T RGBToXYZ_GamutC.gamut}
 addUserKnob {6 draw_pointers_gamut l "pointer's gamut" t "DrawPointer's gamut boundary" +STARTLINE}
 addUserKnob {6 draw_pointers_samples l "pointers sample colors" t "show the individual pointer gamut samples" -STARTLINE}
 addUserKnob {6 draw_macbeth_chart l "macbeth chart" t "draw a ColorChecker24 aka Macbeth Chart" +STARTLINE}
 addUserKnob {6 coordinate_system l "coordinate system" t "Draw CIE xy coordinate grid x and y axes" +STARTLINE}
 coordinate_system true
 addUserKnob {6 map_overlays_to_input_gamut l "map overlays to input gamut" t "This maps the overlays like the spectral locus, pointer's gamut, and the gamut overlay to the working gamut instead of keeping them as XYZ.\n\nFor example if the input gamut is ACEScg, these overlays will be mapped to that. Note that this can cause most of the overlays to be negative or highly saturated which might harm the visual appearance." +STARTLINE}
 map_overlays_to_input_gamut true
}
 Group {
  inputs 0
  name GamutGrid1
  xpos -920
  ypos -201
  postage_stamp true
  addUserKnob {20 GamutGrid}
  addUserKnob {3 style}
  style {{!parent.gamut_grid_style}}
  addUserKnob {3 distribution -STARTLINE}
  distribution {{parent.distribution}}
  addUserKnob {7 density R 10 150}
  density {{parent.density}}
  addUserKnob {26 ""}
  addUserKnob {41 matrix T ColorMatrix.matrix}
  addUserKnob {12 wxy}
  wxy {{parent.RGBToXYZ_GamutGrid.wxy} {parent.RGBToXYZ_GamutGrid.wxy}}
 }
  ColorWheel {
   inputs 0
   format "512 512 0 0 512 512 1 square_512"
   centerSaturation 1
   fillFormat false
   area {-170 -158 682 670}
   name ColorWheel4
   xpos -260
   ypos -15
   postage_stamp false
  }
  Crop {
   box {0 0 {width} {height}}
   crop false
   name Crop2
   xpos -260
   ypos 27
  }
  Reformat {
   type scale
   scale {{max(parent.density/50,0.25)}}
   resize distort
   filter impulse
   pbb true
   name Reformat3
   xpos -260
   ypos 110
  }
set N997a5400 [stack 0]
push $N997a5400
  ContactSheet {
   inputs 2
   width {{width*columns}}
   height {{height/pixel_aspect*rows}}
   rows 1
   columns 2
   roworder TopBottom
   name ContactSheet2
   xpos -260
   ypos 169
  }
  Dot {
   name Dot1
   label " "
   note_font "Helvetica Bold"
   note_font_size 24
   note_font_color 0xa5a5a501
   xpos -226
   ypos 246
  }
  ColorWheel {
   inputs 0
   format "512 512 0 0 512 512 1 square_512"
   fillFormat false
   area {40 40 472 472}
   name ColorWheel1
   xpos -40
   ypos -664
   postage_stamp false
  }
  Reformat {
   type scale
   scale {{max(parent.density/50,0.25)}}
   resize distort
   filter impulse
   pbb true
   name Reformat1
   xpos -40
   ypos -628
  }
  Crop {
   box {0 0 {width} {height}}
   reformat true
   name Crop1
   xpos -40
   ypos -602
  }
  Unpremult {
   name Unpremult1
   xpos -40
   ypos -526
  }
  ColorMatrix {
   matrix {
       {{parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix}}
       {{parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix}}
       {{parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix}}
     }
   name ColorMatrix
   label "RGB to XYZ"
   xpos -40
   ypos -415
  }
  Colorspace {
   colorspace_in CIE-XYZ
   colorspace_out CIE-Yxy
   name Colorspace1
   label "\[value colorspace_in] -> \[value colorspace_out]"
   xpos -40
   ypos -341
  }
set N92dee800 [stack 0]
  Dot {
   name Dot2
   label " "
   note_font "Helvetica Bold"
   note_font_size 24
   note_font_color 0xa5a5a501
   xpos -556
   ypos -331
  }
  Expression {
   expr0 r
   expr1 "4*g / ( -2*g + 12*b + 3)"
   expr2 "9*b / ( -2*g + 12*b + 3)"
   name Expression5
   label "CIE Yxy to CIELuv"
   xpos -590
   ypos -304
   disable {{!parent.distribution}}
  }
  Expression {
   expr0 r
   expr1 "(-(degrees(atan2(g-white.x, b-white.y))-180)+270)%360/360"
   expr2 "hypot(g-white.x, b-white.y)"
   expr3 a
   name Expression3
   xpos -590
   ypos -261
   cached true
   addUserKnob {20 User}
   addUserKnob {12 white}
   white {{"parent.distribution ? 4*parent.wxy.x / ( -2 * parent.wxy.x + 12 * parent.wxy.y + 3) : parent.wxy"} {"parent.distribution ? 9*parent.wxy.y / ( -2*parent.wxy.x + 12*parent.wxy.y + 3) : parent.wxy"}}
  }
set N92dedc00 [stack 0]
  Posterize {
   channels rgb
   Colors {{rint(parent.density/3*2)}}
   name Posterize1
   xpos -590
   ypos -191
  }
set N92ded800 [stack 0]
push $N92dedc00
  Dot {
   name Dot15
   xpos -446
   ypos -257
  }
  Copy {
   inputs 2
   from0 rgba.blue
   to0 rgba.blue
   name Copy1
   xpos -480
   ypos -154
  }
push $N92ded800
push $N92dedc00
  Dot {
   name Dot16
   xpos -666
   ypos -257
  }
  Copy {
   inputs 2
   from0 rgba.green
   to0 rgba.green
   name Copy2
   xpos -700
   ypos -153
  }
  ContactSheet {
   inputs 2
   width {{width*columns}}
   height {{height/pixel_aspect*rows}}
   rows 1
   columns 2
   center true
   roworder TopBottom
   name ContactSheet3
   xpos -590
   ypos -106
  }
  Expression {
   expr0 r
   expr1 cos(radians(g*360))*b+white.x
   expr2 sin(radians(g*360))*b+white.y
   expr3 a
   name Expression19
   xpos -590
   ypos -58
   cached true
   addUserKnob {20 User}
   addUserKnob {12 white}
   white {{parent.Expression3.white} {parent.Expression3.white}}
  }
  Expression {
   expr0 r
   expr1 "9*g / ( 6*g - 16*b + 12)"
   expr2 "4*b/ ( 6*g - 16*b + 12)"
   name Expression2
   label "CIELuv to CIE Yxy"
   xpos -590
   ypos -16
   disable {{!parent.distribution}}
  }
  Colorspace {
   colorspace_in CIE-Yxy
   colorspace_out CIE-XYZ
   name Colorspace2
   label "\[value colorspace_in] -> \[value colorspace_out]"
   xpos -590
   ypos 32
  }
  ColorMatrix {
   matrix {
       {{parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix}}
       {{parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix}}
       {{parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix}}
     }
   invert true
   name ColorMatrix1
   label "XYZ to RGB"
   xpos -590
   ypos 81
  }
  Clamp {
   channels rgba
   maximum_enable false
   name ClampMin2
   xpos -590
   ypos 119
  }
  Clamp {
   channels alpha
   minimum 1
   MinClampTo_enable true
   MaxClampTo_enable true
   name Clamp1
   xpos -590
   ypos 152
  }
  Premult {
   name Premult1
   xpos -590
   ypos 194
  }
  Merge2 {
   inputs 2
   operation under
   bbox B
   name Merge2
   xpos -590
   ypos 242
  }
  Fill {
   output alpha
   name Fill1
   xpos -590
   ypos 297
  }
  Dot {
   name Dot3
   label " GRID"
   note_font "Helvetica Bold"
   note_font_size 24
   note_font_color 0xa5a5a501
   xpos -556
   ypos 378
  }
push $N997a5400
push $N92dee800
  Expression {
   expr0 r
   expr1 "4*g / ( -2*g + 12*b + 3)"
   expr2 "9*b / ( -2*g + 12*b + 3)"
   name Expression4
   label "CIE Yxy to CIELuv"
   xpos -40
   ypos -280
   disable {{!parent.distribution}}
  }
  Expression {
   expr0 r
   expr1 rint(g*Colors)/Colors
   expr2 rint(b*Colors)/Colors
   expr3 a
   name Expression1
   label rint
   xpos -40
   ypos -232
   addUserKnob {20 User}
   addUserKnob {7 Colors R 1 256}
   Colors {{parent.density}}
  }
  Expression {
   expr0 r
   expr1 "9*g / ( 6*g - 16*b + 12)"
   expr2 "4*b/ ( 6*g - 16*b + 12)"
   name Expression6
   label "CIELuv to CIE Yxy"
   xpos -40
   ypos -184
   disable {{!parent.distribution}}
  }
  Colorspace {
   colorspace_in CIE-Yxy
   colorspace_out CIE-XYZ
   name Colorspace3
   label "\[value colorspace_in] -> \[value colorspace_out]"
   xpos -40
   ypos -112
  }
  ColorMatrix {
   matrix {
       {{parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix}}
       {{parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix}}
       {{parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix}}
     }
   invert true
   name ColorMatrix3
   label "XYZ to RGB"
   xpos -40
   ypos -57
  }
  Clamp {
   channels alpha
   minimum 1
   MinClampTo_enable true
   MaxClampTo_enable true
   name Clamp4
   xpos -40
  }
  Premult {
   name Premult2
   xpos -40
   ypos 55
  }
  Merge2 {
   inputs 2
   operation under
   bbox B
   name Merge1
   xpos -40
   ypos 110
  }
  Clamp {
   channels rgba
   maximum_enable false
   name ClampMin1
   xpos -40
   ypos 273
  }
  Dot {
   name Dot4
   label " DOTS"
   note_font "Helvetica Bold"
   note_font_size 24
   note_font_color 0xa5a5a501
   xpos -6
   ypos 378
  }
  Switch {
   inputs 2
   which {{parent.style}}
   name Switch1
   xpos -257
   ypos 483
  }
  ColorMatrix {
   matrix {
       {{parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix}}
       {{parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix}}
       {{parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix} {parent.parent.RGBToXYZ_GamutGrid.ColorMatrix.matrix}}
     }
   name ColorMatrix2
   label "RGB to XYZ"
   xpos -257
   ypos 560
  }
  Output {
   name Output
   xpos -257
   ypos 740
  }
  ColorWheel {
   inputs 0
   format "256 256 0 0 256 256 1 square_256"
   area {40 40 472 472}
   name ColorWheel2
   xpos -37
   ypos -705
   postage_stamp false
  }
 end_group
set N92e1f200 [stack 0]
 Group {
  name RGBToXYZ_GamutGrid
  label "\[if \{\[value invert]\} \{return \"XYZ to \[value gamut]\"\} else \{return \"\[value gamut] to XYZ\"\}]\n\n"
  xpos -1030
  ypos -184
  addUserKnob {20 GamutToXYZ_tab l GamutToXYZ}
  addUserKnob {4 gamut t "Choose gamut" M {XYZ ACES ACEScg "Filmlight E-Gamut" Rec709 Rec2020 P3D60 P3D65 P3DCI "Arri AlexaWideGamut" REDDRAGONcolor REDDRAGONcolor2 REDcolor REDcolor2 REDcolor3 REDcolor4 REDWideGamutRGB "GoPro Protune Native" CanonCinemaGamut SonySGamut SonySGamut3Cine PanasonicVGamut "DJI D-Gamut" "Fujifilm F-Gamut" BMDFilmV1 BMD4kFilmV1 BMD4kFilmV3 BMD46kFilmV1 BMD46kFilmV3 BMDWideGamutV4 "AdobeRGB\t" AdobeWideGamutRGB ROMM RIMM ERIMM ProPhotoRGB RusselRGB SharpRGB AppleRGB BestRGB}}
  gamut ACEScg
  addUserKnob {6 invert +STARTLINE}
  addUserKnob {26 ""}
  addUserKnob {26 chromaticity_coordinates_label l " " T "<b>Chromaticity Coordinates</b>"}
  addUserKnob {41 rxy T ColorMatrix.rxy}
  addUserKnob {41 gxy T ColorMatrix.gxy}
  addUserKnob {41 bxy T ColorMatrix.bxy}
  addUserKnob {41 wxy T ColorMatrix.wxy}
  addUserKnob {41 matrix T ColorMatrix.matrix}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -10
  }
  ColorMatrix {
   matrix {
       {{curve(which) 1 0.9525524378 0.6624541879 0.7053968906 0.4123907983 0.6369580626 0.5049495697 0.4865709841 0.4451698363 0.6380076408 0.5070186853 0.4462202489 0.4300414324 0.4581649601 0.4878340662 0.4517004192 0.7352752686 0.5022571683 0.7160496712 0.7064827085 0.5990839601 0.6796444654 0.6481720209 0.6369580626 0.6390493512 0.6141571999 0.3724023998 0.60689044 0.4017650783 0.6065810919 0.5766690373 0.7165006995 0.797760427 0.797760427 0.797760427 0.7976718545 0.7015837431 0.8156226277 0.4496616423 0.6318944097} {curve(which) 0 0 0.1340042055 0.1640413404 0.3575843275 0.1446169019 0.2646814585 0.2656676769 0.2771343887 0.2147038579 0.3587769568 0.3157556653 0.3700728714 0.3832037449 0.3432727158 0.3178463876 0.06860940903 0.2929667532 0.1296834797 0.1288010478 0.2489254922 0.1522114277 0.1940581352 0.1446169019 0.1578372866 0.2825684249 0.4324877858 0.2193847299 0.4560420811 0.2203479856 0.1855582297 0.1010205746 0.1351858526 0.1351858526 0.1351858526 0.1351878047 0.1554162204 0.04716260359 0.3162561059 0.2053879201} {curve(which) 0 9.367863095e-05 0.1561876982 0.08101774752 0.180480808 0.1688809693 0.1830150485 0.1982172877 0.1722826511 0.09774444997 0.0868505761 0.190669477 0.152531758 0.1112773567 0.1215386018 0.1830992699 0.1465712637 0.1552320272 0.1047228053 0.1151721701 0.1024464965 0.1186000481 0.108225815 0.1688809693 0.1516760886 0.05183707923 0.1436725408 0.124180764 0.09264881909 0.123526901 0.1882286519 0.1467743814 0.03134934977 0.03134934977 0.03134934977 0.03133957833 0.09979832917 0.1372147948 0.1845382005 0.1270133406}}
       {{curve(which) 0 0.3439664543 0.2722287476 0.2801307142 0.2126390189 0.2627002299 0.237623319 0.2289745659 0.209491685 0.2919537723 0.2207257152 0.1942579001 0.2022213936 0.1694435924 0.2289056629 0.2119505703 0.2866941094 0.1387997568 0.2612613738 0.2709796727 0.2150758505 0.2606855333 0.2830046713 0.2627002299 0.1743051857 0.2365771234 0.1383759677 0.1973138005 0.1721783578 0.2680045366 0.2973450124 0.258728236 0.2880711257 0.2880711257 0.2880711257 0.2880405784 0.3152042925 0.3790788651 0.2446159422 0.2276017666} {curve(which) 1 0.7281661034 0.6740817428 0.8202066422 0.7151686549 0.6779980659 0.6891706586 0.6917385459 0.7215952873 0.8238410354 0.839184761 0.7385566831 0.7585275769 0.8648257852 0.7808576822 0.7230190039 0.8429791331 0.910841465 0.8696421385 0.786606431 0.8850684762 0.7748944759 0.8131960034 0.6779980659 0.951146543 0.8896810412 0.911518693 0.943950057 0.8553914428 0.8326833844 0.6273635626 0.7246823311 0.7118432522 0.7118432522 0.7118432522 0.7118694782 0.6648360491 0.5769088268 0.6720442176 0.7383946776} {curve(which) 0 -0.07213255018 0.05368951708 -0.1003373638 0.07219231874 0.05930171534 0.07320601493 0.07928691059 0.06891305745 -0.1157948226 -0.05991046131 0.06718540192 0.03925102949 -0.03426937759 -0.009763340466 0.06503042579 -0.1296732277 -0.04964122549 -0.1309035122 -0.05758608505 -0.1001443192 -0.03558001295 -0.09620071948 0.05930171534 -0.1254517138 -0.1262581497 -0.04989464581 -0.1412638426 -0.02756982669 -0.1006879359 0.07529145479 0.01658944227 8.565396274e-05 8.565396274e-05 8.565396274e-05 8.991353388e-05 0.01995966583 0.04401229322 0.08333983272 0.0340035744}}
       {{curve(which) 0 -3.863927134e-08 -0.005574660841 -0.1037815213 0.01933082007 0 0 0 0 0.0027982709 -0.0544523783 -0.04792318866 -0.0176958181 -0.1061859056 -0.02100777067 -0.01945115253 -0.07968087494 0.07801423222 -0.009676366113 -0.009677864611 -0.03206583485 -0.009310216643 -0.01825834997 0 -0.11669112 -0.02325225808 -0.1602820009 -0.1427432895 -0.10720893 -0.02941203304 0.02703136392 -2.906408625e-08 -3.236030111e-08 -3.236030111e-08 -3.236030111e-08 0 0 -0.01229703799 0.02518104948 0} {curve(which) 0 0 0.004060741514 -0.07290724665 0.1191947311 0.0280726999 0.0449459292 0.04511339962 0.04706057906 -0.06703422964 -0.0003228379355 -0.0002844714036 0.08768811822 0.02554347552 0.01782695204 0.01650637016 -0.3473432064 -0.3148325086 -0.2364816219 0.004600019194 -0.02765839547 -0.004612449091 -0.08316776901 0.0280726999 -0.5518454909 -0.4897170365 -0.171635136 -0.4278847873 0.07809129357 -0.08659287542 0.07068887353 0.05121183768 1.2621717e-08 1.2621717e-08 1.2621717e-08 -1.262213711e-08 0.04317118227 0.01672476344 0.1411857158 0.01001892332} {curve(which) 1 1.008825183 1.010339141 1.265746474 0.950532198 1.060985088 0.9638792276 1.043944359 0.9073553085 1.153293729 1.063571215 1.057001948 0.9388025999 1.089437366 1.01197505 1.011739731 1.51608181 1.325875998 1.335215807 1.094135642 1.148782015 1.102980375 1.190483928 1.060985088 1.745692492 1.590125084 1.409072995 1.65968585 1.118175387 1.205062628 0.9913375378 0.7738927603 0.8251045942 0.8251045942 0.8251045942 0.8248898983 0.8782252669 0.9955722094 0.9226909876 0.8150856495}}
     }
   invert {{parent.invert}}
   name ColorMatrix
   label "RGB to XYZ"
   xpos -40
   ypos 32
   addUserKnob {20 Gamut}
   addUserKnob {3 which}
   which {{parent.gamut}}
   addUserKnob {12 rxy}
   rxy {{curve(which) 1 0.7347 0.713 0.8 0.64 0.708 0.68 0.68 0.68 0.684 0.7530442228 0.7530444911 0.6997470013 0.8786825105 0.7011810359 0.7011805919 0.780308 0.69848046 0.74 0.73 0.766 0.73 0.71 0.708 0.9173 0.7422 1.0625 0.9175 0.8608 0.7177 0.64 0.7347 0.7347 0.7347 0.7347 0.734699 0.69 0.6898 0.625 0.7351916376} {curve(which) 0 0.2653 0.293 0.3177 0.33 0.292 0.32 0.32 0.32 0.313 0.3278305767 0.3278310295 0.3290469303 0.3249640074 0.3290141556 0.3290136991 0.304253 0.19302645 0.27 0.28 0.275 0.28 0.31 0.292 0.2502 0.2859 0.3948 0.2983 0.3689 0.3171 0.33 0.2653 0.2653 0.2653 0.2653 0.265301 0.31 0.3206 0.34 0.2648083624}}
   addUserKnob {12 gxy}
   gxy {{curve(which) 0 0 0.165 0.18 0.3 0.17 0.265 0.265 0.265 0.221 0.2995702285 0.2995704905 0.304264039 0.3008887144 0.3006003047 0.3006003955 0.121595 0.32955538 0.17 0.14 0.225 0.165 0.21 0.17 0.2833 0.414 0.3689 0.2983 0.3282 0.228 0.21 0.1152 0.1596 0.1596 0.1596 0.159597 0.18 0.0736 0.28 0.2153361345} {curve(which) 1 1 0.83 0.9 0.6 0.797 0.69 0.69 0.69 0.848 0.700699322 0.7006994156 0.6236411451 0.6790547558 0.6837888343 0.6837888243 1.493994 1.02459662 1.14 0.855 0.8 0.84 0.88 0.797 1.7072 1.3035 0.7775 1.2835 0.6156 0.8616 0.71 0.8264 0.8404 0.8404 0.8404 0.840403 0.77 0.9003 0.595 0.7741596639}}
   addUserKnob {12 bxy}
   bxy {{curve(which) 0 0.0001 0.128 0.065 0.15 0.131 0.15 0.15 0.15 0.0861 0.07964206674 0.1450115843 0.1349139613 0.09539869461 0.1081544556 0.1453319462 0.095612 0.10844263 0.08 0.1 0.089 0.1 0.09 0.131 0.0856 0.0342 0.0956 0.0756 0.0783 0.1006 0.15 0.1566 0.0366 0.0366 0.0366 0.036598 0.1 0.1166 0.155 0.1301229508} {curve(which) 0 -0.077 0.044 -0.0805 0.06 0.046 0.06 0.06 0.06 -0.102 -0.05493795109 0.05109712509 0.03471744128 -0.02937932683 -0.008688175787 0.05161680362 -0.084589 -0.03467857 -0.1 -0.05 -0.087 -0.03 -0.08 0.046 -0.0708 -0.0833 -0.0332 -0.086 -0.0233 -0.082 0.06 0.0177 0.0001 0.0001 0.0001 0.000105 0.02 0.0374 0.07 0.03483606557}}
   addUserKnob {12 wxy}
   wxy {{curve(which) 0.33333333 0.32168 0.32168 0.3127 0.3127 0.3127 0.32168 0.3127 0.314 0.3127 0.3216831877 0.3216832104 0.3216832894 0.3216832894 0.3216832104 0.3216832894 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3135 0.3135 0.3135 0.3127 0.3127 0.3127 0.3127 0.3457 0.3457 0.3457 0.3457 0.345704 0.33243 0.33333333 0.3127 0.3457} {curve(which) 0.33333333 0.33767 0.33767 0.329 0.329 0.329 0.33767 0.329 0.351 0.329 0.337673316 0.3376736101 0.3376734472 0.3376734472 0.3376736101 0.3376734472 0.329 0.329 0.329 0.329 0.329 0.329 0.329 0.329 0.3305 0.3305 0.3305 0.329 0.329 0.329 0.329 0.3585 0.3585 0.3585 0.3585 0.35854 0.34744 0.33333333 0.329 0.3585}}
  }
  Output {
   name Output
   xpos -40
   ypos 86
  }
 end_group
 ColorWheel {
  inputs 0
  format "512 512 0 0 512 512 1 square_512"
  centerSaturation 1
  fillFormat false
  area {-196 -184 708 696}
  name ColorWheel1
  xpos -920
  ypos 5
 }
 Crop {
  box {0 0 {width} {height}}
  name Crop1
  xpos -920
  ypos 87
 }
 BlackOutside {
  name BlackOutside3
  xpos -920
  ypos 134
 }
set N92d10800 [stack 0]
 Group {
  name RGBToXYZ_GamutC
  label "\[if \{\[value invert]\} \{return \"XYZ to \[value gamut]\"\} else \{return \"\[value gamut] to XYZ\"\}]\n\n"
  xpos -1140
  ypos 176
  addUserKnob {20 GamutToXYZ_tab l GamutToXYZ}
  addUserKnob {4 gamut t "Choose gamut" M {XYZ ACES ACEScg "Filmlight E-Gamut" "DaVinci WG" Rec709 Rec2020 P3D60 P3D65 P3DCI "Arri AlexaWideGamut" REDDRAGONcolor REDDRAGONcolor2 REDcolor REDcolor2 REDcolor3 REDcolor4 REDWideGamutRGB "GoPro Protune Native" CanonCinemaGamut SonySGamut SonySGamut3Cine PanasonicVGamut "DJI D-Gamut" "Fujifilm F-Gamut" BMDFilmV1 BMD4kFilmV1 BMD4kFilmV3 BMD46kFilmV1 BMD46kFilmV3 BMDWideGamutV4 "AdobeRGB\t" AdobeWideGamutRGB ROMM RIMM ERIMM ProPhotoRGB RusselRGB SharpRGB AppleRGB BestRGB}}
  gamut Rec709
  addUserKnob {6 invert +STARTLINE}
  addUserKnob {26 ""}
  addUserKnob {26 chromaticity_coordinates_label l " " T "<b>Chromaticity Coordinates</b>"}
  addUserKnob {41 rxy T ColorMatrix.rxy}
  addUserKnob {41 gxy T ColorMatrix.gxy}
  addUserKnob {41 bxy T ColorMatrix.bxy}
  addUserKnob {41 wxy T ColorMatrix.wxy}
  addUserKnob {41 matrix T ColorMatrix.matrix}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -10
  }
  ColorMatrix {
   matrix {
       {{curve(which) 1 0.9525524378 0.6624541879 0.7053968906 0.7006223798 0.4123907983 0.6369580626 0.5049495697 0.4865709841 0.4451698363 0.6380076408 0.5070186853 0.4462202489 0.4300414324 0.4581649601 0.4878340662 0.4517004192 0.7352752686 0.5022571683 0.7160496712 0.7064827085 0.5990839601 0.6796444654 0.6481720209 0.6369580626 0.6390493512 0.6141571999 0.3724023998 0.60689044 0.4017650783 0.6065810919 0.5766690373 0.7165006995 0.797760427 0.797760427 0.797760427 0.7976718545 0.7015837431 0.8156226277 0.4496616423 0.6318944097} {curve(which) 0 0 0.1340042055 0.1640413404 0.1487748176 0.3575843275 0.1446169019 0.2646814585 0.2656676769 0.2771343887 0.2147038579 0.3587769568 0.3157556653 0.3700728714 0.3832037449 0.3432727158 0.3178463876 0.06860940903 0.2929667532 0.1296834797 0.1288010478 0.2489254922 0.1522114277 0.1940581352 0.1446169019 0.1578372866 0.2825684249 0.4324877858 0.2193847299 0.4560420811 0.2203479856 0.1855582297 0.1010205746 0.1351858526 0.1351858526 0.1351858526 0.1351878047 0.1554162204 0.04716260359 0.3162561059 0.2053879201} {curve(which) 0 9.367863095e-05 0.1561876982 0.08101774752 0.101058729 0.180480808 0.1688809693 0.1830150485 0.1982172877 0.1722826511 0.09774444997 0.0868505761 0.190669477 0.152531758 0.1112773567 0.1215386018 0.1830992699 0.1465712637 0.1552320272 0.1047228053 0.1151721701 0.1024464965 0.1186000481 0.108225815 0.1688809693 0.1516760886 0.05183707923 0.1436725408 0.124180764 0.09264881909 0.123526901 0.1882286519 0.1467743814 0.03134934977 0.03134934977 0.03134934977 0.03133957833 0.09979832917 0.1372147948 0.1845382005 0.1270133406}}
       {{curve(which) 0 0.3439664543 0.2722287476 0.2801307142 0.2741185129 0.2126390189 0.2627002299 0.237623319 0.2289745659 0.209491685 0.2919537723 0.2207257152 0.1942579001 0.2022213936 0.1694435924 0.2289056629 0.2119505703 0.2866941094 0.1387997568 0.2612613738 0.2709796727 0.2150758505 0.2606855333 0.2830046713 0.2627002299 0.1743051857 0.2365771234 0.1383759677 0.1973138005 0.1721783578 0.2680045366 0.2973450124 0.258728236 0.2880711257 0.2880711257 0.2880711257 0.2880405784 0.3152042925 0.3790788651 0.2446159422 0.2276017666} {curve(which) 1 0.7281661034 0.6740817428 0.8202066422 0.8736318946 0.7151686549 0.6779980659 0.6891706586 0.6917385459 0.7215952873 0.8238410354 0.839184761 0.7385566831 0.7585275769 0.8648257852 0.7808576822 0.7230190039 0.8429791331 0.910841465 0.8696421385 0.786606431 0.8850684762 0.7748944759 0.8131960034 0.6779980659 0.951146543 0.8896810412 0.911518693 0.943950057 0.8553914428 0.8326833844 0.6273635626 0.7246823311 0.7118432522 0.7118432522 0.7118432522 0.7118694782 0.6648360491 0.5769088268 0.6720442176 0.7383946776} {curve(which) 0 -0.07213255018 0.05368951708 -0.1003373638 -0.1477504075 0.07219231874 0.05930171534 0.07320601493 0.07928691059 0.06891305745 -0.1157948226 -0.05991046131 0.06718540192 0.03925102949 -0.03426937759 -0.009763340466 0.06503042579 -0.1296732277 -0.04964122549 -0.1309035122 -0.05758608505 -0.1001443192 -0.03558001295 -0.09620071948 0.05930171534 -0.1254517138 -0.1262581497 -0.04989464581 -0.1412638426 -0.02756982669 -0.1006879359 0.07529145479 0.01658944227 8.565396274e-05 8.565396274e-05 8.565396274e-05 8.991353388e-05 0.01995966583 0.04401229322 0.08333983272 0.0340035744}}
       {{curve(which) 0 -3.863927134e-08 -0.005574660841 -0.1037815213 -0.09896291792 0.01933082007 0 0 0 0 0.0027982709 -0.0544523783 -0.04792318866 -0.0176958181 -0.1061859056 -0.02100777067 -0.01945115253 -0.07968087494 0.07801423222 -0.009676366113 -0.009677864611 -0.03206583485 -0.009310216643 -0.01825834997 0 -0.11669112 -0.02325225808 -0.1602820009 -0.1427432895 -0.10720893 -0.02941203304 0.02703136392 -2.906408625e-08 -3.236030111e-08 -3.236030111e-08 -3.236030111e-08 0 0 -0.01229703799 0.02518104948 0} {curve(which) 0 0 0.004060741514 -0.07290724665 -0.1378953159 0.1191947311 0.0280726999 0.0449459292 0.04511339962 0.04706057906 -0.06703422964 -0.0003228379355 -0.0002844714036 0.08768811822 0.02554347552 0.01782695204 0.01650637016 -0.3473432064 -0.3148325086 -0.2364816219 0.004600019194 -0.02765839547 -0.004612449091 -0.08316776901 0.0280726999 -0.5518454909 -0.4897170365 -0.171635136 -0.4278847873 0.07809129357 -0.08659287542 0.07068887353 0.05121183768 1.2621717e-08 1.2621717e-08 1.2621717e-08 -1.262213711e-08 0.04317118227 0.01672476344 0.1411857158 0.01001892332} {curve(which) 1 1.008825183 1.010339141 1.265746474 1.325916052 0.950532198 1.060985088 0.9638792276 1.043944359 0.9073553085 1.153293729 1.063571215 1.057001948 0.9388025999 1.089437366 1.01197505 1.011739731 1.51608181 1.325875998 1.335215807 1.094135642 1.148782015 1.102980375 1.190483928 1.060985088 1.745692492 1.590125084 1.409072995 1.65968585 1.118175387 1.205062628 0.9913375378 0.7738927603 0.8251045942 0.8251045942 0.8251045942 0.8248898983 0.8782252669 0.9955722094 0.9226909876 0.8150856495}}
     }
   invert {{parent.invert}}
   name ColorMatrix
   label "RGB to XYZ"
   xpos -40
   ypos 32
   addUserKnob {20 Gamut}
   addUserKnob {3 which}
   which {{parent.gamut}}
   addUserKnob {12 rxy}
   rxy {{curve(which) 1 0.7347 0.713 0.8 0.8 0.64 0.708 0.68 0.68 0.68 0.684 0.7530442228 0.7530444911 0.6997470013 0.8786825105 0.7011810359 0.7011805919 0.780308 0.69848046 0.74 0.73 0.766 0.73 0.71 0.708 0.9173 0.7422 1.0625 0.9175 0.8608 0.7177 0.64 0.7347 0.7347 0.7347 0.7347 0.734699 0.69 0.6898 0.625 0.7351916376} {curve(which) 0 0.2653 0.293 0.3177 0.313 0.33 0.292 0.32 0.32 0.32 0.313 0.3278305767 0.3278310295 0.3290469303 0.3249640074 0.3290141556 0.3290136991 0.304253 0.19302645 0.27 0.28 0.275 0.28 0.31 0.292 0.2502 0.2859 0.3948 0.2983 0.3689 0.3171 0.33 0.2653 0.2653 0.2653 0.2653 0.265301 0.31 0.3206 0.34 0.2648083624}}
   addUserKnob {12 gxy}
   gxy {{curve(which) 0 0 0.165 0.18 0.1682 0.3 0.17 0.265 0.265 0.265 0.221 0.2995702285 0.2995704905 0.304264039 0.3008887144 0.3006003047 0.3006003955 0.121595 0.32955538 0.17 0.14 0.225 0.165 0.21 0.17 0.2833 0.414 0.3689 0.2983 0.3282 0.228 0.21 0.1152 0.1596 0.1596 0.1596 0.159597 0.18 0.0736 0.28 0.2153361345} {curve(which) 1 1 0.83 0.9 0.9877 0.6 0.797 0.69 0.69 0.69 0.848 0.700699322 0.7006994156 0.6236411451 0.6790547558 0.6837888343 0.6837888243 1.493994 1.02459662 1.14 0.855 0.8 0.84 0.88 0.797 1.7072 1.3035 0.7775 1.2835 0.6156 0.8616 0.71 0.8264 0.8404 0.8404 0.8404 0.840403 0.77 0.9003 0.595 0.7741596639}}
   addUserKnob {12 bxy}
   bxy {{curve(which) 0 0.0001 0.128 0.065 0.079 0.15 0.131 0.15 0.15 0.15 0.0861 0.07964206674 0.1450115843 0.1349139613 0.09539869461 0.1081544556 0.1453319462 0.095612 0.10844263 0.08 0.1 0.089 0.1 0.09 0.131 0.0856 0.0342 0.0956 0.0756 0.0783 0.1006 0.15 0.1566 0.0366 0.0366 0.0366 0.036598 0.1 0.1166 0.155 0.1301229508} {curve(which) 0 -0.077 0.044 -0.0805 -0.1155 0.06 0.046 0.06 0.06 0.06 -0.102 -0.05493795109 0.05109712509 0.03471744128 -0.02937932683 -0.008688175787 0.05161680362 -0.084589 -0.03467857 -0.1 -0.05 -0.087 -0.03 -0.08 0.046 -0.0708 -0.0833 -0.0332 -0.086 -0.0233 -0.082 0.06 0.0177 0.0001 0.0001 0.0001 0.000105 0.02 0.0374 0.07 0.03483606557}}
   addUserKnob {12 wxy}
   wxy {{curve(which) 0.33333333 0.32168 0.32168 0.3127 0.3127 0.3127 0.3127 0.32168 0.3127 0.314 0.3127 0.3216831877 0.3216832104 0.3216832894 0.3216832894 0.3216832104 0.3216832894 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3135 0.3135 0.3135 0.3127 0.3127 0.3127 0.3127 0.3457 0.3457 0.3457 0.3457 0.345704 0.33243 0.33333333 0.3127 0.3457} {curve(which) 0.33333333 0.33767 0.33767 0.329 0.329 0.329 0.329 0.33767 0.329 0.351 0.329 0.337673316 0.3376736101 0.3376734472 0.3376734472 0.3376736101 0.3376734472 0.329 0.329 0.329 0.329 0.329 0.329 0.329 0.329 0.3305 0.3305 0.3305 0.329 0.329 0.329 0.329 0.3585 0.3585 0.3585 0.3585 0.35854 0.34744 0.33333333 0.329 0.3585}}
  }
  Output {
   name Output
   xpos -40
   ypos 86
  }
 end_group
 Position {
  translate {{parent.Reformat1.box_width+Rectangle1.area.r+input.width} {parent.ReformatBox4.box_width-input.height}}
  name Position6
  xpos -1140
  ypos 254
 }
push $N92d10800
 Group {
  name RGBToXYZ_GamutB
  label "\[if \{\[value invert]\} \{return \"XYZ to \[value gamut]\"\} else \{return \"\[value gamut] to XYZ\"\}]\n\n"
  xpos -1030
  ypos 176
  addUserKnob {20 GamutToXYZ_tab l GamutToXYZ}
  addUserKnob {4 gamut t "Choose gamut" M {XYZ ACES ACEScg "Filmlight E-Gamut" "DaVinci WG" Rec709 Rec2020 P3D60 P3D65 P3DCI "Arri AlexaWideGamut" REDDRAGONcolor REDDRAGONcolor2 REDcolor REDcolor2 REDcolor3 REDcolor4 REDWideGamutRGB "GoPro Protune Native" CanonCinemaGamut SonySGamut SonySGamut3Cine PanasonicVGamut "DJI D-Gamut" "Fujifilm F-Gamut" BMDFilmV1 BMD4kFilmV1 BMD4kFilmV3 BMD46kFilmV1 BMD46kFilmV3 BMDWideGamutV4 "AdobeRGB\t" AdobeWideGamutRGB ROMM RIMM ERIMM ProPhotoRGB RusselRGB SharpRGB AppleRGB BestRGB}}
  gamut P3D65
  addUserKnob {6 invert +STARTLINE}
  addUserKnob {26 ""}
  addUserKnob {26 chromaticity_coordinates_label l " " T "<b>Chromaticity Coordinates</b>"}
  addUserKnob {41 rxy T ColorMatrix.rxy}
  addUserKnob {41 gxy T ColorMatrix.gxy}
  addUserKnob {41 bxy T ColorMatrix.bxy}
  addUserKnob {41 wxy T ColorMatrix.wxy}
  addUserKnob {41 matrix T ColorMatrix.matrix}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -10
  }
  ColorMatrix {
   matrix {
       {{curve(which) 1 0.9525524378 0.6624541879 0.7053968906 0.7006223798 0.4123907983 0.6369580626 0.5049495697 0.4865709841 0.4451698363 0.6380076408 0.5070186853 0.4462202489 0.4300414324 0.4581649601 0.4878340662 0.4517004192 0.7352752686 0.5022571683 0.7160496712 0.7064827085 0.5990839601 0.6796444654 0.6481720209 0.6369580626 0.6390493512 0.6141571999 0.3724023998 0.60689044 0.4017650783 0.6065810919 0.5766690373 0.7165006995 0.797760427 0.797760427 0.797760427 0.7976718545 0.7015837431 0.8156226277 0.4496616423 0.6318944097} {curve(which) 0 0 0.1340042055 0.1640413404 0.1487748176 0.3575843275 0.1446169019 0.2646814585 0.2656676769 0.2771343887 0.2147038579 0.3587769568 0.3157556653 0.3700728714 0.3832037449 0.3432727158 0.3178463876 0.06860940903 0.2929667532 0.1296834797 0.1288010478 0.2489254922 0.1522114277 0.1940581352 0.1446169019 0.1578372866 0.2825684249 0.4324877858 0.2193847299 0.4560420811 0.2203479856 0.1855582297 0.1010205746 0.1351858526 0.1351858526 0.1351858526 0.1351878047 0.1554162204 0.04716260359 0.3162561059 0.2053879201} {curve(which) 0 9.367863095e-05 0.1561876982 0.08101774752 0.101058729 0.180480808 0.1688809693 0.1830150485 0.1982172877 0.1722826511 0.09774444997 0.0868505761 0.190669477 0.152531758 0.1112773567 0.1215386018 0.1830992699 0.1465712637 0.1552320272 0.1047228053 0.1151721701 0.1024464965 0.1186000481 0.108225815 0.1688809693 0.1516760886 0.05183707923 0.1436725408 0.124180764 0.09264881909 0.123526901 0.1882286519 0.1467743814 0.03134934977 0.03134934977 0.03134934977 0.03133957833 0.09979832917 0.1372147948 0.1845382005 0.1270133406}}
       {{curve(which) 0 0.3439664543 0.2722287476 0.2801307142 0.2741185129 0.2126390189 0.2627002299 0.237623319 0.2289745659 0.209491685 0.2919537723 0.2207257152 0.1942579001 0.2022213936 0.1694435924 0.2289056629 0.2119505703 0.2866941094 0.1387997568 0.2612613738 0.2709796727 0.2150758505 0.2606855333 0.2830046713 0.2627002299 0.1743051857 0.2365771234 0.1383759677 0.1973138005 0.1721783578 0.2680045366 0.2973450124 0.258728236 0.2880711257 0.2880711257 0.2880711257 0.2880405784 0.3152042925 0.3790788651 0.2446159422 0.2276017666} {curve(which) 1 0.7281661034 0.6740817428 0.8202066422 0.8736318946 0.7151686549 0.6779980659 0.6891706586 0.6917385459 0.7215952873 0.8238410354 0.839184761 0.7385566831 0.7585275769 0.8648257852 0.7808576822 0.7230190039 0.8429791331 0.910841465 0.8696421385 0.786606431 0.8850684762 0.7748944759 0.8131960034 0.6779980659 0.951146543 0.8896810412 0.911518693 0.943950057 0.8553914428 0.8326833844 0.6273635626 0.7246823311 0.7118432522 0.7118432522 0.7118432522 0.7118694782 0.6648360491 0.5769088268 0.6720442176 0.7383946776} {curve(which) 0 -0.07213255018 0.05368951708 -0.1003373638 -0.1477504075 0.07219231874 0.05930171534 0.07320601493 0.07928691059 0.06891305745 -0.1157948226 -0.05991046131 0.06718540192 0.03925102949 -0.03426937759 -0.009763340466 0.06503042579 -0.1296732277 -0.04964122549 -0.1309035122 -0.05758608505 -0.1001443192 -0.03558001295 -0.09620071948 0.05930171534 -0.1254517138 -0.1262581497 -0.04989464581 -0.1412638426 -0.02756982669 -0.1006879359 0.07529145479 0.01658944227 8.565396274e-05 8.565396274e-05 8.565396274e-05 8.991353388e-05 0.01995966583 0.04401229322 0.08333983272 0.0340035744}}
       {{curve(which) 0 -3.863927134e-08 -0.005574660841 -0.1037815213 -0.09896291792 0.01933082007 0 0 0 0 0.0027982709 -0.0544523783 -0.04792318866 -0.0176958181 -0.1061859056 -0.02100777067 -0.01945115253 -0.07968087494 0.07801423222 -0.009676366113 -0.009677864611 -0.03206583485 -0.009310216643 -0.01825834997 0 -0.11669112 -0.02325225808 -0.1602820009 -0.1427432895 -0.10720893 -0.02941203304 0.02703136392 -2.906408625e-08 -3.236030111e-08 -3.236030111e-08 -3.236030111e-08 0 0 -0.01229703799 0.02518104948 0} {curve(which) 0 0 0.004060741514 -0.07290724665 -0.1378953159 0.1191947311 0.0280726999 0.0449459292 0.04511339962 0.04706057906 -0.06703422964 -0.0003228379355 -0.0002844714036 0.08768811822 0.02554347552 0.01782695204 0.01650637016 -0.3473432064 -0.3148325086 -0.2364816219 0.004600019194 -0.02765839547 -0.004612449091 -0.08316776901 0.0280726999 -0.5518454909 -0.4897170365 -0.171635136 -0.4278847873 0.07809129357 -0.08659287542 0.07068887353 0.05121183768 1.2621717e-08 1.2621717e-08 1.2621717e-08 -1.262213711e-08 0.04317118227 0.01672476344 0.1411857158 0.01001892332} {curve(which) 1 1.008825183 1.010339141 1.265746474 1.325916052 0.950532198 1.060985088 0.9638792276 1.043944359 0.9073553085 1.153293729 1.063571215 1.057001948 0.9388025999 1.089437366 1.01197505 1.011739731 1.51608181 1.325875998 1.335215807 1.094135642 1.148782015 1.102980375 1.190483928 1.060985088 1.745692492 1.590125084 1.409072995 1.65968585 1.118175387 1.205062628 0.9913375378 0.7738927603 0.8251045942 0.8251045942 0.8251045942 0.8248898983 0.8782252669 0.9955722094 0.9226909876 0.8150856495}}
     }
   invert {{parent.invert}}
   name ColorMatrix
   label "RGB to XYZ"
   xpos -40
   ypos 32
   addUserKnob {20 Gamut}
   addUserKnob {3 which}
   which {{parent.gamut}}
   addUserKnob {12 rxy}
   rxy {{curve(which) 1 0.7347 0.713 0.8 0.8 0.64 0.708 0.68 0.68 0.68 0.684 0.7530442228 0.7530444911 0.6997470013 0.8786825105 0.7011810359 0.7011805919 0.780308 0.69848046 0.74 0.73 0.766 0.73 0.71 0.708 0.9173 0.7422 1.0625 0.9175 0.8608 0.7177 0.64 0.7347 0.7347 0.7347 0.7347 0.734699 0.69 0.6898 0.625 0.7351916376} {curve(which) 0 0.2653 0.293 0.3177 0.313 0.33 0.292 0.32 0.32 0.32 0.313 0.3278305767 0.3278310295 0.3290469303 0.3249640074 0.3290141556 0.3290136991 0.304253 0.19302645 0.27 0.28 0.275 0.28 0.31 0.292 0.2502 0.2859 0.3948 0.2983 0.3689 0.3171 0.33 0.2653 0.2653 0.2653 0.2653 0.265301 0.31 0.3206 0.34 0.2648083624}}
   addUserKnob {12 gxy}
   gxy {{curve(which) 0 0 0.165 0.18 0.1682 0.3 0.17 0.265 0.265 0.265 0.221 0.2995702285 0.2995704905 0.304264039 0.3008887144 0.3006003047 0.3006003955 0.121595 0.32955538 0.17 0.14 0.225 0.165 0.21 0.17 0.2833 0.414 0.3689 0.2983 0.3282 0.228 0.21 0.1152 0.1596 0.1596 0.1596 0.159597 0.18 0.0736 0.28 0.2153361345} {curve(which) 1 1 0.83 0.9 0.9877 0.6 0.797 0.69 0.69 0.69 0.848 0.700699322 0.7006994156 0.6236411451 0.6790547558 0.6837888343 0.6837888243 1.493994 1.02459662 1.14 0.855 0.8 0.84 0.88 0.797 1.7072 1.3035 0.7775 1.2835 0.6156 0.8616 0.71 0.8264 0.8404 0.8404 0.8404 0.840403 0.77 0.9003 0.595 0.7741596639}}
   addUserKnob {12 bxy}
   bxy {{curve(which) 0 0.0001 0.128 0.065 0.079 0.15 0.131 0.15 0.15 0.15 0.0861 0.07964206674 0.1450115843 0.1349139613 0.09539869461 0.1081544556 0.1453319462 0.095612 0.10844263 0.08 0.1 0.089 0.1 0.09 0.131 0.0856 0.0342 0.0956 0.0756 0.0783 0.1006 0.15 0.1566 0.0366 0.0366 0.0366 0.036598 0.1 0.1166 0.155 0.1301229508} {curve(which) 0 -0.077 0.044 -0.0805 -0.1155 0.06 0.046 0.06 0.06 0.06 -0.102 -0.05493795109 0.05109712509 0.03471744128 -0.02937932683 -0.008688175787 0.05161680362 -0.084589 -0.03467857 -0.1 -0.05 -0.087 -0.03 -0.08 0.046 -0.0708 -0.0833 -0.0332 -0.086 -0.0233 -0.082 0.06 0.0177 0.0001 0.0001 0.0001 0.000105 0.02 0.0374 0.07 0.03483606557}}
   addUserKnob {12 wxy}
   wxy {{curve(which) 0.33333333 0.32168 0.32168 0.3127 0.3127 0.3127 0.3127 0.32168 0.3127 0.314 0.3127 0.3216831877 0.3216832104 0.3216832894 0.3216832894 0.3216832104 0.3216832894 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3135 0.3135 0.3135 0.3127 0.3127 0.3127 0.3127 0.3457 0.3457 0.3457 0.3457 0.345704 0.33243 0.33333333 0.3127 0.3457} {curve(which) 0.33333333 0.33767 0.33767 0.329 0.329 0.329 0.329 0.33767 0.329 0.351 0.329 0.337673316 0.3376736101 0.3376734472 0.3376734472 0.3376736101 0.3376734472 0.329 0.329 0.329 0.329 0.329 0.329 0.329 0.329 0.3305 0.3305 0.3305 0.329 0.329 0.329 0.329 0.3585 0.3585 0.3585 0.3585 0.35854 0.34744 0.33333333 0.329 0.3585}}
  }
  Output {
   name Output
   xpos -40
   ypos 86
  }
 end_group
 Position {
  translate {{parent.Reformat1.box_width+Rectangle1.area.r} {parent.ReformatBox4.box_width-input.height*2}}
  name Position5
  xpos -1030
  ypos 254
 }
push $N92d10800
 Group {
  name RGBToXYZ_GamutA
  label "\[if \{\[value invert]\} \{return \"XYZ to \[value gamut]\"\} else \{return \"\[value gamut] to XYZ\"\}]\n\n"
  xpos -920
  ypos 176
  addUserKnob {20 GamutToXYZ_tab l GamutToXYZ}
  addUserKnob {4 gamut t "Choose gamut" M {XYZ ACES ACEScg "Filmlight E-Gamut" "DaVinci WG" Rec709 Rec2020 P3D60 P3D65 P3DCI "Arri AlexaWideGamut" REDDRAGONcolor REDDRAGONcolor2 REDcolor REDcolor2 REDcolor3 REDcolor4 REDWideGamutRGB "GoPro Protune Native" CanonCinemaGamut SonySGamut SonySGamut3Cine PanasonicVGamut "DJI D-Gamut" "Fujifilm F-Gamut" BMDFilmV1 BMD4kFilmV1 BMD4kFilmV3 BMD46kFilmV1 BMD46kFilmV3 BMDWideGamutV4 "AdobeRGB\t" AdobeWideGamutRGB ROMM RIMM ERIMM ProPhotoRGB RusselRGB SharpRGB AppleRGB BestRGB}}
  gamut ACEScg
  addUserKnob {6 invert +STARTLINE}
  addUserKnob {26 ""}
  addUserKnob {26 chromaticity_coordinates_label l " " T "<b>Chromaticity Coordinates</b>"}
  addUserKnob {41 rxy T ColorMatrix.rxy}
  addUserKnob {41 gxy T ColorMatrix.gxy}
  addUserKnob {41 bxy T ColorMatrix.bxy}
  addUserKnob {41 wxy T ColorMatrix.wxy}
  addUserKnob {41 matrix T ColorMatrix.matrix}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -10
  }
  ColorMatrix {
   matrix {
       {{curve(which) 1 0.9525524378 0.6624541879 0.7053968906 0.7006223798 0.4123907983 0.6369580626 0.5049495697 0.4865709841 0.4451698363 0.6380076408 0.5070186853 0.4462202489 0.4300414324 0.4581649601 0.4878340662 0.4517004192 0.7352752686 0.5022571683 0.7160496712 0.7064827085 0.5990839601 0.6796444654 0.6481720209 0.6369580626 0.6390493512 0.6141571999 0.3724023998 0.60689044 0.4017650783 0.6065810919 0.5766690373 0.7165006995 0.797760427 0.797760427 0.797760427 0.7976718545 0.7015837431 0.8156226277 0.4496616423 0.6318944097} {curve(which) 0 0 0.1340042055 0.1640413404 0.1487748176 0.3575843275 0.1446169019 0.2646814585 0.2656676769 0.2771343887 0.2147038579 0.3587769568 0.3157556653 0.3700728714 0.3832037449 0.3432727158 0.3178463876 0.06860940903 0.2929667532 0.1296834797 0.1288010478 0.2489254922 0.1522114277 0.1940581352 0.1446169019 0.1578372866 0.2825684249 0.4324877858 0.2193847299 0.4560420811 0.2203479856 0.1855582297 0.1010205746 0.1351858526 0.1351858526 0.1351858526 0.1351878047 0.1554162204 0.04716260359 0.3162561059 0.2053879201} {curve(which) 0 9.367863095e-05 0.1561876982 0.08101774752 0.101058729 0.180480808 0.1688809693 0.1830150485 0.1982172877 0.1722826511 0.09774444997 0.0868505761 0.190669477 0.152531758 0.1112773567 0.1215386018 0.1830992699 0.1465712637 0.1552320272 0.1047228053 0.1151721701 0.1024464965 0.1186000481 0.108225815 0.1688809693 0.1516760886 0.05183707923 0.1436725408 0.124180764 0.09264881909 0.123526901 0.1882286519 0.1467743814 0.03134934977 0.03134934977 0.03134934977 0.03133957833 0.09979832917 0.1372147948 0.1845382005 0.1270133406}}
       {{curve(which) 0 0.3439664543 0.2722287476 0.2801307142 0.2741185129 0.2126390189 0.2627002299 0.237623319 0.2289745659 0.209491685 0.2919537723 0.2207257152 0.1942579001 0.2022213936 0.1694435924 0.2289056629 0.2119505703 0.2866941094 0.1387997568 0.2612613738 0.2709796727 0.2150758505 0.2606855333 0.2830046713 0.2627002299 0.1743051857 0.2365771234 0.1383759677 0.1973138005 0.1721783578 0.2680045366 0.2973450124 0.258728236 0.2880711257 0.2880711257 0.2880711257 0.2880405784 0.3152042925 0.3790788651 0.2446159422 0.2276017666} {curve(which) 1 0.7281661034 0.6740817428 0.8202066422 0.8736318946 0.7151686549 0.6779980659 0.6891706586 0.6917385459 0.7215952873 0.8238410354 0.839184761 0.7385566831 0.7585275769 0.8648257852 0.7808576822 0.7230190039 0.8429791331 0.910841465 0.8696421385 0.786606431 0.8850684762 0.7748944759 0.8131960034 0.6779980659 0.951146543 0.8896810412 0.911518693 0.943950057 0.8553914428 0.8326833844 0.6273635626 0.7246823311 0.7118432522 0.7118432522 0.7118432522 0.7118694782 0.6648360491 0.5769088268 0.6720442176 0.7383946776} {curve(which) 0 -0.07213255018 0.05368951708 -0.1003373638 -0.1477504075 0.07219231874 0.05930171534 0.07320601493 0.07928691059 0.06891305745 -0.1157948226 -0.05991046131 0.06718540192 0.03925102949 -0.03426937759 -0.009763340466 0.06503042579 -0.1296732277 -0.04964122549 -0.1309035122 -0.05758608505 -0.1001443192 -0.03558001295 -0.09620071948 0.05930171534 -0.1254517138 -0.1262581497 -0.04989464581 -0.1412638426 -0.02756982669 -0.1006879359 0.07529145479 0.01658944227 8.565396274e-05 8.565396274e-05 8.565396274e-05 8.991353388e-05 0.01995966583 0.04401229322 0.08333983272 0.0340035744}}
       {{curve(which) 0 -3.863927134e-08 -0.005574660841 -0.1037815213 -0.09896291792 0.01933082007 0 0 0 0 0.0027982709 -0.0544523783 -0.04792318866 -0.0176958181 -0.1061859056 -0.02100777067 -0.01945115253 -0.07968087494 0.07801423222 -0.009676366113 -0.009677864611 -0.03206583485 -0.009310216643 -0.01825834997 0 -0.11669112 -0.02325225808 -0.1602820009 -0.1427432895 -0.10720893 -0.02941203304 0.02703136392 -2.906408625e-08 -3.236030111e-08 -3.236030111e-08 -3.236030111e-08 0 0 -0.01229703799 0.02518104948 0} {curve(which) 0 0 0.004060741514 -0.07290724665 -0.1378953159 0.1191947311 0.0280726999 0.0449459292 0.04511339962 0.04706057906 -0.06703422964 -0.0003228379355 -0.0002844714036 0.08768811822 0.02554347552 0.01782695204 0.01650637016 -0.3473432064 -0.3148325086 -0.2364816219 0.004600019194 -0.02765839547 -0.004612449091 -0.08316776901 0.0280726999 -0.5518454909 -0.4897170365 -0.171635136 -0.4278847873 0.07809129357 -0.08659287542 0.07068887353 0.05121183768 1.2621717e-08 1.2621717e-08 1.2621717e-08 -1.262213711e-08 0.04317118227 0.01672476344 0.1411857158 0.01001892332} {curve(which) 1 1.008825183 1.010339141 1.265746474 1.325916052 0.950532198 1.060985088 0.9638792276 1.043944359 0.9073553085 1.153293729 1.063571215 1.057001948 0.9388025999 1.089437366 1.01197505 1.011739731 1.51608181 1.325875998 1.335215807 1.094135642 1.148782015 1.102980375 1.190483928 1.060985088 1.745692492 1.590125084 1.409072995 1.65968585 1.118175387 1.205062628 0.9913375378 0.7738927603 0.8251045942 0.8251045942 0.8251045942 0.8248898983 0.8782252669 0.9955722094 0.9226909876 0.8150856495}}
     }
   invert {{parent.invert}}
   name ColorMatrix
   label "RGB to XYZ"
   xpos -40
   ypos 32
   addUserKnob {20 Gamut}
   addUserKnob {3 which}
   which {{parent.gamut}}
   addUserKnob {12 rxy}
   rxy {{curve(which) 1 0.7347 0.713 0.8 0.8 0.64 0.708 0.68 0.68 0.68 0.684 0.7530442228 0.7530444911 0.6997470013 0.8786825105 0.7011810359 0.7011805919 0.780308 0.69848046 0.74 0.73 0.766 0.73 0.71 0.708 0.9173 0.7422 1.0625 0.9175 0.8608 0.7177 0.64 0.7347 0.7347 0.7347 0.7347 0.734699 0.69 0.6898 0.625 0.7351916376} {curve(which) 0 0.2653 0.293 0.3177 0.313 0.33 0.292 0.32 0.32 0.32 0.313 0.3278305767 0.3278310295 0.3290469303 0.3249640074 0.3290141556 0.3290136991 0.304253 0.19302645 0.27 0.28 0.275 0.28 0.31 0.292 0.2502 0.2859 0.3948 0.2983 0.3689 0.3171 0.33 0.2653 0.2653 0.2653 0.2653 0.265301 0.31 0.3206 0.34 0.2648083624}}
   addUserKnob {12 gxy}
   gxy {{curve(which) 0 0 0.165 0.18 0.1682 0.3 0.17 0.265 0.265 0.265 0.221 0.2995702285 0.2995704905 0.304264039 0.3008887144 0.3006003047 0.3006003955 0.121595 0.32955538 0.17 0.14 0.225 0.165 0.21 0.17 0.2833 0.414 0.3689 0.2983 0.3282 0.228 0.21 0.1152 0.1596 0.1596 0.1596 0.159597 0.18 0.0736 0.28 0.2153361345} {curve(which) 1 1 0.83 0.9 0.9877 0.6 0.797 0.69 0.69 0.69 0.848 0.700699322 0.7006994156 0.6236411451 0.6790547558 0.6837888343 0.6837888243 1.493994 1.02459662 1.14 0.855 0.8 0.84 0.88 0.797 1.7072 1.3035 0.7775 1.2835 0.6156 0.8616 0.71 0.8264 0.8404 0.8404 0.8404 0.840403 0.77 0.9003 0.595 0.7741596639}}
   addUserKnob {12 bxy}
   bxy {{curve(which) 0 0.0001 0.128 0.065 0.079 0.15 0.131 0.15 0.15 0.15 0.0861 0.07964206674 0.1450115843 0.1349139613 0.09539869461 0.1081544556 0.1453319462 0.095612 0.10844263 0.08 0.1 0.089 0.1 0.09 0.131 0.0856 0.0342 0.0956 0.0756 0.0783 0.1006 0.15 0.1566 0.0366 0.0366 0.0366 0.036598 0.1 0.1166 0.155 0.1301229508} {curve(which) 0 -0.077 0.044 -0.0805 -0.1155 0.06 0.046 0.06 0.06 0.06 -0.102 -0.05493795109 0.05109712509 0.03471744128 -0.02937932683 -0.008688175787 0.05161680362 -0.084589 -0.03467857 -0.1 -0.05 -0.087 -0.03 -0.08 0.046 -0.0708 -0.0833 -0.0332 -0.086 -0.0233 -0.082 0.06 0.0177 0.0001 0.0001 0.0001 0.000105 0.02 0.0374 0.07 0.03483606557}}
   addUserKnob {12 wxy}
   wxy {{curve(which) 0.33333333 0.32168 0.32168 0.3127 0.3127 0.3127 0.3127 0.32168 0.3127 0.314 0.3127 0.3216831877 0.3216832104 0.3216832894 0.3216832894 0.3216832104 0.3216832894 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3135 0.3135 0.3135 0.3127 0.3127 0.3127 0.3127 0.3457 0.3457 0.3457 0.3457 0.345704 0.33243 0.33333333 0.3127 0.3457} {curve(which) 0.33333333 0.33767 0.33767 0.329 0.329 0.329 0.329 0.33767 0.329 0.351 0.329 0.337673316 0.3376736101 0.3376734472 0.3376734472 0.3376736101 0.3376734472 0.329 0.329 0.329 0.329 0.329 0.329 0.329 0.329 0.3305 0.3305 0.3305 0.329 0.329 0.329 0.329 0.3585 0.3585 0.3585 0.3585 0.35854 0.34744 0.33333333 0.329 0.3585}}
  }
  Output {
   name Output
   xpos -40
   ypos 86
  }
 end_group
 Position {
  translate {{parent.Reformat1.box_width+Rectangle1.area.r} {parent.ReformatBox4.box_width-input.height}}
  name Position4
  xpos -920
  ypos 254
 }
push $N92e1f200
 Reformat {
  type scale
  scale 0.8
  turn true
  filter impulse
  black_outside true
  name Reformat2
  xpos -920
  ypos -129
 }
 BlackOutside {
  name BlackOutside2
  xpos -920
  ypos -106
 }
 Position {
  translate {{Rectangle1.area.r} {parent.Position3.translate.y-input.height}}
  name Position2
  xpos -920
  ypos -81
 }
 Group {
  inputs 0
  name ColorChecker24_After_November_2014
  label "CIE XYZ D50"
  xpos -920
  ypos -352
  addUserKnob {20 colorchecker_tab l "ColorChecker24 - After November 2014"}
  addUserKnob {3 patch_resolution}
  patch_resolution 48
 }
  Group {
   inputs 0
   name bluish_green
   selected true
   xpos 622
   ypos -321
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.30451114 0.4143554688 0.344352688 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob "bluish green"
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 6
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
    xpos 262
    ypos 125
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name blue_flower
   xpos 512
   ypos -321
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.2419823988 0.2287175998 0.3282104382 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob "blue flower"
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 5
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name foliage
   xpos 402
   ypos -321
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.1114392339 0.1346792679 0.05239320311 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob foliage
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 4
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name blue_sky
   xpos 292
   ypos -321
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.1652470004 0.1785519348 0.2546024121 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob "blue sky"
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 3
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name light_skin
   xpos 180
   ypos -321
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.3811104477 0.336202304 0.1852590702 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob "light skin"
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 2
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 63
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
    xpos 262
    ypos 135
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name dark_skin
   xpos 70
   ypos -321
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.1136398927 0.09832436105 0.047793811 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob "dark skin"
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 1
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 290
    ypos 63
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
    xpos 290
    ypos 158
   }
   Output {
    name Output
    xpos 290
    ypos 230
   }
  end_group
  Group {
   inputs 0
   name orange_yellow
   xpos 622
   ypos -201
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.4769723742 0.4293377578 0.06005041429 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob "orange yellow"
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 12
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name yellow_green
   xpos 512
   ypos -201
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.3427379502 0.4331759409 0.08330791241 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob "yellow green"
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 11
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name purple
   xpos 401
   ypos -201
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.08353888545 0.06276662955 0.1042075686 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob purple
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 10
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name moderate_red
   xpos 290
   ypos -201
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.2915036416 0.188999956 0.09736350318 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob "moderate red"
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 9
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name purplish_blue
   xpos 180
   ypos -201
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.1200518326 0.1091090233 0.2874447494 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob "purplish blue"
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 8
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name orange
   xpos 74
   ypos -201
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.4073691399 0.3126416159 0.05130591012 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob orange
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 7
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name cyan
   xpos 622
   ypos -81
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.1247966941 0.180609913 0.2913392383 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob cyan
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 18
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name magenta
   xpos 512
   ypos -81
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.299122798 0.1895114577 0.2213469194 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob magenta
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 17
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name yellow
   xpos 399
   ypos -81
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.5888922356 0.5992976803 0.07077420003 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob yellow
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 16
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
    xpos 262
    ypos 125
   }
   Output {
    name Output
    xpos 262
    ypos 182
   }
  end_group
  Group {
   inputs 0
   name red
   xpos 292
   ypos -81
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.2143728424 0.127800835 0.03868150726 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob red
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 15
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name green
   xpos 182
   ypos -81
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.1413517689 0.2233437582 0.07287461742 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob green
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 14
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name blue
   xpos 72
   ypos -81
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.06809095613 0.05596214063 0.2077405936 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob blue
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 13
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name black_2
   xpos 623
   ypos 39
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.03042544265 0.03151319431 0.02656724434 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob "black 2 (1.5 D)"
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 24
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
    xpos 262
    ypos 125
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name neutral_3
   xpos 512
   ypos 39
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.08448968042 0.08817234828 0.07391630753 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob "neutral 3.5 (1.05 D)"
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 23
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name neutral_5
   xpos 403
   ypos 39
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.1835495863 0.1906228754 0.1566717383 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob "neutral 5 (.70 D)"
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 22
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name neutral_6
   xpos 292
   ypos 39
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.3495921991 0.3648652066 0.3013565492 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob "neutral 6.5 (.44 D)"
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 21
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name neutral_8
   xpos 179
   ypos 39
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.5665335579 0.5899709702 0.4828473821 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob "neutral 8 (.23 D)"
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 20
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  Group {
   inputs 0
   name white_9
   xpos 70
   ypos 39
   postage_stamp true
   addUserKnob {20 sample_Tab l Sample}
   addUserKnob {19 colour_RGBA_Color_Knob l Colour}
   colour_RGBA_Color_Knob {0.8436985288 0.8806903203 0.6936778752 1}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 colour_RGBA_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {1 name_Text_Knob l Name}
   name_Text_Knob "white 9.5 (.05 D)"
   addUserKnob {1 index_Text_Knob l Index}
   index_Text_Knob 19
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 label_colour_RGB_Color_Knob_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {3 resolution}
   resolution {{parent.patch_resolution}}
  }
   Constant {
    inputs 0
    color {{parent.colour_RGBA_Color_Knob.r} {parent.colour_RGBA_Color_Knob.g} {parent.colour_RGBA_Color_Knob.b} {parent.colour_RGBA_Color_Knob.a}}
    format "512 512 0 0 512 512 1 square_512"
    name Constant
    xpos 262
    ypos 53
   }
   Reformat {
    type "to box"
    box_width {{parent.resolution}}
    box_height {{parent.resolution}}
    box_fixed true
    filter impulse
    black_outside true
    name Reformat1
    xpos 262
    ypos 134
   }
   Output {
    name Output
    xpos 262
    ypos 173
   }
  end_group
  ContactSheet {
   inputs 24
   width {{"rint(parent.patch_resolution * 6 + gap * 7)"}}
   height {{"rint(parent.patch_resolution * 4 + gap * 5)"}}
   rows 4
   columns 6
   startframe 1
   endframe 1
   name ContactSheet
   xpos 620
   ypos 206
  }
  Unpremult {
   name Unpremult1
   xpos 620
   ypos 278
  }
  Output {
   name Output
   xpos 620
   ypos 446
  }
 end_group
 BlackOutside {
  name BlackOutside4
  xpos -920
  ypos -298
 }
 Position {
  translate {{parent.Reformat1.box_width*3+Rectangle1.area.r} {parent.ReformatBox4.box_width-input.height}}
  name Position7
  xpos -920
  ypos -273
 }
 Constant {
  inputs 0
  format "256 256 0 0 256 256 1 square_256"
  name Constant5
  xpos -700
  ypos -1354
  postage_stamp false
 }
 Dot {
  name Dot25
  xpos -666
  ypos -1302
 }
set N97170c00 [stack 0]
 Dot {
  name Dot27
  xpos -1546
  ypos -1302
 }
 Reformat {
  type "to box"
  box_width {{parent.Reformat1.box_width}}
  box_height 100
  box_fixed true
  name ReformatBox1
  xpos -1580
  ypos -994
 }
 Ramp {
  p0 {0 0}
  p1 {{input.width} 0}
  color {{p1}}
  name Ramp3
  xpos -1580
  ypos -898
 }
 ColorLookup {
  lut {master {}
    red {curve 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.31 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.397 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.483 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.569 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.655 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.741 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.828 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914 0.914}
    green {curve 0.433 0.464 0.513 0.611 0.576 0.46 0.426 0.412 0.404 0.397 0.384 0.374 0.346 0.333 0.311 0.287 0.257 0.23 0.21 0.219 0.208 0.211 0.208 0.187 0.191 0.187 0.18 0.164 0.17 0.177 0.175 0.188 0.252 0.325 0.385 0.416 0.433 0.487 0.532 0.588 0.637 0.634 0.549 0.506 0.49 0.458 0.426 0.412 0.397 0.365 0.337 0.301 0.262 0.221 0.192 0.164 0.167 0.162 0.176 0.179 0.148 0.156 0.142 0.148 0.138 0.145 0.145 0.161 0.197 0.256 0.324 0.393 0.451 0.487 0.508 0.538 0.587 0.634 0.659 0.611 0.552 0.526 0.484 0.452 0.428 0.406 0.371 0.334 0.293 0.243 0.204 0.177 0.151 0.151 0.162 0.158 0.161 0.142 0.141 0.129 0.134 0.14 0.156 0.166 0.192 0.221 0.265 0.325 0.392 0.451 0.508 0.48 0.513 0.554 0.597 0.63 0.634 0.58 0.546 0.499 0.466 0.434 0.408 0.372 0.332 0.288 0.242 0.202 0.179 0.16 0.157 0.162 0.157 0.159 0.149 0.153 0.147 0.154 0.164 0.18 0.199 0.226 0.25 0.279 0.325 0.38 0.439 0.48 0.436 0.468 0.502 0.541 0.57 0.605 0.594 0.555 0.511 0.473 0.439 0.409 0.371 0.332 0.288 0.252 0.217 0.196 0.181 0.178 0.185 0.176 0.173 0.168 0.176 0.178 0.19 0.202 0.214 0.235 0.254 0.27 0.291 0.323 0.366 0.41 0.436 0.396 0.414 0.438 0.465 0.485 0.527 0.566 0.557 0.523 0.478 0.442 0.409 0.371 0.334 0.294 0.265 0.244 0.223 0.225 0.212 0.218 0.211 0.211 0.207 0.214 0.217 0.229 0.237 0.244 0.264 0.275 0.285 0.3 0.321 0.348 0.376 0.396 0.357 0.368 0.377 0.391 0.402 0.431 0.481 0.503 0.521 0.482 0.444 0.409 0.372 0.337 0.307 0.286 0.27 0.257 0.247 0.251 0.257 0.255 0.254 0.25 0.258 0.259 0.265 0.269 0.278 0.284 0.292 0.297 0.305 0.317 0.33 0.344 0.357 0.321 0.322 0.328 0.332 0.333 0.346 0.365 0.389 0.411 0.459 0.443 0.399 0.352 0.327 0.313 0.304 0.3 0.294 0.295 0.294 0.293 0.292 0.291 0.295 0.3 0.301 0.302 0.304 0.304 0.304 0.305 0.307 0.309 0.312 0.313 0.316 0.321}
    blue {curve 0.26 0.281 0.298 0.306 0.342 0.365 0.39 0.381 0.392 0.416 0.413 0.43 0.448 0.446 0.433 0.425 0.419 0.394 0.362 0.328 0.305 0.298 0.286 0.247 0.26 0.219 0.199 0.168 0.178 0.14 0.11 0.084 0.104 0.158 0.18 0.225 0.26 0.235 0.26 0.28 0.298 0.327 0.372 0.395 0.417 0.43 0.435 0.455 0.488 0.479 0.521 0.522 0.515 0.49 0.436 0.383 0.331 0.295 0.282 0.258 0.219 0.208 0.179 0.168 0.141 0.129 0.106 0.094 0.095 0.112 0.127 0.165 0.199 0.235 0.226 0.258 0.28 0.298 0.316 0.361 0.399 0.427 0.446 0.461 0.482 0.52 0.521 0.553 0.563 0.573 0.524 0.454 0.389 0.33 0.295 0.266 0.247 0.214 0.195 0.168 0.178 0.142 0.14 0.128 0.129 0.126 0.131 0.144 0.167 0.199 0.226 0.238 0.266 0.289 0.31 0.329 0.351 0.395 0.428 0.453 0.475 0.494 0.533 0.542 0.568 0.584 0.576 0.53 0.451 0.385 0.331 0.299 0.266 0.245 0.22 0.206 0.184 0.174 0.167 0.166 0.166 0.173 0.172 0.165 0.172 0.187 0.208 0.238 0.258 0.28 0.3 0.321 0.343 0.362 0.391 0.427 0.458 0.482 0.503 0.546 0.554 0.573 0.582 0.546 0.499 0.431 0.375 0.33 0.304 0.275 0.254 0.234 0.225 0.212 0.209 0.206 0.203 0.21 0.215 0.212 0.204 0.208 0.214 0.231 0.258 0.277 0.294 0.31 0.328 0.348 0.372 0.397 0.427 0.462 0.487 0.51 0.544 0.558 0.559 0.556 0.503 0.444 0.402 0.355 0.329 0.309 0.289 0.275 0.26 0.254 0.245 0.245 0.241 0.238 0.249 0.249 0.245 0.241 0.242 0.246 0.258 0.277 0.295 0.305 0.315 0.327 0.339 0.359 0.39 0.421 0.461 0.491 0.515 0.54 0.546 0.522 0.478 0.429 0.393 0.368 0.345 0.325 0.313 0.303 0.295 0.286 0.284 0.279 0.277 0.274 0.277 0.277 0.28 0.276 0.273 0.274 0.279 0.285 0.295 0.311 0.314 0.316 0.32 0.323 0.331 0.346 0.367 0.397 0.468 0.513 0.494 0.425 0.388 0.372 0.348 0.336 0.331 0.326 0.32 0.316 0.314 0.312 0.309 0.321 0.32 0.319 0.305 0.317 0.316 0.316 0.315 0.316 0.317 0.319 0.321 0.311}
    alpha {}}
  name ColorLookup7
  label "Pointers Samples Yxy\nSource: https://www.rit.edu/cos/colorscience/rc_useful_data.php"
  xpos -1580
  ypos -790
 }
 Colorspace {
  colorspace_in CIE-Yxy
  primary_in "Adobe (1998)"
  colorspace_out CIE-XYZ
  name Colorspace12
  label "\[value colorspace_in] -> \[value colorspace_out]"
  xpos -1580
  ypos -688
 }
 Fill {
  output alpha
  name Fill5
  xpos -1580
  ypos -639
 }
 BlackOutside {
  name BlackOutside7
  xpos -1580
  ypos -562
 }
 Position {
  translate {6 {parent.Position1.translate.y-input.height}}
  name Position3
  xpos -1580
  ypos -538
 }
 Dot {
  name Dot15
  xpos -1546
  ypos -414
 }
push $N97170c00
 Reformat {
  type "to box"
  box_width 2048
  box_height 2048
  box_fixed true
  name ReformatBox4
  xpos -700
  ypos -1258
 }
 Expression {
  temp_name0 n
  temp_expr0 input.width/8
  channel0 {rgba.red rgba.green rgba.blue none}
  expr0 x/width*(1-y/height)
  channel3 alpha
  expr3 1
  name Expression7
  xpos -700
  ypos -1209
 }
 Dot {
  name Dot10
  xpos -666
  ypos -1158
 }
set N97135000 [stack 0]
 Dot {
  name Dot26
  xpos -886
  ypos -1158
 }
set N97134c00 [stack 0]
 Dot {
  name Dot23
  xpos -1106
  ypos -1158
 }
set N97134800 [stack 0]
 Dot {
  name Dot12
  xpos -1326
  ypos -1158
 }
 Mirror2 {
  flip true
  flop true
  name Mirror2_1
  xpos -1360
  ypos -1042
 }
 Reformat {
  type "to box"
  box_width 512
  box_height {{box_width}}
  box_fixed true
  name Reformat1
  xpos -1360
  ypos -994
 }
 Gamma {
  channels rgb
  value 2
  name Gamma1
  xpos -1360
  ypos -898
 }
 Multiply {
  channels rgb
  value 8000
  name Multiply1
  label "\[value value]"
  xpos -1360
  ypos -811
 }
 ColorLookup {
  lut {master {}
    red {curve R 0.4830000103 x50 0.5045000315 0.5260000229 0.5475000143 0.5690000057 0.5904999971 0.6119999886 0.63349998 0.6549999714 0.6805312037 0.7087500095 0.7315937281 0.7409999967 0.7409999967 0.7409999967 0.7409999967 0.7409999967 0.75459373 0.7845000029 0.8144062757 0.8280000091 0.8280000091 0.8280000091 0.8280000091 0.8280000091 0.8009687662 0.74150002 0.6820312142 0.6549999714 0.6684374809 0.6980000138 0.7275624871 0.7409999967 0.7315937281 0.7087500095 0.6805312037 0.6549999714 0.629468739 0.6012499928 0.5784062743 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5555624962 0.5260000229 0.4964375198 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4964375198 0.5260000229 0.5555624962 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5690000057 0.5653046966 0.5555624962 0.5417890549 0.5260000229 0.5102109313 0.4964375198 0.4866953194 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4695625007 0.4400000274 0.4104375243 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.3970000148 0.4104375243 0.4400000274 0.4695625007 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103 0.4830000103}
    green {curve R 0.6589999795 x50 0.6542205811 0.6484853029 0.6414804459 0.6340000033 0.6249843836 0.6147499681 0.6041406393 0.5939999819 0.5844687223 0.575124979 0.5659687519 0.5569999814 0.5484530926 0.5402500033 0.5319218636 0.5230000019 0.5131718516 0.5027499795 0.4922031164 0.4819999933 0.4722187519 0.4626249969 0.4532187581 0.4440000057 0.4351093769 0.4265000224 0.4178906381 0.4090000093 0.3997343779 0.3902499974 0.380640626 0.3709999919 0.3614374995 0.3518749774 0.3421249986 0.3319999874 0.321398437 0.3104375005 0.2992577851 0.2879999876 0.2764999866 0.2647500038 0.2531249821 0.2419999987 0.2312265635 0.2206875086 0.2108047009 0.202000007 0.1947187632 0.1886250079 0.1829687506 0.1770000011 0.1693515629 0.1608124971 0.1538671851 0.1509999931 0.1509999931 0.1509999931 0.1509999931 0.1509999931 0.1527187377 0.1564999968 0.1602812558 0.1620000005 0.1620000005 0.1620000005 0.1620000005 0.1620000005 0.1612187475 0.1595000029 0.1577812582 0.1570000052 0.1573124975 0.1579999924 0.1586875021 0.1589999944 0.1575781256 0.1543750018 0.1509843767 0.1490000039 0.1485625058 0.1484999955 0.1484375 0.1480000019 0.1467812508 0.1449999958 0.1432187557 0.1420000046 0.1415625066 0.1414999962 0.1414375007 0.1410000026 0.1397656202 0.1378750056 0.1357968748 0.1340000033 0.1323750019 0.1307500005 0.1295000017 0.1289999932 0.130031243 0.1324999928 0.1354687512 0.1379999965 0.1402187496 0.1424999982 0.1442812532 0.1449999958 0.1449999958 0.1449999958 0.1449999958 0.1449999958 0.1464921832 0.1503124982 0.1554765552 0.1609999985 0.1673984379 0.1749375015 0.1822578013 0.1879999936 0.1906718612 0.1913749874 0.1926406175 0.1969999969 0.2064140588 0.2199375033 0.2357421964 0.2520000041 0.2688750029 0.2871249914 0.3058125079 0.324000001 0.3417187631 0.359375 0.3765937686 0.3930000067 0.4082968831 0.4227499962 0.4368281364 0.451000005 0.4659531415 0.4812500179 0.4956718981 0.5080000162 0.5169296861 0.5234375 0.5297265649 0.5379999876 0.5491171479 0.5618124604 0.5751015544 0.5879999995 0.6009531021 0.6142500043 0.6266719103 0.6370000243 0.6457066536 0.6532088518 0.6575522423 0.6589999795}
    blue {curve R 0.3160000145 x50 0.324739933 0.3330312669 0.3418398499 0.351000011 0.3607422113 0.3709374964 0.3811640739 0.3910000026 0.4003046751 0.4093124866 0.4181640446 0.4269999862 0.4359609187 0.4449374974 0.453695327 0.4620000124 0.4697890878 0.4771875143 0.4842422009 0.4909999967 0.4971874952 0.5028749704 0.5086249709 0.5149999857 0.5227031112 0.53125 0.5394218564 0.5460000038 0.5502656102 0.5530000329 0.5552343726 0.5580000281 0.561632812 0.5655625463 0.5694609284 0.5730000138 0.5765469074 0.5801249743 0.5828906298 0.5839999914 0.5838750005 0.5830000043 0.5806249976 0.5759999752 0.5682968497 0.5576249957 0.5446406007 0.5299999714 0.5128515363 0.4931874871 0.4729296863 0.4539999962 0.4368359447 0.420437485 0.4045703113 0.3889999986 0.3731718659 0.3573749959 0.3426406384 0.3300000131 0.3193906248 0.310375005 0.3034218848 0.298999995 0.2972500026 0.2969999909 0.2967499793 0.2949999869 0.2899531126 0.2821249962 0.2734843791 0.2660000026 0.2602812648 0.2552500069 0.2503437698 0.2450000048 0.2380000055 0.2300000042 0.2232500017 0.2199999988 0.2195625007 0.2194999903 0.2194374949 0.2189999968 0.2183593661 0.2176249921 0.2163281292 0.2140000015 0.2101874948 0.205249995 0.1999374926 0.1949999928 0.1904453039 0.185937494 0.1817109436 0.1780000031 0.1754062474 0.1736250073 0.1715312451 0.1679999977 0.1620937437 0.1546249986 0.147093758 0.1410000026 0.1372031271 0.1347499937 0.1324218661 0.1289999932 0.1237656176 0.1174999923 0.1112343743 0.1059999987 0.1021796837 0.09918750077 0.09660156071 0.09399999678 0.09089062363 0.0876249969 0.0850468725 0.08399999887 0.08524999768 0.0882499963 0.09187500179 0.09499999881 0.09706249833 0.09875000268 0.1008125022 0.1040000021 0.1084140688 0.1136875004 0.1198671907 0.1270000041 0.1355390698 0.145312503 0.1554296911 0.1650000066 0.1739453226 0.1826875061 0.1910859346 0.199000001 0.2061250061 0.2126249969 0.2190624923 0.2259999961 0.2338827997 0.2423124909 0.2505859137 0.2579999864 0.2642968595 0.26987499 0.2750156224 0.2800000012 0.2847812474 0.2892500162 0.2935937643 0.2980000079 0.3025000095 0.3070000112 0.3115000129 0.3160000145}
    alpha {}}
  name ColorLookup5
  label "Pointer's Gamut Boundary Yxy\ninterpolated: incr 50 - 0 to 8000"
  xpos -1360
  ypos -775
 }
 Multiply {
  channels rgb
  value {0.31 1 1 1}
  name Multiply2
  label "dim boundary"
  xpos -1360
  ypos -725
 }
 Colorspace {
  colorspace_in CIE-Yxy
  primary_in "Adobe (1998)"
  colorspace_out CIE-XYZ
  name Colorspace5
  label "\[value colorspace_in] -> \[value colorspace_out]"
  xpos -1360
  ypos -688
 }
 Fill {
  output alpha
  name Fill4
  xpos -1360
  ypos -639
 }
 BlackOutside {
  name BlackOutside1
  xpos -1360
  ypos -562
 }
 Position {
  translate {6 {ReformatBox4.box_width-input.width}}
  name Position1
  xpos -1360
  ypos -538
 }
 Dot {
  name Dot24
  xpos -1326
  ypos -486
 }
push $N97134800
 Reformat {
  type "to box"
  box_width {{parent.Reformat1.box_width}}
  box_height 100
  box_fixed true
  name ReformatBox2
  xpos -1140
  ypos -994
 }
 Expression {
  temp_name0 n
  temp_expr0 input.width/8
  channel0 {rgba.red rgba.green rgba.blue none}
  expr0 x/width*(1-y/height)
  channel3 alpha
  expr3 1
  name Expression1
  xpos -1140
  ypos -898
 }
set N970e0400 [stack 0]
 Dot {
  name Dot8
  xpos -996
  ypos -894
 }
 ColorLookup {
  lut {master {curve L 0 s0 t0.9499999881 C k x0.308139503 1 s0}
    red {}
    green {}
    blue {}
    alpha {}}
  name ColorLookup1
  xpos -1030
  ypos -849
 }
 Dot {
  name Dot14
  xpos -996
  ypos -750
 }
push $N970e0400
 Multiply {
  channels rgb
  value 269
  name Multiply5
  label "\[value value]"
  xpos -1140
  ypos -856
 }
 ColorLookup {
  lut {master {}
    red {curve C 1.8783474 1.85965741 1.8410753 1.82260251 1.80424976 1.78602886 1.76794314 1.75000143 1.73221421 1.71458244 1.69711792 1.67982578 1.66271067 1.6457777 1.62903571 1.6124835 1.59613538 1.57998943 1.56404996 1.54832447 1.5328095 1.51751649 1.50244594 1.48759735 1.47297573 1.45858264 1.44442391 1.43049574 1.41680288 1.40334678 1.39012623 1.37714779 1.36440396 1.35190022 1.33963728 1.32761216 1.31582856 1.30428183 1.29297352 1.28190565 1.27107596 1.2604804 1.25012183 1.23999798 1.23010659 1.22044563 1.21101499 1.20181489 1.19284034 1.18408906 1.17556167 1.16725397 1.15916491 1.15129638 1.14363372 1.13618886 1.12895167 1.12192106 1.11509454 1.10846853 1.10204577 1.09580922 1.08977199 1.08392429 1.07826447 1.07278681 1.06749392 1.06237841 1.05743873 1.05267084 1.04807138 1.04364109 1.03937256 1.03526449 1.03131545 1.02751946 1.02387333 1.02037668 1.01702523 1.01381445 1.01074362 1.00780725 1.00500631 1.00233305 0.99978602 0.99736285 0.9950608 0.99287677 0.99080539 0.98884678 0.98699367 0.9852494 0.98361033 0.98206747 0.98062134 0.97926998 0.97800934 0.97683728 0.97575116 0.97474778 0.97382426 0.97297859 0.97220623 0.97150886 0.97087657 0.97031689 0.96981871 0.96938527 0.96900952 0.96869147 0.96842706 0.96821606 0.96805781 0.96794283 0.96787858 0.96785843 0.96787864 0.96793604 0.96803701 0.96817231 0.96833968 0.96854311 0.96877253 0.96903455 0.96932232 0.96963543 0.96997368 0.97033387 0.97071254 0.9711163 0.97153723 0.97197378 0.97242606 0.97289121 0.97337079 0.97386622 0.97437072 0.97488332 0.97540969 0.97594237 0.97647977 0.97702706 0.97757769 0.97813445 0.97869468 0.97925854 0.97982538 0.98039114 0.98096472 0.98153675 0.98210776 0.98267955 0.98325121 0.98382008 0.98438704 0.9849571 0.98552132 0.98608243 0.98664182 0.98719966 0.98775077 0.98829895 0.98884273 0.98938417 0.98991877 0.9904511 0.99097681 0.99149919 0.99201453 0.99252397 0.99303031 0.99353105 0.99402624 0.99451613 0.99499857 0.99547589 0.99594522 0.99641174 0.99687338 0.99732745 0.99777603 0.9982177 0.99865389 0.999084 0.99950838 0.99992663 1.00033772 1.00074494 1.00114489 1.00153947 1.00192833 1.00231075 1.00268865 1.00305855 1.00342607 1.00378489 1.00413895 1.00448751 1.00483036 1.00517035 1.00550389 1.00583148 1.00615203 1.00646758 1.00678015 1.00708604 1.00738645 1.00768471 1.00797844 1.0082655 1.00854778 1.00882483 1.00909901 1.00936711 1.00963116 1.00989032 1.0101465 1.01039672 1.01064491 1.01088691 1.0111258 1.01135957 1.01158977 1.01181614 1.01203847 1.01225793 1.01247287 1.01268291 1.01289058 1.01309609 1.01329684 1.01349473 1.0136888 1.0138787 1.01406395 1.01424909 1.01442885 1.01460576 1.01478052 1.01495218 1.01512218 1.01528883 1.01545072 1.01561022 1.01576698 1.01592219 1.01607502 1.01622343 1.01636875 1.0165143 1.01665616 1.01679492 1.0169313 1.01706588 1.01719737 1.01732695 1.01745498 1.01757956 1.01770294 1.01782393 1.01794255 1.0180583 1.01817465 1.01828551 1.01839495 1.01850486 1.01861191 1.01871693 1.01882088 1.01891339}
    green {curve C 1}
    blue {curve C 0.00879261 0.00962762 0.010532 0.01151017 0.01256675 0.01370643 0.01493413 0.01625487 0.01767381 0.01919618 0.02082733 0.02257277 0.02443803 0.02642871 0.02855051 0.03080913 0.0332104 0.0357601 0.03846392 0.04132775 0.04435719 0.04755813 0.05093599 0.05449668 0.0582453 0.0621875 0.06632853 0.07067341 0.07522713 0.07999477 0.08498063 0.09018957 0.09562518 0.10129225 0.10719412 0.11333443 0.11971687 0.12634411 0.133219 0.14034435 0.14772213 0.15535444 0.16324303 0.17138906 0.179794 0.18845794 0.197382 0.20656651 0.21601067 0.22571453 0.23567709 0.24589771 0.25637382 0.26710594 0.2780903 0.28932518 0.30080822 0.3125369 0.32450783 0.33671761 0.34916404 0.36183971 0.37474373 0.38787127 0.40121818 0.41477671 0.42854655 0.44251823 0.45668846 0.47105014 0.48559928 0.50033116 0.5152359 0.5303098 0.5455451 0.56093836 0.5764783 0.59215891 0.60797763 0.62392306 0.63999057 0.65616876 0.6724565 0.68884456 0.70532417 0.72188419 0.73852479 0.7552371 0.77200818 0.78883314 0.80570388 0.82261622 0.83956301 0.8565321 0.87351894 0.89051074 0.90751225 0.92450547 0.94148719 0.95845115 0.97538745 0.99229181 1.00915313 1.02597356 1.04273522 1.05944169 1.07608175 1.09265125 1.10914159 1.12555146 1.14187002 1.15809321 1.1742171 1.190238 1.20614767 1.22194457 1.23762202 1.2531724 1.26859927 1.28389311 1.29905295 1.31407428 1.32895291 1.34368753 1.35827363 1.3727088 1.38699389 1.40111876 1.41508293 1.42889357 1.44254065 1.45602405 1.46934104 1.48249614 1.49548101 1.50830269 1.5209527 1.53343177 1.54574537 1.5578897 1.56985986 1.5816654 1.59329891 1.60476208 1.61605716 1.62718153 1.63813758 1.64892519 1.65955138 1.67000985 1.68030369 1.69043732 1.70040607 1.71021223 1.71985734 1.72934508 1.73867714 1.74785423 1.75688136 1.76575518 1.77447391 1.78304338 1.79146802 1.79975164 1.80788386 1.81587982 1.82373333 1.83144975 1.83902776 1.84647095 1.85378456 1.86096811 1.86802399 1.87495112 1.88175035 1.88842535 1.89497983 1.90141833 1.90774179 1.91394711 1.92004013 1.92602086 1.93188739 1.93765306 1.94330883 1.94886208 1.95430994 1.95965815 1.96490622 1.97005856 1.97511387 1.98007631 1.98494554 1.98972344 1.99441445 1.99901712 2.00353193 2.00796437 2.01231384 2.01658392 2.02076721 2.02487659 2.02890825 2.03286695 2.03675175 2.04056406 2.04430199 2.04797506 2.05157685 2.05511236 2.0585804 2.06198287 2.06532407 2.06860161 2.07181907 2.07497644 2.07807779 2.0811162 2.08409977 2.08702946 2.08990335 2.09272337 2.09549189 2.0982089 2.10087585 2.10349345 2.10606146 2.1085825 2.11105394 2.11348104 2.11586332 2.11820364 2.12050176 2.12275648 2.12496805 2.127141 2.12927723 2.13136625 2.13341999 2.13543844 2.13741732 2.13936305 2.1412704 2.1431427 2.14498401 2.14678812 2.14856291 2.1503005 2.15200949 2.15368938 2.15533352 2.15695238 2.15853977 2.16009951 2.16162968 2.16313291 2.16460824 2.16605687 2.16747928 2.16887903 2.17024994 2.1715951 2.17291784 2.17421341 2.17548871 2.17674041 2.17797112 2.17918396 2.18036819 2.18143296}
    alpha {}}
  name ColorLookup3
  label "Planckian Locus 0-269"
  xpos -1140
  ypos -808
 }
 Multiply {
  inputs 1+1
  channels rgb
  value 0
  maskChannelMask rgba.red
  invert_mask true
  name Multiply3
  label dim
  xpos -1140
  ypos -760
 }
 BlackOutside {
  name BlackOutside6
  xpos -1140
  ypos -706
 }
 Position {
  translate {6 {parent.Position2.translate.y-input.height}}
  name Position8
  xpos -1140
  ypos -682
 }
 Dot {
  name Dot28
  xpos -1106
  ypos -654
 }
push $N97134c00
 Dot {
  name Dot4
  xpos -886
  ypos -1086
 }
set N4d005800 [stack 0]
 Rectangle {
  replace true
  area {0 0 6 {height}}
  name Rectangle1
  xpos -810
  ypos -1089
 }
 BlackOutside {
  name BlackOutside5
  xpos -810
  ypos -1041
 }
push $N4d005800
 Radial {
  inputs 1+1
  replace true
  area {-5422 -3542 7470 5590}
  softness 0
  ramp linear
  color {0.0719 0.02604 0.0001 1}
  p1 {0 0}
  color0 {0.039378 0.001097 0.188331 1}
  p0 {0 2048}
  name Radial1
  xpos -920
  ypos -1041
 }
 Dot {
  name Dot9
  xpos -886
  ypos -894
 }
push $N97135000
 Gamma {
  channels rgba
  value 0.5
  name Gamma2
  xpos -700
  ypos -1120
 }
 Expression {
  temp_name0 start
  temp_expr0 360
  temp_name1 end
  temp_expr1 830
  channel0 {rgba.red rgba.green rgba.blue none}
  expr0 r*(end-start)+start
  channel1 none
  channel2 none
  expr3 1
  name Expression2
  label "360nm to 830nm"
  xpos -700
  ypos -1096
 }
 ColorLookup {
  lut {master {}
    red {curve x360 0.0001299 C 0.00014585 0.0001638 0.000184 0.00020669 0.0002321 0.00026073 0.00029307 0.00032939 0.00036991 0.0004149 0.00046416 0.00051899 0.00058185 0.00065523 0.0007416 0.00084503 0.00096453 0.00109495 0.00123115 0.001368 0.00150205 0.00164233 0.00180238 0.00199576 0.002236 0.00253539 0.0028926 0.00330083 0.00375324 0.004243 0.00476239 0.00533005 0.00597871 0.00674112 0.00765 0.00875137 0.01002888 0.0114217 0.01286901 0.01431 0.01570443 0.01714744 0.01878122 0.02074801 0.02319 0.02620736 0.02978248 0.03388092 0.03846824 0.04351 0.0489956 0.0550226 0.0617188 0.069212 0.07763 0.08695811 0.09717672 0.1084063 0.1207672 0.13438 0.1493582 0.16539571 0.1819831 0.19861101 0.21477 0.23018681 0.24487969 0.25877729 0.27180791 0.28389999 0.29494381 0.3048965 0.31378731 0.32164541 0.3285 0.3343513 0.33921009 0.34312129 0.3461296 0.34828001 0.3495999 0.3501474 0.35001299 0.349287 0.34806001 0.34637329 0.34426239 0.3418088 0.3390941 0.3362 0.33319771 0.33004111 0.32663569 0.32288679 0.31869999 0.3140251 0.30888399 0.3032904 0.2972579 0.29080001 0.28397009 0.27672139 0.2689178 0.26042271 0.2511 0.2408475 0.2298512 0.2184072 0.2068115 0.19536 0.18421359 0.1733273 0.16268811 0.1522833 0.14210001 0.1321786 0.1225696 0.1132752 0.1042979 0.09564 0.08729955 0.07930804 0.07171776 0.06458099 0.05795001 0.05186211 0.04628152 0.04115088 0.03641283 0.03201 0.0279172 0.0241444 0.020687 0.0175404 0.0147 0.01216179 0.00991996 0.00796724 0.00629635 0.0049 0.00377717 0.00294532 0.00242488 0.00223629 0.0024 0.00292552 0.00383656 0.00517484 0.00698208 0.0093 0.01214949 0.01553588 0.01947752 0.02399277 0.0291 0.03481485 0.04112016 0.04798504 0.05537861 0.06327 0.07163501 0.08046224 0.08973996 0.09945645 0.1096 0.1201674 0.1311145 0.1423679 0.15385421 0.1655 0.17725711 0.18914001 0.2011694 0.21336579 0.2257499 0.2383209 0.2510668 0.26399219 0.2771017 0.2904 0.30389121 0.31757259 0.33143839 0.3454828 0.35969999 0.37408391 0.3886396 0.4033784 0.41831151 0.43344989 0.44879529 0.46433601 0.480064 0.49597129 0.51205009 0.52829587 0.54469162 0.56120938 0.57782149 0.59450001 0.6112209 0.62797582 0.64476019 0.66156971 0.67839998 0.69523919 0.7120586 0.72882837 0.7455188 0.76209998 0.77854317 0.79482561 0.81092638 0.82682478 0.84249997 0.85793251 0.87308162 0.88789439 0.90231812 0.9163 0.9297995 0.94279838 0.95527762 0.96721792 0.97860003 0.9893856 0.99954879 1.00908923 1.01800644 1.02629995 1.03398275 1.04098594 1.04718804 1.05246675 1.05669999 1.05979443 1.06179917 1.06280684 1.0629096 1.06219995 1.06073523 1.05844355 1.05522442 1.05097675 1.04560006 1.03903687 1.03136074 1.02266622 1.0130477 1.00259995 0.99136752 0.97933137 0.96649158 0.9528479 0.93839997 0.92319399 0.90724403 0.89050198 0.87291998 0.85444993 0.83508402 0.814946 0.794186 0.77295399 0.75139999 0.72958362 0.70758879 0.68560219 0.66381037 0.64240003 0.62151492 0.6011138 0.58110517 0.56139767 0.54189998 0.52259952 0.50354642 0.4847436 0.46619391 0.4479 0.42986131 0.41209799 0.39464399 0.37753329 0.3608 0.34445629 0.32851681 0.31301919 0.29800111 0.28349999 0.26954481 0.25611839 0.2431896 0.2307272 0.21870001 0.2070971 0.19592319 0.1851708 0.1748323 0.1649 0.1553667 0.14623 0.13749 0.1291467 0.1212 0.1136397 0.106465 0.09969044 0.09333061 0.0874 0.08190096 0.07680428 0.07207712 0.06768664 0.0636 0.05980685 0.05628216 0.05297104 0.04981861 0.04677 0.04378405 0.04087536 0.03807264 0.03540461 0.0329 0.03056419 0.02838056 0.02634484 0.02445275 0.0227 0.02108429 0.01959988 0.01823732 0.01698717 0.01584 0.01479064 0.01383132 0.01294868 0.0121292 0.01135916 0.01062935 0.00993885 0.00928842 0.00867885 0.00811092 0.00758239 0.00708875 0.00662731 0.00619541 0.00579035 0.00540983 0.00505258 0.00471751 0.00440351 0.00410946 0.00383391 0.00357575 0.00333434 0.00310907 0.00289933 0.00270435 0.00252302 0.00235417 0.00219662 0.00204919 0.00191096 0.00178144 0.00166011 0.00154646 0.00143997 0.00134004 0.00124628 0.00115847 0.00107643 0.00099995 0.00092874 0.00086243 0.00080075 0.0007434 0.00069008 0.00064052 0.0005945 0.00055186 0.00051243 0.00047602 0.00044245 0.00041151 0.00038298 0.00035665 0.0003323 0.00030976 0.00028889 0.00026954 0.00025157 0.00023483 0.00021917 0.00020453 0.00019084 0.00017807 0.00016615 0.00015502 0.00014462 0.00013491 0.00012585 0.00011741 0.00010955 0.00010222 9.539e-05 8.902e-05 8.308e-05 7.751e-05 7.231e-05 6.746e-05 6.293e-05 5.871e-05 5.477e-05 5.11e-05 4.768e-05 4.449e-05 4.151e-05 3.873e-05 3.614e-05 3.372e-05 3.146e-05 2.935e-05 2.738e-05 2.552e-05 2.379e-05 2.218e-05 2.067e-05 1.927e-05 1.797e-05 1.675e-05 1.562e-05 1.456e-05 1.357e-05 1.265e-05 1.18e-05 1.1e-05 1.025e-05 9.56e-06 8.91e-06 8.31e-06 7.75e-06 7.22e-06 6.73e-06 6.28e-06 5.85e-06 5.46e-06 5.09e-06 4.74e-06 4.42e-06 4.12e-06 3.84e-06 3.58e-06 3.34e-06 3.11e-06 2.9e-06 2.71e-06 2.52e-06 2.35e-06 2.19e-06 2.04e-06 1.91e-06 1.78e-06 1.66e-06 1.54e-06 1.44e-06 1.34e-06 S 1.25e-06}
    green {curve x360 3.92e-06 C 4.39e-06 4.93e-06 5.53e-06 6.21e-06 6.97e-06 7.81e-06 8.77e-06 9.84e-06 1.104e-05 1.239e-05 1.389e-05 1.556e-05 1.744e-05 1.958e-05 2.202e-05 2.484e-05 2.804e-05 3.153e-05 3.522e-05 3.9e-05 4.283e-05 4.691e-05 5.159e-05 5.718e-05 6.4e-05 7.234e-05 8.221e-05 9.351e-05 0.00010614 0.00012 0.00013498 0.00015149 0.00017021 0.00019182 0.000217 0.00024691 0.00028124 0.00031852 0.00035727 0.000396 0.00043371 0.00047302 0.00051788 0.00057222 0.00064 0.00072456 0.0008255 0.00094116 0.00106988 0.00121 0.00136209 0.00153075 0.00172037 0.00193532 0.00218 0.0024548 0.002764 0.0031178 0.0035264 0.004 0.00454624 0.00515932 0.00582928 0.00654616 0.0073 0.00808651 0.00890872 0.00976768 0.01066443 0.0116 0.01257317 0.01358272 0.01462968 0.01571509 0.01684 0.01800736 0.01921448 0.02045392 0.02171824 0.023 0.02429461 0.02561024 0.02695857 0.02835125 0.0298 0.03131083 0.03288368 0.03452112 0.03622571 0.038 0.03984667 0.041768 0.043766 0.04584267 0.048 0.05024368 0.05257304 0.05498056 0.05745872 0.06 0.06260197 0.06527752 0.06804208 0.07091109 0.0739 0.077016 0.0802664 0.0836668 0.0872328 0.09098 0.09491755 0.09904584 0.1033674 0.1078846 0.1126 0.117532 0.1226744 0.12799279 0.1334528 0.13902 0.1446764 0.1504693 0.15646189 0.1627177 0.1693 0.1762431 0.18355811 0.1912735 0.19941799 0.20802 0.2171199 0.2267345 0.2368571 0.2474812 0.2586 0.2701849 0.28229389 0.2950505 0.30857801 0.32300001 0.33840209 0.35468581 0.37169859 0.3892875 0.4073 0.42562991 0.44430959 0.4633944 0.48293951 0.50300002 0.52356929 0.54451197 0.56568998 0.58696532 0.60820001 0.6293456 0.65030682 0.67087519 0.69084239 0.70999998 0.72818518 0.74546361 0.76196939 0.7778368 0.79320002 0.80811042 0.82249618 0.83630681 0.8494916 0.86199999 0.87381083 0.88496238 0.89549363 0.90544319 0.91485012 0.92373478 0.93209243 0.93992257 0.94722521 0.954 0.9602561 0.96600741 0.97126061 0.97602248 0.98030001 0.98409241 0.98741817 0.99031281 0.99281162 0.99495012 0.99671078 0.99809831 0.99911201 0.99974817 1 0.99985671 0.99930459 0.99832553 0.99689871 0.995 0.9926005 0.98974258 0.98644441 0.98272407 0.97860003 0.97408372 0.96917123 0.96385682 0.95813489 0.95200002 0.94545043 0.93849921 0.93116277 0.92345762 0.91540003 0.90700638 0.89827722 0.8892048 0.8797816 0.87 0.85986131 0.849392 0.83862197 0.82758129 0.81629997 0.80479473 0.793082 0.781192 0.76915473 0.75700003 0.74475408 0.73242241 0.7200036 0.70749652 0.69489998 0.68221921 0.66947162 0.65667439 0.64384478 0.63099998 0.61815548 0.60531437 0.59247559 0.57963789 0.5668 0.5539611 0.54113722 0.5283528 0.51563227 0.50300002 0.4904688 0.47803041 0.46567759 0.4534032 0.44119999 0.42908001 0.417036 0.40503201 0.39303201 0.38100001 0.36891839 0.3568272 0.34477681 0.33281761 0.32100001 0.30933809 0.2978504 0.28659359 0.27562451 0.26499999 0.25476319 0.2448896 0.2353344 0.22605281 0.21699999 0.20816161 0.1995488 0.1911552 0.1829744 0.175 0.1672235 0.15964641 0.1522776 0.1451259 0.1382 0.1315003 0.1250248 0.1187792 0.1127691 0.107 0.1014762 0.09618864 0.09112296 0.08626485 0.0816 0.07712064 0.07282552 0.06871008 0.06476976 0.061 0.05739621 0.05395504 0.05067376 0.04754965 0.04458 0.04175872 0.03908496 0.03656384 0.03420048 0.032 0.02996261 0.02807664 0.02632936 0.02470805 0.0232 0.02180077 0.02050112 0.01928108 0.01812069 0.017 0.01590379 0.01483718 0.01381068 0.01283478 0.01192 0.01106831 0.01027339 0.00953331 0.00884616 0.00821 0.00762378 0.00708542 0.00659148 0.00613848 0.005723 0.00534306 0.0049958 0.0046764 0.00438007 0.004102 0.00383845 0.0035891 0.00335422 0.00313409 0.002929 0.00273814 0.00255988 0.00239324 0.00223728 0.002091 0.00195359 0.00182458 0.00170358 0.00159019 0.001484 0.0013845 0.00129127 0.00120409 0.00112274 0.001047 0.00097659 0.00091111 0.00085013 0.00079324 0.00074 0.00069008 0.00064331 0.0005995 0.00055845 0.00052 0.00048391 0.00045005 0.00041835 0.00038872 0.0003611 0.00033538 0.00031144 0.00028917 0.00026845 0.0002492 0.0002313 0.00021469 0.00019929 0.00018505 0.0001719 0.00015978 0.0001486 0.0001383 0.00012879 0.00012 0.00011186 0.00010432 9.734e-05 9.085e-05 8.48e-05 7.915e-05 7.386e-05 6.892e-05 6.43e-05 6e-05 5.598e-05 5.223e-05 4.872e-05 4.545e-05 4.24e-05 3.956e-05 3.692e-05 3.445e-05 3.215e-05 3e-05 2.799e-05 2.611e-05 2.436e-05 2.272e-05 2.12e-05 1.978e-05 1.845e-05 1.722e-05 1.606e-05 1.499e-05 1.399e-05 1.305e-05 1.218e-05 1.136e-05 1.06e-05 9.89e-06 9.22e-06 8.59e-06 8.01e-06 7.47e-06 6.96e-06 6.49e-06 6.05e-06 5.64e-06 5.26e-06 4.9e-06 4.57e-06 4.26e-06 3.97e-06 3.7e-06 3.45e-06 3.22e-06 3e-06 2.8e-06 2.61e-06 2.43e-06 2.27e-06 2.11e-06 1.97e-06 1.84e-06 1.71e-06 1.6e-06 1.49e-06 1.39e-06 1.29e-06 1.21e-06 1.12e-06 1.05e-06 9.8e-07 9.1e-07 8.5e-07 7.9e-07 7.4e-07 6.9e-07 6.4e-07 6e-07 5.6e-07 5.2e-07 4.8e-07 S 4.5e-07}
    blue {curve x360 0.0006061 C 0.00068088 0.00076515 0.00086001 0.00096659 0.001086 0.00122059 0.00137273 0.00154358 0.00173429 0.001946 0.00217778 0.00243581 0.00273195 0.00307806 0.003486 0.00397523 0.00454088 0.00515832 0.00580291 0.00645 0.00708322 0.00774549 0.00850115 0.00941454 0.01054999 0.0119658 0.01365587 0.01558805 0.01773015 0.02005001 0.02251136 0.02520288 0.02827972 0.03189704 0.03621 0.04143771 0.04750372 0.05411988 0.06099803 0.06785001 0.07448632 0.08136156 0.08915364 0.09854048 0.1102 0.1246133 0.1417017 0.16130351 0.1832568 0.20739999 0.23369209 0.26261139 0.29477459 0.33079851 0.37130001 0.4162091 0.4654642 0.51969481 0.5795303 0.64560002 0.71848381 0.79671329 0.87784588 0.95943898 1.0390501 1.11536729 1.18849707 1.25812328 1.32392955 1.38559997 1.44263518 1.49480355 1.54219031 1.58488071 1.62295997 1.65640485 1.68529594 1.70987451 1.73038209 1.74705994 1.76004458 1.76962328 1.77626371 1.78043342 1.78260004 1.78296816 1.78169978 1.77919817 1.7758671 1.77210998 1.76825893 1.76403904 1.7589438 1.75246632 1.74409997 1.73355949 1.7208581 1.70593691 1.68873715 1.66919994 1.64752865 1.62341273 1.59602225 1.56452799 1.52810001 1.4861114 1.43952155 1.38987994 1.33873618 1.28763998 1.23742235 1.18782425 1.13876104 1.09014797 1.04190004 0.99419761 0.94734728 0.90145308 0.8566193 0.81295007 0.77051729 0.7294448 0.68991357 0.65210491 0.61619997 0.58232862 0.55041617 0.52033758 0.49196729 0.46518001 0.4399246 0.41618359 0.39388219 0.3729459 0.35330001 0.33485779 0.31755209 0.30133751 0.28616861 0.27200001 0.25881711 0.2464838 0.2347718 0.2234533 0.2123 0.20116919 0.19011959 0.1792254 0.1685608 0.1582 0.1481383 0.1383758 0.1289942 0.1200751 0.1117 0.1039048 0.09666748 0.08998272 0.08384531 0.07824999 0.07320899 0.06867816 0.06456784 0.06078835 0.05725001 0.05390435 0.05074664 0.04775276 0.04489859 0.04216 0.03950728 0.03693564 0.03445836 0.03208872 0.02984 0.02771181 0.02569444 0.02378716 0.02198925 0.0203 0.01871805 0.01724036 0.01586364 0.01458461 0.0134 0.01230723 0.01130188 0.01037792 0.00952931 0.00875 0.0080352 0.0073816 0.0067854 0.0062428 0.00575 0.0053036 0.0048998 0.0045342 0.0042024 0.0039 0.0036232 0.0033706 0.0031414 0.0029348 0.00275 0.0025852 0.0024386 0.0023094 0.0021968 0.0021 0.00201773 0.0019482 0.0018898 0.00184093 0.0018 0.00176627 0.0017378 0.0017112 0.00168307 0.00165 0.00161013 0.0015644 0.0015136 0.00145853 0.0014 0.00133667 0.00127 0.001205 0.00114667 0.0011 0.0010688 0.0010494 0.0010356 0.0010212 0.001 0.00096864 0.00092992 0.00088688 0.00084256 0.0008 0.00076096 0.00072368 0.00068592 0.00064544 0.0006 0.00054787 0.0004916 0.0004354 0.00038347 0.00034 0.00030725 0.00028316 0.00026544 0.00025181 0.00024 0.00022955 0.00022064 0.00021196 0.00020219 0.00019 0.00017421 0.00015564 0.00013596 0.00011685 0.0001 8.613e-05 7.46e-05 6.5e-05 5.693e-05 5e-05 4.416e-05 3.948e-05 3.572e-05 3.264e-05 3e-05 2.765e-05 2.556e-05 2.364e-05 2.181e-05 2e-05 1.813e-05 1.62e-05 1.42e-05 1.213e-05 1e-05 7.73e-06 5.4e-06 3.2e-06 1.33e-06 0 0 0 0 0 0 0 0 S 0}
    alpha {}}
  name ColorLookup4
  label "CIE 1931 2 Degree Standard Observer\n360nm to 830nm"
  xpos -700
  ypos -1030
 }
 Merge2 {
  inputs 2
  bbox B
  name MergeLineOfPurples
  xpos -700
  ypos -897
  disable {{!parent.draw_line_of_purples}}
 }
 Fill {
  color {0 0 0 1}
  name Disable_SpectralLocus
  xpos -700
  ypos -826
  disable {{parent.draw_spectral_locus}}
 }
 Merge2 {
  inputs 2
  bbox B
  name MergePlanckianLocus
  xpos -700
  ypos -658
  disable {{!parent.draw_planckian_locus}}
 }
 Merge2 {
  inputs 2
  bbox B
  name MergePointerGamut
  xpos -700
  ypos -489
  disable {{!parent.draw_pointers_gamut}}
 }
 Merge2 {
  inputs 2
  bbox B
  name MergePointerGamut_Samples
  xpos -700
  ypos -417
  disable {{!draw_pointers_samples}}
 }
 Merge2 {
  inputs 2
  bbox B
  name MergeMacbeth
  xpos -700
  ypos -273
  disable {{!parent.draw_macbeth_chart}}
 }
 Merge2 {
  inputs 2
  bbox B
  name MergeGamutGrid
  xpos -700
  ypos -81
  disable {{!parent.gamut_grid}}
 }
 Merge2 {
  inputs 2
  bbox B
  name MergeGamutA
  xpos -700
  ypos 255
  disable {{!parent.gamut_a}}
 }
 Merge2 {
  inputs 2
  bbox B
  name MergeGamutB
  xpos -700
  ypos 279
  disable {{!parent.gamut_b}}
 }
 Merge2 {
  inputs 2
  bbox B
  name MergeGamutC
  xpos -700
  ypos 303
  disable {{!parent.gamut_c}}
 }
 Dot {
  name Dot2
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -666
  ypos 450
 }
set N4cfb0c00 [stack 0]
 Dot {
  name Dot5
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -556
  ypos 450
 }
 Colorspace {
  colorspace_in CIE-XYZ
  primary_in "Adobe (1998)"
  colorspace_out CIE-Yxy
  name Colorspace6
  label "\[value colorspace_in] -> \[value colorspace_out]"
  xpos -590
  ypos 488
 }
 Expression {
  expr0 r
  expr1 "4*g / ( -2*g + 12*b + 3)"
  expr2 "9*b / ( -2*g + 12*b + 3)"
  name Expression5
  label "CIE Yxy to CIELuv"
  xpos -590
  ypos 536
  disable {{!parent.diagram}}
 }
 Dot {
  name Dot11
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -556
  ypos 618
 }
push $N4cfb0c00
 ColorMatrix {
  matrix {
      {{parent.GamutToXYZ.ColorMatrix.matrix} {parent.GamutToXYZ.ColorMatrix.matrix} {parent.GamutToXYZ.ColorMatrix.matrix}}
      {{parent.GamutToXYZ.ColorMatrix.matrix} {parent.GamutToXYZ.ColorMatrix.matrix} {parent.GamutToXYZ.ColorMatrix.matrix}}
      {{parent.GamutToXYZ.ColorMatrix.matrix} {parent.GamutToXYZ.ColorMatrix.matrix} {parent.GamutToXYZ.ColorMatrix.matrix}}
    }
  invert true
  name ColorMatrix1
  label "XYZ to working"
  xpos -700
  ypos 488
  disable {{!map_overlays_to_input_gamut}}
 }
 BlinkScript {
  inputs 2
  KernelDescription "2 \"PlotChromaticity_grid\" iterate pixelWise b2e7b5f8a89bdb0629aa8cc2eae387ef3436f24cb0af642eeba41235874506c4 3 \"col\" Read Random \"Yxy\" Read Random \"dst\" Write Random 6 \"padding\" Float 1 AAAAAA== \"left_margin\" Float 1 AAAAAA== \"tolerance\" Float 1 AAAAAA== \"antialias\" Bool 1 AA== \"draw_axes\" Bool 1 AA== \"grid_color\" Float 4 AAAAAAAAAAAAAAAAAAAAAA== 6 \"padding\" 1 1 \"left_margin\" 1 1 \"tolerance\" 1 1 \"antialias\" 1 1 \"draw_axes\" 1 1 \"grid_color\" 4 1 2 \"outsize\" Float 1 1 AAAAAA== \"offset\" Float 1 1 AAAAAA=="
  kernelSource "kernel PlotChromaticity_grid : public ImageComputationKernel<ePixelWise>\n\{\n  Image<eRead, eAccessRandom, eEdgeClamped> col;\n  Image<eRead, eAccessRandom, eEdgeClamped> Yxy;\n  Image<eWrite, eAccessRandom> dst;\n\nparam:\n  float padding;\n  float left_margin;\n  float tolerance;\n  bool antialias;\n  bool draw_axes;\n  float4 grid_color;\n\nlocal:\n  float outsize;\n  float offset;\n\n  void init() \{\n    // calculate output width and height and offset based on padding\n    outsize = float(dst.bounds.height()/padding);\n    // xy offset for margin on lower left corner\n    offset = dst.bounds.height()*left_margin;\n  \}\n\n  float gaussian(float d, float a, float expv) \{\n    return max(0.0f, exp(-a*d*d)-expv);\n  \}\n\n  float gaussian_filter(float x, float y, float r) \{\n    // return gaussian weighted distance from origin (0, 0)\n    // given coordinate (x, y) and radius r\n    float a = 1.5f; // rate falloff\n    float expv = exp(-a*r*r);\n    return gaussian(x, a, expv) * gaussian(y, a, expv);\n  \}\n\n  void write_aa(float x, float y, float4 rgb) \{\n    // skip black pixels\n    if (rgb.x == 0.0f && rgb.y == 0.0f && rgb.z == 0.0f) return;\n    \n    // size of pixel neighborhood = n*2+1 by n*2+1\n    int n = 2;\n\n    // center of neighborhood\n    int u0 = round(x);\n    int v0 = round(y);\n\n    // skip if center pixel weight is greater than tolerance\n    if ( dst.bounds.inside(u0, v0)) \{\n      if (dst(u0, v0, 3) >= tolerance) return;\n    \}\n\n    // loop over neighborhood\n    for (int j = -n; j <= n; j++) \{\n      int v = v0 + j;\n      for (int i = -n; i <= n; i++) \{\n        int u = u0 + i;\n        if ( dst.bounds.inside(u, v)) \{\n          // get filter weight for coord (u,v)\n          float w = gaussian_filter(u-x, v-y, float(n));\n          float4 c0 = dst(u, v); // existing color\n\n          // merge current color sample over existing color sample\n          for (int k=0; k<3; k++) \{\n            dst(u, v, k) = rgb\[k]*w+c0\[k]*(1-w); \n          \}\n\n          // merge current weight over existing weight\n          float w0 = dst(u, v, 3);\n          dst(u, v, 3) = w+w0*(1-w);\n        \}\n      \}\n    \}\n  \}\n\n  void draw_grid() \{\n    // grid width in pixels. expresses a 0 to 1 range in CIE xy\n    float grid_width = 1.0f * outsize + offset;\n    // draw grid lines\n    float i = offset;\n    while (i <= grid_width && i > 0.0f) \{\n      write_aa(offset, i, grid_color);\n      write_aa(i, offset, grid_color);\n      i += 1.0;\n    \}\n    // cross-hatching interval in pixels\n    float hatch_interval = (grid_width - offset) * 0.1f;\n    // cross-hatch length in pixels\n    float hatch_width = outsize * 0.01f;\n    i = offset;\n    while (i <= grid_width) \{\n      i += hatch_interval;\n      float j = 0.0;\n      while (j <= hatch_width/2) \{\n        write_aa(offset+j, i, grid_color);\n        write_aa(offset-j, i, grid_color);\n        write_aa(i, offset+j, grid_color);\n        write_aa(i, offset-j, grid_color);\n        j += 1.0;\n      \}\n    \}\n  \}\n\n  void process(int2 pos) \{\n    float4 rgba = col(pos.x, pos.y);\n    \n    // Get CIE xy position from Yxy input for current pixel\n    float2 xy = float2(Yxy(pos.x, pos.y, 1), Yxy(pos.x, pos.y, 2));\n    \n    // Find output pixel coordinate for this CIE xy pixel value\n    float2 out_coord = float2(xy.x * outsize + offset, xy.y * outsize + offset);\n\n    // For each RGB component, write value from color input to output coordinate\n    if (antialias) \{\n      write_aa(out_coord.x, out_coord.y, rgba);\n    \} else \{\n      // For each RGB component, write value from color input to output coordinate\n      int2 p = int2(round(out_coord.x), round(out_coord.y));\n      if (dst.bounds.inside(p.x, p.y)) \{\n        for (int k=0; k<3; k++) \{\n          dst(p.x, p.y, k) = col(pos.x, pos.y, k);\n        \}\n        dst(p.x, p.y, 3) = 1.0f;\n      \}\n    \}\n\n    // draw CIExy coordinate system axes\n    if (draw_axes && pos.x == 0 && pos.y == 0) \{\n      draw_grid();\n    \}\n  \}\n\};"
  useGPUIfAvailable {{parent.use_gpu}}
  rebuild ""
  PlotChromaticity_grid_padding {{parent.PlotChromaticities.PlotChromaticity_padding}}
  PlotChromaticity_grid_left_margin {{parent.PlotChromaticities.PlotChromaticity_left_margin}}
  PlotChromaticity_grid_tolerance 0.8
  PlotChromaticity_grid_antialias true
  PlotChromaticity_grid_draw_axes {{parent.coordinate_system}}
  PlotChromaticity_grid_grid_color {0.15 0 0.005 1}
  format "2048 2048 0 0 2048 2048 1 square_2K"
  rebuild_finalise ""
  name PlotInput2
  xpos -700
  ypos 608
 }
 FrameHold {
  firstFrame 1
  name FrameHold1
  xpos -700
  ypos 680
  cached true
 }
 Dot {
  name Dot3
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -666
  ypos 762
 }
 Input {
  inputs 0
  name Input
  xpos 620
  ypos -1426
 }
 AddChannels {
  name AddChannels1
  xpos 620
  ypos -1360
 }
 Reformat {
  type "to box"
  box_width {{parent.resolution}}
  box_height {{box_width}}
  box_fixed true
  box_pixel_aspect {{input.pixel_aspect}}
  resize distort
  filter impulse
  name OutputFormat
  xpos 620
  ypos -1282
  disable {{!parent.resample_input}}
 }
 Crop {
  box {0 0 {width} {height}}
  crop false
  name CropBBox
  xpos 620
  ypos -1257
 }
 Dot {
  name Dot7
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 654
  ypos 162
 }
set N4cf41400 [stack 0]
 Constant {
  inputs 0
  channels rgb
  color {0 0 0 1}
  format "256 256 0 0 256 256 1 square_256"
  name Constant2
  xpos 400
  ypos 38
  postage_stamp false
 }
 Reformat {
  type "to box"
  box_width {{parent.resolution}}
  box_height {{box_width}}
  box_fixed true
  box_pixel_aspect {{input.pixel_aspect}}
  resize distort
  filter impulse
  name OutputFormat1
  xpos 400
  ypos 64
  disable {{!parent.resample_input}}
 }
 Switch {
  inputs 2
  which {{"\[exists parent.input0]"}}
  name Switch1
  xpos 400
  ypos 158
 }
 Fill {
  output rgb
  color 0.18
  name SampleColor
  xpos 290
  ypos 158
 }
 Crop {
  box {0 0 {width} {height}}
  crop false
  name Crop2
  xpos 290
  ypos 184
 }
 Fill {
  output alpha
  name Fill3
  xpos 290
  ypos 224
 }
 Dot {
  name Dot6
  xpos 324
  ypos 282
 }
set N4ceeb400 [stack 0]
 ColorMatrix {
  matrix {
      {{parent.GamutToXYZ.ColorMatrix.matrix} {parent.GamutToXYZ.ColorMatrix.matrix} {parent.GamutToXYZ.ColorMatrix.matrix}}
      {{parent.GamutToXYZ.ColorMatrix.matrix} {parent.GamutToXYZ.ColorMatrix.matrix} {parent.GamutToXYZ.ColorMatrix.matrix}}
      {{parent.GamutToXYZ.ColorMatrix.matrix} {parent.GamutToXYZ.ColorMatrix.matrix} {parent.GamutToXYZ.ColorMatrix.matrix}}
    }
  name ColorMatrix4
  label "working to XYZ"
  xpos 180
  ypos 272
 }
 Colorspace {
  colorspace_in CIE-XYZ
  primary_in "Adobe (1998)"
  colorspace_out CIE-Yxy
  name Colorspace1
  label "\[value colorspace_in] -> \[value colorspace_out]"
  xpos 180
  ypos 320
 }
 Expression {
  expr0 r
  expr1 "4*g / ( -2*g + 12*b + 3)"
  expr2 "9*b / ( -2*g + 12*b + 3)"
  name Expression6
  label "CIE Yxy to CIELuv"
  xpos 180
  ypos 368
  disable {{!parent.diagram}}
 }
push $N4ceeb400
 BlinkScript {
  inputs 2
  KernelDescription "2 \"PlotChromaticity_sample\" iterate pixelWise 20e14b615a937bac78c1a771cbdfd10cc7c5fb6c487f65d0bb2d6633e404b958 3 \"col\" Read Random \"Yxy\" Read Random \"dst\" Write Random 3 \"padding\" Float 1 AAAAAA== \"left_margin\" Float 1 AAAAAA== \"tolerance\" Float 1 AAAAAA== 3 \"padding\" 1 1 \"left_margin\" 1 1 \"tolerance\" 1 1 2 \"outsize\" Float 1 1 AAAAAA== \"offset\" Float 1 1 AAAAAA=="
  kernelSource "kernel PlotChromaticity_sample : public ImageComputationKernel<ePixelWise>\n\{\n  Image<eRead, eAccessRandom, eEdgeClamped> col;\n  Image<eRead, eAccessRandom, eEdgeClamped> Yxy;\n  Image<eWrite, eAccessRandom> dst;\n\nparam:\n  float padding;\n  float left_margin;\n  float tolerance;\n\nlocal:\n  float outsize;\n  float offset;\n\n  void init() \{\n    // calculate output width and height and offset based on padding\n    outsize = float(dst.bounds.height()/padding);\n    // xy offset for margin on lower left corner\n    offset = dst.bounds.height()*left_margin;\n  \}\n\n  void process(int2 pos) \{\n    // only process the first pixel\n    if (pos.x > 0 && pos.y > 0) return;\n\n    // Get CIE xy position from Yxy input for current pixel\n    float2 xy = float2(Yxy(pos.x, pos.y, 1), Yxy(pos.x, pos.y, 2));\n    \n    // Find output pixel coordinate for this CIE xy pixel value\n    float2 out_coord = float2(xy.x * outsize + offset, xy.y * outsize + offset);\n\n    // For each RGB component, write value from color input to output coordinate\n    int2 p = int2(round(out_coord.x), round(out_coord.y));\n    if (dst.bounds.inside(p.x, p.y)) \{\n      for (int k=0; k<3; k++) \{\n        dst(p.x, p.y, k) = col(pos.x, pos.y, k);\n      \}\n      dst(p.x, p.y, 3) = 1.0f;\n    \}\n  \}\n\};"
  useGPUIfAvailable {{parent.use_gpu}}
  rebuild ""
  PlotChromaticity_sample_padding {{"parent.diagram ? parent.right_margin*0.8 : parent.right_margin"}}
  PlotChromaticity_sample_left_margin {{parent.left_margin}}
  PlotChromaticity_sample_tolerance 1
  format "2048 2048 0 0 2048 2048 1 square_2K"
  rebuild_finalise ""
  name PlotChromaticities1
  xpos 290
  ypos 368
 }
 Dot {
  name Dot22
  xpos 324
  ypos 450
 }
set N4ceea000 [stack 0]
 Dilate {
  channels rgba
  size {{Output.width/2048}}
  name Dilate1
  label "\[value size]"
  xpos 290
  ypos 488
 }
set N4cee9c00 [stack 0]
 Dilate {
  channels rgba
  size {{Output.width/2048*2}}
  name Dilate2
  label "\[value size]"
  xpos 180
  ypos 488
 }
push $N4ceea000
 Dot {
  name Dot21
  xpos -6
  ypos 450
 }
 FilterErode {
  channels rgba
  size {{-Output.width/2048/5}}
  filter triangle
  name FilterErode1
  label "\[value size]"
  xpos -40
  ypos 489
 }
set N4cee9000 [stack 0]
 Dilate {
  channels rgba
  size {0 {parent.Dilate3.size.w}}
  name Dilate4
  label "\[value size]"
  xpos -40
  ypos 584
 }
push $N4cee9000
 Dilate {
  channels rgba
  size {{Output.width*plus_size/100} 0}
  name Dilate3
  label "\[value size]"
  xpos 70
  ypos 488
  addUserKnob {20 User}
  addUserKnob {7 plus_size R 0 4}
  plus_size 0.8
 }
 Merge2 {
  inputs 2
  operation screen
  bbox B
  name Merge9
  xpos 70
  ypos 591
 }
 Merge2 {
  inputs 2
  operation stencil
  bbox B
  name Merge10
  xpos 180
  ypos 591
 }
 Group {
  name HueRotate
  xpos 180
  ypos 639
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -24
  }
  Unpremult {
   name Unpremult1
   xpos -40
   ypos 15
  }
  Colorspace {
   colorspace_out HSV
   name Colorspace1
   xpos -40
   ypos 72
  }
  Add {
   channels {rgba.red -rgba.green -rgba.blue none}
   value 0.5
   name Add1
   xpos -40
   ypos 111
  }
  Fill {
   output {-rgba.red -rgba.green rgba.blue none}
   name Fill1
   xpos -40
   ypos 147
  }
  Colorspace {
   colorspace_in HSV
   name Colorspace2
   xpos -40
   ypos 183
  }
  Premult {
   name Premult1
   xpos -40
   ypos 231
  }
  Output {
   name Output1
   xpos -40
   ypos 302
  }
 end_group
push $N4cee9c00
 Merge2 {
  inputs 2
  bbox B
  name Merge8
  xpos 290
  ypos 638
 }
 Dot {
  name Dot20
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 324
  ypos 690
 }
push $N4cf41400
 Dot {
  name Dot1
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 764
  ypos 162
 }
 Group {
  name GamutToXYZ
  label "\[if \{\[value invert]\} \{return \"XYZ to \[value gamut]\"\} else \{return \"\[value gamut] to XYZ\"\}]\n\n"
  xpos 730
  ypos 247
  addUserKnob {20 GamutToXYZ_tab l GamutToXYZ}
  addUserKnob {4 gamut t "Choose gamut" M {XYZ ACES ACEScg "Filmlight E-Gamut" Rec709 Rec2020 P3D60 P3D65 P3DCI "Arri AlexaWideGamut" REDDRAGONcolor REDDRAGONcolor2 REDcolor REDcolor2 REDcolor3 REDcolor4 REDWideGamutRGB "GoPro Protune Native" CanonCinemaGamut SonySGamut SonySGamut3Cine PanasonicVGamut "DJI D-Gamut" "Fujifilm F-Gamut" BMDFilmV1 BMD4kFilmV1 BMD4kFilmV3 BMD46kFilmV1 BMD46kFilmV3 BMDWideGamutV4 "AdobeRGB\t" AdobeWideGamutRGB ROMM RIMM ERIMM ProPhotoRGB RusselRGB SharpRGB AppleRGB BestRGB}}
  gamut Rec709
  addUserKnob {6 invert +STARTLINE}
  addUserKnob {26 ""}
  addUserKnob {26 chromaticity_coordinates_label l " " T "<b>Chromaticity Coordinates</b>"}
  addUserKnob {41 rxy T ColorMatrix.rxy}
  addUserKnob {41 gxy T ColorMatrix.gxy}
  addUserKnob {41 bxy T ColorMatrix.bxy}
  addUserKnob {41 wxy T ColorMatrix.wxy}
  addUserKnob {41 matrix T ColorMatrix.matrix}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -10
  }
  ColorMatrix {
   matrix {
       {{curve(which) 1 0.9525524378 0.6624541879 0.7053968906 0.4123907983 0.6369580626 0.5049495697 0.4865709841 0.4451698363 0.6380076408 0.5070186853 0.4462202489 0.4300414324 0.4581649601 0.4878340662 0.4517004192 0.7352752686 0.5022571683 0.7160496712 0.7064827085 0.5990839601 0.6796444654 0.6481720209 0.6369580626 0.6390493512 0.6141571999 0.3724023998 0.60689044 0.4017650783 0.6065810919 0.5766690373 0.7165006995 0.797760427 0.797760427 0.797760427 0.7976718545 0.7015837431 0.8156226277 0.4496616423 0.6318944097} {curve(which) 0 0 0.1340042055 0.1640413404 0.3575843275 0.1446169019 0.2646814585 0.2656676769 0.2771343887 0.2147038579 0.3587769568 0.3157556653 0.3700728714 0.3832037449 0.3432727158 0.3178463876 0.06860940903 0.2929667532 0.1296834797 0.1288010478 0.2489254922 0.1522114277 0.1940581352 0.1446169019 0.1578372866 0.2825684249 0.4324877858 0.2193847299 0.4560420811 0.2203479856 0.1855582297 0.1010205746 0.1351858526 0.1351858526 0.1351858526 0.1351878047 0.1554162204 0.04716260359 0.3162561059 0.2053879201} {curve(which) 0 9.367863095e-05 0.1561876982 0.08101774752 0.180480808 0.1688809693 0.1830150485 0.1982172877 0.1722826511 0.09774444997 0.0868505761 0.190669477 0.152531758 0.1112773567 0.1215386018 0.1830992699 0.1465712637 0.1552320272 0.1047228053 0.1151721701 0.1024464965 0.1186000481 0.108225815 0.1688809693 0.1516760886 0.05183707923 0.1436725408 0.124180764 0.09264881909 0.123526901 0.1882286519 0.1467743814 0.03134934977 0.03134934977 0.03134934977 0.03133957833 0.09979832917 0.1372147948 0.1845382005 0.1270133406}}
       {{curve(which) 0 0.3439664543 0.2722287476 0.2801307142 0.2126390189 0.2627002299 0.237623319 0.2289745659 0.209491685 0.2919537723 0.2207257152 0.1942579001 0.2022213936 0.1694435924 0.2289056629 0.2119505703 0.2866941094 0.1387997568 0.2612613738 0.2709796727 0.2150758505 0.2606855333 0.2830046713 0.2627002299 0.1743051857 0.2365771234 0.1383759677 0.1973138005 0.1721783578 0.2680045366 0.2973450124 0.258728236 0.2880711257 0.2880711257 0.2880711257 0.2880405784 0.3152042925 0.3790788651 0.2446159422 0.2276017666} {curve(which) 1 0.7281661034 0.6740817428 0.8202066422 0.7151686549 0.6779980659 0.6891706586 0.6917385459 0.7215952873 0.8238410354 0.839184761 0.7385566831 0.7585275769 0.8648257852 0.7808576822 0.7230190039 0.8429791331 0.910841465 0.8696421385 0.786606431 0.8850684762 0.7748944759 0.8131960034 0.6779980659 0.951146543 0.8896810412 0.911518693 0.943950057 0.8553914428 0.8326833844 0.6273635626 0.7246823311 0.7118432522 0.7118432522 0.7118432522 0.7118694782 0.6648360491 0.5769088268 0.6720442176 0.7383946776} {curve(which) 0 -0.07213255018 0.05368951708 -0.1003373638 0.07219231874 0.05930171534 0.07320601493 0.07928691059 0.06891305745 -0.1157948226 -0.05991046131 0.06718540192 0.03925102949 -0.03426937759 -0.009763340466 0.06503042579 -0.1296732277 -0.04964122549 -0.1309035122 -0.05758608505 -0.1001443192 -0.03558001295 -0.09620071948 0.05930171534 -0.1254517138 -0.1262581497 -0.04989464581 -0.1412638426 -0.02756982669 -0.1006879359 0.07529145479 0.01658944227 8.565396274e-05 8.565396274e-05 8.565396274e-05 8.991353388e-05 0.01995966583 0.04401229322 0.08333983272 0.0340035744}}
       {{curve(which) 0 -3.863927134e-08 -0.005574660841 -0.1037815213 0.01933082007 0 0 0 0 0.0027982709 -0.0544523783 -0.04792318866 -0.0176958181 -0.1061859056 -0.02100777067 -0.01945115253 -0.07968087494 0.07801423222 -0.009676366113 -0.009677864611 -0.03206583485 -0.009310216643 -0.01825834997 0 -0.11669112 -0.02325225808 -0.1602820009 -0.1427432895 -0.10720893 -0.02941203304 0.02703136392 -2.906408625e-08 -3.236030111e-08 -3.236030111e-08 -3.236030111e-08 0 0 -0.01229703799 0.02518104948 0} {curve(which) 0 0 0.004060741514 -0.07290724665 0.1191947311 0.0280726999 0.0449459292 0.04511339962 0.04706057906 -0.06703422964 -0.0003228379355 -0.0002844714036 0.08768811822 0.02554347552 0.01782695204 0.01650637016 -0.3473432064 -0.3148325086 -0.2364816219 0.004600019194 -0.02765839547 -0.004612449091 -0.08316776901 0.0280726999 -0.5518454909 -0.4897170365 -0.171635136 -0.4278847873 0.07809129357 -0.08659287542 0.07068887353 0.05121183768 1.2621717e-08 1.2621717e-08 1.2621717e-08 -1.262213711e-08 0.04317118227 0.01672476344 0.1411857158 0.01001892332} {curve(which) 1 1.008825183 1.010339141 1.265746474 0.950532198 1.060985088 0.9638792276 1.043944359 0.9073553085 1.153293729 1.063571215 1.057001948 0.9388025999 1.089437366 1.01197505 1.011739731 1.51608181 1.325875998 1.335215807 1.094135642 1.148782015 1.102980375 1.190483928 1.060985088 1.745692492 1.590125084 1.409072995 1.65968585 1.118175387 1.205062628 0.9913375378 0.7738927603 0.8251045942 0.8251045942 0.8251045942 0.8248898983 0.8782252669 0.9955722094 0.9226909876 0.8150856495}}
     }
   invert {{parent.invert}}
   name ColorMatrix
   label "RGB to XYZ"
   xpos -40
   ypos 32
   addUserKnob {20 Gamut}
   addUserKnob {3 which}
   which {{parent.gamut}}
   addUserKnob {12 rxy}
   rxy {{curve(which) 1 0.7347 0.713 0.8 0.64 0.708 0.68 0.68 0.68 0.684 0.7530442228 0.7530444911 0.6997470013 0.8786825105 0.7011810359 0.7011805919 0.780308 0.69848046 0.74 0.73 0.766 0.73 0.71 0.708 0.9173 0.7422 1.0625 0.9175 0.8608 0.7177 0.64 0.7347 0.7347 0.7347 0.7347 0.734699 0.69 0.6898 0.625 0.7351916376} {curve(which) 0 0.2653 0.293 0.3177 0.33 0.292 0.32 0.32 0.32 0.313 0.3278305767 0.3278310295 0.3290469303 0.3249640074 0.3290141556 0.3290136991 0.304253 0.19302645 0.27 0.28 0.275 0.28 0.31 0.292 0.2502 0.2859 0.3948 0.2983 0.3689 0.3171 0.33 0.2653 0.2653 0.2653 0.2653 0.265301 0.31 0.3206 0.34 0.2648083624}}
   addUserKnob {12 gxy}
   gxy {{curve(which) 0 0 0.165 0.18 0.3 0.17 0.265 0.265 0.265 0.221 0.2995702285 0.2995704905 0.304264039 0.3008887144 0.3006003047 0.3006003955 0.121595 0.32955538 0.17 0.14 0.225 0.165 0.21 0.17 0.2833 0.414 0.3689 0.2983 0.3282 0.228 0.21 0.1152 0.1596 0.1596 0.1596 0.159597 0.18 0.0736 0.28 0.2153361345} {curve(which) 1 1 0.83 0.9 0.6 0.797 0.69 0.69 0.69 0.848 0.700699322 0.7006994156 0.6236411451 0.6790547558 0.6837888343 0.6837888243 1.493994 1.02459662 1.14 0.855 0.8 0.84 0.88 0.797 1.7072 1.3035 0.7775 1.2835 0.6156 0.8616 0.71 0.8264 0.8404 0.8404 0.8404 0.840403 0.77 0.9003 0.595 0.7741596639}}
   addUserKnob {12 bxy}
   bxy {{curve(which) 0 0.0001 0.128 0.065 0.15 0.131 0.15 0.15 0.15 0.0861 0.07964206674 0.1450115843 0.1349139613 0.09539869461 0.1081544556 0.1453319462 0.095612 0.10844263 0.08 0.1 0.089 0.1 0.09 0.131 0.0856 0.0342 0.0956 0.0756 0.0783 0.1006 0.15 0.1566 0.0366 0.0366 0.0366 0.036598 0.1 0.1166 0.155 0.1301229508} {curve(which) 0 -0.077 0.044 -0.0805 0.06 0.046 0.06 0.06 0.06 -0.102 -0.05493795109 0.05109712509 0.03471744128 -0.02937932683 -0.008688175787 0.05161680362 -0.084589 -0.03467857 -0.1 -0.05 -0.087 -0.03 -0.08 0.046 -0.0708 -0.0833 -0.0332 -0.086 -0.0233 -0.082 0.06 0.0177 0.0001 0.0001 0.0001 0.000105 0.02 0.0374 0.07 0.03483606557}}
   addUserKnob {12 wxy}
   wxy {{curve(which) 0.33333333 0.32168 0.32168 0.3127 0.3127 0.3127 0.32168 0.3127 0.314 0.3127 0.3216831877 0.3216832104 0.3216832894 0.3216832894 0.3216832104 0.3216832894 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3135 0.3135 0.3135 0.3127 0.3127 0.3127 0.3127 0.3457 0.3457 0.3457 0.3457 0.345704 0.33243 0.33333333 0.3127 0.3457} {curve(which) 0.33333333 0.33767 0.33767 0.329 0.329 0.329 0.33767 0.329 0.351 0.329 0.337673316 0.3376736101 0.3376734472 0.3376734472 0.3376736101 0.3376734472 0.329 0.329 0.329 0.329 0.329 0.329 0.329 0.329 0.3305 0.3305 0.3305 0.329 0.329 0.329 0.329 0.3585 0.3585 0.3585 0.3585 0.35854 0.34744 0.33333333 0.329 0.3585}}
  }
  Output {
   name Output
   xpos -40
   ypos 86
  }
 end_group
 Colorspace {
  colorspace_in CIE-XYZ
  primary_in "Adobe (1998)"
  colorspace_out CIE-Yxy
  name Colorspace2
  label "\[value colorspace_in] -> \[value colorspace_out]"
  xpos 730
  ypos 296
 }
 Expression {
  expr0 r
  expr1 "4*g / ( -2*g + 12*b + 3)"
  expr2 "9*b / ( -2*g + 12*b + 3)"
  name Expression4
  label "CIE Yxy to CIELuv"
  xpos 730
  ypos 344
  disable {{!parent.diagram}}
 }
 Dot {
  name Dot13
  label " Pos"
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 764
  ypos 546
 }
push $N4cf41400
 Dot {
  name Dot16
  label " Col"
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 654
  ypos 450
 }
 BlinkScript {
  inputs 2
  KernelDescription "2 \"PlotChromaticity\" iterate pixelWise 3e86399c7642fe5c35c23528a644f88a8bf13f967de084ae6842f8be55098c6b 3 \"col\" Read Random \"Yxy\" Read Random \"dst\" Write Random 4 \"padding\" Float 1 AAAAAA== \"left_margin\" Float 1 AAAAAA== \"tolerance\" Float 1 AAAAAA== \"antialias\" Bool 1 AA== 4 \"padding\" 1 1 \"left_margin\" 1 1 \"tolerance\" 1 1 \"antialias\" 1 1 2 \"outsize\" Float 1 1 AAAAAA== \"offset\" Float 1 1 AAAAAA=="
  kernelSource "kernel PlotChromaticity : public ImageComputationKernel<ePixelWise>\n\{\n  Image<eRead, eAccessRandom, eEdgeClamped> col;\n  Image<eRead, eAccessRandom, eEdgeClamped> Yxy;\n  Image<eWrite, eAccessRandom> dst;\n\nparam:\n  float padding;\n  float left_margin;\n  float tolerance;\n  bool antialias;\n\nlocal:\n  float outsize;\n  float offset;\n\n  void init() \{\n    // calculate output width and height and offset based on padding\n    outsize = float(dst.bounds.height()/padding);\n    // xy offset for margin on lower left corner\n    offset = dst.bounds.height()*left_margin;\n  \}\n\n  float gaussian(float d, float a, float expv) \{\n    return max(0.0f, exp(-a*d*d)-expv);\n  \}\n\n  float gaussian_filter(float x, float y, float r) \{\n    // return gaussian weighted distance from origin (0, 0)\n    // given coordinate (x, y) and radius r\n    float a = 1.5f; // rate falloff\n    float expv = exp(-a*r*r);\n    return gaussian(x, a, expv) * gaussian(y, a, expv);\n  \}\n\n  void write_aa(float x, float y, float4 rgb) \{\n    // skip black pixels\n    if (rgb.x == 0.0f && rgb.y == 0.0f && rgb.z == 0.0f) return;\n    \n    // size of pixel neighborhood = n*2+1 by n*2+1\n    int n = 2;\n\n    // center of neighborhood\n    int u0 = round(x);\n    int v0 = round(y);\n\n    // skip if center pixel weight is greater than tolerance\n    if ( dst.bounds.inside(u0, v0)) \{\n      if (dst(u0, v0, 3) >= tolerance) return;\n    \}\n\n    // loop over neighborhood\n    for (int j = -n; j <= n; j++) \{\n      int v = v0 + j;\n      for (int i = -n; i <= n; i++) \{\n        int u = u0 + i;\n        if ( dst.bounds.inside(u, v)) \{\n          // get filter weight for coord (u,v)\n          float w = gaussian_filter(u-x, v-y, float(n));\n          float4 c0 = dst(u, v); // existing color\n\n          // merge current color sample over existing color sample\n          for (int k=0; k<3; k++) \{\n            dst(u, v, k) = rgb\[k]*w+c0\[k]*(1-w); \n          \}\n\n          // merge current weight over existing weight\n          float w0 = dst(u, v, 3);\n          dst(u, v, 3) = w+w0*(1-w);\n        \}\n      \}\n    \}\n  \}\n\n\n  void process(int2 pos) \{\n    float4 rgba = col(pos.x, pos.y);\n    \n    // Get CIE xy position from Yxy input for current pixel\n    float2 xy = float2(Yxy(pos.x, pos.y, 1), Yxy(pos.x, pos.y, 2));\n    \n    // Find output pixel coordinate for this CIE xy pixel value\n    float2 out_coord = float2(xy.x * outsize + offset, xy.y * outsize + offset);\n\n    // For each RGB component, write value from color input to output coordinate\n    if (antialias) \{\n      write_aa(out_coord.x, out_coord.y, rgba);\n    \} else \{\n      // For each RGB component, write value from color input to output coordinate\n      int2 p = int2(round(out_coord.x), round(out_coord.y));\n      if (dst.bounds.inside(p.x, p.y)) \{\n        for (int k=0; k<3; k++) \{\n          dst(p.x, p.y, k) = col(pos.x, pos.y, k);\n        \}\n        dst(p.x, p.y, 3) = 1.0f;\n      \}\n    \}\n  \}\n\};"
  useGPUIfAvailable {{parent.use_gpu}}
  rebuild ""
  PlotChromaticity_padding {{"parent.diagram ? parent.right_margin*0.8 : parent.right_margin"}}
  PlotChromaticity_left_margin {{parent.left_margin}}
  PlotChromaticity_tolerance 2
  PlotChromaticity_antialias true
  format "2048 2048 0 0 2048 2048 1 square_2K"
  rebuild_finalise ""
  name PlotChromaticities
  xpos 620
  ypos 536
  disable {{!parent.plot_input}}
 }
 Fill {
  color 0
  name BLACK
  tile_color 0x111111ff
  xpos 620
  ypos 591
  disable {{parent.plot_input}}
 }
 Merge2 {
  inputs 2
  bbox B
  name Merge7
  xpos 620
  ypos 686
  disable {{!parent.enable_sample_color}}
 }
 Merge2 {
  inputs 2
  name Merge1
  xpos 620
  ypos 758
 }
 Output {
  name Output
  xpos 620
  ypos 1046
 }
end_group
Write {
 file /Users/afry/GitHub/nukeZCAM/images/comparisons/ZCAMishDRTv03_macbethArcs_v001.jpg
 file_type jpeg
 checkHashOnRead false
 version 3
 name Write9
 xpos 2327
 ypos 2185
}
push $N5a113900
Crop {
 box {0 -74 {width} {height}}
 reformat true
 crop false
 name Crop5
 xpos 1639
 ypos 2323
 disable true
}
Rectangle {
 opacity 0.955
 area {782.4000244 6 1137.599976 67.80000305}
 color 0
 name Rectangle5
 xpos 1639
 ypos 2347
}
Text2 {
 font_size_toolbar 30
 font_width_toolbar 100
 font_height_toolbar 100
 message "ACES 1.2"
 old_message {{65 67 69 83 32 49 46 50}
   }
 box {0 16 1920 55}
 xjustify center
 yjustify center
 transforms {{0 2}
   }
 font_size_values {{0 30 1 30 2 30 3 30 4 30 5 30 6 30 7 30 0 99}
   }
 cursor_position 8
 font {{ Helvetica : Regular : Helvetica.ttc : 0 }}
 font_size 30
 center {960 540}
 cursor_initialised true
 autofit_bbox false
 initial_cursor_position {{717.6001587 112.7998962}
   }
 group_animations {{0} imported: 0 selected: items: "root transform/"}
 animation_layers {{1 11 960 540 0 0 1 1 0 0 0 0}
   }
 name Text3
 xpos 1634
 ypos 2375
}
push $N2c83bc00
Group {
 name OpenDRT
 xpos 1230
 ypos 11
 addUserKnob {20 OpenDRT}
 addUserKnob {26 about_label l " " T "<style> a:link \{ color: #ccc \}</style>\n<font color=#ccc>\n<b>OpenDRT</b> created by Jed Smith\n<br>v0.0.90b2 | <a href=https://github.com/jedypod/open-display-transform>documentation</a><br>"}
 addUserKnob {41 gamut l "in gamut" T InGamut_to_XYZ.gamut}
 addUserKnob {26 spacer l " " T ""}
 addUserKnob {35 presets l " " M {"presets/Rec.1886: 2.4 Power | Rec.709" "knobs this \{Lw 100 su 1 sat 1.2 wp 3 eotf 2 display_gamut 4\}" "presets/sRGB Display: 2.2 Power | Rec.709" "knobs this \{Lw 100 su 0 sat 1.2 wp 3 eotf 1 display_gamut 4\}" "presets/Apple Display P3: 2.2 Power | P3D65" "knobs this \{Lw 100 su 0 sat 1.2 wp 3 eotf 1 display_gamut 1\}" "presets/Rec.2020: 2.4 Power | Rec.2020" "knobs this \{Lw 100 su 1 sat 1.2 wp 3 eotf 2 display_gamut 0\}" "presets/Rec.2100: ST 2084 PQ | Rec.2020 | 100 nit" "knobs this \{Lw 100 su 1 sat 1.2 wp 3 eotf 4 display_gamut 0\}" "presets/Rec.2100: ST 2084 PQ | Rec.2020 | 600 nit" "knobs this \{Lw 600 su 2 sat 1 wp 3 eotf 4 display_gamut 0\}" "presets/Rec.2100: ST 2084 PQ | Rec.2020 | 1000 nit" "knobs this \{Lw 1000 su 2 sat 1 wp 3 eotf 4 display_gamut 0\}" "presets/Rec.2100: HLG | Rec.2020 | 1000 nit" "knobs this \{Lw 1000 su 2 sat 1 wp 3 eotf 5 display_gamut 0\}" "presets/Rec.2100: ST 2084 PQ | Rec.2020 | 2000 nit" "knobs this \{Lw 2000 su 2 sat 1 wp 3 eotf 4 display_gamut 0\}" "presets/Rec.2100: ST 2084 PQ | Rec.2020 | 4000 nit" "knobs this \{Lw 4000 su 2 sat 1 wp 3 eotf 4 display_gamut 0\}" "presets/Dolby: ST 2084 PQ | P3D65 | 100 nit" "knobs this \{Lw 100 su 1 sat 1.2 wp 3 eotf 4 display_gamut 1\}" "presets/Dolby: ST 2084 PQ | P3D65 | 600 nit" "knobs this \{Lw 600 su 2 sat 1 wp 3 eotf 4 display_gamut 1\}" "presets/Dolby: ST 2084 PQ | P3D65 | 1000 nit" "knobs this \{Lw 1000 su 2 sat 1 wp 3 eotf 4 display_gamut 1\}" "presets/Dolby: ST 2084 PQ | P3D65 | 2000 nit" "knobs this \{Lw 2000 su 2 sat 1 wp 3 eotf 4 display_gamut 1\}" "presets/Dolby: ST 2084 PQ | P3D65 | 4000 nit" "knobs this \{Lw 4000 su 2 sat 1 wp 3 eotf 4 display_gamut 1\}" "presets/DCI: 2.6 Power | P3 D60" "knobs this \{Lw 100 su 2 sat 1.2 wp 3 eotf 3 display_gamut 2\}" "presets/DCI: 2.6 Power | P3 D65" "knobs this \{Lw 100 su 2 sat 1.2 wp 3 eotf 3 display_gamut 1\}" "presets/DCI: 2.6 Power | P3 DCI" "knobs this \{Lw 100 su 2 sat 1.2 wp 3 eotf 3 display_gamut 3\}" "presets/DCI: 2.6 Power | DCDM XYZ" "knobs this \{Lw 100 su 2 sat 1.2 wp 3 eotf 3 display_gamut 5\}"}}
 addUserKnob {26 ""}
 addUserKnob {26 luminance_label l " " T <b>luminance</b>}
 addUserKnob {41 Lw T ToneScale.Lw}
 addUserKnob {41 su l surround T ToneScale.su}
 addUserKnob {26 chroma_label l " " T "<br/>\n<b>chroma</b>"}
 addUserKnob {41 dch l dechroma T ToneScale.dch}
 addUserKnob {41 sat l saturation T ToneScale.sat}
 addUserKnob {6 pdch l "perceptual dechroma" t "uses a perceptual colorspace to bias hue paths for chroma compression." +STARTLINE}
 pdch true
 addUserKnob {6 gcmp l "gamut compression" t "enable gamut compression" -STARTLINE}
 gcmp true
 addUserKnob {41 wp l whitepoint T Scale.wp}
 addUserKnob {26 ""}
 addUserKnob {26 display_encoding_label l " " T "<b>display encoding</b>"}
 addUserKnob {41 eotf T InverseEOTF.eotf}
 addUserKnob {41 display_gamut l gamut -STARTLINE T XYZ_to_DisplayGamut.gamut}
 addUserKnob {6 clamp t "clamp output to a 0-1 range" -STARTLINE}
 clamp true
 addUserKnob {26 ""}
 addUserKnob {4 direction M {forward inverse}}
}
 Input {
  inputs 0
  name Input
  xpos 180
  ypos -586
 }
set N5d498400 [stack 0]
 Group {
  name EOTF
  xpos 510
  ypos -490
  addUserKnob {20 EOTF_tab l EOTF}
  addUserKnob {4 eotf l EOTF t "Choose the inverse EOTF to apply for the target display device." M {None "sRGB Display" BT.1886 "Gamma 2.6" PQ HLG ""}}
  eotf {{parent.InverseEOTF.eotf}}
 }
  Input {
   inputs 0
   name Input
   xpos 400
   ypos -130
  }
set N5d82bc00 [stack 0]
  Expression {
   expr0 r<=0.5?r*r/3:(exp((r-_c)/_a)+_b)/12
   expr1 g<=0.5?g*g/3:(exp((g-_c)/_a)+_b)/12
   expr2 b<=0.5?b*b/3:(exp((b-_c)/_a)+_b)/12
   name HLG_InverseOETF
   xpos 620
   ypos -58
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 _a t alpha}
   _a 0.17883277
   addUserKnob {7 _b t beta}
   _b {{1-4*_a}}
   addUserKnob {7 _c}
   _c {{0.5-_a*log(4*_a)}}
  }
  Expression {
   temp_name0 Ys
   temp_expr0 0.2627*r+0.6780*g+0.0593*b
   expr0 pow(Ys,_g-1)*r
   expr1 pow(Ys,_g-1)*g
   expr2 pow(Ys,_g-1)*b
   name HLG_OOTF
   xpos 620
   ypos -34
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 _g t "Gamma: Extended model for gamma variation according to peak display luminance and surround luminance: BT.2390-8 p32" R 0 2}
   _g {{1.2*pow(1.111,log(Lw/1000)/log(2))*pow(0.98,log(max(1e-6,Lamb)/5)/log(2))}}
   addUserKnob {7 Lw R 600 4000}
   Lw 1000
   addUserKnob {7 Lb}
   addUserKnob {7 Lamb t "ambient luminance level in nits" R 0 200}
   Lamb 5
  }
push $N5d82bc00
  Expression {
   temp_name0 rp
   temp_expr0 pow(r,1/m_2)
   temp_name1 gp
   temp_expr1 pow(g,1/m_2)
   temp_name2 bp
   temp_expr2 pow(b,1/m_2)
   expr0 pow((rp-c_1)/(c_2-c_3*rp),1/m_1)
   expr1 pow((gp-c_1)/(c_2-c_3*gp),1/m_1)
   expr2 pow((bp-c_1)/(c_2-c_3*bp),1/m_1)
   name ST2084_EOTF
   xpos 510
   ypos -58
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 m_1}
   m_1 {{2610/4096*(1/4)}}
   addUserKnob {7 m_2}
   m_2 {{2523/4096*128}}
   addUserKnob {7 c_1}
   c_1 {{107/128}}
   addUserKnob {7 c_2}
   c_2 {{2413/128}}
   addUserKnob {7 c_3}
   c_3 {{2392/128}}
  }
push $N5d82bc00
  Expression {
   expr0 sign(r)*pow(fabs(r),p)
   expr1 sign(g)*pow(fabs(g),p)
   expr2 sign(b)*pow(fabs(b),p)
   name Power
   xpos 400
   ypos -58
   addUserKnob {20 Params_tab l Params}
   addUserKnob {7 p l power R 0.2 2}
   p {{eotf?2+eotf*0.2:1}}
  }
  Switch {
   inputs 3
   which {{eotf-3}}
   name SwitchInverseEOTF
   xpos 400
   ypos -10
  }
  Output {
   name Output
   xpos 400
   ypos 62
  }
 end_group
 Expression {
  temp_name0 mx
  temp_expr0 dcdm?1:s
  expr0 parent.clamp?max(0,min(mx,r/s)):r/s
  expr1 parent.clamp?max(0,min(mx,g/s)):g/s
  expr2 parent.clamp?max(0,min(mx,b/s)):b/s
  name InvDisplayScale
  xpos 510
  ypos -442
  addUserKnob {20 Params}
  addUserKnob {6 pq +STARTLINE}
  pq {{eotf==4}}
  addUserKnob {6 hlg -STARTLINE}
  hlg {{eotf==5}}
  addUserKnob {6 dcdm -STARTLINE}
  dcdm {{eotf==3&&display_gamut==5}}
  addUserKnob {7 s}
  s {{pq?Lw/10000:hlg?Lw/1000:dcdm?48/52.37:1}}
 }
 ColorMatrix {
  matrix {
      {{parent.XYZ_to_DisplayGamut.ColorMatrix.matrix} {parent.XYZ_to_DisplayGamut.ColorMatrix.matrix} {parent.XYZ_to_DisplayGamut.ColorMatrix.matrix}}
      {{parent.XYZ_to_DisplayGamut.ColorMatrix.matrix} {parent.XYZ_to_DisplayGamut.ColorMatrix.matrix} {parent.XYZ_to_DisplayGamut.ColorMatrix.matrix}}
      {{parent.XYZ_to_DisplayGamut.ColorMatrix.matrix} {parent.XYZ_to_DisplayGamut.ColorMatrix.matrix} {parent.XYZ_to_DisplayGamut.ColorMatrix.matrix}}
    }
  invert true
  name Inv_XYZ_to_DisplayGamut
  xpos 510
  ypos -370
 }
 ColorMatrix {
  matrix {
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
    }
  name Inv_tlms_to_XYZ6
  xpos 510
  ypos -346
 }
 Expression {
  expr0 n*r/w.0
  expr1 n*g/w.1
  expr2 n*b/w.2
  name InvScale
  xpos 510
  ypos -322
  addUserKnob {20 Params}
  addUserKnob {78 w n 3}
  w {{parent.Scale.w} {parent.Scale.w} {parent.Scale.w}}
  addUserKnob {7 n R 0 4}
  n {{parent.Scale.wn}}
 }
set N5d829800 [stack 0]
 Expression {
  expr0 r*w.0
  expr1 g*w.1
  expr2 b*w.2
  name InvNormalize1
  xpos 620
  ypos -178
  addUserKnob {20 Params}
  addUserKnob {78 w n 3}
  w {{parent.Normalize.w} {parent.Normalize.w} {parent.Normalize.w}}
 }
 ColorMatrix {
  matrix {
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
    }
  invert true
  name Inv_XYZ_to_tlms1
  xpos 620
  ypos -154
 }
 Group {
  name Colorspace_JzAzBz_Forward4
  xpos 620
  ypos -106
  addUserKnob {20 JzAzBz_tab l JzAzBz}
  addUserKnob {41 L_p T eotf_inverse_ST2084_.L_p}
  addUserKnob {6 JCh t "Lightness, Chroma, hue angle" +STARTLINE}
  JCh true
  addUserKnob {35 const_d_presets l "" +STARTLINE M {"const d/JzAzBz" "knobs this \{d -0.56\}" "const d/CAM16-UCS" "knobs this \{d 0\}" "const d/IPT" "knobs this \{d -0.64\}" "const d/ICtCp" "knobs this \{d 1.1\}"}}
  addUserKnob {7 d l "" t "the d constant which can can be adjusted to tune the lightness predictors to different colorspaces:\ndefault: -0.56\nCAM16-UCS: 0\nIPT: -0.64\nICtCp: 1.1" -STARTLINE R -1 1}
  d -0.56
 }
  StickyNote {
   inputs 0
   name StickyNote1
   tile_color 0x40454aff
   label "<left><b>JzAzBz Colorspace</b>\nSafdar, M., Cui, G., Kim, Y. J., & Luo, M. R. (2017).\n    Perceptually uniform color space for image signals including high dynamic\n    range and wide gamut. Optics Express, 25(13), 15131.\n    doi:10.1364/OE.25.015131\nhttps://www.osapublishing.org/oe/fulltext.cfm?uri=oe-25-13-15131&id=368272\nhttps://observablehq.com/@jrus/jzazbz"
   note_font_size 14
   xpos 107
   ypos -332
  }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -394
  }
  Expression {
   expr0 1.15*r-(1.15-1)*b
   expr1 0.66*g-(0.66-1)*r
   expr2 b
   name Expression3
   label "X_p Y_p Z"
   xpos -40
   ypos -333
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   name ColorMatrix6
   label XYZ_TO_LMS
   xpos -40
   ypos -295
  }
  Group {
   name eotf_inverse_ST2084_
   xpos -40
   ypos -250
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 m_1}
   m_1 {{2610/4096*(1/4)}}
   addUserKnob {7 m_2}
   m_2 {{1.7*2523/2**5}}
   addUserKnob {7 c_1}
   c_1 {{3424/4096}}
   addUserKnob {7 c_2}
   c_2 {{2413/4096*32}}
   addUserKnob {7 c_3}
   c_3 {{2392/4096*32}}
   addUserKnob {7 L_p R 100 10000}
   L_p 10000
  }
   Input {
    inputs 0
    name Input
    xpos -40
    ypos -290
   }
   Expression {
    expr0 "pow(r/L_p, m_1)"
    expr1 "pow(g/L_p, m_1)"
    expr2 "pow(b/L_p, m_1)"
    name Expression4
    label Y_p
    xpos -40
    ypos -255
   }
   Expression {
    expr0 "pow((c_1+c_2*r)/(c_3*r+1), m_2)"
    expr1 "pow((c_1+c_2*g)/(c_3*g+1), m_2)"
    expr2 "pow((c_1+c_2*b)/(c_3*b+1), m_2)"
    name Expression8
    label N
    xpos -40
    ypos -215
   }
   Output {
    name Output
    xpos -40
    ypos -170
   }
  end_group
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name ColorMatrix2
   label LMS_P_TO_IZAZBZ
   xpos -40
   ypos -224
  }
  Expression {
   temp_name0 d_0
   temp_expr0 1.6295499532821565e-11
   expr0 r*(1+d)/(1+d*r)-d_0
   expr1 g
   expr2 b
   name Expression1
   label Jz
   xpos -40
   ypos -184
  }
  Expression {
   expr0 r
   expr1 sqrt(g*g+b*b)
   expr2 atan2(b,g)
   channel3 none
   name Expression5
   label "JzAzBz to JCh"
   xpos -40
   ypos -136
   disable {{!parent.JCh}}
  }
  Output {
   name Output
   xpos -40
   ypos -58
  }
 end_group
push $N5d829800
 Expression {
  temp_name0 n
  temp_expr0 sqrt(pow(w.0*r,2)+pow(w.1*g,2)+pow(w.2*b,2))/sum
  temp_name1 nt
  temp_expr1 (n+sqrt(n*(4*fl+n)))/2
  temp_name2 ns
  temp_expr2 (pow(nt/sy,1/p)/(1-pow(nt/sy,1/p)))*sx
  temp_name3 ccf
  temp_expr3 pow(ns==0?0:pow(nt,1/p)/(ns/sx),dch)*sat
  expr0 n==0?0:(n*(ccf-1)+r)/ccf*ns/n
  expr1 n==0?0:(n*(ccf-1)+g)/ccf*ns/n
  expr2 n==0?0:(n*(ccf-1)+b)/ccf*ns/n
  expr3 ccf
  name InvToneScale
  xpos 510
  ypos -250
  addUserKnob {20 Params}
  addUserKnob {7 Lw R 100 4000}
  Lw {{parent.ToneScale.Lw}}
  addUserKnob {7 p R 1 2}
  p {{parent.ToneScale.p}}
  addUserKnob {7 fl l flare R 0 0.01}
  fl {{1/Lw}}
  addUserKnob {7 sx R 0 10}
  sx {{0.016*pow(Lw,0.87)-0.17}}
  addUserKnob {7 sy R 0 4}
  sy {{1.036+5e-5*Lw}}
  addUserKnob {7 dch l dechroma}
  dch {{parent.ToneScale.dch}}
  addUserKnob {7 sat l saturation R 0.9 1.6}
  sat {{parent.ToneScale.sat}}
  addUserKnob {78 w n 3}
  w {0.24 0.1 0.09}
  addUserKnob {7 sum t "Normalize so achromatic in=out" R 0 2}
  sum {{sqrt(w.0*w.0+w.1*w.1+w.2*w.2)}}
 }
 Expression {
  expr0 r*w.0
  expr1 g*w.1
  expr2 b*w.2
  name InvNormalize
  xpos 510
  ypos -178
  addUserKnob {20 Params}
  addUserKnob {78 w n 3}
  w {{parent.Normalize.w} {parent.Normalize.w} {parent.Normalize.w}}
 }
 ColorMatrix {
  matrix {
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
    }
  invert true
  name Inv_XYZ_to_tlms
  xpos 510
  ypos -154
 }
 Group {
  name Colorspace_JzAzBz_Forward3
  xpos 510
  ypos -106
  addUserKnob {20 JzAzBz_tab l JzAzBz}
  addUserKnob {41 L_p T eotf_inverse_ST2084_.L_p}
  addUserKnob {6 JCh t "Lightness, Chroma, hue angle" +STARTLINE}
  JCh true
  addUserKnob {35 const_d_presets l "" +STARTLINE M {"const d/JzAzBz" "knobs this \{d -0.56\}" "const d/CAM16-UCS" "knobs this \{d 0\}" "const d/IPT" "knobs this \{d -0.64\}" "const d/ICtCp" "knobs this \{d 1.1\}"}}
  addUserKnob {7 d l "" t "the d constant which can can be adjusted to tune the lightness predictors to different colorspaces:\ndefault: -0.56\nCAM16-UCS: 0\nIPT: -0.64\nICtCp: 1.1" -STARTLINE R -1 1}
  d {{parent.Colorspace_JzAzBz_Forward4.d}}
 }
  StickyNote {
   inputs 0
   name StickyNote1
   tile_color 0x40454aff
   label "<left><b>JzAzBz Colorspace</b>\nSafdar, M., Cui, G., Kim, Y. J., & Luo, M. R. (2017).\n    Perceptually uniform color space for image signals including high dynamic\n    range and wide gamut. Optics Express, 25(13), 15131.\n    doi:10.1364/OE.25.015131\nhttps://www.osapublishing.org/oe/fulltext.cfm?uri=oe-25-13-15131&id=368272\nhttps://observablehq.com/@jrus/jzazbz"
   note_font_size 14
   xpos 107
   ypos -332
  }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -394
  }
  Expression {
   expr0 1.15*r-(1.15-1)*b
   expr1 0.66*g-(0.66-1)*r
   expr2 b
   name Expression3
   label "X_p Y_p Z"
   xpos -40
   ypos -333
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   name ColorMatrix6
   label XYZ_TO_LMS
   xpos -40
   ypos -295
  }
  Group {
   name eotf_inverse_ST2084_
   xpos -40
   ypos -250
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 m_1}
   m_1 {{2610/4096*(1/4)}}
   addUserKnob {7 m_2}
   m_2 {{1.7*2523/2**5}}
   addUserKnob {7 c_1}
   c_1 {{3424/4096}}
   addUserKnob {7 c_2}
   c_2 {{2413/4096*32}}
   addUserKnob {7 c_3}
   c_3 {{2392/4096*32}}
   addUserKnob {7 L_p R 100 10000}
   L_p {{parent.parent.Colorspace_JzAzBz_Forward4.eotf_inverse_ST2084_.L_p}}
  }
   Input {
    inputs 0
    name Input
    xpos -40
    ypos -290
   }
   Expression {
    expr0 "pow(r/L_p, m_1)"
    expr1 "pow(g/L_p, m_1)"
    expr2 "pow(b/L_p, m_1)"
    name Expression4
    label Y_p
    xpos -40
    ypos -255
   }
   Expression {
    expr0 "pow((c_1+c_2*r)/(c_3*r+1), m_2)"
    expr1 "pow((c_1+c_2*g)/(c_3*g+1), m_2)"
    expr2 "pow((c_1+c_2*b)/(c_3*b+1), m_2)"
    name Expression8
    label N
    xpos -40
    ypos -215
   }
   Output {
    name Output
    xpos -40
    ypos -170
   }
  end_group
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name ColorMatrix2
   label LMS_P_TO_IZAZBZ
   xpos -40
   ypos -224
  }
  Expression {
   temp_name0 d_0
   temp_expr0 1.6295499532821565e-11
   expr0 r*(1+d)/(1+d*r)-d_0
   expr1 g
   expr2 b
   name Expression1
   label Jz
   xpos -40
   ypos -184
  }
  Expression {
   expr0 r
   expr1 sqrt(g*g+b*b)
   expr2 atan2(b,g)
   channel3 none
   name Expression5
   label "JzAzBz to JCh"
   xpos -40
   ypos -136
   disable {{!parent.JCh}}
  }
  Output {
   name Output
   xpos -40
   ypos -58
  }
 end_group
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy1
  xpos 510
  ypos -64
  disable {{!pdch}}
 }
 Group {
  name Colorspace_JzAzBz_Inverse2
  xpos 510
  ypos -10
  addUserKnob {20 JzAzBz_tab l JzAzBz}
  addUserKnob {41 L_p T eotf_ST2084_.L_p}
  addUserKnob {6 JCh t "Lightness, Chroma, hue angle" +STARTLINE}
  JCh true
  addUserKnob {35 const_d_presets l "" +STARTLINE M {"const d/JzAzBz" "knobs this \{d -0.56\}" "const d/CAM16-UCS" "knobs this \{d 0\}" "const d/IPT" "knobs this \{d -0.64\}" "const d/ICtCp" "knobs this \{d 1.1\}"}}
  addUserKnob {7 d l "" t "the d constant which can can be adjusted to tune the lightness predictors to different colorspaces:\ndefault: -0.56\nCAM16-UCS: 0\nIPT: -0.64\nICtCp: 1.1" -STARTLINE R -1 1}
  d {{parent.Colorspace_JzAzBz_Forward4.d}}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -490
  }
  Expression {
   expr0 r
   expr1 g*cos(b)
   expr2 g*sin(b)
   channel3 none
   name Expression6
   label "JCh to JzAzBz"
   xpos -40
   ypos -376
   disable {{!parent.JCh}}
  }
  Expression {
   temp_name0 d_0
   temp_expr0 1.6295499532821565e-11
   expr0 (r+d_0)/(1+d-d*(r+d_0))
   expr1 g
   expr2 b
   name Expression4
   label Iz
   xpos -40
   ypos -328
  }
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   invert true
   name ColorMatrix4
   label IZAZBZ_TO_LMS_P
   xpos -40
   ypos -280
  }
  Group {
   name eotf_ST2084_
   xpos -40
   ypos -226
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 m_1}
   m_1 {{2610/4096*(1/4)}}
   addUserKnob {7 m_2}
   m_2 {{1.7*2523/2**5}}
   addUserKnob {7 c_1}
   c_1 {{3424/4096}}
   addUserKnob {7 c_2}
   c_2 {{2413/4096*32}}
   addUserKnob {7 c_3}
   c_3 {{2392/4096*32}}
   addUserKnob {7 L_p R 0 10000}
   L_p {{parent.parent.Colorspace_JzAzBz_Forward4.eotf_inverse_ST2084_.L_p}}
  }
   Input {
    inputs 0
    name Input
    xpos -40
    ypos -290
   }
   Expression {
    expr0 "pow(r, 1/m_2)"
    expr1 "pow(g, 1/m_2)"
    expr2 "pow(b, 1/m_2)"
    name Expression1
    label V_p
    xpos -40
    ypos -256
   }
   Expression {
    expr0 pow(((r-c_1)/(c_2-c_3*r)),1/m_1)*L_p
    expr1 pow(((g-c_1)/(c_2-c_3*g)),1/m_1)*L_p
    expr2 pow(((b-c_1)/(c_2-c_3*b)),1/m_1)*L_p
    name Expression2
    label C
    xpos -40
    ypos -218
   }
   Output {
    name Output
    xpos -40
    ypos -169
   }
  end_group
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   invert true
   name ColorMatrix5
   label LMS_TO_XYZ
   xpos -40
   ypos -184
  }
  Expression {
   expr0 (r+(1.15-1)*b)/1.15
   expr1 (g+(0.66-1)*((r+(1.15-1)*b)/1.15))/0.66
   expr2 b
   name Expression2
   label "X_p Y_p Z"
   xpos -40
   ypos -136
  }
  Output {
   name Output
   xpos -40
   ypos 42
  }
 end_group
 ColorMatrix {
  matrix {
      {{parent.InGamut_to_XYZ.ColorMatrix.matrix} {parent.InGamut_to_XYZ.ColorMatrix.matrix} {parent.InGamut_to_XYZ.ColorMatrix.matrix}}
      {{parent.InGamut_to_XYZ.ColorMatrix.matrix} {parent.InGamut_to_XYZ.ColorMatrix.matrix} {parent.InGamut_to_XYZ.ColorMatrix.matrix}}
      {{parent.InGamut_to_XYZ.ColorMatrix.matrix} {parent.InGamut_to_XYZ.ColorMatrix.matrix} {parent.InGamut_to_XYZ.ColorMatrix.matrix}}
    }
  invert true
  name Inv_InGamut_to_XYZ1
  xpos 510
  ypos 38
 }
push $N5d498400
 Group {
  name InGamut_to_XYZ
  tile_color 0x429940ff
  xpos 180
  ypos -514
  addUserKnob {20 InputGamut_to_XYZ_tab l InputGamut_to_XYZ}
  addUserKnob {4 gamut l "in gamut" M {ACES ACEScg P3D65 Rec.2020 Rec.709 "Alexa WideGamut" "Red WideGamutRGB" "Sony SGamut3" "Filmlight E-Gamut" "DaVinci Wide Gamut" "" "" ""}}
  addUserKnob {41 matrix T ColorMatrix.matrix}
  addUserKnob {41 invert -STARTLINE T ColorMatrix.invert}
 }
  Input {
   inputs 0
   name Input
   xpos 290
   ypos -610
  }
  Dot {
   name Dot1
   xpos 324
   ypos -546
  }
set N5dac9c00 [stack 0]
  ColorMatrix {
   matrix {
       {{"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"}}
       {{"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"}}
       {{"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"}}
     }
   name ColorMatrix
   xpos 290
   ypos -370
  }
  Output {
   name Output
   xpos 290
   ypos -250
  }
push $N5dac9c00
  Dot {
   name Dot391
   label " *RGB to XYZ D65 CAT: XYZ Scaling"
   xpos 434
   ypos -546
  }
set N5dac9000 [stack 0]
  ColorMatrix {
   matrix {
       {0.7006223202 0.1487748027 0.101058729}
       {0.2741184831 0.8736317754 -0.1477504224}
       {-0.09896290302 -0.1378953159 1.325916052}
     }
   name ColorMatrix30
   label "DaVinci WG to XYZ D65"
   xpos 1390
   ypos -466
  }
push $N5dac9000
  ColorMatrix {
   matrix {
       {0.705396831 0.1640413404 0.08101775497}
       {0.2801307142 0.8202067018 -0.1003373787}
       {-0.1037815139 -0.07290726155 1.265746593}
     }
   name ColorMatrix29
   label "Filmlight E-Gamut to XYZ D65"
   xpos 1280
   ypos -466
  }
push $N5dac9000
  ColorMatrix {
   matrix {
       {0.5990839005 0.2489254922 0.1024464965}
       {0.2150758207 0.8850684166 -0.1001443192}
       {-0.03206584975 -0.02765838802 1.148782015}
     }
   name ColorMatrix31
   label "SonySGamut3 to XYZ D65"
   xpos 1170
   ypos -465
  }
push $N5dac9000
  ColorMatrix {
   matrix {
       {0.735275209 0.06860940903 0.1465712786}
       {0.2866940796 0.8429790735 -0.1296732426}
       {-0.07968084514 -0.3473432064 1.516081929}
     }
   name ColorMatrix22
   label "REDWideGamutRGB to XYZ D65"
   xpos 1060
   ypos -466
  }
push $N5dac9000
  ColorMatrix {
   matrix {
       {0.6380076408 0.2147038132 0.09774445742}
       {0.2919537723 0.8238408566 -0.1157948226}
       {0.002798279049 -0.06703422219 1.153293848}
     }
   name ColorMatrix21
   label "Arri AlexaWideGamut to XYZ D65"
   xpos 950
   ypos -466
  }
push $N5dac9000
  ColorMatrix {
   matrix {
       {0.4123909175 0.3575843573 0.1804807931}
       {0.2126390785 0.7151687145 0.07219231129}
       {0.01933082566 0.1191947833 0.9505321383}
     }
   name ColorMatrix18
   label "Rec709 to XYZ D65"
   xpos 840
   ypos -466
  }
push $N5dac9000
  ColorMatrix {
   matrix {
       {0.6369581223 0.1446169168 0.1688809693}
       {0.2627002299 0.6779981256 0.05930171534}
       {4.99410725e-17 0.02807269618 1.060985088}
     }
   name ColorMatrix17
   label "Rec2020 to XYZ D65"
   xpos 730
   ypos -466
  }
push $N5dac9000
  ColorMatrix {
   matrix {
       {0.4865711331 0.2656677067 0.1982173175}
       {0.2289746404 0.6917386055 0.07928691804}
       {-3.972076965e-17 0.04511338845 1.043944478}
     }
   name ColorMatrix16
   label "P3D65 to XYZ D65"
   xpos 620
   ypos -466
  }
push $N5dac9000
  ColorMatrix {
   matrix {
       {0.6609312296 0.1336961389 0.1558285803}
       {0.2722287476 0.6740817428 0.05368950963}
       {-0.006018006243 0.004383686464 1.090692043}
     }
   name ColorMatrix1
   label "ACEScg to XYZ D65"
   xpos 510
   ypos -466
  }
push $N5dac9000
  ColorMatrix {
   matrix {
       {0.9503623843 0 9.346324805e-05}
       {0.3439664543 0.728166163 -0.07213254273}
       {0 0 1.089057803}
     }
   name ColorMatrix2
   label "ACES to XYZ D65"
   xpos 400
   ypos -466
  }
  Switch {
   inputs 10
   which {{gamut}}
   name SwitchGamut
   xpos 400
   ypos -370
  }
 end_group
 ColorMatrix {
  matrix {
      {0.257085 0.859943 -0.031061}
      {-0.394427 1.1758 0.106423}
      {0.064856 -0.07625 0.559067}
    }
  name XYZ_to_tlms
  xpos 180
  ypos -490
 }
 Expression {
  expr0 r/w.0
  expr1 g/w.1
  expr2 b/w.2
  name Normalize
  xpos 180
  ypos -466
  addUserKnob {20 Params}
  addUserKnob {35 presets l "" +STARTLINE M {presets/D50 "knobs this \{w \{1.08221 0.883260 0.447579\}\}" presets/D55 "knobs this \{w \{1.07730 0.896467 0.500927\}\}" presets/D60 "knobs this \{w \{1.07344 0.907523 0.549381\}\}" presets/D65 "knobs this \{w \{1.07046 0.916817 0.594251\}\}" presets/D75 "knobs this \{w \{1.06600 0.931715 0.670839\}\}" presets/D93 "knobs this \{w \{1.06098 0.950462 0.776150\}\}"}}
  addUserKnob {78 w n 3}
  w {1.07046 0.916817 0.594251}
 }
set N5da69c00 [stack 0]
 Expression {
  expr0 r*w.0/n
  expr1 g*w.1/n
  expr2 b*w.2/n
  name Scale1
  xpos 70
  ypos -226
  addUserKnob {20 Params}
  addUserKnob {78 w n 3}
  w {{parent.Scale.w} {parent.Scale.w} {parent.Scale.w}}
  addUserKnob {7 n R 0 2}
  n {{parent.Scale.wn}}
 }
 ColorMatrix {
  matrix {
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
    }
  invert true
  name tlms_to_XYZ1
  xpos 70
  ypos -202
 }
 Group {
  name Colorspace_JzAzBz_Forward1
  xpos 70
  ypos -154
  addUserKnob {20 JzAzBz_tab l JzAzBz}
  addUserKnob {41 L_p T eotf_inverse_ST2084_.L_p}
  addUserKnob {6 JCh t "Lightness, Chroma, hue angle" +STARTLINE}
  JCh true
  addUserKnob {35 const_d_presets l "" +STARTLINE M {"const d/JzAzBz" "knobs this \{d -0.56\}" "const d/CAM16-UCS" "knobs this \{d 0\}" "const d/IPT" "knobs this \{d -0.64\}" "const d/ICtCp" "knobs this \{d 1.1\}"}}
  addUserKnob {7 d l "" t "the d constant which can can be adjusted to tune the lightness predictors to different colorspaces:\ndefault: -0.56\nCAM16-UCS: 0\nIPT: -0.64\nICtCp: 1.1" -STARTLINE R -1 1}
  d {{parent.Colorspace_JzAzBz_Forward2.d}}
 }
  StickyNote {
   inputs 0
   name StickyNote1
   tile_color 0x40454aff
   label "<left><b>JzAzBz Colorspace</b>\nSafdar, M., Cui, G., Kim, Y. J., & Luo, M. R. (2017).\n    Perceptually uniform color space for image signals including high dynamic\n    range and wide gamut. Optics Express, 25(13), 15131.\n    doi:10.1364/OE.25.015131\nhttps://www.osapublishing.org/oe/fulltext.cfm?uri=oe-25-13-15131&id=368272\nhttps://observablehq.com/@jrus/jzazbz"
   note_font_size 14
   xpos 107
   ypos -332
  }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -394
  }
  Expression {
   expr0 1.15*r-(1.15-1)*b
   expr1 0.66*g-(0.66-1)*r
   expr2 b
   name Expression3
   label "X_p Y_p Z"
   xpos -40
   ypos -333
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   name ColorMatrix6
   label XYZ_TO_LMS
   xpos -40
   ypos -295
  }
  Group {
   name eotf_inverse_ST2084_
   xpos -40
   ypos -250
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 m_1}
   m_1 {{2610/4096*(1/4)}}
   addUserKnob {7 m_2}
   m_2 {{1.7*2523/2**5}}
   addUserKnob {7 c_1}
   c_1 {{3424/4096}}
   addUserKnob {7 c_2}
   c_2 {{2413/4096*32}}
   addUserKnob {7 c_3}
   c_3 {{2392/4096*32}}
   addUserKnob {7 L_p R 100 10000}
   L_p {{parent.parent.Colorspace_JzAzBz_Forward2.eotf_inverse_ST2084_.L_p}}
  }
   Input {
    inputs 0
    name Input
    xpos -40
    ypos -290
   }
   Expression {
    expr0 "pow(r/L_p, m_1)"
    expr1 "pow(g/L_p, m_1)"
    expr2 "pow(b/L_p, m_1)"
    name Expression4
    label Y_p
    xpos -40
    ypos -255
   }
   Expression {
    expr0 "pow((c_1+c_2*r)/(c_3*r+1), m_2)"
    expr1 "pow((c_1+c_2*g)/(c_3*g+1), m_2)"
    expr2 "pow((c_1+c_2*b)/(c_3*b+1), m_2)"
    name Expression8
    label N
    xpos -40
    ypos -215
   }
   Output {
    name Output
    xpos -40
    ypos -170
   }
  end_group
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name ColorMatrix2
   label LMS_P_TO_IZAZBZ
   xpos -40
   ypos -224
  }
  Expression {
   temp_name0 d_0
   temp_expr0 1.6295499532821565e-11
   expr0 r*(1+d)/(1+d*r)-d_0
   expr1 g
   expr2 b
   name Expression1
   label Jz
   xpos -40
   ypos -184
  }
  Expression {
   expr0 r
   expr1 sqrt(g*g+b*b)
   expr2 atan2(b,g)
   channel3 none
   name Expression5
   label "JzAzBz to JCh"
   xpos -40
   ypos -136
   disable {{!parent.JCh}}
  }
  Output {
   name Output
   xpos -40
   ypos -58
  }
 end_group
push $N5da69c00
 Expression {
  temp_name0 n
  temp_expr0 max(1e-12,sqrt(pow(w.0*r,2)+pow(w.1*g,2)+pow(w.2*b,2))/sum)
  temp_name1 ns
  temp_expr1 sy*pow(n/(n+sx),p)
  temp_name2 nt
  temp_expr2 ns*ns/(ns+fl)
  temp_name3 ccf
  temp_expr3 pow(sx/(n+sx),dch)*sat
  expr0 nt*(1-ccf)+r*(nt/n)*ccf
  expr1 nt*(1-ccf)+g*(nt/n)*ccf
  expr2 nt*(1-ccf)+b*(nt/n)*ccf
  expr3 ccf
  name ToneScale
  xpos 180
  ypos -394
  addUserKnob {20 Params}
  addUserKnob {7 Lw R 100 4000}
  Lw 100
  addUserKnob {7 c l contrast R 0.8 2}
  c {{12*pow(Lw,-0.86)+1.17}}
  addUserKnob {4 su l surround t "dark = 1.0\ndim = 0.95\naverage = 0.90" M {average dim dark}}
  su dim
  addUserKnob {7 p R 1 2}
  p {{c*(0.9+0.05*su)}}
  addUserKnob {7 fl l flare R 0 0.01}
  fl {{1/Lw}}
  addUserKnob {7 sx R 0 10}
  sx {{0.016*pow(Lw,0.87)-0.17}}
  addUserKnob {7 sy R 0 4}
  sy {{1.036+5e-5*Lw}}
  addUserKnob {7 dch l dechroma}
  dch 0.5
  addUserKnob {7 sat l saturation R 0.9 1.6}
  sat 1.2
  addUserKnob {78 w n 3}
  w {0.24 0.1 0.09}
  addUserKnob {7 sum t "Normalize so achromatic in=out" R 0 2}
  sum {{sqrt(w.0*w.0+w.1*w.1+w.2*w.2)}}
 }
set N5d9f1c00 [stack 0]
 Group {
  name LMS_to_Yrg
  xpos 290
  ypos -346
 }
  Input {
   inputs 0
   name Input
   xpos 400
   ypos -346
  }
  Clamp {
   channels rgba
   maximum_enable false
   name ClampMin
   xpos 400
   ypos -320
  }
  Expression {
   temp_name0 _a
   temp_expr0 r+g+b
   temp_name1 l
   temp_expr1 _a==0?0:r/_a
   temp_name2 m
   temp_expr2 _a==0?0:g/_a
   expr0 0.68990272*r+0.34832189*g
   expr1 1.0671*l-0.6873*m+0.02062-0.14722
   expr2 -0.0362*l+1.7182*m-0.05155-0.50911666
   name LMS_to_Yrg
   xpos 400
   ypos -298
  }
  Expression {
   expr0 r
   expr1 hypot(g,b)
   expr2 atan2(b,g)
   name cartesian_to_polar1
   xpos 400
   ypos -274
  }
  Output {
   name Output
   xpos 400
   ypos -226
  }
 end_group
 Expression {
  expr1 g<t0?g:s*sqrt(g-ox)+oy
  maskChannelMask rgba.red
  name compress_parabolic
  xpos 290
  ypos -322
  addUserKnob {20 Params_tab l Params}
  addUserKnob {7 t0 t "threshold to start compression\n" R 0 2}
  t0 0.3
  addUserKnob {7 x0 t "x coordinate to compress to" R 0 2}
  x0 0.5
  addUserKnob {7 y0 t "y coordinate to compress to" R 0 2}
  y0 0.45
  addUserKnob {7 s}
  s {{(y0-t0)/sqrt(x0-y0)}}
  addUserKnob {7 ox R -2 2}
  ox {{t0-s*s/4}}
  addUserKnob {7 oy R -2 2}
  oy {{t0-s*sqrt(s*s/4)}}
 }
 Group {
  name Yrg_to_LMS
  xpos 290
  ypos -298
 }
  Input {
   inputs 0
   name Input
   xpos 510
   ypos -106
  }
  Expression {
   expr0 r
   expr1 g*cos(b)
   expr2 g*sin(b)
   name polar_to_cartesian
   xpos 510
   ypos -58
  }
  Expression {
   expr0 r
   expr1 g+0.14722
   expr2 b+0.50911666
   name offset_white1
   xpos 510
   ypos -34
  }
  Expression {
   temp_name0 l
   temp_expr0 0.95*g+0.38*b
   temp_name1 m
   temp_expr1 0.02*g+0.59*b+0.03
   temp_name2 _a
   temp_expr2 r/(0.68990272*l+0.34832189*m)
   expr0 l*_a
   expr1 m*_a
   expr2 (1-l-m)*_a
   name Yrg_to_LMS
   xpos 510
   ypos -10
  }
  Output {
   name Output
   xpos 510
   ypos 38
  }
 end_group
push $N5d9f1c00
 Switch {
  inputs 2
  which {{gcmp}}
  name Switch_gcmp
  xpos 180
  ypos -298
 }
 Expression {
  expr0 r*w.0/wn
  expr1 g*w.1/wn
  expr2 b*w.2/wn
  name Scale
  xpos 180
  ypos -226
  addUserKnob {20 Params}
  addUserKnob {4 wp M {D50 D55 D60 D65 D75 D93}}
  wp D65
  addUserKnob {78 w n 3}
  w {{curve(wp) 1.08221 1.0773 1.07344 1.07046 1.066 1.06098} {curve(wp) 0.88326 0.896467 0.907523 0.916817 0.931715 0.950462} {curve(wp) 0.447579 0.500927 0.549381 0.594251 0.670839 0.77615}}
  addUserKnob {7 wn R 0 2}
  wn {{curve(wp+6*display_gamut) 1.09063 1.05337 1.02355 1 1.12915 1.30631 1.1408 1.08334 1.037 1 1.13116 1.31116 1.09928 1.04391 1.00028 1.08307 1.22512 1.42007 1.2469 1.18409 1.13345 1.15054 1.30144 1.50853 1.17646 1.10416 1.0461 1 1.14486 1.34374 1 1 1 1 1 1}}
 }
 ColorMatrix {
  matrix {
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
    }
  invert true
  name tlms_to_XYZ
  xpos 180
  ypos -202
 }
 Group {
  name Colorspace_JzAzBz_Forward2
  xpos 180
  ypos -154
  addUserKnob {20 JzAzBz_tab l JzAzBz}
  addUserKnob {41 L_p T eotf_inverse_ST2084_.L_p}
  addUserKnob {6 JCh t "Lightness, Chroma, hue angle" +STARTLINE}
  JCh true
  addUserKnob {35 const_d_presets l "" +STARTLINE M {"const d/JzAzBz" "knobs this \{d -0.56\}" "const d/CAM16-UCS" "knobs this \{d 0\}" "const d/IPT" "knobs this \{d -0.64\}" "const d/ICtCp" "knobs this \{d 1.1\}"}}
  addUserKnob {7 d l "" t "the d constant which can can be adjusted to tune the lightness predictors to different colorspaces:\ndefault: -0.56\nCAM16-UCS: 0\nIPT: -0.64\nICtCp: 1.1" -STARTLINE R -1 1}
  d -0.56
 }
  StickyNote {
   inputs 0
   name StickyNote1
   tile_color 0x40454aff
   label "<left><b>JzAzBz Colorspace</b>\nSafdar, M., Cui, G., Kim, Y. J., & Luo, M. R. (2017).\n    Perceptually uniform color space for image signals including high dynamic\n    range and wide gamut. Optics Express, 25(13), 15131.\n    doi:10.1364/OE.25.015131\nhttps://www.osapublishing.org/oe/fulltext.cfm?uri=oe-25-13-15131&id=368272\nhttps://observablehq.com/@jrus/jzazbz"
   note_font_size 14
   xpos 107
   ypos -332
  }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -394
  }
  Expression {
   expr0 1.15*r-(1.15-1)*b
   expr1 0.66*g-(0.66-1)*r
   expr2 b
   name Expression3
   label "X_p Y_p Z"
   xpos -40
   ypos -333
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   name ColorMatrix6
   label XYZ_TO_LMS
   xpos -40
   ypos -295
  }
  Group {
   name eotf_inverse_ST2084_
   xpos -40
   ypos -250
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 m_1}
   m_1 {{2610/4096*(1/4)}}
   addUserKnob {7 m_2}
   m_2 {{1.7*2523/2**5}}
   addUserKnob {7 c_1}
   c_1 {{3424/4096}}
   addUserKnob {7 c_2}
   c_2 {{2413/4096*32}}
   addUserKnob {7 c_3}
   c_3 {{2392/4096*32}}
   addUserKnob {7 L_p R 100 10000}
   L_p 10000
  }
   Input {
    inputs 0
    name Input
    xpos -40
    ypos -290
   }
   Expression {
    expr0 "pow(r/L_p, m_1)"
    expr1 "pow(g/L_p, m_1)"
    expr2 "pow(b/L_p, m_1)"
    name Expression4
    label Y_p
    xpos -40
    ypos -255
   }
   Expression {
    expr0 "pow((c_1+c_2*r)/(c_3*r+1), m_2)"
    expr1 "pow((c_1+c_2*g)/(c_3*g+1), m_2)"
    expr2 "pow((c_1+c_2*b)/(c_3*b+1), m_2)"
    name Expression8
    label N
    xpos -40
    ypos -215
   }
   Output {
    name Output
    xpos -40
    ypos -170
   }
  end_group
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name ColorMatrix2
   label LMS_P_TO_IZAZBZ
   xpos -40
   ypos -224
  }
  Expression {
   temp_name0 d_0
   temp_expr0 1.6295499532821565e-11
   expr0 r*(1+d)/(1+d*r)-d_0
   expr1 g
   expr2 b
   name Expression1
   label Jz
   xpos -40
   ypos -184
  }
  Expression {
   expr0 r
   expr1 sqrt(g*g+b*b)
   expr2 atan2(b,g)
   channel3 none
   name Expression5
   label "JzAzBz to JCh"
   xpos -40
   ypos -136
   disable {{!parent.JCh}}
  }
  Output {
   name Output
   xpos -40
   ypos -58
  }
 end_group
 Expression {
  expr1 g<t0?g:s*sqrt(g-ox)+oy
  maskChannelMask rgba.red
  name compress_parabolic2
  xpos 180
  ypos -106
  disable {{!gcmp}}
  addUserKnob {20 Params_tab l Params}
  addUserKnob {7 t0 t "threshold to start compression\n" R 0 0.1}
  t0 0.016
  addUserKnob {7 x0 t "x coordinate to compress to" R 0 0.2}
  x0 0.05
  addUserKnob {7 y0 t "y coordinate to compress to" R 0 0.1}
  y0 0.02
  addUserKnob {7 s}
  s {{(y0-t0)/sqrt(x0-y0)}}
  addUserKnob {7 ox R -2 2}
  ox {{t0-s*s/4}}
  addUserKnob {7 oy R -2 2}
  oy {{t0-s*sqrt(s*s/4)}}
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy2
  xpos 180
  ypos -64
  disable {{!pdch}}
 }
 Group {
  name Colorspace_JzAzBz_Inverse1
  xpos 180
  ypos -10
  addUserKnob {20 JzAzBz_tab l JzAzBz}
  addUserKnob {41 L_p T eotf_ST2084_.L_p}
  addUserKnob {6 JCh t "Lightness, Chroma, hue angle" +STARTLINE}
  JCh true
  addUserKnob {35 const_d_presets l "" +STARTLINE M {"const d/JzAzBz" "knobs this \{d -0.56\}" "const d/CAM16-UCS" "knobs this \{d 0\}" "const d/IPT" "knobs this \{d -0.64\}" "const d/ICtCp" "knobs this \{d 1.1\}"}}
  addUserKnob {7 d l "" t "the d constant which can can be adjusted to tune the lightness predictors to different colorspaces:\ndefault: -0.56\nCAM16-UCS: 0\nIPT: -0.64\nICtCp: 1.1" -STARTLINE R -1 1}
  d {{parent.Colorspace_JzAzBz_Forward2.d}}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -490
  }
  Expression {
   expr0 r
   expr1 g*cos(b)
   expr2 g*sin(b)
   channel3 none
   name Expression6
   label "JCh to JzAzBz"
   xpos -40
   ypos -376
   disable {{!parent.JCh}}
  }
  Expression {
   temp_name0 d_0
   temp_expr0 1.6295499532821565e-11
   expr0 (r+d_0)/(1+d-d*(r+d_0))
   expr1 g
   expr2 b
   name Expression4
   label Iz
   xpos -40
   ypos -328
  }
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   invert true
   name ColorMatrix4
   label IZAZBZ_TO_LMS_P
   xpos -40
   ypos -280
  }
  Group {
   name eotf_ST2084_
   xpos -40
   ypos -226
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 m_1}
   m_1 {{2610/4096*(1/4)}}
   addUserKnob {7 m_2}
   m_2 {{1.7*2523/2**5}}
   addUserKnob {7 c_1}
   c_1 {{3424/4096}}
   addUserKnob {7 c_2}
   c_2 {{2413/4096*32}}
   addUserKnob {7 c_3}
   c_3 {{2392/4096*32}}
   addUserKnob {7 L_p R 0 10000}
   L_p {{parent.parent.Colorspace_JzAzBz_Forward2.eotf_inverse_ST2084_.L_p}}
  }
   Input {
    inputs 0
    name Input
    xpos -40
    ypos -290
   }
   Expression {
    expr0 "pow(r, 1/m_2)"
    expr1 "pow(g, 1/m_2)"
    expr2 "pow(b, 1/m_2)"
    name Expression1
    label V_p
    xpos -40
    ypos -256
   }
   Expression {
    expr0 pow(((r-c_1)/(c_2-c_3*r)),1/m_1)*L_p
    expr1 pow(((g-c_1)/(c_2-c_3*g)),1/m_1)*L_p
    expr2 pow(((b-c_1)/(c_2-c_3*b)),1/m_1)*L_p
    name Expression2
    label C
    xpos -40
    ypos -218
   }
   Output {
    name Output
    xpos -40
    ypos -169
   }
  end_group
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   invert true
   name ColorMatrix5
   label LMS_TO_XYZ
   xpos -40
   ypos -184
  }
  Expression {
   expr0 (r+(1.15-1)*b)/1.15
   expr1 (g+(0.66-1)*((r+(1.15-1)*b)/1.15))/0.66
   expr2 b
   name Expression2
   label "X_p Y_p Z"
   xpos -40
   ypos -136
  }
  Output {
   name Output
   xpos -40
   ypos 42
  }
 end_group
 Group {
  name XYZ_to_DisplayGamut
  tile_color 0x425440ff
  xpos 180
  ypos 38
  addUserKnob {20 XYZ_to_DisplayGamut_tab l XYZ_to_DisplayGamut}
  addUserKnob {4 gamut l "display gamut" t "Choose the target display device chromaticities." M {Rec.2020 "P3 D65" "P3 D60" "P3 DCI" Rec.709 "DCDM X'Y'Z'"}}
  gamut Rec.709
  addUserKnob {41 matrix T ColorMatrix.matrix}
  addUserKnob {41 invert -STARTLINE T ColorMatrix.invert}
 }
  Input {
   inputs 0
   name Input
   xpos 290
   ypos -580
  }
  Dot {
   name Dot391
   label " "
   xpos 324
   ypos -516
  }
set N5dd67000 [stack 0]
  ColorMatrix {
   matrix {
       {{"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"}}
       {{"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"}}
       {{"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"}}
     }
   name ColorMatrix
   xpos 290
   ypos -399
  }
  Output {
   name Output
   xpos 290
   ypos -310
  }
push $N5dd67000
  Dot {
   name Dot1
   label " XYZ D65 to *RGB CAT: XYZ Scaling"
   xpos 434
   ypos -516
  }
set N5dd66400 [stack 0]
  ColorMatrix {
   matrix {
       {1 0 0}
       {0 1 0}
       {0 0 1}
     }
   name ColorMatrix4
   label "XYZ D65 to XYZ E"
   xpos 950
   ypos -465
  }
push $N5dd66400
  ColorMatrix {
   matrix {
       {3.240968943 -1.537382722 -0.4986106157}
       {-0.9692435861 1.875967264 0.04155508429}
       {0.05563007668 -0.2039769441 1.056971431}
     }
   name ColorMatrix2
   label "XYZ D65 to Rec709"
   xpos 840
   ypos -465
  }
push $N5dd66400
  ColorMatrix {
   matrix {
       {2.72539258 -1.01800251 -0.4401629865}
       {-0.795167923 1.689731836 0.02264717408}
       {0.04124189168 -0.08763902634 1.100929379}
     }
   name ColorMatrix12
   label "XYZ D65 to P3DCI"
   xpos 730
   ypos -465
  }
push $N5dd66400
  ColorMatrix {
   matrix {
       {2.40274024 -0.8974836469 -0.3880532086}
       {-0.8325793743 1.769231319 0.02371269651}
       {0.03882337734 -0.0824996829 1.036368608}
     }
   name ColorMatrix11
   label "XYZ D65 to P3D60"
   xpos 620
   ypos -465
  }
push $N5dd66400
  ColorMatrix {
   matrix {
       {2.493495464 -0.9313831329 -0.4027105868}
       {-0.8294886947 1.762663484 0.02362468652}
       {0.03584581986 -0.07617236674 0.9568843246}
     }
   name ColorMatrix10
   label "XYZ D65 to P3D65"
   xpos 510
   ypos -465
  }
push $N5dd66400
  ColorMatrix {
   matrix {
       {1.716650844 -0.3556707203 -0.2533662021}
       {-0.6666842103 1.616480947 0.01576854289}
       {0.01763985492 -0.04277061298 0.9421030283}
     }
   name ColorMatrix5
   label "XYZ D65 to Rec2020"
   xpos 400
   ypos -465
  }
  Switch {
   inputs 6
   which {{gamut}}
   name SwitchGamut
   xpos 400
   ypos -399
  }
 end_group
 Expression {
  temp_name0 mx
  temp_expr0 dcdm?1:s
  expr0 parent.clamp?max(0,min(mx,r*s)):r*s
  expr1 parent.clamp?max(0,min(mx,g*s)):g*s
  expr2 parent.clamp?max(0,min(mx,b*s)):b*s
  name DisplayScale1
  xpos 180
  ypos 86
  addUserKnob {20 Params}
  addUserKnob {6 pq +STARTLINE}
  pq {{eotf==4}}
  addUserKnob {6 hlg -STARTLINE}
  hlg {{eotf==5}}
  addUserKnob {6 dcdm -STARTLINE}
  dcdm {{eotf==3&&display_gamut==5}}
  addUserKnob {7 s}
  s {{pq?Lw/10000:hlg?Lw/1000:dcdm?48/52.37:1}}
 }
 Group {
  name InverseEOTF
  xpos 180
  ypos 110
  addUserKnob {20 EOTF_tab l EOTF}
  addUserKnob {4 eotf t "Choose the inverse EOTF to apply for the target display device." M {None "sRGB Display" BT.1886 "Gamma 2.6" PQ HLG "" "" ""}}
 }
  Input {
   inputs 0
   name Input
   xpos 400
   ypos -130
  }
set N5dd64400 [stack 0]
  Expression {
   temp_name0 Yd
   temp_expr0 0.2627*r+0.6780*g+0.0593*b
   expr0 r*pow(Yd,(1-_g)/_g)
   expr1 g*pow(Yd,(1-_g)/_g)
   expr2 b*pow(Yd,(1-_g)/_g)
   name HLG_InverseOOTF
   xpos 620
   ypos -58
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 _g t "Gamma: Extended model for gamma variation according to peak display luminance and surround luminance: BT.2390-8 p32" R 0 2}
   _g {{1.2*pow(1.111,log(Lw/1000)/log(2))*pow(0.98,log(max(1e-6,Lamb)/5)/log(2))}}
   addUserKnob {7 Lw R 600 4000}
   Lw {{parent.parent.Lw}}
   addUserKnob {7 Lamb t "ambient luminance level in nits" R 0 200}
   Lamb 5
  }
  Expression {
   expr0 r<=1/12?sqrt(3*r):_a*log(12*r-_b)+_c
   expr1 g<=1/12?sqrt(3*g):_a*log(12*g-_b)+_c
   expr2 b<=1/12?sqrt(3*b):_a*log(12*b-_b)+_c
   name HLG_OETF
   xpos 620
   ypos -34
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 _a t alpha}
   _a 0.17883277
   addUserKnob {7 _b t beta}
   _b {{1-4*_a}}
   addUserKnob {7 _c}
   _c {{0.5-_a*log(4*_a)}}
  }
push $N5dd64400
  Expression {
   temp_name0 rp
   temp_expr0 pow(r,m_1)
   temp_name1 gp
   temp_expr1 pow(g,m_1)
   temp_name2 bp
   temp_expr2 pow(b,m_1)
   expr0 pow((c_1+c_2*rp)/(1+c_3*rp),m_2)
   expr1 pow((c_1+c_2*gp)/(1+c_3*gp),m_2)
   expr2 pow((c_1+c_2*bp)/(1+c_3*bp),m_2)
   name ST2084_InverseEOTF
   xpos 510
   ypos -58
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 m_1}
   m_1 {{2610/4096*(1/4)}}
   addUserKnob {7 m_2}
   m_2 {{2523/4096*128}}
   addUserKnob {7 c_1}
   c_1 {{107/128}}
   addUserKnob {7 c_2}
   c_2 {{2413/128}}
   addUserKnob {7 c_3}
   c_3 {{2392/128}}
  }
push $N5dd64400
  Expression {
   expr0 sign(r)*pow(fabs(r),1/p)
   expr1 sign(g)*pow(fabs(g),1/p)
   expr2 sign(b)*pow(fabs(b),1/p)
   name power
   xpos 400
   ypos -58
   addUserKnob {20 Params_tab l Params}
   addUserKnob {7 p l power R 0.2 2}
   p {{eotf?2+eotf*0.2:1}}
  }
  Switch {
   inputs 3
   which {{eotf-3}}
   name SwitchInverseEOTF
   xpos 400
   ypos 14
  }
  Output {
   name Output
   xpos 400
   ypos 86
  }
 end_group
 Switch {
  inputs 2
  which {{parent.direction}}
  name SwitchDirection
  xpos 180
  ypos 206
 }
 Output {
  name Output
  xpos 180
  ypos 278
 }
end_group
Crop {
 box {0 -74 {width} {height}}
 reformat true
 crop false
 name Crop4
 xpos 1523
 ypos 2323
 disable true
}
Rectangle {
 opacity 0.955
 area {782.4000244 6 1137.599976 67.80000305}
 color 0
 name Rectangle4
 xpos 1523
 ypos 2347
}
Text2 {
 font_size_toolbar 30
 font_width_toolbar 100
 font_height_toolbar 100
 message "OpenDRT v0.0.90b2"
 old_message {{79 112 101 110 68 82 84 32 118 48 46 48 46 57 48 98 50}
   }
 box {0 16 1920 55}
 xjustify center
 yjustify center
 transforms {{0 2}
   }
 font_size_values {{0 30 1 30 2 30 3 30 4 30 5 30 6 30 7 30 8 30 9 30 10 30 11 30 12 30 13 30 14 30 15 30 16 30 8 99}
   }
 cursor_position 8
 font {{ Helvetica : Regular : Helvetica.ttc : 0 }}
 font_size 30
 center {960 540}
 cursor_initialised true
 autofit_bbox false
 initial_cursor_position {{717.6001587 112.7998962}
   }
 group_animations {{0} imported: 0 selected: items: "root transform/"}
 animation_layers {{1 11 960 540 0 0 1 1 0 0 0 0}
   }
 name Text2
 xpos 1537
 ypos 2374
}
push $N5dcfcc00
ContactSheet {
 inputs 3
 width {{input.width*columns}}
 height {{input.height}}
 rows 1
 columns 3
 name ContactSheet1
 xpos 1537
 ypos 2457
}
set N5dcfc800 [stack 0]
Reformat {
 format "3840 2160 0 0 3840 2160 1 UHD_4K"
 scale 0.5
 name Reformat5
 xpos 1537
 ypos 2481
}
Colorspace {
 colorspace_out sRGB
 name Colorspace9
 xpos 1537
 ypos 2513
}
Write {
 file /Users/afry/GitHub/nukeZCAM/images/comparisons/ZCAMishDRTv03_vs_v001/ZCAMishDRTv03_vs_v001.####.jpg
 colorspace texture_paint
 raw true
 file_type jpeg
 checkHashOnRead false
 version 10
 name Write1
 xpos 1537
 ypos 2568
}
Constant {
 inputs 0
 channels rgb
 color {100 {frame/20*100} 0 0}
 format "1024 1024 0 0 1024 1024 1 square_1K"
 name Constant7
 xpos -530
 ypos 966
}
Expression {
 expr0 (y/(height-1))*r
 expr2 cx*180
 name Expression15
 xpos -530
 ypos 1077
}
Shuffle2 {
 fromInput1 {{0} B}
 out1 zcam_J
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.red 0 0 zcam_J.blue 0 2 rgba.red 0 0 zcam_J.alpha 0 3"
 name Shuffle31
 xpos -530
 ypos 1101
}
Shuffle2 {
 fromInput1 {{0} B}
 out1 zcam_Q
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.red 0 0 zcam_Q.blue 0 2 rgba.red 0 0 zcam_Q.alpha 0 3"
 name Shuffle32
 xpos -530
 ypos 1125
}
Shuffle2 {
 fromInput1 {{0} B}
 out1 zcam_M
 fromInput2 {{0} B}
 mappings "4 rgba.green 0 1 zcam_M.green 0 1 rgba.green 0 1 zcam_M.red 0 0 rgba.green 0 1 zcam_M.blue 0 2 rgba.green 0 1 zcam_M.alpha 0 3"
 name Shuffle47
 xpos -530
 ypos 1147
}
Shuffle2 {
 fromInput1 {{0} B}
 out1 zcam_h
 fromInput2 {{0} B}
 mappings "4 rgba.blue 0 2 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.red 0 0 rgba.blue 0 2 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.alpha 0 3"
 name Shuffle53
 xpos -530
 ypos 1171
}
Group {
 name ZCAM18
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos -530
 ypos 1223
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 direction inverse
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 inverseData1 M,h
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set N5cd83c00 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set N5cd82800 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $N5cd82800
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set N5cd98f00 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $N5cd98f00
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set N5cd80c00 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set N5cd80800 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $N5cd80c00
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set N5cd0f800 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set N5cd0f400 [stack 0]
push $N5cd80c00
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set N5cd0f000 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set N5cd0ec00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set N5cd0e800 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set N5cd0e400 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $N5cd80800
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $N5cd80c00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $N5cd80c00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $N5cd80c00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $N5cd83c00
push $N5cd80800
push $N5cd0f800
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set N5cd0c800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $N5cd0c800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $N5cd80800
push $N5cd0f400
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set N5ccab000 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $N5ccab000
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $N5cd80800
push $N5cd0f000
push $N5cd0f800
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set N5cca9800 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set N5cca9400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $N5cca9400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $N5cd0e800
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $N5cca9800
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $N5cd0e800
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $N5cd0e400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $N5cca9800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $N5cd0f400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $N5cd0ec00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $N5cd0f800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $N5cd0f000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $N5cd80800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $N5cd83c00
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set N5cf53c00 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set N5cf53000 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $N5cf53000
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $N5cf53c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $N5cf53c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $N5cf53c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set N5cf51800 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set N5cf50c00 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $N5cf50c00
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $N5cf50c00
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set N5d2ff800 [stack 0]
push $N5d2ff800
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $N5cf53c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $N5cf53c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  selected true
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $N5cf51800
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set N5d2fcc00 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $N5d2fcc00
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $N5d2fcc00
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set N5ccb4f00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set N5d2bb800 [stack 0]
 Dot {
  name Dot44
  label C,h
  xpos -1673
  ypos 2768
 }
push $N5ccb4f00
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set N5d2bb000 [stack 0]
 Dot {
  name Dot20
  label M,h
  xpos -1737
  ypos 2767
 }
push $N5ccb4f00
push $N5cf53c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set N5d2ba400 [stack 0]
push $N5cf53c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set N5d2b9800 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set N5ccb4800 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $N5d2bb800
push $N5d2bb000
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set N5d24f800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $N5d24f800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $N5ccb4800
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set N5d24d800 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $N5d24d800
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set N5d1fb900 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $N5d1fb900
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $N5cf53c00
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $N5cf53c00
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $N5cf53c00
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $N5ccb4800
push $N5cf53c00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $N5cf51800
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $N5d2ba400
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $N5d2b9800
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $N5ccb4f00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
Multiply {
 value 0.01
 name Multiply23
 label "Div by 100 to go from nits"
 xpos -530
 ypos 1305
}
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.blue 0 2 white -1 -1 rgba.alpha 0 3"
 name Shuffle54
 xpos -530
 ypos 1347
}
Colorspace {
 colorspace_in CIE-XYZ
 name Colorspace21
 label "XYZ to sRGB Prims"
 xpos -530
 ypos 1371
}
Dot {
 name Dot16
 xpos -496
 ypos 1420
}
set N5d176800 [stack 0]
Dot {
 name Dot17
 xpos -369
 ypos 1446
}
set N5d176400 [stack 0]
Expression {
 channel0 rgba
 expr0 min((r<0?0:1),(g<0?0:1),(b<0?0:1))
 name Expression16
 xpos -446
 ypos 1471
}
push $N5d176400
Expression {
 channel0 rgba
 expr0 min((r>1?0:1),(g>1?0:1),(b>1?0:1))
 name Expression17
 xpos -341
 ypos 1469
}
Merge2 {
 inputs 2
 operation multiply
 name Multiply24
 xpos -404
 ypos 1501
}
push $N5d176800
Copy {
 inputs 2
 from0 rgba.alpha
 to0 rgba.alpha
 name Copy5
 xpos -530
 ypos 1557
}
Premult {
 name Premult2
 xpos -530
 ypos 1589
}
Write {
 file /Users/afry/GitHub/nukeZCAM/images/gamutBounds/sRGBgamutBoundGif/sRGBgamutBoundGif_v001.%04d.png
 file_type png
 checkHashOnRead false
 version 1
 in_colorspace scene_linear
 out_colorspace scene_linear
 name Write5
 xpos -530
 ypos 1625
}
Read {
 inputs 0
 file_type exr
 file "\[value Write11.file]"
 origset true
 version 3095
 name Read64
 xpos -8
 ypos 1675
}
set N2c2de800 [stack 0]
Write {
 file /Users/afry/GitHub/nukeZCAM/images/gamutBounds/sRGBgamutBound_tempImg.png
 file_type png
 checkHashOnRead false
 version 1047
 in_colorspace scene_linear
 out_colorspace scene_linear
 name Write12
 xpos 111
 ypos 1832
}
push $N4d568800
Group {
 name ZCAM11
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos 412
 ypos -565
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 inverseData1 M,h
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set N8a626000 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set N8a624c00 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $N8a624c00
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set N6767b900 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $N6767b900
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set N78166c00 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set N78166800 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $N78166c00
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set N78165c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set N78165800 [stack 0]
push $N78166c00
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set N78165400 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set N78165000 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set N78164c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set N78164800 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $N78166800
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $N78166c00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $N78166c00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $N78166c00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $N8a626000
push $N78166800
push $N78165c00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set N67d1e800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $N67d1e800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $N78166800
push $N78165800
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set N67d1d400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $N67d1d400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $N78166800
push $N78165400
push $N78165c00
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set N47a67800 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set N47a67400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $N47a67400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $N78164c00
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $N47a67800
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $N78164c00
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $N78164800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $N47a67800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $N78165800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $N78165000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $N78165c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $N78165400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $N78166800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $N8a626000
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set N47282000 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set N47281400 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $N47281400
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $N47282000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $N47282000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $N47282000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set N4784b800 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set N4784ac00 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $N4784ac00
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $N4784ac00
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set N47849c00 [stack 0]
push $N47849c00
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $N47282000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $N47282000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  selected true
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $N4784b800
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set N67deec00 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $N67deec00
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $N67deec00
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set N67c93900 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set N67dedc00 [stack 0]
 Dot {
  name Dot44
  label C,h
  xpos -1673
  ypos 2768
 }
push $N67c93900
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set N67ded400 [stack 0]
 Dot {
  name Dot20
  label M,h
  xpos -1737
  ypos 2767
 }
push $N67c93900
push $N47282000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set N67dec800 [stack 0]
push $N47282000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set N67c6f800 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set N67c93200 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $N67dedc00
push $N67ded400
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set N67c6dc00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $N67c6dc00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $N67c93200
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set N67bef800 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $N67bef800
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set N67c92400 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $N67c92400
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $N47282000
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $N47282000
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $N47282000
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $N67c93200
push $N47282000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $N4784b800
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $N67dec800
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $N67c6f800
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $N67c93900
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
set N8a616b00 [stack 0]
Remove {
 channels zcam_M
 name Remove2
 xpos 416
 ypos -508
}
Multiply {
 channels zcam_C
 value 0.45
 name Multiply19
 xpos 408
 ypos -474
}
Expression {
 channel0 zcam_C
 expr0 20
 name Expression21
 xpos 408
 ypos -442
}
Group {
 name ZCAM15
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos 408
 ypos -397
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 direction inverse
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 inverseData1 C,h
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set N67b8d000 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set N9d563800 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $N9d563800
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set N67b4c800 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $N67b4c800
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set N9d561c00 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set N9d561800 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $N9d561c00
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set N9d560c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set N9d560800 [stack 0]
push $N9d561c00
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set N9d560400 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set N9d4f3c00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set N9d4f3800 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set N9d4f3400 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $N9d561800
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $N9d561c00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $N9d561c00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $N9d561c00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $N67b8d000
push $N9d561800
push $N9d560c00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set N9d4f1800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $N9d4f1800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $N9d561800
push $N9d560800
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set N9d4f0400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $N9d4f0400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $N9d561800
push $N9d560400
push $N9d560c00
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set N9d48a800 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set N9d48a400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $N9d48a400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $N9d4f3800
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $N9d48a800
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $N9d4f3800
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $N9d4f3400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $N9d48a800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $N9d560800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $N9d4f3c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $N9d560c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $N9d560400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $N9d561800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $N67b8d000
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set N9d3bd000 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set N9d3bc400 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $N9d3bc400
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $N9d3bd000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $N9d3bd000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $N9d3bd000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set N9d34e800 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set N9d34dc00 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $N9d34dc00
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $N9d34dc00
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set N9d34cc00 [stack 0]
push $N9d34cc00
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $N9d3bd000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $N9d3bd000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  selected true
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $N9d34e800
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set N9d305c00 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $N9d305c00
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $N9d305c00
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set N9d4b0800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set N9d304c00 [stack 0]
 Dot {
  name Dot44
  label C,h
  xpos -1673
  ypos 2768
 }
push $N9d4b0800
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set N9d304400 [stack 0]
 Dot {
  name Dot20
  label M,h
  xpos -1737
  ypos 2767
 }
push $N9d4b0800
push $N9d3bd000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set N9d2b3400 [stack 0]
push $N9d3bd000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set N9d2b2800 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set N9d4b0100 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $N9d304c00
push $N9d304400
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set N9d2b0c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $N9d2b0c00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $N9d4b0100
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set N9d226800 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $N9d226800
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set N9d25f200 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $N9d25f200
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $N9d3bd000
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $N9d3bd000
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $N9d3bd000
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $N9d4b0100
push $N9d3bd000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $N9d34e800
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $N9d2b3400
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $N9d2b2800
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $N9d4b0800
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
push $N8a616b00
Remove {
 channels zcam_C
 name Remove1
 xpos 308
 ypos -505
}
Multiply {
 channels zcam_M
 value {{parent.Multiply19.value}}
 name Multiply20
 xpos 308
 ypos -473
}
Expression {
 channel0 zcam_M
 expr0 20
 name Expression20
 xpos 308
 ypos -441
}
Group {
 name ZCAM16
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos 304
 ypos -398
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 direction inverse
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 inverseData1 M,h
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set N76e26c00 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set N76e25800 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $N76e25800
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set N7906c100 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $N7906c100
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set N9dd73800 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set N9dd73400 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $N9dd73800
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set N9dd72800 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set N9dd72400 [stack 0]
push $N9dd73800
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set N9dd72000 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set N9dd71c00 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set N9dd71800 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set N9dd71400 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $N9dd73400
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $N9dd73800
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $N9dd73800
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $N9dd73800
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $N76e26c00
push $N9dd73400
push $N9dd72800
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set N9dcfb400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $N9dcfb400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $N9dd73400
push $N9dd72400
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set N9dcfa000 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $N9dcfa000
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $N9dd73400
push $N9dd72000
push $N9dd72800
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set N9dcf8800 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set N9dcf8400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $N9dcf8400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $N9dd71800
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $N9dcf8800
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $N9dd71800
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $N9dd71400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $N9dcf8800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $N9dd72400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $N9dd71c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $N9dd72800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $N9dd72000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $N9dd73400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $N76e26c00
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set N9dbbac00 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set N9dbba000 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $N9dbba000
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $N9dbbac00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $N9dbbac00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $N9dbbac00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set N9dbb8800 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set N9db63800 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $N9db63800
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $N9db63800
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set N9db62800 [stack 0]
push $N9db62800
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $N9dbbac00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $N9dbbac00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  selected true
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $N9dbb8800
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set N9db1f800 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $N9db1f800
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $N9db1f800
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set N9dd60100 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2714
 }
set N9db1e800 [stack 0]
 Dot {
  name Dot44
  label C,h
  xpos -1673
  ypos 2768
 }
push $N9dd60100
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2036
  ypos 2713
 }
set N9db1e000 [stack 0]
 Dot {
  name Dot20
  label M,h
  xpos -1737
  ypos 2767
 }
push $N9dd60100
push $N9dbbac00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set N9db1d400 [stack 0]
push $N9dbbac00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set N9db1c800 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set N9dad7900 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1818
  ypos 2708
 }
push $N9db1e800
push $N9db1e000
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  xpos -1543
  ypos 2822
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2986
 }
set N9dace800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $N9dace800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $N9dad7900
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set N9dacc800 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $N9dacc800
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set N9dad6b00 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $N9dad6b00
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $N9dbbac00
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $N9dbbac00
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $N9dbbac00
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $N9dad7900
push $N9dbbac00
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $N9dbb8800
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $N9db1d400
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $N9db1c800
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $N9dd60100
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
end_group
push $N5be07800
push $N5d174800
Merge2 {
 inputs 2
 name Merge5
 xpos 492
 ypos 1788
}
Write {
 file /Users/afry/GitHub/nukeZCAM/images/gamutBounds/JMh_sRGBgamutBound_tempImg.exr
 file_type exr
 first_part rgba
 version 2074
 name Write4
 xpos 492
 ypos 1830
 addUserKnob {20 User}
 addUserKnob {22 recursiveWrite T "writeNode = nuke.thisNode()\nmergeNode = writeNode.input(0)\nreadNode = writeNode.input(0).input(0)\n\nwriteNode.setInput(0,writeNode.input(0).input(1))\nnuke.execute(writeNode, 0, 0)\nreadNode.knob('reload').execute()\nwriteNode.setInput(0,mergeNode)\n\n\nfor i in range(0,1024):\n    nuke.execute(writeNode, i, i)\n    readNode.knob('reload').execute()" +STARTLINE}
}
Constant {
 inputs 0
 channels rgb
 color {100 {frame/1023*100} 0 0}
 format "1024 1024 0 0 1024 1024 1 square_1K"
 name Constant8
 xpos -156
 ypos 991
}
Expression {
 expr0 (y/(height-1))*r
 expr2 cx*180
 name Expression14
 xpos -156
 ypos 1102
}
Shuffle2 {
 fromInput1 {{0} B}
 out1 zcam_J
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.red 0 0 zcam_J.blue 0 2 rgba.red 0 0 zcam_J.alpha 0 3"
 name Shuffle36
 xpos -156
 ypos 1126
}
Shuffle2 {
 fromInput1 {{0} B}
 out1 zcam_C
 fromInput2 {{0} B}
 mappings "4 rgba.green 0 1 zcam_C.green 0 1 rgba.green 0 1 zcam_C.red 0 0 rgba.green 0 1 zcam_C.blue 0 2 rgba.green 0 1 zcam_C.alpha 0 3"
 name Shuffle37
 xpos -156
 ypos 1172
}
Shuffle2 {
 fromInput1 {{0} B}
 out1 zcam_h
 fromInput2 {{0} B}
 mappings "4 rgba.blue 0 2 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.red 0 0 rgba.blue 0 2 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.alpha 0 3"
 name Shuffle39
 xpos -156
 ypos 1196
}
Group {
 name ZCAM10
 label "\[value direction]\n\[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData0]\} \{return  \"\"\}] - \[if \{\[value direction] ==\"inverse\"\} \{return \[value inverseData1]\} \{return  \"\"\}]\n0.0.2"
 xpos -156
 ypos 1248
 addUserKnob {20 ZCAM}
 addUserKnob {4 direction M {forward inverse}}
 direction inverse
 addUserKnob {26 ""}
 addUserKnob {26 inverseModes l "Inverse Input Data Modes"}
 addUserKnob {4 inverseData0 l "Inverse Data 0" M {J Q}}
 addUserKnob {4 inverseData1 l "Inverse Data 1" M {aM,bM aC,bC aS,bS M,h C,h}}
 inverseData1 C,h
 addUserKnob {26 ""}
 addUserKnob {26 _1 l _SURROUND_PARAMETERS}
 addUserKnob {41 surrounds T Constants.surrounds}
 addUserKnob {41 c T Constants.c}
 addUserKnob {41 Nc T Constants.Nc}
 addUserKnob {41 F T Constants.F}
 addUserKnob {41 FLL T Constants.FLL}
 addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
 addUserKnob {41 La T Constants.La}
 addUserKnob {41 Yb T Constants.Yb}
 addUserKnob {41 surround T Constants.surround}
 addUserKnob {41 D T Constants.D}
 addUserKnob {41 Dtype T Constants.Dtype}
 addUserKnob {26 ""}
 addUserKnob {41 xyzw_d65 T Constants.xyzw_d65}
 addUserKnob {41 xyzw T Constants.xyzw}
 addUserKnob {26 ""}
 addUserKnob {41 Yw T Constants.Yw}
 addUserKnob {41 FL T Constants.FL}
 addUserKnob {41 n T Constants.n}
 addUserKnob {41 Fb T Constants.Fb}
 addUserKnob {41 Fs T Constants.Fs}
 addUserKnob {26 ""}
 addUserKnob {41 xyzwc T Constants.xyzwc}
 addUserKnob {41 iabzw T Constants.iabzw}
 addUserKnob {41 Qw T Constants.Qw}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x71c67100
  label xyz_to_jabz
  note_font_size 42
  xpos -1063
  ypos -50
  bdwidth 255
  bdheight 678
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x388e8e00
  label Forward
  note_font_size 42
  xpos -1278
  ypos 673
  bdwidth 1634
  bdheight 582
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  tile_color 0x388e8e00
  label Inverse
  note_font_size 42
  xpos -2310
  ypos 2374
  bdwidth 1715
  bdheight 953
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  tile_color 0x388e8e00
  label "jabz to xyz"
  note_font_size 42
  xpos -2260
  ypos 3390
  bdwidth 300
  bdheight 667
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "h,H,Q,J,M,C,Sz,Vz,Kz,Wz\n\n        :outin:\n            | 'J,aM,bM', optional\n            | String with requested output (e.g. \"J,aM,bM,M,h\") \[Forward mode]\n            | - attributes: 'J': lightness,'Q': brightness,\n            |               'M': colorfulness,'C': chroma, 's': saturation,\n            |               'h': hue angle, 'H': hue quadrature/composition,\n            |               'Wz': whiteness, 'Kz':blackness, 'Sz': saturation, 'V': vividness\n            | String with inputs in data \[inverse mode]. \n            | Input must have data.shape\[-1]==3 and last dim of data must have \n            | the following structure for inverse mode: \n            |  * data\[...,0] = J or Q,\n            |  * data\[...,1:] = (aM,bM) or (aC,bC) or (aS,bS) or (M,h) or (C, h), ..."
  xpos -1922
  ypos 791
  bdwidth 411
  bdheight 201
 }
 Input {
  inputs 0
  name Input1
  xpos -984
  ypos -137
 }
 Dot {
  name Dot4
  label xyzc
  xpos -950
  ypos -97
 }
 Dot {
  name Dot5
  xpos -950
  ypos -21
 }
set Ne12e6000 [stack 0]
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  name M_to_xyzp
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -984
  ypos 30
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  name _M_XYZP_TO_LMS
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -984
  ypos 102
 }
 Dot {
  name Dot1
  label LMS
  xpos -950
  ypos 154
 }
 Expression {
  expr0 "((c1 + c2*(r/10000)**n)/(1 + c3*(r/10000)**n))**p"
  expr1 "((c1 + c2*(g/10000)**n)/(1 + c3*(g/10000)**n))**p"
  expr2 "((c1 + c2*(b/10000)**n)/(1 + c3*(b/10000)**n))**p"
  name Expression1
  label "# response compression: lms to lms'"
  xpos -984
  ypos 199
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 Dot {
  name Dot2
  label lmsp
  xpos -950
  ypos 260
 }
set Ne12e4c00 [stack 0]
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_ZCAM
  xpos -912
  ypos 329
 }
 Add {
  value -3.703522621e-11
  name Add1
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -912
  ypos 353
 }
 Dot {
  name Dot6
  label Iabz
  xpos -878
  ypos 411
 }
push $Ne12e4c00
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  name _M_LMSP_TO_IAB_JABZ
  xpos -1053
  ypos 328
 }
 Dot {
  name Dot7
  label Iabz
  xpos -1019
  ypos 410
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters
  xpos -978
  ypos 441
 }
set Ne12a9d00 [stack 0]
 Expression {
  expr0 "((1-0.56)*r/(1-0.56*r)) - 1.6295499532821566e-11"
  name Expression2
  label "    if ztype == 'jabz':\n        Iabz\[...,0] = ((1-0.56)*Iabz\[...,0]/(1-0.56*Iabz\[...,0])) - 1.6295499532821566e-11\n        print(\"Iabz post jabz: \", Iabz)"
  xpos -886
  ypos 492
 }
push $Ne12a9d00
 Switch {
  inputs 2
  name use_zcam_parameters1
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -978
  ypos 564
 }
 Dot {
  name Dot3
  label iabz
  xpos -944
  ypos 753
 }
set Ne1262c00 [stack 0]
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(b,g)*r2d
  channel0 rgba
  expr0 h
  name h
  xpos -1074
  ypos 904
 }
set Ne1262800 [stack 0]
 Expression {
  temp_name0 h
  temp_expr0 r
  channel0 rgba
  expr0 "1.015 + cos((h + 89.038)*pi/180)"
  name ez
  xpos -1074
  ypos 928
 }
push $Ne1262c00
 Copy {
  inputs 2
  from0 rgba.red
  to0 rgba.red
  name Copy1
  xpos -894
  ypos 989
 }
 Expression {
  channel0 rgba
  expr0 "100*((g**2.0 + b**2.0)**0.37)*(r**0.068)*(Constants.FL**0.2) / ((Constants.iabzw.r**0.78) * (Constants.Fb**0.1))"
  name M_colorfulness
  label "# calculate colorfulness, M:"
  xpos -894
  ypos 1021
 }
set Ne1261c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C
  label "# calculate chroma, C:"
  xpos -894
  ypos 1118
 }
set Ne1261800 [stack 0]
push $Ne1262c00
 Expression {
  channel0 rgba
  expr0 "2700 * (r**(1.6*Constants.Fs/(Constants.Fb**0.12))) * (Constants.Fs**2.2) * (Constants.Fb**0.5) * (Constants.FL**0.2)"
  name Q
  label "# calculate brightness, Q:"
  xpos -1030
  ypos 1019
 }
set Ne1261400 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100.0 * (r/Constants.Qw)"
  name J
  label "# calculate lightness, J:"
  xpos -1030
  ypos 1117
 }
set Ne1261000 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy3
  xpos -1030
  ypos 1155
 }
set Ne1260c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 "100 - ((100-r)**2 + g**2)**0.5"
  name Wz
  label "# calculate whiteness, W:"
  xpos -1030
  ypos 1195
 }
set Ne1260800 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam
  fromInput2 {{0} B}
  mappings "4 black -1 -1 zcam.J 0 0 black -1 -1 zcam.Q 0 1 black -1 -1 zcam.M 0 2 black -1 -1 zcam.C 0 3"
  name Shuffle2
  xpos -1202
  ypos 1199
 }
push $Ne1262800
 Dot {
  name Dot9
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1975
  ypos 2339
 }
push $Ne1262c00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.red 0 0 rgba.blue 0 2 rgba.red 0 0 rgba.alpha 0 3"
  name Iz
  xpos -1127
  ypos 835
 }
push $Ne1262c00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.green 0 1 rgba.alpha 0 3"
  name az
  xpos -978
  ypos 837
 }
push $Ne1262c00
 Shuffle2 {
  fromInput1 {{0} B}
  fromInput2 {{0} B}
  mappings "4 rgba.blue 0 2 rgba.blue 0 2 rgba.blue 0 2 rgba.red 0 0 rgba.blue 0 2 rgba.green 0 1 rgba.blue 0 2 rgba.alpha 0 3"
  name bz
  xpos -825
  ypos 835
 }
 NoOp {
  inputs 0
  name Constants
  xpos -527
  ypos 180
  addUserKnob {20 User}
  addUserKnob {26 _1 l _SURROUND_PARAMETERS}
  addUserKnob {4 surrounds M {average dim dark}}
  addUserKnob {7 c}
  c {{curve(surrounds) 0.69 0.59 0.525}}
  addUserKnob {7 Nc}
  Nc {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 F}
  F {{curve(surrounds) 1 0.9 0.8}}
  addUserKnob {7 FLL}
  FLL {{curve(surrounds) 1 1 1}}
  addUserKnob {26 _2 l _DEFAULT_CONDITIONS}
  addUserKnob {7 La}
  La 100
  addUserKnob {7 Yb}
  Yb 20
  addUserKnob {4 surround M {avg dim dark}}
  addUserKnob {7 D}
  D 1
  addUserKnob {7 Dtype}
  addUserKnob {26 ""}
  addUserKnob {18 xyzw_d65}
  xyzw_d65 {95.043 100 108.89}
  addUserKnob {6 xyzw_d65_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 xyzw}
  xyzw {{xyzw_d65.r} {xyzw_d65.g} {xyzw_d65.b}}
  addUserKnob {6 xyzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {26 ""}
  addUserKnob {7 Yw}
  Yw 100
  addUserKnob {7 FL}
  FL {{"0.171 * La**(1/3) * (1 - exp(-48/9*La))"}}
  addUserKnob {7 n}
  n {{Yb/Yw}}
  addUserKnob {7 Fb}
  Fb {{n**0.5}}
  addUserKnob {7 Fs}
  Fs {{c}}
  addUserKnob {26 ""}
  addUserKnob {18 xyzwc}
  xyzwc {95.043 100 108.89}
  addUserKnob {6 xyzwc_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 iabzw}
  iabzw {0.31331 -0.00014318 -8.9369e-05}
  addUserKnob {6 iabzw_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 Qw}
  Qw 185.85
 }
push $Ne12e6000
push $Ne1262800
push $Ne1261c00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy5
  xpos 67
  ypos 1136
 }
set Ne11fe800 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bM
  xpos 163
  ypos 1202
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bM.red 0 0 rgba.green 0 1 zcam_bM.green 0 1 rgba.blue 0 2 zcam_bM.blue 0 2 rgba.alpha 0 3 zcam_bM.alpha 0 3"
  name Shuffle11
  xpos -752
  ypos 1400
 }
push $Ne11fe800
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aM
  xpos 67
  ypos 1203
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aM
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aM.red 0 0 rgba.green 0 1 zcam_aM.green 0 1 rgba.blue 0 2 zcam_aM.blue 0 2 rgba.alpha 0 3 zcam_aM.alpha 0 3"
  name Shuffle10
  xpos -848
  ypos 1400
 }
push $Ne1262800
push $Ne1261800
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy25
  xpos -164
  ypos 1149
 }
set Ne11fd400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bC
  xpos -76
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bC.red 0 0 rgba.green 0 1 zcam_bC.green 0 1 rgba.blue 0 2 zcam_bC.blue 0 2 rgba.alpha 0 3 zcam_bC.alpha 0 3"
  name Shuffle25
  xpos -949
  ypos 1399
 }
push $Ne11fd400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aC
  xpos -164
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aC
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aC.red 0 0 rgba.green 0 1 zcam_aC.green 0 1 rgba.blue 0 2 zcam_aC.blue 0 2 rgba.alpha 0 3 zcam_aC.alpha 0 3"
  name Shuffle24
  xpos -1048
  ypos 1397
 }
push $Ne1262800
push $Ne1261400
push $Ne1261c00
 Copy {
  inputs 2
  from1 rgba.green
  to1 rgba.green
  name Copy2
  xpos -734
  ypos 1076
 }
 Expression {
  channel0 rgba
  expr0 "100.0* ((r/g)**0.5) * (Constants.FL)**0.6"
  name s
  label "# calculate saturation, s:"
  xpos -734
  ypos 1118
 }
set Ne118b800 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy24
  xpos -381
  ypos 1143
 }
set Ne118b400 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180.0)
  name bS
  xpos -287
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_bS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_bS.red 0 0 rgba.green 0 1 zcam_bS.green 0 1 rgba.blue 0 2 zcam_bS.blue 0 2 rgba.alpha 0 3 zcam_bS.alpha 0 3"
  name Shuffle23
  xpos -1150
  ypos 1398
 }
push $Ne118b400
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180.0)
  name aS
  xpos -381
  ypos 1207
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_aS
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_aS.red 0 0 rgba.green 0 1 zcam_aS.green 0 1 rgba.blue 0 2 zcam_aS.blue 0 2 rgba.alpha 0 3 zcam_aS.alpha 0 3"
  name Shuffle22
  xpos -1254
  ypos 1395
 }
push $Ne1260c00
 Expression {
  channel0 rgba
  expr0 "((r - 58)**2 + 3.4*g**2)**0.5"
  name Vz
  label "# calculate vividness, V:"
  xpos -583
  ypos 1200
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Vz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Vz.red 0 0 rgba.green 0 1 zcam_Vz.green 0 1 rgba.blue 0 2 zcam_Vz.blue 0 2 rgba.alpha 0 3 zcam_Vz.alpha 0 3"
  name Shuffle9
  xpos -1345
  ypos 1396
 }
push $Ne118b800
 Expression {
  channel0 rgba
  name Sz
  label "# calculate saturation, S:"
  xpos -734
  ypos 1196
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Sz.red 0 0 rgba.green 0 1 zcam_Sz.green 0 1 rgba.blue 0 2 zcam_Sz.blue 0 2 rgba.alpha 0 3 zcam_Sz.alpha 0 3"
  name Shuffle8
  xpos -1436
  ypos 1395
 }
push $Ne1260c00
 Expression {
  channel0 rgba
  expr0 "100 - 0.8*(r**2 + 8*g**2)**0.5"
  name Kz
  label "# calculate blackness, K:"
  xpos -895
  ypos 1195
 }
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Kz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Kz.red 0 0 rgba.green 0 1 zcam_Kz.green 0 1 rgba.blue 0 2 zcam_Kz.blue 0 2 rgba.alpha 0 3 zcam_Kz.alpha 0 3"
  name Shuffle7
  xpos -1524
  ypos 1393
 }
push $Ne1260800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Wz
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Wz.red 0 0 rgba.green 0 1 zcam_Wz.green 0 1 rgba.blue 0 2 zcam_Wz.blue 0 2 rgba.alpha 0 3 zcam_Wz.alpha 0 3"
  name Shuffle6
  xpos -1613
  ypos 1393
 }
push $Ne118b800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_s
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_s.red 0 0 rgba.green 0 1 zcam_s.green 0 1 rgba.blue 0 2 zcam_s.blue 0 2 rgba.alpha 0 3 zcam_s.alpha 0 3"
  name Shuffle5
  xpos -1708
  ypos 1392
 }
push $Ne1261800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_C
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_C.red 0 0 rgba.green 0 1 zcam_C.green 0 1 rgba.blue 0 2 zcam_C.blue 0 2 rgba.alpha 0 3 zcam_C.alpha 0 3"
  name Shuffle4
  xpos -1798
  ypos 1391
 }
push $Ne1261000
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_J
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_J.red 0 0 rgba.green 0 1 zcam_J.green 0 1 rgba.blue 0 2 zcam_J.blue 0 2 rgba.alpha 0 3 zcam_J.alpha 0 3"
  name Shuffle1
  xpos -1900
  ypos 1390
 }
push $Ne1261c00
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_M
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_M.red 0 0 rgba.green 0 1 zcam_M.green 0 1 rgba.blue 0 2 zcam_M.blue 0 2 rgba.alpha 0 3 zcam_M.alpha 0 3"
  name Shuffle12
  xpos -1999
  ypos 1389
 }
push $Ne1261400
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_Q.red 0 0 rgba.green 0 1 zcam_Q.green 0 1 rgba.blue 0 2 zcam_Q.blue 0 2 rgba.alpha 0 3 zcam_Q.alpha 0 3"
  name Shuffle3
  xpos -2089
  ypos 1391
 }
push $Ne1262800
 Shuffle2 {
  fromInput1 {{0} B}
  out1 zcam_h
  fromInput2 {{0} B}
  mappings "4 rgba.red 0 0 zcam_h.red 0 0 rgba.green 0 1 zcam_h.green 0 1 rgba.blue 0 2 zcam_h.blue 0 2 rgba.alpha 0 3 zcam_h.alpha 0 3"
  name Shuffle13
  xpos -2182
  ypos 1392
 }
push $Ne12e6000
 Dot {
  name Dot16
  xpos -2265
  ypos 1253
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_h
  name Copy21
  xpos -2299
  ypos 1416
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Q
  name Copy22
  xpos -2299
  ypos 1458
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_M
  name Copy20
  xpos -2298
  ypos 1505
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_J
  name Copy11
  xpos -2298
  ypos 1547
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_C
  name Copy12
  xpos -2298
  ypos 1589
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_s
  name Copy13
  xpos -2302
  ypos 1631
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Wz
  name Copy14
  xpos -2302
  ypos 1673
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Kz
  name Copy15
  xpos -2302
  ypos 1715
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Sz
  name Copy16
  xpos -2302
  ypos 1757
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_Vz
  name Copy17
  xpos -2302
  ypos 1799
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aS
  name Copy26
  xpos -2302
  ypos 1841
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bS
  name Copy27
  xpos -2302
  ypos 1883
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aC
  name Copy28
  xpos -2302
  ypos 1925
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bC
  name Copy29
  xpos -2302
  ypos 1963
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_aM
  name Copy18
  xpos -2302
  ypos 2005
 }
 Copy {
  inputs 2
  from0 -rgba.alpha
  to0 -rgba.alpha
  channels zcam_bM
  name Copy19
  xpos -2302
  ypos 2047
 }
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction1
  xpos -2302
  ypos 2112
 }
 Dot {
  name Dot17
  xpos -2268
  ypos 2157
 }
set Ne10be000 [stack 0]
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_h
  fromInput2 {{0} B}
  mappings "4 zcam_h.red 0 0 rgba.red 0 0 zcam_h.green 0 1 rgba.green 0 1 zcam_h.blue 0 2 rgba.blue 0 2 zcam_h.alpha 0 3 rgba.alpha 0 3"
  name Shuffle20
  xpos -1041
  ypos 2260
 }
 Dot {
  name Dot41
  label h
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1007
  ypos 2349
 }
 Dot {
  name Dot33
  label "h in outIn"
  xpos -1007
  ypos 2613
 }
set Ne10bd400 [stack 0]
 Dot {
  name Dot34
  xpos -1007
  ypos 2652
 }
push $Ne10bd400
 Dot {
  name Dot35
  xpos -1034
  ypos 2640
 }
push $Ne10be000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bS
  fromInput2 {{0} B}
  in2 zcam_aS
  mappings "4 zcam_bS.blue 0 2 rgba.blue 0 2 zcam_bS.alpha 0 3 rgba.alpha 0 3 zcam_bS.green 0 1 rgba.green 0 1 zcam_aS.red 1 0 rgba.red 0 0"
  name Shuffle16
  label "aS & bS"
  note_font_size 15
  xpos -1489
  ypos 2304
 }
push $Ne10be000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bC
  fromInput2 {{0} B}
  in2 zcam_aC
  mappings "4 zcam_bC.blue 0 2 rgba.blue 0 2 zcam_bC.alpha 0 3 rgba.alpha 0 3 zcam_bC.green 0 1 rgba.green 0 1 zcam_aC.red 1 0 rgba.red 0 0"
  name Shuffle17
  label "aC & bC"
  note_font_size 15
  xpos -1585
  ypos 2304
 }
push $Ne10be000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_bM
  fromInput2 {{0} B}
  in2 zcam_aM
  mappings "4 zcam_bM.blue 0 2 rgba.blue 0 2 zcam_bM.alpha 0 3 rgba.alpha 0 3 zcam_bM.green 0 1 rgba.green 0 1 zcam_aM.red 1 0 rgba.red 0 0"
  name Shuffle26
  label "aM & bM"
  note_font_size 15
  xpos -1682
  ypos 2303
 }
 Switch {
  inputs 3
  which {{parent.inverseData1}}
  name inputdata_abX_mode
  xpos -1543
  ypos 2400
 }
 Dot {
  name Dot30
  xpos -1509
  ypos 2449
 }
set Ne105f800 [stack 0]
 Dot {
  name Dot29
  xpos -1210
  ypos 2483
 }
 Expression {
  temp_name0 r2d
  temp_expr0 180.0/pi
  temp_name1 h360
  temp_expr1 "360.0\n"
  temp_name2 h
  temp_expr2 atan2(g,r)*r2d
  channel0 rgba
  expr0 h
  name inv_h
  label "   # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n            print('h:'+str(h))"
  xpos -1244
  ypos 2546
 }
 Dot {
  name Dot36
  label "a in outIn"
  xpos -1210
  ypos 2619
 }
set Ne105ec00 [stack 0]
 Dot {
  name Dot37
  xpos -1163
  ypos 2636
 }
push $Ne105ec00
 Dot {
  name Dot38
  xpos -1185
  ypos 2648
 }
push $Ne105ec00
 Dot {
  name Dot39
  xpos -1210
  ypos 2663
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode1
  label MCs
  xpos -1116
  ypos 2672
 }
 Dot {
  name Dot40
  xpos -1210
  ypos 2719
 }
set Ne105dc00 [stack 0]
push $Ne105dc00
 Expression {
  channel0 rgba
  expr0 "1.015 + cos((r + 89.038)*pi/180)"
  name inv_ez
  xpos -1244
  ypos 2756
 }
push $Ne10be000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_C
  fromInput2 {{0} B}
  mappings "4 zcam_C.red 0 0 rgba.red 0 0 zcam_C.green 0 1 rgba.green 0 1 zcam_C.blue 0 2 rgba.blue 0 2 zcam_C.alpha 0 3 rgba.alpha 0 3"
  name Shuffle21
  xpos -1357
  ypos 2252
 }
 Dot {
  name Dot42
  label C
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1323
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs2
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1357
  ypos 2501
 }
 Dot {
  name Dot43
  label "h in outIn"
  xpos -1323
  ypos 2578
 }
push $Ne10be000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_M
  fromInput2 {{0} B}
  mappings "4 zcam_M.red 0 0 rgba.red 0 0 zcam_M.green 0 1 rgba.green 0 1 zcam_M.blue 0 2 rgba.blue 0 2 zcam_M.alpha 0 3 rgba.alpha 0 3"
  name Shuffle19
  xpos -1442
  ypos 2252
 }
 Dot {
  name Dot31
  label M
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1408
  ypos 2341
 }
 Expression {
  channel0 rgba
  expr0 r
  name MCs1
  label "        elif 'h' in outin:\n            h = data\[...,2]\n            MCs = data\[...,1]  "
  xpos -1442
  ypos 2501
 }
 Dot {
  name Dot25
  label "h in outIn"
  xpos -1408
  ypos 2575
 }
push $Ne105f800
 Expression {
  channel0 rgba
  expr0 "(r**2.0 + g**2.0)**0.5"
  name MCs
  label "  if 'a' in outin\[1]: \n            # calculate hue h:\n            h = hue_angle(data\[...,1],data\[...,2], htype = 'deg')\n        \n            #--------------------------------------------\n            # calculate Colorfulness M or Chroma C or Saturation s from a,b:\n            MCs = (data\[...,1]**2.0 + data\[...,2]**2.0)**0.5  \n            print('MCs:'+str(MCs))"
  xpos -1645
  ypos 2460
 }
 Dot {
  name Dot24
  label "a in outIn"
  xpos -1611
  ypos 2581
 }
set N2c462c00 [stack 0]
 Dot {
  name Dot28
  xpos -1564
  ypos 2598
 }
push $N2c462c00
 Dot {
  name Dot27
  xpos -1586
  ypos 2610
 }
push $N2c462c00
 Dot {
  name Dot26
  xpos -1611
  ypos 2625
 }
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inverseData1_Mode
  label MCs
  xpos -1517
  ypos 2634
 }
set Ne11ddd00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r
  name C_from_aC
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -1926
  ypos 2710
 }
set N2c461c00 [stack 0]
 Dot {
  name Dot44
  label C,h
  xpos -1673
  ypos 2768
 }
push $Ne11ddd00
 Expression {
  channel0 rgba
  expr0 100*r/Constants.Qw
  name C_from_aM
  label "        if ('aM' in outin) | ('M' in outin): \n            C = 100*MCs/Qw"
  xpos -2032
  ypos 2710
 }
set N2c461400 [stack 0]
 Dot {
  name Dot20
  label M,h
  xpos -1737
  ypos 2767
 }
push $Ne11ddd00
push $Ne10be000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Q
  fromInput2 {{0} B}
  mappings "4 zcam_Q.red 0 0 rgba.red 0 0 zcam_Q.green 0 1 rgba.green 0 1 zcam_Q.blue 0 2 rgba.blue 0 2 zcam_Q.alpha 0 3 rgba.alpha 0 3"
  name Shuffle18
  xpos -2182
  ypos 2257
 }
 Dot {
  name Dot21
  label Q
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1996
  ypos 2435
 }
set N2c460800 [stack 0]
push $Ne10be000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_J
  fromInput2 {{0} B}
  mappings "4 zcam_J.red 0 0 rgba.red 0 0 zcam_J.green 0 1 rgba.green 0 1 zcam_J.blue 0 2 rgba.blue 0 2 zcam_J.alpha 0 3 rgba.alpha 0 3"
  name Shuffle14
  xpos -2302
  ypos 2259
 }
 Dot {
  name Dot8
  label J
  note_font_size 20
  note_font_color 0x677754ff
  xpos -2229
  ypos 2434
 }
 Dot {
  name Dot22
  xpos -2229
  ypos 2456
 }
set N2c41b800 [stack 0]
 Expression {
  channel0 rgba
  expr0 Constants.Qw*(r/100)
  name Q_from_J
  label "# Get Lightness J and brightness Q from data:"
  xpos -2263
  ypos 2519
 }
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode
  label Q
  xpos -2263
  ypos 2564
 }
set Ne11dd600 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy30
  xpos -1818
  ypos 2676
 }
 Expression {
  temp_name0 M
  temp_expr0 "r * (g / Constants.FL**0.6 / 100)**2"
  channel0 rgba
  expr0 100*M/Constants.Qw
  name C_from_aS
  label "        if ('aS' in outin) | ('S' in outin):\n            M = Q * (MCs / FL**0.6 / 100)**2 \n            C = 100*M/Qw"
  xpos -1814
  ypos 2705
 }
push $N2c461c00
push $N2c461400
 Switch {
  inputs 5
  which {{parent.inverseData1}}
  name inputdata_abX_mode1
  xpos -1926
  ypos 2799
 }
 Expression {
  channel0 rgba
  expr0 "Constants.Qw * r / 100"
  name inv_M
  label "        #--------------------------------------------\n        # Calculate colorfulness, M:\n        M = Qw * C / 100\n        "
  selected true
  xpos -1543
  ypos 2822
 }
set N2c41a800 [stack 0]
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy7
  xpos -1543
  ypos 2874
 }
 Expression {
  channel0 rgba
  expr0 "(((r/100) * (Constants.iabzw.r**0.78) * (Constants.Fb**0.1))/((g**0.068)*(Constants.FL**0.2)))**(1/0.37/2)"
  name inv_t
  label "       #--------------------------------------------\n        # calculate t (=sqrt(a**2+b**2)) from M:\n        t = (((M/100) * (iabzw\[...,0]**0.78) * (Fb**0.1))/((ez**0.068)*(FL**0.2)))**(1/0.37/2)"
  xpos -1543
  ypos 2906
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy8
  xpos -1543
  ypos 2985
 }
set N2c419c00 [stack 0]
 Expression {
  channel0 rgba
  expr0 r*sin(g*pi/180)
  name inv_bz
  label t*np.sin(h*np.pi/180)
  xpos -1402
  ypos 3067
 }
push $N2c419c00
 Expression {
  channel0 rgba
  expr0 r*cos(g*pi/180)
  name inv_az
  label "az = t*np.cos(h*np.pi/180)"
  xpos -1543
  ypos 3064
 }
push $Ne11dd600
 Expression {
  channel0 rgba
  expr0 (r/(2700*(Constants.Fs**2.2)*(Constants.Fb**0.5)*(Constants.FL**0.2)))**((Constants.Fb**0.12)/(1.6*Constants.Fs))
  name inv_Iz
  label "# calculate achromatic signal, Iz:"
  xpos -2263
  ypos 2619
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy9
  xpos -2181
  ypos 3184
 }
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy10
  xpos -2181
  ypos 3216
 }
 Dot {
  name Dot15
  label iabz
  note_font_size 20
  xpos -2147
  ypos 3275
 }
 Dot {
  name Dot13
  xpos -2145
  ypos 3414
 }
 Dot {
  name Dot14
  xpos -2145
  ypos 3470
 }
set N2c39b800 [stack 0]
 Expression {
  expr0 "(r + 1.6295499532821566e-11)/(1 - 0.56*(1 - (r + 1.6295499532821566e-11)))"
  name Expression3
  label "   # Convert Jz to Iz:\n    if ztype == 'jabz':\n        jabz\[...,0] = (jabz\[...,0] + 1.6295499532821566e-11)/(1 - 0.56*(1 - (jabz\[...,0] + 1.6295499532821566e-11)))\n"
  xpos -2050
  ypos 3532
 }
push $N2c39b800
 Switch {
  inputs 2
  name use_zcam_parameters2
  label "# convert Iabz' to Jabz coordinates:\n    if ztype == 'jabz':"
  xpos -2179
  ypos 3608
 }
set Ne11dc800 [stack 0]
 Dot {
  name Dot19
  label Iabz
  xpos -2092
  ypos 3678
 }
 Add {
  value 3.703522621e-11
  name Add2
  label "Iabz\[...,0]-=epsilon # correct to ensure zero output"
  xpos -2126
  ypos 3712
 }
 ColorMatrix {
  matrix {
      {0 1 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_ZCAM1
  xpos -2126
  ypos 3750
 }
push $Ne11dc800
 Dot {
  name Dot18
  label Iabz
  xpos -2216
  ypos 3683
 }
 ColorMatrix {
  matrix {
      {0.5 0.5 0}
      {3.524 -4.066708 0.542708}
      {0.199076 1.096799 -1.295875}
    }
  invert true
  name _M_LMSP_TO_IAB_JABZ1
  xpos -2250
  ypos 3748
 }
 Switch {
  inputs 2
  which 1
  name use_zcam_parameters3
  xpos -2182
  ypos 3844
 }
 Expression {
  expr0 "10000*((c1 - r**(1/p)) / ((c3*r**(1/p)) - c2))**(1/n)"
  expr1 "10000*((c1 - g**(1/p)) / ((c3*g**(1/p)) - c2))**(1/n)"
  expr2 "10000*((c1 - b**(1/p)) / ((c3*b**(1/p)) - c2))**(1/n)"
  name Expression4
  label "        \n    # Convert lmsp to lms:\n    c1, c2, c3, n, p = \[_PQ_PARAMETERS\[x] for x in sorted(_PQ_PARAMETERS.keys())]\n    lms = 10000*((c1 - lmsp**(1/p)) / ((c3*lmsp**(1/p)) - c2))**(1/n)\n   "
  xpos -2182
  ypos 3874
  addUserKnob {20 _PQ_PARAMETERS}
  addUserKnob {7 c1}
  c1 {{3424/2**12}}
  addUserKnob {7 c2}
  c2 {{2413/2**7}}
  addUserKnob {7 c3}
  c3 {{2392/2**7}}
  addUserKnob {7 n}
  n {{2610/2**14}}
  addUserKnob {7 p}
  p {{1.7*2523/2**5}}
 }
 ColorMatrix {
  matrix {
      {0.41478972 0.579999 0.014648}
      {-0.20151 1.120649 0.0531008}
      {-0.0166008 0.2648 0.6684799}
    }
  invert true
  name _M_XYZP_TO_LMS1
  label "# Define X',Y',Z' to L,M,S conversion matrix:"
  xpos -2182
  ypos 3949
 }
 ColorMatrix {
  matrix {
      {{b} 0 {1-b}}
      {{1-g} {g} 0}
      {0 0 1}
    }
  invert true
  name M_to_xyzp1
  label " # Setup X,Y,Z to X',Y',Z' transform as matrix:\n    b = 1.15 \n    g = 0.66\n\n    M_to_xyzp = np.array(\[\[b, 0, 1 - b],\[1 - g, g, 0],\[0, 0, 1]])"
  xpos -2182
  ypos 3981
  addUserKnob {20 User}
  addUserKnob {7 b}
  b 1.15
  addUserKnob {7 g}
  g 0.66
 }
push $Ne10be000
 Switch {
  inputs 2
  which {{parent.direction}}
  name direction
  xpos -1519
  ypos 4172
 }
 Output {
  name Output1
  xpos -1519
  ypos 4272
 }
push $Ne10be000
 Dot {
  name Dot11
  label aM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1535
  ypos 2170
 }
push $Ne10be000
 Dot {
  name Dot12
  label bM
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1439
  ypos 2173
 }
push $Ne11dd600
push $Ne10be000
 Shuffle2 {
  fromInput1 {{0} B}
  in1 zcam_Sz
  fromInput2 {{0} B}
  mappings "4 zcam_Sz.red 0 0 rgba.red 0 0 zcam_Sz.green 0 1 rgba.green 0 1 zcam_Sz.blue 0 2 rgba.blue 0 2 zcam_Sz.alpha 0 3 rgba.alpha 0 3"
  name Shuffle15
  xpos -1870
  ypos 2254
 }
 Dot {
  name Dot10
  label Sz
  note_font_size 20
  note_font_color 0x677754ff
  xpos -1836
  ypos 2342
 }
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy4
  xpos -1770
  ypos 2555
 }
 Expression {
  expr0 "(g / Constants.Qw) * Constants.MCs**2 / FL**1.2 / 100"
  name inv_C
  label "if ('Sz' in outin) | ('aSz' in outin):  # saturation"
  xpos -1770
  ypos 2587
 }
push $Ne105f800
 Dot {
  name Dot23
  label "H in outIn"
  xpos -1509
  ypos 2582
 }
 Dot {
  inputs 0
  name Dot32
  label "H in outIn"
  xpos -1108
  ypos 2620
 }
push $N2c460800
 Expression {
  channel0 rgba
  expr0 "100.0* (r/Constants.Qw)"
  name J_from_Q
  xpos -2030
  ypos 2479
 }
push $N2c41b800
 Switch {
  inputs 2
  which {{parent.inverseData0}}
  name InverseData0_Mode1
  label J
  xpos -2030
  ypos 2527
 }
push $Ne11ddd00
 Copy {
  inputs 2
  from0 rgba.green
  to0 rgba.green
  name Copy23
  xpos -1596
  ypos 2681
 }
 Expression {
  channel0 rgba
  expr0 "(((100-r))**2 - (100 - g)**2)**0.5"
  name inv3_C
  label "if ('Wz' in outin) | ('aWz' in outin): #whiteness\n            C = (((100-MCs))**2 - (100 - J)**2)**0.5"
  xpos -1596
  ypos 2713
 }
 Constant {
  inputs 0
  channels rgb
  color 0.034705
  name Constant1
  xpos -440
  ypos 2450
 }
push $N2c461400
push $N2c41a800
 Viewer {
  inputs 2
  frame 78
  frame_range 1-480
  gain 0.015625
  colour_sample_bbox {0.00390625 -0.1640625 0.005859375 -0.162109375}
  name Viewer1
  xpos -2115
  ypos 2819
 }
end_group
Multiply {
 value 0.01
 name Multiply13
 label "Div by 100 to go from nits"
 xpos -156
 ypos 1330
}
Shuffle2 {
 fromInput1 {{0} B}
 fromInput2 {{0} B}
 mappings "4 rgba.red 0 0 rgba.red 0 0 rgba.green 0 1 rgba.green 0 1 rgba.blue 0 2 rgba.blue 0 2 white -1 -1 rgba.alpha 0 3"
 name Shuffle48
 xpos -156
 ypos 1372
}
Colorspace {
 colorspace_in CIE-XYZ
 name Colorspace35
 label "XYZ to sRGB Prims"
 xpos -156
 ypos 1396
}
Dot {
 name Dot12
 xpos -122
 ypos 1445
}
set N2c338c00 [stack 0]
Dot {
 name Dot18
 xpos 5
 ypos 1471
}
set N2c338800 [stack 0]
Expression {
 channel0 rgba
 expr0 min((r<0?0:1),(g<0?0:1),(b<0?0:1))
 name Expression18
 xpos -72
 ypos 1496
}
push $N2c338800
Expression {
 channel0 rgba
 expr0 min((r>1?0:1),(g>1?0:1),(b>1?0:1))
 name Expression19
 xpos 33
 ypos 1494
}
Merge2 {
 inputs 2
 operation multiply
 name Multiply18
 xpos -30
 ypos 1526
}
push $N2c338c00
Copy {
 inputs 2
 from0 rgba.alpha
 to0 rgba.alpha
 name Copy6
 xpos -156
 ypos 1582
}
Premult {
 name Premult3
 xpos -156
 ypos 1614
}
Dot {
 name Dot19
 xpos -122
 ypos 1721
}
push $N2c2de800
Merge2 {
 inputs 2
 name Merge2
 xpos -8
 ypos 1794
}
Write {
 file /Users/afry/GitHub/nukeZCAM/images/gamutBounds/JMh_sRGBgamutBound_tempImg.exr
 file_type exr
 first_part rgba
 version 3099
 name Write11
 xpos -8
 ypos 1832
 addUserKnob {20 User}
 addUserKnob {22 recursiveWrite T "writeNode = nuke.thisNode()\nmergeNode = writeNode.input(0)\nreadNode = writeNode.input(0).input(0)\n\nwriteNode.setInput(0,writeNode.input(0).input(1))\nnuke.execute(writeNode, 0, 0)\nreadNode.knob('reload').execute()\nwriteNode.setInput(0,mergeNode)\n\n\nfor i in range(0,1024):\n    nuke.execute(writeNode, i, i)\n    readNode.knob('reload').execute()" +STARTLINE}
}
Colorspace {
 inputs 0
 primary_out DCI-P3
 name VIEWER_INPUT
 xpos -496
 ypos -580
}
push $N5d174800
push $N5dcfc800
Viewer {
 inputs 2
 frame 78
 frame_range 1-480
 colour_sample_bbox {-0.1260416657 -0.8125 -0.125 -0.8114583492}
 samplepoints {{1.416015625 -0.658203125}
   }
 gl_buffer_depth half-float
 translate {-1.083500028 -0.07800000161}
 name Viewer1
 xpos 1207
 ypos 64
}
